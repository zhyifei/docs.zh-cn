### <a name="sslstream-supports-tls-alerts"></a><span data-ttu-id="56ac4-101">SslStream 支持 TLS 警报</span><span class="sxs-lookup"><span data-stu-id="56ac4-101">SslStream supports TLS Alerts</span></span>

|   |   |
|---|---|
|<span data-ttu-id="56ac4-102">详细信息</span><span class="sxs-lookup"><span data-stu-id="56ac4-102">Details</span></span>|<span data-ttu-id="56ac4-103">TLS 握手失败后，第一个 I/O 读取/写入操作将引发带有内部 <xref:System.ComponentModel.Win32Exception?displayProperty=name> 异常的 <xref:System.IO.IOException?displayProperty=name>。</span><span class="sxs-lookup"><span data-stu-id="56ac4-103">After a failed TLS handshake, an <xref:System.IO.IOException?displayProperty=name> with an inner <xref:System.ComponentModel.Win32Exception?displayProperty=name> exception will be thrown by the first I/O Read/Write operation.</span></span> <span data-ttu-id="56ac4-104">可使用此 [Schannel 文档](https://msdn.microsoft.com/library/windows/desktop/dd721886%28v=vs.85%29.aspx)将 <xref:System.ComponentModel.Win32Exception?displayProperty=name> 的 <xref:System.ComponentModel.Win32Exception.NativeErrorCode?displayProperty=name> 代码映射到远程参与方的 TLS 警报。有关详细信息，请参阅 [RFC 2246：第 7.2.2 节：错误警报](https://tools.ietf.org/html/rfc2246#section-7.2.2)。 .NET 4.6.2 及以下版本中的行为是，如果另一方握手失败并随后立即拒绝连接，则传输通道（通常是 TCP 连接）将在写入或读取期间超时。</span><span class="sxs-lookup"><span data-stu-id="56ac4-104">The <xref:System.ComponentModel.Win32Exception.NativeErrorCode?displayProperty=name> code for the <xref:System.ComponentModel.Win32Exception?displayProperty=name> can be mapped to the TLS Alert from the remote party using this [Schannel documentation](https://msdn.microsoft.com/library/windows/desktop/dd721886%28v=vs.85%29.aspx).For more information, see [RFC 2246: Section 7.2.2 Error alerts](https://tools.ietf.org/html/rfc2246#section-7.2.2)The behavior in .NET 4.6.2 and below is that the transport channel (usually TCP connection) will timeout during either Write or Read if the other party failed the handshake and immediately afterwards rejected the connection.</span></span>|
|<span data-ttu-id="56ac4-105">建议</span><span class="sxs-lookup"><span data-stu-id="56ac4-105">Suggestion</span></span>|<span data-ttu-id="56ac4-106">调用网络 I/O API 的应用程序（例如 <xref:System.IO.Stream.Read(System.Byte[],System.Int32,System.Int32)>/<xref:System.IO.Stream.Write(System.Byte[],System.Int32,System.Int32)>）应处理 <xref:System.IO.IOException> 或 <xref:System.TimeoutException?displayProperty=name>。默认情况下，从 .NET 4.7 开始启用 TLS 警报功能。</span><span class="sxs-lookup"><span data-stu-id="56ac4-106">Applications calling network I/O APIs such as <xref:System.IO.Stream.Read(System.Byte[],System.Int32,System.Int32)>/<xref:System.IO.Stream.Write(System.Byte[],System.Int32,System.Int32)> should handle <xref:System.IO.IOException> or <xref:System.TimeoutException?displayProperty=name>.The TLS Alerts feature is enabled by default starting with .NET 4.7.</span></span> <span data-ttu-id="56ac4-107">在 .NET 4.7 或更高版本系统上运行的面向 .NET 4.0 - .NET 4.6.2 的应用程序将禁用该功能以保持兼容性。下列配置 API 可用于为在 .NET 4.7 或更高版本的框架上运行的 .NET 4.6 及更高版本应用程序启用或禁用该功能。</span><span class="sxs-lookup"><span data-stu-id="56ac4-107">Applications targeting .NET 4.0 - .NET 4.6.2 running on a .NET 4.7 or higher system will have the feature disabled to preserve compatibility.The following configuration API is available to enable or disable the feature for .NET 4.6 and above applications running on .NET 4.7 or higher framework.</span></span><ul><li><span data-ttu-id="56ac4-108">以编程方式：</span><span class="sxs-lookup"><span data-stu-id="56ac4-108">Programmatically:</span></span></li></ul><span data-ttu-id="56ac4-109">必须是应用程序执行的第一件事，因为 ServicePointManager 将只初始化一次：</span><span class="sxs-lookup"><span data-stu-id="56ac4-109">Must be the very first thing the application does since ServicePointManager will initialize only once:</span></span><pre><code class="language-C#">AppContext.SetSwitch(&quot;TestSwitch.LocalAppContext.DisableCaching&quot;, true);&#13;&#10;AppContext.SetSwitch(&quot;Switch.System.Net.DontEnableTlsAlerts&quot;, true); // Set to &#39;false&#39; to enable the feature in .NET 4.6 - 4.6.2.&#13;&#10;</code></pre><ul><li><span data-ttu-id="56ac4-110">AppConfig：</span><span class="sxs-lookup"><span data-stu-id="56ac4-110">AppConfig:</span></span></li></ul><pre><code class="language-XML">&lt;runtime&gt;&#13;&#10;&lt;AppContextSwitchOverrides value=&quot;Switch.System.Net.DontEnableTlsAlerts=true&quot;/&gt;&#13;&#10;&lt;!-- Set to &#39;false&#39; to enable the feature in .NET 4.6 - 4.6.2. --&gt;&#13;&#10;&lt;/runtime&gt;&#13;&#10;</code></pre><ul><li><span data-ttu-id="56ac4-111">注册表项（计算机全局）：</span><span class="sxs-lookup"><span data-stu-id="56ac4-111">Registry key (machine global):</span></span></li></ul><span data-ttu-id="56ac4-112">将值设置为“false”以在 .NET 4.6 - 4.6.2 中启用该功能。</span><span class="sxs-lookup"><span data-stu-id="56ac4-112">Set the Value to 'false' to enable the feature in .NET 4.6 - 4.6.2.</span></span><pre><code>Key = HKLM\SOFTWARE\[Wow6432Node\]Microsoft\.NETFramework\AppContext\Switch.System.Net.DontEnableTlsAlerts&#13;&#10;Type = String&#13;&#10;Value = &quot;true&quot;&#13;&#10;</code></pre>|
|<span data-ttu-id="56ac4-113">范围</span><span class="sxs-lookup"><span data-stu-id="56ac4-113">Scope</span></span>|<span data-ttu-id="56ac4-114">边缘</span><span class="sxs-lookup"><span data-stu-id="56ac4-114">Edge</span></span>|
|<span data-ttu-id="56ac4-115">版本</span><span class="sxs-lookup"><span data-stu-id="56ac4-115">Version</span></span>|<span data-ttu-id="56ac4-116">4.7</span><span class="sxs-lookup"><span data-stu-id="56ac4-116">4.7</span></span>|
|<span data-ttu-id="56ac4-117">类型</span><span class="sxs-lookup"><span data-stu-id="56ac4-117">Type</span></span>|<span data-ttu-id="56ac4-118">重定目标</span><span class="sxs-lookup"><span data-stu-id="56ac4-118">Retargeting</span></span>|
|<span data-ttu-id="56ac4-119">受影响的 API</span><span class="sxs-lookup"><span data-stu-id="56ac4-119">Affected APIs</span></span>|<ul><li><xref:System.Net.Security.SslStream?displayProperty=nameWithType></li><li><xref:System.Net.WebRequest?displayProperty=nameWithType></li><li><xref:System.Net.HttpWebRequest?displayProperty=nameWithType></li><li><xref:System.Net.FtpWebRequest?displayProperty=nameWithType></li><li><xref:System.Net.Mail.SmtpClient?displayProperty=nameWithType></li><li><xref:System.Net.Http?displayProperty=nameWithType></li></ul>|

