---
title: "演练：在 Win32 中承载 WPF 内容"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-wpf
ms.tgt_pltfrm: 
ms.topic: article
dev_langs: cpp
helpviewer_keywords: hosting WPF content in Win32 window [WPF]
ms.assetid: 38ce284a-4303-46dd-b699-c9365b22a7dc
caps.latest.revision: "24"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: fce70ab1571602fb046d3ccde9e7c014834ae6a0
ms.sourcegitcommit: 4f3fef493080a43e70e951223894768d36ce430a
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/21/2017
---
# <a name="walkthrough-hosting-wpf-content-in-win32"></a><span data-ttu-id="d366d-102">演练：在 Win32 中承载 WPF 内容</span><span class="sxs-lookup"><span data-stu-id="d366d-102">Walkthrough: Hosting WPF Content in Win32</span></span>
[!INCLUDE[TLA#tla_winclient](../../../../includes/tlasharptla-winclient-md.md)]<span data-ttu-id="d366d-103"> 提供了用于创建应用程序的丰富环境。</span><span class="sxs-lookup"><span data-stu-id="d366d-103"> provides a rich environment for creating applications.</span></span> <span data-ttu-id="d366d-104">但是，当你对 [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] 代码有大量投入时，向应用程序添加 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 功能（而不是重写原始代码）可能更有效。</span><span class="sxs-lookup"><span data-stu-id="d366d-104">However, when you have a substantial investment in [!INCLUDE[TLA#tla_win32](../../../../includes/tlasharptla-win32-md.md)] code, it might be more effective to add [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] functionality to your application rather than rewriting your original code.</span></span> [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="d366d-105">提供用于承载的简单机制[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中的内容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]窗口。</span><span class="sxs-lookup"><span data-stu-id="d366d-105"> provides a straightforward mechanism for hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span>  
  
 <span data-ttu-id="d366d-106">本教程介绍如何编写的示例应用， [Win32 窗口示例中承载 WPF 内容](http://go.microsoft.com/fwlink/?LinkID=160004)，则该主机[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中的内容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]窗口。</span><span class="sxs-lookup"><span data-stu-id="d366d-106">This tutorial describes how to write a sample application, [Hosting WPF Content in a Win32 Window Sample](http://go.microsoft.com/fwlink/?LinkID=160004), that hosts [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="d366d-107">你可以扩展此示例，使其可托管任何 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 窗口。</span><span class="sxs-lookup"><span data-stu-id="d366d-107">You can extend this sample to host any [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="d366d-108">由于涉及混合托管代码和非托管代码，应用程序是在 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 中编写的。</span><span class="sxs-lookup"><span data-stu-id="d366d-108">Because it involves mixing managed and unmanaged code, the application is written in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span>  
  
 
  
<a name="requirements"></a>   
## <a name="requirements"></a><span data-ttu-id="d366d-109">要求</span><span class="sxs-lookup"><span data-stu-id="d366d-109">Requirements</span></span>  
 <span data-ttu-id="d366d-110">本教程假定你已基本熟悉 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 和 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 编程。</span><span class="sxs-lookup"><span data-stu-id="d366d-110">This tutorial assumes a basic familiarity with both [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] and [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programming.</span></span> <span data-ttu-id="d366d-111">有关的基本介绍[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]编程，请参阅[入门](../../../../docs/framework/wpf/getting-started/index.md)。</span><span class="sxs-lookup"><span data-stu-id="d366d-111">For a basic introduction to [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming, see [Getting Started](../../../../docs/framework/wpf/getting-started/index.md).</span></span> <span data-ttu-id="d366d-112">有关的简介[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]编程，你应引用的任何有关该主题的很多书籍尤其*编程 Windows* Charles Petzold 通过。</span><span class="sxs-lookup"><span data-stu-id="d366d-112">For an introduction to [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] programming, you should reference any of the numerous books on the subject, in particular *Programming Windows* by Charles Petzold.</span></span>  
  
 <span data-ttu-id="d366d-113">因为附带本教程的示例中实现[!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)]，本教程假定你熟悉使用[!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)]到程序[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)][!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)]编程，并且托管的代码编程的了解。</span><span class="sxs-lookup"><span data-stu-id="d366d-113">Because the sample that accompanies this tutorial is implemented in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)], this tutorial assumes familiarity with the use of [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] to program the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)][!INCLUDE[TLA2#tla_api](../../../../includes/tla2sharptla-api-md.md)] plus an understanding of managed code programming.</span></span> <span data-ttu-id="d366d-114">熟悉 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 将有所帮助，但并非必备条件。</span><span class="sxs-lookup"><span data-stu-id="d366d-114">Familiarity with [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] is helpful but not essential.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d366d-115">本教程包括来自相关示例的一些代码示例。</span><span class="sxs-lookup"><span data-stu-id="d366d-115">This tutorial includes a number of code examples from the associated sample.</span></span> <span data-ttu-id="d366d-116">但是，出于可读性考虑，不包括完整的示例代码。</span><span class="sxs-lookup"><span data-stu-id="d366d-116">However, for readability, it does not include the complete sample code.</span></span> <span data-ttu-id="d366d-117">有关完整的示例代码，请参阅[承载内容 Win32 窗口示例中的 WPF](http://go.microsoft.com/fwlink/?LinkID=160004)。</span><span class="sxs-lookup"><span data-stu-id="d366d-117">For the complete sample code, see [Hosting WPF Content in a Win32 Window Sample](http://go.microsoft.com/fwlink/?LinkID=160004).</span></span>  
  
<a name="basic_procedure"></a>   
## <a name="the-basic-procedure"></a><span data-ttu-id="d366d-118">基本过程</span><span class="sxs-lookup"><span data-stu-id="d366d-118">The Basic Procedure</span></span>  
 <span data-ttu-id="d366d-119">本部分概述了你使用的基本过程主机[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中的内容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]窗口。</span><span class="sxs-lookup"><span data-stu-id="d366d-119">This section outlines the basic procedure you use to host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window.</span></span> <span data-ttu-id="d366d-120">其余章节说明每个步骤的详细内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-120">The remaining sections explain the details of each step.</span></span>  
  
 <span data-ttu-id="d366d-121">承载的关键[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容上[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]窗口<xref:System.Windows.Interop.HwndSource>类。</span><span class="sxs-lookup"><span data-stu-id="d366d-121">The key to hosting [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content on a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window is the <xref:System.Windows.Interop.HwndSource> class.</span></span> <span data-ttu-id="d366d-122">此类将包装[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中的内容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]窗口中，使其能够被合并到你[!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)]用作子窗口。</span><span class="sxs-lookup"><span data-stu-id="d366d-122">This class wraps the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window, allowing it to be incorporated into your [!INCLUDE[TLA#tla_ui](../../../../includes/tlasharptla-ui-md.md)] as a child window.</span></span> <span data-ttu-id="d366d-123">以下方法在单个应用程序中合并 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 和 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d366d-123">The following approach combines the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] and [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] in a single application.</span></span>  
  
1.  <span data-ttu-id="d366d-124">实现你[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容为托管类。</span><span class="sxs-lookup"><span data-stu-id="d366d-124">Implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content as a managed class.</span></span>  
  
2.  <span data-ttu-id="d366d-125">使用 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 实现 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 应用程序。</span><span class="sxs-lookup"><span data-stu-id="d366d-125">Implement a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application with [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span> <span data-ttu-id="d366d-126">如果从现有应用程序和非托管 [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] 代码开始，你通常可以通过更改项目设置以包括 `/clr` 编译器标志来使其可以调用托管代码。</span><span class="sxs-lookup"><span data-stu-id="d366d-126">If you are starting with an existing application and unmanaged [!INCLUDE[TLA#tla_cpp](../../../../includes/tlasharptla-cpp-md.md)] code, you can usually enable it to call managed code by changing your project settings to include the `/clr` compiler flag.</span></span>  
  
3.  <span data-ttu-id="d366d-127">将线程处理模型设置为单线程单元 (STA)。</span><span class="sxs-lookup"><span data-stu-id="d366d-127">Set the threading model to single-threaded apartment (STA).</span></span>  
  
4.  <span data-ttu-id="d366d-128">处理[WM_CREATE](http://msdn.microsoft.com/library/ms632619.aspx)窗口过程并执行以下中的通知：</span><span class="sxs-lookup"><span data-stu-id="d366d-128">Handle the [WM_CREATE](http://msdn.microsoft.com/library/ms632619.aspx)notification in your window procedure and do the following:</span></span>  
  
    1.  <span data-ttu-id="d366d-129">创建一个新的 <xref:System.Windows.Interop.HwndSource> 对象，将父窗口用作其 `parent` 参数。</span><span class="sxs-lookup"><span data-stu-id="d366d-129">Create a new <xref:System.Windows.Interop.HwndSource> object with the parent window as its `parent` parameter.</span></span>  
  
    2.  <span data-ttu-id="d366d-130">创建 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容类的一个实例。</span><span class="sxs-lookup"><span data-stu-id="d366d-130">Create an instance of your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class.</span></span>  
  
    3.  <span data-ttu-id="d366d-131">为分配一个引用[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]到的内容对象<xref:System.Windows.Interop.HwndSource.RootVisual%2A>属性<xref:System.Windows.Interop.HwndSource>。</span><span class="sxs-lookup"><span data-stu-id="d366d-131">Assign a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object to the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource>.</span></span>  
  
    4.  <span data-ttu-id="d366d-132">获取该内容的 HWND。</span><span class="sxs-lookup"><span data-stu-id="d366d-132">Get the HWND for the content.</span></span> <span data-ttu-id="d366d-133"><xref:System.Windows.Interop.HwndSource.Handle%2A> 对象的 <xref:System.Windows.Interop.HwndSource> 属性包含窗口句柄 (HWND)。</span><span class="sxs-lookup"><span data-stu-id="d366d-133">The <xref:System.Windows.Interop.HwndSource.Handle%2A> property of the <xref:System.Windows.Interop.HwndSource> object contains the window handle (HWND).</span></span> <span data-ttu-id="d366d-134">要获取可在应用程序的非托管部分中使用的 HWND，需将 `Handle.ToPointer()` 强制装换为 HWND。</span><span class="sxs-lookup"><span data-stu-id="d366d-134">To get an HWND that you can use in the unmanaged part of your application, cast `Handle.ToPointer()` to an HWND.</span></span>  
  
5.  <span data-ttu-id="d366d-135">实现一个托管类，该类包含一个用于保存对 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容的引用的静态字段。</span><span class="sxs-lookup"><span data-stu-id="d366d-135">Implement a managed class that contains a static field to hold a reference to your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d366d-136">该类使你可以从 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 代码获取对 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 内容的引用。</span><span class="sxs-lookup"><span data-stu-id="d366d-136">This class allows you to get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code.</span></span>  
  
6.  <span data-ttu-id="d366d-137">向静态字段分配 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-137">Assign the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to the static field.</span></span>  
  
7.  <span data-ttu-id="d366d-138">接收来自通知[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]通过将处理程序附加到一个或多个内容[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]事件。</span><span class="sxs-lookup"><span data-stu-id="d366d-138">Receive notifications from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content by attaching a handler to one or more of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] events.</span></span>  
  
8.  <span data-ttu-id="d366d-139">通过使用存储在静态字段中用于设置属性等的引用来与 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容通信。</span><span class="sxs-lookup"><span data-stu-id="d366d-139">Communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content by using the reference that you stored in the static field to set properties, and so on.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d366d-140">你还可以使用[!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)]实现你[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-140">You can also use [!INCLUDE[TLA#tla_xaml](../../../../includes/tlasharptla-xaml-md.md)] to implement your [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d366d-141">但是，你必须将其作为 [!INCLUDE[TLA#tla_dll](../../../../includes/tlasharptla-dll-md.md)] 单独编译并从 [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] 应用程序引用 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d366d-141">However, you will have to compile it separately as a [!INCLUDE[TLA#tla_dll](../../../../includes/tlasharptla-dll-md.md)] and reference that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application.</span></span> <span data-ttu-id="d366d-142">该过程的其余部分与上述相似。</span><span class="sxs-lookup"><span data-stu-id="d366d-142">The remainder of the procedure is similar to that outlined above.</span></span>  
  
<a name="implementing_the_application"></a>   
## <a name="implementing-the-host-application"></a><span data-ttu-id="d366d-143">实现主机应用程序</span><span class="sxs-lookup"><span data-stu-id="d366d-143">Implementing the Host Application</span></span>  
 <span data-ttu-id="d366d-144">本部分介绍如何主机[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中基本的内容[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]应用程序。</span><span class="sxs-lookup"><span data-stu-id="d366d-144">This section describes how to host [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in a basic [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application.</span></span> <span data-ttu-id="d366d-145">该内容本身是在 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 中作为托管类实现的。</span><span class="sxs-lookup"><span data-stu-id="d366d-145">The content itself is implemented in [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] as a managed class.</span></span> <span data-ttu-id="d366d-146">大多数情况下，它是简单的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 编程。</span><span class="sxs-lookup"><span data-stu-id="d366d-146">For the most part, it is straightforward [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] programming.</span></span> <span data-ttu-id="d366d-147">讨论内容实现的关键方面[实现 WPF 内容](#implementing_the_wpf_page)。</span><span class="sxs-lookup"><span data-stu-id="d366d-147">The key aspects of the content implementation are discussed in [Implementing the WPF Content](#implementing_the_wpf_page).</span></span>  
  
<a name="autoNestedSectionsOUTLINE1"></a>   
-   [<span data-ttu-id="d366d-148">基本应用程序</span><span class="sxs-lookup"><span data-stu-id="d366d-148">The Basic Application</span></span>](#the_basic_application)  
  
-   [<span data-ttu-id="d366d-149">承载 WPF 内容</span><span class="sxs-lookup"><span data-stu-id="d366d-149">Hosting the WPF Content</span></span>](#hosting_the_wpf_page)  
  
-   [<span data-ttu-id="d366d-150">保存对 WPF 内容的引用</span><span class="sxs-lookup"><span data-stu-id="d366d-150">Holding a Reference to the WPF Content</span></span>](#holding_a_reference)  
  
-   [<span data-ttu-id="d366d-151">与 WPF 内容通信</span><span class="sxs-lookup"><span data-stu-id="d366d-151">Communicating with the WPF Content</span></span>](#communicating_with_the_page)  
  
<a name="the_basic_application"></a>   
### <a name="the-basic-application"></a><span data-ttu-id="d366d-152">基本应用程序</span><span class="sxs-lookup"><span data-stu-id="d366d-152">The Basic Application</span></span>  
 <span data-ttu-id="d366d-153">主机应用程序的起点是创建 [!INCLUDE[TLA#tla_visualstu2005](../../../../includes/tlasharptla-visualstu2005-md.md)] 模板。</span><span class="sxs-lookup"><span data-stu-id="d366d-153">The starting point for the host application was to create a [!INCLUDE[TLA#tla_visualstu2005](../../../../includes/tlasharptla-visualstu2005-md.md)] template.</span></span>  
  
1.  <span data-ttu-id="d366d-154">打开[!INCLUDE[TLA2#tla_visualstu2005](../../../../includes/tla2sharptla-visualstu2005-md.md)]，然后选择**新项目**从**文件**菜单。</span><span class="sxs-lookup"><span data-stu-id="d366d-154">Open [!INCLUDE[TLA2#tla_visualstu2005](../../../../includes/tla2sharptla-visualstu2005-md.md)], and select **New Project** from the **File** menu.</span></span>  
  
2.  <span data-ttu-id="d366d-155">选择**Win32**从列表中[!INCLUDE[TLA2#tla_visualcpp](../../../../includes/tla2sharptla-visualcpp-md.md)]项目类型。</span><span class="sxs-lookup"><span data-stu-id="d366d-155">Select **Win32** from the list of [!INCLUDE[TLA2#tla_visualcpp](../../../../includes/tla2sharptla-visualcpp-md.md)] project types.</span></span> <span data-ttu-id="d366d-156">如果你的默认语言不是[!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)]，你会发现在这些项目类型**其他语言**。</span><span class="sxs-lookup"><span data-stu-id="d366d-156">If your default language is not [!INCLUDE[TLA2#tla_cpp](../../../../includes/tla2sharptla-cpp-md.md)], you will find these project types under **Other Languages**.</span></span>  
  
3.  <span data-ttu-id="d366d-157">选择**Win32 项目**模板，为项目分配一个名称，然后单击**确定**以启动**Win32 应用程序向导**。</span><span class="sxs-lookup"><span data-stu-id="d366d-157">Select a **Win32 Project** template, assign a name to the project and click **OK** to launch the **Win32 Application Wizard**.</span></span>  
  
4.  <span data-ttu-id="d366d-158">接受向导的默认设置，然后单击**完成**以启动项目。</span><span class="sxs-lookup"><span data-stu-id="d366d-158">Accept the wizard's default settings and click **Finish** to start the project.</span></span>  
  
 <span data-ttu-id="d366d-159">该模板将创建一个基本的 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 应用程序，包括：</span><span class="sxs-lookup"><span data-stu-id="d366d-159">The template creates a basic [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] application, including:</span></span>  
  
-   <span data-ttu-id="d366d-160">应用程序的入口点。</span><span class="sxs-lookup"><span data-stu-id="d366d-160">An entry point for the application.</span></span>  
  
-   <span data-ttu-id="d366d-161">一个窗口和关联的窗口过程 (WndProc)。</span><span class="sxs-lookup"><span data-stu-id="d366d-161">A window, with an associated window procedure (WndProc).</span></span>  
  
-   <span data-ttu-id="d366d-162">使用菜单**文件**和**帮助**标题。</span><span class="sxs-lookup"><span data-stu-id="d366d-162">A menu with **File** and **Help** headings.</span></span> <span data-ttu-id="d366d-163">**文件**菜单还拥有**退出**关闭应用程序的项。</span><span class="sxs-lookup"><span data-stu-id="d366d-163">The **File** menu has an **Exit** item that closes the application.</span></span> <span data-ttu-id="d366d-164">**帮助**菜单还拥有**有关**启动简单对话框中的项。</span><span class="sxs-lookup"><span data-stu-id="d366d-164">The **Help** menu has an **About** item that launches a simple dialog box.</span></span>  
  
 <span data-ttu-id="d366d-165">在开始编写代码以承载之前[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容，你需要进行两项修改对此基本模板。</span><span class="sxs-lookup"><span data-stu-id="d366d-165">Before you start writing code to host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, you need to make two modifications to the basic template.</span></span>  
  
 <span data-ttu-id="d366d-166">第一项是将项目作为托管代码进行编译。</span><span class="sxs-lookup"><span data-stu-id="d366d-166">The first is to compile the project as managed code.</span></span> <span data-ttu-id="d366d-167">默认情况下，项目将作为非托管代码进行编译。</span><span class="sxs-lookup"><span data-stu-id="d366d-167">By default, the project compiles as unmanaged code.</span></span> <span data-ttu-id="d366d-168">但是，由于 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 是在托管代码中实现的，因此必须将项目进行相应编译。</span><span class="sxs-lookup"><span data-stu-id="d366d-168">However, because [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] is implemented in managed code, the project must be compiled accordingly.</span></span>  
  
1.  <span data-ttu-id="d366d-169">右键单击中的项目名称**解决方案资源管理器**和选择**属性**从上下文菜单以启动**属性页**对话框。</span><span class="sxs-lookup"><span data-stu-id="d366d-169">Right-click the project name in **Solution Explorer** and select **Properties** from the context menu to launch the **Property Pages** dialog box.</span></span>  
  
2.  <span data-ttu-id="d366d-170">选择**配置属性**从左窗格中的树视图。</span><span class="sxs-lookup"><span data-stu-id="d366d-170">Select **Configuration Properties** from the tree view in the left pane.</span></span>  
  
3.  <span data-ttu-id="d366d-171">选择**公共语言运行时**支持从**项目默认值**右窗格中的列表。</span><span class="sxs-lookup"><span data-stu-id="d366d-171">Select **Common Language Runtime** support from the **Project Defaults** list in the right pane.</span></span>  
  
4.  <span data-ttu-id="d366d-172">选择**公共语言运行时支持 (/ clr)**从下拉列表框。</span><span class="sxs-lookup"><span data-stu-id="d366d-172">Select **Common Language Runtime Support (/clr)** from the drop-down list box.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d366d-173">此编译器标志使你能够在应用程序中使用托管代码，但非托管代码将仍将像以前一样进行编译。</span><span class="sxs-lookup"><span data-stu-id="d366d-173">This compiler flag allows you to use managed code in your application, but your unmanaged code will still compile as before.</span></span>  
  
 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]<span data-ttu-id="d366d-174"> 使用单线程单元 (STA) 线程处理模型。</span><span class="sxs-lookup"><span data-stu-id="d366d-174"> uses the single-threaded apartment (STA) threading model.</span></span> <span data-ttu-id="d366d-175">若要正常使用[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容的代码中，你必须设置应用程序的线程模型为 STA 通过将属性应用于入口点。</span><span class="sxs-lookup"><span data-stu-id="d366d-175">In order to work properly with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content code, you must set the application's threading model to STA by applying an attribute to the entry point.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WinMain](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#winmain)]  
  
<a name="hosting_the_wpf_page"></a>   
### <a name="hosting-the-wpf-content"></a><span data-ttu-id="d366d-176">承载 WPF 内容</span><span class="sxs-lookup"><span data-stu-id="d366d-176">Hosting the WPF Content</span></span>  
 <span data-ttu-id="d366d-177">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容是一个简单的地址条目应用程序。</span><span class="sxs-lookup"><span data-stu-id="d366d-177">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is a simple address entry application.</span></span> <span data-ttu-id="d366d-178">它包含若干个 <xref:System.Windows.Controls.TextBox> 控件，这些控件用于获得用户名称、地址等。</span><span class="sxs-lookup"><span data-stu-id="d366d-178">It consists of several <xref:System.Windows.Controls.TextBox> controls to take user name, address, and so on.</span></span> <span data-ttu-id="d366d-179">有两个<xref:System.Windows.Controls.Button>控件，**确定**和**取消**。</span><span class="sxs-lookup"><span data-stu-id="d366d-179">There are also two <xref:System.Windows.Controls.Button> controls, **OK** and **Cancel**.</span></span> <span data-ttu-id="d366d-180">当用户单击**确定**，该按钮的<xref:System.Windows.Controls.Primitives.ButtonBase.Click>事件处理程序收集的数据从<xref:System.Windows.Controls.TextBox>控制，将其分配给相应的属性，并引发自定义事件， `OnButtonClicked`。</span><span class="sxs-lookup"><span data-stu-id="d366d-180">When the user clicks **OK**, the button's <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler collects the data from the <xref:System.Windows.Controls.TextBox> controls, assigns it to corresponding properties, and raises a custom event, `OnButtonClicked`.</span></span> <span data-ttu-id="d366d-181">当用户单击**取消**，该处理程序只需引发`OnButtonClicked`。</span><span class="sxs-lookup"><span data-stu-id="d366d-181">When the user clicks **Cancel**, the handler simply raises `OnButtonClicked`.</span></span> <span data-ttu-id="d366d-182">`OnButtonClicked` 的事件参数对象包含布尔型字段，用于指示被单击的按钮。</span><span class="sxs-lookup"><span data-stu-id="d366d-182">The event argument object for `OnButtonClicked` contains a Boolean field that indicates which button was clicked.</span></span>  
  
 <span data-ttu-id="d366d-183">到主机代码[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容的处理程序中实现[WM_CREATE](http://msdn.microsoft.com/library/ms632619.aspx)宿主窗口上的通知。</span><span class="sxs-lookup"><span data-stu-id="d366d-183">The code to host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented in a handler for the [WM_CREATE](http://msdn.microsoft.com/library/ms632619.aspx) notification on the host window.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WMCreate](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wmcreate)]  
  
 <span data-ttu-id="d366d-184">`GetHwnd`方法采用大小和位置信息以及父窗口句柄并返回的窗口句柄将托管的[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-184">The `GetHwnd` method takes size and position information plus the parent window handle and returns the window handle of the hosted [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="d366d-185">无法对 `#using` 命名空间使用 `System::Windows::Interop` 指令。</span><span class="sxs-lookup"><span data-stu-id="d366d-185">You cannot use a `#using` directive for the `System::Windows::Interop` namespace.</span></span> <span data-ttu-id="d366d-186">如果进行此操作，将造成该命名空间中的 <xref:System.Windows.Interop.MSG> 结构和在 winuser.h 中声明的 MSG 结构之间的名称冲突。</span><span class="sxs-lookup"><span data-stu-id="d366d-186">Doing so creates a name collision between the <xref:System.Windows.Interop.MSG> structure in that namespace and the MSG structure declared in winuser.h.</span></span> <span data-ttu-id="d366d-187">必须使用完全限定名来访问该命名空间的内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-187">You must instead use fully-qualified names to access the contents of that namespace.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#GetHwnd](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#gethwnd)]  
  
 <span data-ttu-id="d366d-188">你不能托管[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容直接在应用程序窗口中。</span><span class="sxs-lookup"><span data-stu-id="d366d-188">You cannot host the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content directly in your application window.</span></span> <span data-ttu-id="d366d-189">从而，首先创建 <xref:System.Windows.Interop.HwndSource> 对象以包装 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-189">Instead, you first create an <xref:System.Windows.Interop.HwndSource> object to wrap the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d366d-190">此对象基本上是一个窗口，专门用来承载[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-190">This object is basically a window that is designed to host a [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d366d-191">你托管<xref:System.Windows.Interop.HwndSource>父窗口的创建方式的子级中的对象[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]属于你的应用程序的窗口。</span><span class="sxs-lookup"><span data-stu-id="d366d-191">You host the <xref:System.Windows.Interop.HwndSource> object in the parent window by creating it as a child of a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] window that is part of your application.</span></span> <span data-ttu-id="d366d-192"><xref:System.Windows.Interop.HwndSource> 构造函数参数所包含的信息与创建 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 子窗口时要传递给 CreateWindow 的信息基本相同。</span><span class="sxs-lookup"><span data-stu-id="d366d-192">The <xref:System.Windows.Interop.HwndSource> constructor parameters contain much the same information that you would pass to CreateWindow when you create a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] child window.</span></span>  
  
 <span data-ttu-id="d366d-193">下一步创建的实例[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容对象。</span><span class="sxs-lookup"><span data-stu-id="d366d-193">You next create an instance of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content object.</span></span> <span data-ttu-id="d366d-194">在此情况下，通过使用 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]，将 `WPFPage` 内容作为单独的类 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 实现。</span><span class="sxs-lookup"><span data-stu-id="d366d-194">In this case, the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented as a separate class, `WPFPage`, using [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)].</span></span> <span data-ttu-id="d366d-195">还可以使用 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 实现 [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)] 内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-195">You could also implement the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content with [!INCLUDE[TLA2#tla_xaml](../../../../includes/tla2sharptla-xaml-md.md)].</span></span> <span data-ttu-id="d366d-196">但是，为此，你需要设置一个单独的项目和生成[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容为[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d366d-196">However, to do so you need to set up a separate project and build the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content as a [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)].</span></span> <span data-ttu-id="d366d-197">可以向项目添加对 [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] 的引用，并使用该引用创建 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容的实例。</span><span class="sxs-lookup"><span data-stu-id="d366d-197">You can add a reference to that [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)] to your project, and use that reference to create an instance of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span>  
  
 <span data-ttu-id="d366d-198">你显示[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]中您将分配到的引用的子窗口的内容[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容到<xref:System.Windows.Interop.HwndSource.RootVisual%2A>属性<xref:System.Windows.Interop.HwndSource>。</span><span class="sxs-lookup"><span data-stu-id="d366d-198">You display the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content in your child window by assigning a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to the <xref:System.Windows.Interop.HwndSource.RootVisual%2A> property of the <xref:System.Windows.Interop.HwndSource>.</span></span>  
  
 <span data-ttu-id="d366d-199">代码的下一行将一个事件处理程序 `WPFButtonClicked` 附加到 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容 `OnButtonClicked` 事件。</span><span class="sxs-lookup"><span data-stu-id="d366d-199">The next line of code attaches an event handler, `WPFButtonClicked`, to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content `OnButtonClicked` event.</span></span> <span data-ttu-id="d366d-200">当用户单击时，会调用此处理程序**确定**或**取消**按钮。</span><span class="sxs-lookup"><span data-stu-id="d366d-200">This handler is called when the user clicks the **OK** or **Cancel** button.</span></span> <span data-ttu-id="d366d-201">请参阅[wpf 内容](#communicating_with_the_page)有关此事件处理程序的进一步讨论。</span><span class="sxs-lookup"><span data-stu-id="d366d-201">See [communicating_with_the_WPF content](#communicating_with_the_page) for further discussion of this event handler.</span></span>  
  
 <span data-ttu-id="d366d-202">代码显示的最后一行返回与 <xref:System.Windows.Interop.HwndSource> 对象关联的窗口句柄 (HWND)。</span><span class="sxs-lookup"><span data-stu-id="d366d-202">The final line of code shown returns the window handle (HWND) that is associated with the <xref:System.Windows.Interop.HwndSource> object.</span></span> <span data-ttu-id="d366d-203">可以从 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 代码使用此句柄，将消息发送到托管窗口，尽管该示例并未执行这一操作。</span><span class="sxs-lookup"><span data-stu-id="d366d-203">You can use this handle from your [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] code to send messages to the hosted window, although the sample does not do so.</span></span> <span data-ttu-id="d366d-204">每当 <xref:System.Windows.Interop.HwndSource> 对象收到一条消息时就会引发一个事件。</span><span class="sxs-lookup"><span data-stu-id="d366d-204">The <xref:System.Windows.Interop.HwndSource> object raises an event every time it receives a message.</span></span> <span data-ttu-id="d366d-205">若要处理消息，请调用 <xref:System.Windows.Interop.HwndSource.AddHook%2A> 方法来附加消息处理程序，然后在此处理程序中处理消息。</span><span class="sxs-lookup"><span data-stu-id="d366d-205">To process the messages, call the <xref:System.Windows.Interop.HwndSource.AddHook%2A> method to attach a message handler and then process the messages in that handler.</span></span>  
  
<a name="holding_a_reference"></a>   
### <a name="holding-a-reference-to-the-wpf-content"></a><span data-ttu-id="d366d-206">保存对 WPF 内容的引用</span><span class="sxs-lookup"><span data-stu-id="d366d-206">Holding a Reference to the WPF Content</span></span>  
 <span data-ttu-id="d366d-207">对于许多应用程序，你将需要稍后与 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容进行通信。</span><span class="sxs-lookup"><span data-stu-id="d366d-207">For many applications, you will want to communicate with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content later.</span></span> <span data-ttu-id="d366d-208">例如，可能需要修改 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容属性，或可能让 <xref:System.Windows.Interop.HwndSource> 对象托管不同的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-208">For example, you might want to modify the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties, or perhaps have the <xref:System.Windows.Interop.HwndSource> object host different [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d366d-209">执行此操作需要对 <xref:System.Windows.Interop.HwndSource> 对象或 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容的引用。</span><span class="sxs-lookup"><span data-stu-id="d366d-209">To do this, you need a reference to the <xref:System.Windows.Interop.HwndSource> object or the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d366d-210"><xref:System.Windows.Interop.HwndSource> 对象及其关联 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容保留在内存中，直到销毁窗口句柄。</span><span class="sxs-lookup"><span data-stu-id="d366d-210">The <xref:System.Windows.Interop.HwndSource> object and its associated [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content remain in memory until you destroy the window handle.</span></span> <span data-ttu-id="d366d-211">但是，一旦从窗口过程返回，分配给 <xref:System.Windows.Interop.HwndSource> 对象的变量就将超出范围。</span><span class="sxs-lookup"><span data-stu-id="d366d-211">However, the variable you assign to the <xref:System.Windows.Interop.HwndSource> object will go out of scope as soon as you return from the window procedure.</span></span> <span data-ttu-id="d366d-212">用来处理 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 应用程序的这一问题的惯用方法是使用静态或全局变量。</span><span class="sxs-lookup"><span data-stu-id="d366d-212">The customary way to handle this issue with [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] applications is to use a static or global variable.</span></span> <span data-ttu-id="d366d-213">遗憾的是，你无法向这些类型的变量分配托管对象。</span><span class="sxs-lookup"><span data-stu-id="d366d-213">Unfortunately, you cannot assign a managed object to those types of variables.</span></span> <span data-ttu-id="d366d-214">可以向全局或静态变量分配与 <xref:System.Windows.Interop.HwndSource> 对象关联的窗口句柄，但这一操作不会提供对对象本身的访问。</span><span class="sxs-lookup"><span data-stu-id="d366d-214">You can assign the window handle associated with <xref:System.Windows.Interop.HwndSource> object to a global or static variable, but that doe not provide access to the object itself.</span></span>  
  
 <span data-ttu-id="d366d-215">针对这一问题最简单的解决方案是实现一个托管类，该类包含一组静态字段，这些字段保存对需要访问的任何托管对象的引用。</span><span class="sxs-lookup"><span data-stu-id="d366d-215">The simplest solution to this issue is to implement a managed class that contains a set of static fields to hold references to any managed objects that you need access to.</span></span> <span data-ttu-id="d366d-216">此示例使用 `WPFPageHost` 类来保存对 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容的引用，以及对该内容某些属性的初始值的引用（用户以后可能会对这些属性进行更改）。</span><span class="sxs-lookup"><span data-stu-id="d366d-216">The sample uses the `WPFPageHost` class to hold a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, plus the initial values of a number of its properties that might be changed later by the user.</span></span> <span data-ttu-id="d366d-217">这在标头中进行定义。</span><span class="sxs-lookup"><span data-stu-id="d366d-217">This is defined in the header.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageHost](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.h#wpfpagehost)]  
  
 <span data-ttu-id="d366d-218">`GetHwnd` 函数的后半部分将值分配给这些字段以供以后使用（在 `myPage` 仍处于范围内时）。</span><span class="sxs-lookup"><span data-stu-id="d366d-218">The latter part of the `GetHwnd` function assigns values to those fields for later use while `myPage` is still in scope.</span></span>  
  
<a name="communicating_with_the_page"></a>   
### <a name="communicating-with-the-wpf-content"></a><span data-ttu-id="d366d-219">与 WPF 内容通信</span><span class="sxs-lookup"><span data-stu-id="d366d-219">Communicating with the WPF Content</span></span>  
 <span data-ttu-id="d366d-220">与 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容的通信有两种类型。</span><span class="sxs-lookup"><span data-stu-id="d366d-220">There are two types of communication with the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d366d-221">应用程序收到信息从[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容当用户单击**确定**或**取消**按钮。</span><span class="sxs-lookup"><span data-stu-id="d366d-221">The application receives information from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content when the user clicks the **OK** or **Cancel** buttons.</span></span> <span data-ttu-id="d366d-222">该应用程序还具有 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]，使用户可以更改各种 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容属性，例如背景色或默认字体大小。</span><span class="sxs-lookup"><span data-stu-id="d366d-222">The application also has a [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] that allows the user to change various [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties, such as the background color or default font size.</span></span>  
  
 <span data-ttu-id="d366d-223">如上所述，用户单击任一按钮时，[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容将引发 `OnButtonClicked` 事件。</span><span class="sxs-lookup"><span data-stu-id="d366d-223">As mentioned above, when the user clicks either button the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content raises an `OnButtonClicked` event.</span></span> <span data-ttu-id="d366d-224">该应用程序将一个处理程序附加到此事件以接收这些通知。</span><span class="sxs-lookup"><span data-stu-id="d366d-224">The application attaches a handler to this event to receive these notifications.</span></span> <span data-ttu-id="d366d-225">如果**确定**所单击的按钮，在处理程序获得中的用户信息[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容，并在一组静态控件中显示它。</span><span class="sxs-lookup"><span data-stu-id="d366d-225">If the **OK** button was clicked, the handler gets the user information from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content and displays it in a set of static controls.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFButtonClicked](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wpfbuttonclicked)]  
  
 <span data-ttu-id="d366d-226">该处理程序从 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容接收到一个自定义事件参数对象 `MyPageEventArgs`。</span><span class="sxs-lookup"><span data-stu-id="d366d-226">The handler receives a custom event argument object from the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, `MyPageEventArgs`.</span></span> <span data-ttu-id="d366d-227">对象的`IsOK`属性设置为`true`如果**确定**所单击的按钮和`false`如果**取消**按钮被单击。</span><span class="sxs-lookup"><span data-stu-id="d366d-227">The object's `IsOK` property is set to `true` if the **OK** button was clicked, and `false` if the **Cancel** button was clicked.</span></span>  
  
 <span data-ttu-id="d366d-228">如果**确定**所单击的按钮，在处理程序获得对引用[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]容器类中的内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-228">If the **OK** button was clicked, the handler gets a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content from the container class.</span></span> <span data-ttu-id="d366d-229">然后它会收集由关联的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容属性保存的用户信息，并使用静态控件在父窗口上显示该信息。</span><span class="sxs-lookup"><span data-stu-id="d366d-229">It then collects the user information that is held by the associated [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties and uses the static controls to display the information on the parent window.</span></span> <span data-ttu-id="d366d-230">由于 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容数据的形式为托管字符串，因此必须对其进行封送处理以供 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 控件使用。</span><span class="sxs-lookup"><span data-stu-id="d366d-230">Because the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content data is in the form of a managed string, it has to be marshaled for use by a [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] control.</span></span> <span data-ttu-id="d366d-231">如果**取消**所单击的按钮，该处理程序会清除从静态控件的数据。</span><span class="sxs-lookup"><span data-stu-id="d366d-231">If the **Cancel** button was clicked, the handler clears the data from the static controls.</span></span>  
  
 <span data-ttu-id="d366d-232">应用程序 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 提供一组单选按钮，允许用户修改 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容的背景色和若干与字体相关的属性。</span><span class="sxs-lookup"><span data-stu-id="d366d-232">The application [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] provides a set of radio buttons that allow the user to modify the background color of the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and several font-related properties.</span></span> <span data-ttu-id="d366d-233">下面的示例是应用程序的窗口过程 (WndProc) 的一段摘录及其消息处理功能，通过该功能可设置不同消息上的各种属性，包括背景色。</span><span class="sxs-lookup"><span data-stu-id="d366d-233">The following example is an excerpt from the application's window procedure (WndProc) and its message handling that sets various properties on different messages, including the background color.</span></span> <span data-ttu-id="d366d-234">其他内容与此类似，将不进行展示。</span><span class="sxs-lookup"><span data-stu-id="d366d-234">The others are similar, and are not shown.</span></span> <span data-ttu-id="d366d-235">请查看完整示例了解详细信息和上下文。</span><span class="sxs-lookup"><span data-stu-id="d366d-235">See the complete sample for details and context.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WMCommandToBG](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/Win32HostingWPFPage.cpp#wmcommandtobg)]  
  
 <span data-ttu-id="d366d-236">若要设置背景色，请从 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 获取对 `hostedPage` 内容 (`WPFPageHost`) 的引用并将背景色属性设置为适当的颜色。</span><span class="sxs-lookup"><span data-stu-id="d366d-236">To set the background color, get a reference to the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content (`hostedPage`) from `WPFPageHost` and set the background color property to the appropriate color.</span></span> <span data-ttu-id="d366d-237">此示例使用三种颜色选项：原始颜色、浅绿色或浅橙红色。</span><span class="sxs-lookup"><span data-stu-id="d366d-237">The sample uses three color options: the original color, light green, or light salmon.</span></span> <span data-ttu-id="d366d-238">原始背景色作为静态字段存储在 `WPFPageHost` 类中。</span><span class="sxs-lookup"><span data-stu-id="d366d-238">The original background color is stored as a static field in the `WPFPageHost` class.</span></span> <span data-ttu-id="d366d-239">若要设置其他两种颜色，请创建一个新的 <xref:System.Windows.Media.SolidColorBrush> 对象，并从 <xref:System.Windows.Media.Colors> 对象向构造函数传递一个静态颜色值。</span><span class="sxs-lookup"><span data-stu-id="d366d-239">To set the other two, you create a new <xref:System.Windows.Media.SolidColorBrush> object and pass the constructor a static colors value from the <xref:System.Windows.Media.Colors> object.</span></span>  
  
<a name="implementing_the_wpf_page"></a>   
## <a name="implementing-the-wpf-page"></a><span data-ttu-id="d366d-240">实现 WPF 页</span><span class="sxs-lookup"><span data-stu-id="d366d-240">Implementing the WPF Page</span></span>  
 <span data-ttu-id="d366d-241">你可以承载和使用[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容无需任何实际的实施的知识。</span><span class="sxs-lookup"><span data-stu-id="d366d-241">You can host and use the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content without any knowledge of the actual implementation.</span></span> <span data-ttu-id="d366d-242">如果[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容具有已打包在单独[!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)]，它可能已内置了任何[!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)]语言。</span><span class="sxs-lookup"><span data-stu-id="d366d-242">If the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content had been packaged in a separate [!INCLUDE[TLA2#tla_dll](../../../../includes/tla2sharptla-dll-md.md)], it could have been built in any [!INCLUDE[TLA#tla_clr](../../../../includes/tlasharptla-clr-md.md)] language.</span></span> <span data-ttu-id="d366d-243">以下是在该示例中使用的 [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] 实现的简短演练。</span><span class="sxs-lookup"><span data-stu-id="d366d-243">Following is a brief walkthrough of the [!INCLUDE[TLA#tla_cppcli](../../../../includes/tlasharptla-cppcli-md.md)] implementation that is used in the sample.</span></span> <span data-ttu-id="d366d-244">本节包含下列子节。</span><span class="sxs-lookup"><span data-stu-id="d366d-244">This section contains the following subsections.</span></span>  
  
<a name="autoNestedSectionsOUTLINE2"></a>   
-   [<span data-ttu-id="d366d-245">布局</span><span class="sxs-lookup"><span data-stu-id="d366d-245">Layout</span></span>](#page_layout)  
  
-   [<span data-ttu-id="d366d-246">将数据返回到主机窗口</span><span class="sxs-lookup"><span data-stu-id="d366d-246">Returning the Data to the Host Window</span></span>](#returning_data_to_window)  
  
-   [<span data-ttu-id="d366d-247">设置 WPF 属性</span><span class="sxs-lookup"><span data-stu-id="d366d-247">Setting the WPF Properties</span></span>](#set_page_properties)  
  
<a name="page_layout"></a>   
### <a name="layout"></a><span data-ttu-id="d366d-248">布局</span><span class="sxs-lookup"><span data-stu-id="d366d-248">Layout</span></span>  
 <span data-ttu-id="d366d-249">[!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)]中的元素[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容包含五个<xref:System.Windows.Controls.TextBox>控制，与关联<xref:System.Windows.Controls.Label>控件： 名称、 地址、 市/县、 州和 Zip。</span><span class="sxs-lookup"><span data-stu-id="d366d-249">The [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content consist of five <xref:System.Windows.Controls.TextBox> controls, with associated <xref:System.Windows.Controls.Label> controls: Name, Address, City, State, and Zip.</span></span> <span data-ttu-id="d366d-250">有两个<xref:System.Windows.Controls.Button>控件，**确定**和**取消**</span><span class="sxs-lookup"><span data-stu-id="d366d-250">There are also two <xref:System.Windows.Controls.Button> controls, **OK** and **Cancel**</span></span>  
  
 <span data-ttu-id="d366d-251">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容在 `WPFPage` 类中实现。</span><span class="sxs-lookup"><span data-stu-id="d366d-251">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content is implemented in the `WPFPage` class.</span></span> <span data-ttu-id="d366d-252">布局通过 <xref:System.Windows.Controls.Grid> 布局元素进行处理。</span><span class="sxs-lookup"><span data-stu-id="d366d-252">Layout is handled with a <xref:System.Windows.Controls.Grid> layout element.</span></span> <span data-ttu-id="d366d-253">该类继承自实际使其成为 <xref:System.Windows.Controls.Grid> 内容根元素的 [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="d366d-253">The class inherits from <xref:System.Windows.Controls.Grid>, which effectively makes it the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content root element.</span></span>  
  
 <span data-ttu-id="d366d-254">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容的构造函数采用所需的宽度和高度和大小<xref:System.Windows.Controls.Grid>相应地。</span><span class="sxs-lookup"><span data-stu-id="d366d-254">The [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content constructor takes the required width and height, and sizes the <xref:System.Windows.Controls.Grid> accordingly.</span></span> <span data-ttu-id="d366d-255">然后，它定义基本布局通过创建一组<xref:System.Windows.Controls.ColumnDefinition>和<xref:System.Windows.Controls.RowDefinition>对象并将它们添加到<xref:System.Windows.Controls.Grid>基对象<xref:System.Windows.Controls.Grid.ColumnDefinitions%2A>和<xref:System.Windows.Controls.Grid.RowDefinitions%2A>集合，分别。</span><span class="sxs-lookup"><span data-stu-id="d366d-255">It then defines the basic layout by creating a set of <xref:System.Windows.Controls.ColumnDefinition> and <xref:System.Windows.Controls.RowDefinition> objects and adding them to the <xref:System.Windows.Controls.Grid> object base <xref:System.Windows.Controls.Grid.ColumnDefinitions%2A> and <xref:System.Windows.Controls.Grid.RowDefinitions%2A> collections, respectively.</span></span> <span data-ttu-id="d366d-256">这将定义具有 5 行和 7 列的网格，该网格具有单元内容定义的维度。</span><span class="sxs-lookup"><span data-stu-id="d366d-256">This defines a grid of five rows and seven columns, with the dimensions determined by the contents of the cells.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageCtorToGridDef](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectortogriddef)]  
  
 <span data-ttu-id="d366d-257">接下来，此构造函数将 [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] 元素添加到 <xref:System.Windows.Controls.Grid>。</span><span class="sxs-lookup"><span data-stu-id="d366d-257">Next, the constructor adds the [!INCLUDE[TLA2#tla_ui](../../../../includes/tla2sharptla-ui-md.md)] elements to the <xref:System.Windows.Controls.Grid>.</span></span> <span data-ttu-id="d366d-258">第一个元素是标题文本，这是一个在网格首行居中的 <xref:System.Windows.Controls.Label> 控件。</span><span class="sxs-lookup"><span data-stu-id="d366d-258">The first element is the title text, which is a <xref:System.Windows.Controls.Label> control that is centered in the first row of the grid.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageCtorTitle](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectortitle)]  
  
 <span data-ttu-id="d366d-259">下一行包含名称 <xref:System.Windows.Controls.Label> 控制及其关联的 <xref:System.Windows.Controls.TextBox> 控件。</span><span class="sxs-lookup"><span data-stu-id="d366d-259">The next row contains the Name <xref:System.Windows.Controls.Label> control and its associated <xref:System.Windows.Controls.TextBox> control.</span></span> <span data-ttu-id="d366d-260">由于对每个标签/文本框对使用同一代码，因而该代码被置于一对专用方法内并用于所有五个标签/文本框对。</span><span class="sxs-lookup"><span data-stu-id="d366d-260">Because the same code is used for each label/textbox pair, it is placed in a pair of private methods and used for all five label/textbox pairs.</span></span> <span data-ttu-id="d366d-261">该方法创建相应的控件，并调用 <xref:System.Windows.Controls.Grid> 类静态 <xref:System.Windows.Controls.Grid.SetColumn%2A> 和 <xref:System.Windows.Controls.Grid.SetRow%2A> 方法，以将控件置于相应单元格内。</span><span class="sxs-lookup"><span data-stu-id="d366d-261">The methods create the appropriate control, and call the <xref:System.Windows.Controls.Grid> class static <xref:System.Windows.Controls.Grid.SetColumn%2A> and <xref:System.Windows.Controls.Grid.SetRow%2A> methods to place the controls in the appropriate cell.</span></span> <span data-ttu-id="d366d-262">创建控件后，该示例对 <xref:System.Windows.Controls.UIElementCollection.Add%2A> 的 <xref:System.Windows.Controls.Panel.Children%2A> 属性调用 <xref:System.Windows.Controls.Grid> 方法，以便将控件添加到网格。</span><span class="sxs-lookup"><span data-stu-id="d366d-262">After the control is created, the sample calls the <xref:System.Windows.Controls.UIElementCollection.Add%2A> method on the <xref:System.Windows.Controls.Panel.Children%2A> property of the <xref:System.Windows.Controls.Grid> to add the control to the grid.</span></span> <span data-ttu-id="d366d-263">用于添加剩余标签/文本框对的代码相似。</span><span class="sxs-lookup"><span data-stu-id="d366d-263">The code to add the remaining label/textbox pairs is similar.</span></span> <span data-ttu-id="d366d-264">请参阅示例代码了解详细信息。</span><span class="sxs-lookup"><span data-stu-id="d366d-264">See the sample code for details.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageCtorName](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectorname)]  
  
 <span data-ttu-id="d366d-265">这两种方法的实现如下所示：</span><span class="sxs-lookup"><span data-stu-id="d366d-265">The implementation of the two methods is as follows:</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageCreateHelpers](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagecreatehelpers)]  
  
 <span data-ttu-id="d366d-266">最后，示例添加**确定**和**取消**按钮，并将附加到事件处理程序其<xref:System.Windows.Controls.Primitives.ButtonBase.Click>事件。</span><span class="sxs-lookup"><span data-stu-id="d366d-266">Finally, the sample adds the **OK** and **Cancel** buttons and attaches an event handler to their <xref:System.Windows.Controls.Primitives.ButtonBase.Click> events.</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageCtorButtonsEvents](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagectorbuttonsevents)]  
  
<a name="returning_data_to_window"></a>   
### <a name="returning-the-data-to-the-host-window"></a><span data-ttu-id="d366d-267">将数据返回到主机窗口</span><span class="sxs-lookup"><span data-stu-id="d366d-267">Returning the Data to the Host Window</span></span>  
 <span data-ttu-id="d366d-268">单击任一按钮后，将引发其 <xref:System.Windows.Controls.Primitives.ButtonBase.Click> 事件。</span><span class="sxs-lookup"><span data-stu-id="d366d-268">When either button is clicked, its <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event is raised.</span></span> <span data-ttu-id="d366d-269">主机窗口只需将处理程序附加到这些事件，然后直接从 <xref:System.Windows.Controls.TextBox> 控件获取数据。</span><span class="sxs-lookup"><span data-stu-id="d366d-269">The host window could simply attach handlers to these events and get the data directly from the <xref:System.Windows.Controls.TextBox> controls.</span></span> <span data-ttu-id="d366d-270">此示例使用的是不太直接的方法。</span><span class="sxs-lookup"><span data-stu-id="d366d-270">The sample uses a somewhat less direct approach.</span></span> <span data-ttu-id="d366d-271">它处理<xref:System.Windows.Controls.Primitives.ButtonBase.Click>内[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容，然后引发自定义事件`OnButtonClicked`，以通知[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容。</span><span class="sxs-lookup"><span data-stu-id="d366d-271">It handles the <xref:System.Windows.Controls.Primitives.ButtonBase.Click> within the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content, and then raises a custom event `OnButtonClicked`, to notify the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content.</span></span> <span data-ttu-id="d366d-272">这允许[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容执行之前通知宿主某些参数验证。</span><span class="sxs-lookup"><span data-stu-id="d366d-272">This allows the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content to do some parameter validation before notifying the host.</span></span> <span data-ttu-id="d366d-273">该处理程序从 <xref:System.Windows.Controls.TextBox> 控件获取文本，然后将其分配给公共属性（主机可从其中检索信息）。</span><span class="sxs-lookup"><span data-stu-id="d366d-273">The handler gets the text from the <xref:System.Windows.Controls.TextBox> controls and assigns it to public properties, from which the host can retrieve the information.</span></span>  
  
 <span data-ttu-id="d366d-274">WPFPage.h 中的事件声明：</span><span class="sxs-lookup"><span data-stu-id="d366d-274">The event declaration, in WPFPage.h:</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageEventDecl](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.h#wpfpageeventdecl)]  
  
 <span data-ttu-id="d366d-275">WPFPage.cpp 中的 <xref:System.Windows.Controls.Primitives.ButtonBase.Click> 事件处理程序：</span><span class="sxs-lookup"><span data-stu-id="d366d-275">The <xref:System.Windows.Controls.Primitives.ButtonBase.Click> event handler, in WPFPage.cpp:</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageButtonClicked](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagebuttonclicked)]  
  
<a name="set_page_properties"></a>   
### <a name="setting-the-wpf-properties"></a><span data-ttu-id="d366d-276">设置 WPF 属性</span><span class="sxs-lookup"><span data-stu-id="d366d-276">Setting the WPF Properties</span></span>  
 <span data-ttu-id="d366d-277">[!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)]主机允许用户更改几个[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)]内容属性。</span><span class="sxs-lookup"><span data-stu-id="d366d-277">The [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] host allows the user to change several [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content properties.</span></span> <span data-ttu-id="d366d-278">就 [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] 端而言，这只是更改属性的问题。</span><span class="sxs-lookup"><span data-stu-id="d366d-278">From the [!INCLUDE[TLA2#tla_win32](../../../../includes/tla2sharptla-win32-md.md)] side, it is simply a matter of changing the properties.</span></span> <span data-ttu-id="d366d-279">[!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] 内容类中的实现从某种意义上来说更加复杂，因为不存在控制所有控件的字体的单个全局属性。</span><span class="sxs-lookup"><span data-stu-id="d366d-279">The implementation in the [!INCLUDE[TLA2#tla_winclient](../../../../includes/tla2sharptla-winclient-md.md)] content class is somewhat more complicated, because there is no single global property that controls the fonts for all controls.</span></span> <span data-ttu-id="d366d-280">相反，每个控件的相应属性均是在属性的 set 访问器中进行更改的。</span><span class="sxs-lookup"><span data-stu-id="d366d-280">Instead, the appropriate property for each control is changed in the properties' set accessors.</span></span> <span data-ttu-id="d366d-281">下面的示例演示的代码`DefaultFontFamily`属性。</span><span class="sxs-lookup"><span data-stu-id="d366d-281">The following example shows the code for the `DefaultFontFamily` property.</span></span> <span data-ttu-id="d366d-282">设置属性将调用专用方法，该方法依次又将为各控件设置 <xref:System.Windows.Controls.Control.FontFamily%2A> 属性。</span><span class="sxs-lookup"><span data-stu-id="d366d-282">Setting the property calls a private method that in turn sets the <xref:System.Windows.Controls.Control.FontFamily%2A> properties for the various controls.</span></span>  
  
 <span data-ttu-id="d366d-283">从 WPFPage.h：</span><span class="sxs-lookup"><span data-stu-id="d366d-283">From WPFPage.h:</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageFontFamilyProperty](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.h#wpfpagefontfamilyproperty)]  
  
 <span data-ttu-id="d366d-284">从 WPFPage.cpp：</span><span class="sxs-lookup"><span data-stu-id="d366d-284">From WPFPage.cpp:</span></span>  
  
 [!code-cpp[Win32HostingWPFPage#WPFPageSetFontFamily](../../../../samples/snippets/cpp/VS_Snippets_Wpf/Win32HostingWPFPage/CPP/WPFPage.cpp#wpfpagesetfontfamily)]  
  
## <a name="see-also"></a><span data-ttu-id="d366d-285">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d366d-285">See Also</span></span>  
 <xref:System.Windows.Interop.HwndSource>  
 [<span data-ttu-id="d366d-286">WPF 和 Win32 互操作</span><span class="sxs-lookup"><span data-stu-id="d366d-286">WPF and Win32 Interoperation</span></span>](../../../../docs/framework/wpf/advanced/wpf-and-win32-interoperation.md)
