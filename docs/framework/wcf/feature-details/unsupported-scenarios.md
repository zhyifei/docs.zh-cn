---
title: 不支持的方案
ms.date: 03/30/2017
ms.assetid: 72027d0f-146d-40c5-9d72-e94392c8bb40
ms.openlocfilehash: 2e44cbf159d5df724a5213648b28d952f49b8e8d
ms.sourcegitcommit: 8c28ab17c26bf08abbd004cc37651985c68841b8
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/06/2018
ms.locfileid: "48845671"
---
# <a name="unsupported-scenarios"></a><span data-ttu-id="53e7b-102">不支持的方案</span><span class="sxs-lookup"><span data-stu-id="53e7b-102">Unsupported Scenarios</span></span>
<span data-ttu-id="53e7b-103">由于各种原因，Windows Communication Foundation (WCF) 不支持某些特定安全方案。</span><span class="sxs-lookup"><span data-stu-id="53e7b-103">For various reasons, Windows Communication Foundation (WCF) does not support some specific security scenarios.</span></span> <span data-ttu-id="53e7b-104">例如， [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition 没有实现 SSPI 或 Kerberos 身份验证协议，并因此 WCF 不支持该平台上运行使用 Windows 身份验证的服务。</span><span class="sxs-lookup"><span data-stu-id="53e7b-104">For example, [!INCLUDE[wxp](../../../../includes/wxp-md.md)] Home Edition does not implement the SSPI or Kerberos authentication protocols, and therefore WCF does not support running a service with Windows authentication on that platform.</span></span> <span data-ttu-id="53e7b-105">运行 Windows XP Home Edition 下的 WCF 时，支持其他身份验证机制，例如用户名/密码和 HTTP/HTTPS 集成身份验证。</span><span class="sxs-lookup"><span data-stu-id="53e7b-105">Other authentication mechanisms, such as username/password and HTTP/HTTPS integrated authentication are supported when running WCF under Windows XP Home Edition.</span></span>  
  
## <a name="impersonation-scenarios"></a><span data-ttu-id="53e7b-106">模拟方案</span><span class="sxs-lookup"><span data-stu-id="53e7b-106">Impersonation Scenarios</span></span>  
  
### <a name="impersonated-identity-might-not-flow-when-clients-make-asynchronous-calls"></a><span data-ttu-id="53e7b-107">当客户端进行异步调用时可能无法流动模拟标识</span><span class="sxs-lookup"><span data-stu-id="53e7b-107">Impersonated Identity Might Not Flow When Clients Make Asynchronous Calls</span></span>  
 <span data-ttu-id="53e7b-108">当 WCF 客户端通过模拟使用 Windows 身份验证对 WCF 服务进行异步调用时，可能会使用客户端进程的标识进行身份验证，而不是使用模拟的标识进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="53e7b-108">When a WCF client makes asynchronous calls to a WCF service using Windows authentication under impersonation, authentication might occur with the identity of the client process instead of the impersonated identity.</span></span>  
  
### <a name="windows-xp-and-secure-context-token-cookie-enabled"></a><span data-ttu-id="53e7b-109">启用了 Windows XP 和安全上下文令牌 Cookie</span><span class="sxs-lookup"><span data-stu-id="53e7b-109">Windows XP and Secure Context Token Cookie Enabled</span></span>  
 <span data-ttu-id="53e7b-110">WCF 不支持模拟和<xref:System.InvalidOperationException>时存在以下条件引发：</span><span class="sxs-lookup"><span data-stu-id="53e7b-110">WCF does not support impersonation and an <xref:System.InvalidOperationException> is thrown when the following conditions exist:</span></span>  
  
-   <span data-ttu-id="53e7b-111">操作系统为 [!INCLUDE[wxp](../../../../includes/wxp-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="53e7b-111">The operating system is [!INCLUDE[wxp](../../../../includes/wxp-md.md)].</span></span>  
  
-   <span data-ttu-id="53e7b-112">身份验证模式产生 Windows 标识。</span><span class="sxs-lookup"><span data-stu-id="53e7b-112">The authentication mode results in a Windows identity.</span></span>  
  
-   <span data-ttu-id="53e7b-113"><xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> 的 <xref:System.ServiceModel.OperationBehaviorAttribute> 属性设置为 <xref:System.ServiceModel.ImpersonationOption.Required>。</span><span class="sxs-lookup"><span data-stu-id="53e7b-113">The <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property of the <xref:System.ServiceModel.OperationBehaviorAttribute> is set to <xref:System.ServiceModel.ImpersonationOption.Required>.</span></span>  
  
-   <span data-ttu-id="53e7b-114">创建了基于状态的安全上下文令牌 (SCT)。默认情况下禁止创建此类令牌。</span><span class="sxs-lookup"><span data-stu-id="53e7b-114">A state-based security context token (SCT) is created (by default, creation is disabled).</span></span>  
  
 <span data-ttu-id="53e7b-115">基于状态的 SCT 只能使用自定义绑定来创建。</span><span class="sxs-lookup"><span data-stu-id="53e7b-115">The state-based SCT can only be created using a custom binding.</span></span> <span data-ttu-id="53e7b-116">有关详细信息，请参阅[如何： 为安全会话创建的安全上下文令牌](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md)。)在代码中，可通过创建安全绑定元素（<xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> 或 <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>）启用令牌，方法是：使用 <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSspiNegotiationBindingElement%28System.Boolean%29?displayProperty=nameWithType> 或 <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSecureConversationBindingElement%28System.ServiceModel.Channels.SecurityBindingElement%2CSystem.Boolean%29?displayProperty=nameWithType> 方法，并且将 `requireCancellation` 参数设置为 `false`。</span><span class="sxs-lookup"><span data-stu-id="53e7b-116">For more information, see [How to: Create a Security Context Token for a Secure Session](../../../../docs/framework/wcf/feature-details/how-to-create-a-security-context-token-for-a-secure-session.md).) In code, the token is enabled by creating a security binding element (either <xref:System.ServiceModel.Channels.SymmetricSecurityBindingElement> or <xref:System.ServiceModel.Channels.AsymmetricSecurityBindingElement>) using the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSspiNegotiationBindingElement%28System.Boolean%29?displayProperty=nameWithType> or the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateSecureConversationBindingElement%28System.ServiceModel.Channels.SecurityBindingElement%2CSystem.Boolean%29?displayProperty=nameWithType> method and setting the `requireCancellation` parameter to `false`.</span></span> <span data-ttu-id="53e7b-117">该参数引用 SCT 的缓存。</span><span class="sxs-lookup"><span data-stu-id="53e7b-117">The parameter refers to the caching of the SCT.</span></span> <span data-ttu-id="53e7b-118">若将该值设置为 `false`，则启用基于状态的 SCT 功能。</span><span class="sxs-lookup"><span data-stu-id="53e7b-118">Setting the value to `false` enables the state-based SCT feature.</span></span>  
  
 <span data-ttu-id="53e7b-119">或者，在配置中，以下方法启用令牌通过创建 <`customBinding`>，然后添加 <`security`> 元素，并将`authenticationMode`SecureConversation 属性和`requireSecurityContextCancellation`归于`true`。</span><span class="sxs-lookup"><span data-stu-id="53e7b-119">Alternatively, in configuration, the token is enabled by creating a <`customBinding`>, then adding a <`security`> element, and setting the `authenticationMode` attribute to SecureConversation and the `requireSecurityContextCancellation` attribute to `true`.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="53e7b-120">上述需求是特定的。</span><span class="sxs-lookup"><span data-stu-id="53e7b-120">The preceding requirements are specific.</span></span> <span data-ttu-id="53e7b-121">例如，<xref:System.ServiceModel.Channels.SecurityBindingElement.CreateKerberosBindingElement%2A> 创建一个产生 Windows 标识的绑定元素，但并不建立一个 SCT。</span><span class="sxs-lookup"><span data-stu-id="53e7b-121">For example, the <xref:System.ServiceModel.Channels.SecurityBindingElement.CreateKerberosBindingElement%2A> creates a binding element that results in a Windows identity, but does not establish an SCT.</span></span> <span data-ttu-id="53e7b-122">因此，在 `Required` 上，可以将其与 [!INCLUDE[wxp](../../../../includes/wxp-md.md)] 选项一起使用。</span><span class="sxs-lookup"><span data-stu-id="53e7b-122">Therefore, you can use it with the `Required` option on [!INCLUDE[wxp](../../../../includes/wxp-md.md)].</span></span>  
  
### <a name="possible-aspnet-conflict"></a><span data-ttu-id="53e7b-123">可能发生 ASP.NET 冲突</span><span class="sxs-lookup"><span data-stu-id="53e7b-123">Possible ASP.NET Conflict</span></span>  
 <span data-ttu-id="53e7b-124">WCF 和[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]都可能启用或禁用模拟。</span><span class="sxs-lookup"><span data-stu-id="53e7b-124">WCF and [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] can both enable or disable impersonation.</span></span> <span data-ttu-id="53e7b-125">当[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]托管 WCF 应用程序，WCF 之间可能存在冲突和[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]配置设置。</span><span class="sxs-lookup"><span data-stu-id="53e7b-125">When [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] hosts an WCF application, a conflict may exist between the WCF and [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] configuration settings.</span></span> <span data-ttu-id="53e7b-126">当发生冲突时，WCF 设置优先，除非<xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A>属性设置为<xref:System.ServiceModel.ImpersonationOption.NotAllowed>，在这种情况下[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]模拟设置优先。</span><span class="sxs-lookup"><span data-stu-id="53e7b-126">In case of conflict, the WCF setting takes precedence, unless the <xref:System.ServiceModel.OperationBehaviorAttribute.Impersonation%2A> property is set to <xref:System.ServiceModel.ImpersonationOption.NotAllowed>, in which case the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] impersonation setting takes precedence.</span></span>  
  
### <a name="assembly-loads-may-fail-under-impersonation"></a><span data-ttu-id="53e7b-127">程序集加载操作可能在模拟下失败</span><span class="sxs-lookup"><span data-stu-id="53e7b-127">Assembly Loads May Fail Under Impersonation</span></span>  
 <span data-ttu-id="53e7b-128">如果所模拟的上下文没有加载程序集的访问权限，并且这是公共语言运行库 (CLR) 第一次试图加载该 AppDomain 的程序集，则 <xref:System.AppDomain> 会缓存失败。</span><span class="sxs-lookup"><span data-stu-id="53e7b-128">If the impersonated context does not have access rights to load an assembly and if it is the first time the common language runtime (CLR) is attempting to load the assembly for that AppDomain, the <xref:System.AppDomain> caches the failure.</span></span> <span data-ttu-id="53e7b-129">随后进行的加载该程序集（或多个程序集）的尝试仍将失败，即使撤消了模拟，并且恢复之后的上下文具有加载该程序集的访问权限。</span><span class="sxs-lookup"><span data-stu-id="53e7b-129">Subsequent attempts to load that assembly (or assemblies) fail, even after reverting the impersonation, and even if the reverted context has access rights to load the assembly.</span></span> <span data-ttu-id="53e7b-130">这是因为，用户上下文更改后，CLR 不会重新尝试加载。</span><span class="sxs-lookup"><span data-stu-id="53e7b-130">This is because the CLR does not re-attempt the load after the user context is changed.</span></span> <span data-ttu-id="53e7b-131">必须重新启动应用程序域才能从失败中恢复。</span><span class="sxs-lookup"><span data-stu-id="53e7b-131">You must restart the application domain to recover from the failure.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="53e7b-132"><xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> 类的 <xref:System.ServiceModel.Security.WindowsClientCredential> 属性的默认值为 <xref:System.Security.Principal.TokenImpersonationLevel.Identification>。</span><span class="sxs-lookup"><span data-stu-id="53e7b-132">The default value for the <xref:System.ServiceModel.Security.WindowsClientCredential.AllowedImpersonationLevel%2A> property of the <xref:System.ServiceModel.Security.WindowsClientCredential> class is <xref:System.Security.Principal.TokenImpersonationLevel.Identification>.</span></span> <span data-ttu-id="53e7b-133">大多数情况下，标识级模拟上下文不具有加载任何其他程序集的权限。</span><span class="sxs-lookup"><span data-stu-id="53e7b-133">In most cases, an identification-level impersonation context has no rights to load any additional assemblies.</span></span> <span data-ttu-id="53e7b-134">这是默认值，因此这是一个需要注意的非常常见的条件。</span><span class="sxs-lookup"><span data-stu-id="53e7b-134">This is the default value, so this is a very common condition to be aware of.</span></span> <span data-ttu-id="53e7b-135">当模拟进程不具有 `SeImpersonate` 特权时，也会发生标识级模拟。</span><span class="sxs-lookup"><span data-stu-id="53e7b-135">Identification-level impersonation also occurs when the impersonating process does not have the `SeImpersonate` privilege.</span></span> <span data-ttu-id="53e7b-136">有关详细信息，请参阅[委托和模拟](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)。</span><span class="sxs-lookup"><span data-stu-id="53e7b-136">For more information, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
### <a name="delegation-requires-credential-negotiation"></a><span data-ttu-id="53e7b-137">委托要求凭据协商</span><span class="sxs-lookup"><span data-stu-id="53e7b-137">Delegation Requires Credential Negotiation</span></span>  
 <span data-ttu-id="53e7b-138">若要将 Kerberos 身份验证协议与委托联合使用，必须实现带有凭据协商的 Kerberos 协议（有时称作多段或多步 Kerberos）。</span><span class="sxs-lookup"><span data-stu-id="53e7b-138">To use the Kerberos authentication protocol with delegation, you must implement the Kerberos protocol with credential negotiation (sometimes called multi-leg or multi-step Kerberos).</span></span> <span data-ttu-id="53e7b-139">如果不用凭据协商来实现 Kerberos 协议（有时称作单稳或单路 Kerberos），则会引发异常。</span><span class="sxs-lookup"><span data-stu-id="53e7b-139">If you implement Kerberos authentication without credential negotiation (sometimes called one-shot or single-leg Kerberos), an exception is thrown.</span></span> <span data-ttu-id="53e7b-140">有关如何实现凭据协商的详细信息，请参阅[调试 Windows 身份验证错误](../../../../docs/framework/wcf/feature-details/debugging-windows-authentication-errors.md)。</span><span class="sxs-lookup"><span data-stu-id="53e7b-140">For more information about how to implement credential negotiation, see [Debugging Windows Authentication Errors](../../../../docs/framework/wcf/feature-details/debugging-windows-authentication-errors.md).</span></span>  
  
## <a name="cryptography"></a><span data-ttu-id="53e7b-141">密码</span><span class="sxs-lookup"><span data-stu-id="53e7b-141">Cryptography</span></span>  
  
### <a name="sha-256-supported-only-for-symmetric-key-usages"></a><span data-ttu-id="53e7b-142">仅为对称密钥的使用支持 SHA-256</span><span class="sxs-lookup"><span data-stu-id="53e7b-142">SHA-256 Supported Only for Symmetric Key Usages</span></span>  
 <span data-ttu-id="53e7b-143">WCF 支持的各种加密和签名摘要创建算法，可以指定在系统提供的绑定中使用的算法套件。</span><span class="sxs-lookup"><span data-stu-id="53e7b-143">WCF supports a variety of encryption and signature digest creation algorithms that you can specify using the algorithm suite in the system-provided bindings.</span></span> <span data-ttu-id="53e7b-144">为了提高安全性，WCF 支持安全哈希算法 (SHA) 2 算法，特别是 SHA-256，用于创建签名摘要哈希。</span><span class="sxs-lookup"><span data-stu-id="53e7b-144">For improved security, WCF supports Secure Hash Algorithm (SHA) 2 algorithms, specifically SHA-256, for creating signature digest hashes.</span></span> <span data-ttu-id="53e7b-145">此版本仅在使用对称密钥（例如，Kerberos 密钥）并且没有使用 X.509 证书对消息进行签名的情况下才支持 SHA-256。</span><span class="sxs-lookup"><span data-stu-id="53e7b-145">This release supports SHA-256 only for symmetric key usages, such as Kerberos keys, and where an X.509 certificate is not used to sign the message.</span></span> <span data-ttu-id="53e7b-146">WCF 不支持 RSA 签名 （在 X.509 证书） 对 RSA-SHA256 中使用由于当前不支持 SHA-256 哈希[!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)]。</span><span class="sxs-lookup"><span data-stu-id="53e7b-146">WCF does not support RSA signatures (used in X.509 certificates) using SHA-256 hash due to the current lack of support for RSA-SHA256 in the [!INCLUDE[vstecwinfx](../../../../includes/vstecwinfx-md.md)].</span></span>  
  
### <a name="fips-compliant-sha-256-hashes-not-supported"></a><span data-ttu-id="53e7b-147">不支持与 FIPS 兼容的 SHA-256 哈希</span><span class="sxs-lookup"><span data-stu-id="53e7b-147">FIPS-Compliant SHA-256 Hashes not Supported</span></span>  
 <span data-ttu-id="53e7b-148">WCF 不支持 SHA-256 符合 FIPS 的哈希值，因此，使用 SHA-256 的算法套件使用符合 FIPS 的算法是所需的系统上不支持由 WCF。</span><span class="sxs-lookup"><span data-stu-id="53e7b-148">WCF does not support SHA-256 FIPS-compliant hashes, so algorithm suites that use SHA-256 are not supported by WCF on systems where use of FIPS compliant algorithms is required.</span></span>  
  
### <a name="fips-compliant-algorithms-may-fail-if-registry-is-edited"></a><span data-ttu-id="53e7b-149">如果编辑注册表，与 FIPS 兼容的算法可能失败</span><span class="sxs-lookup"><span data-stu-id="53e7b-149">FIPS-Compliant Algorithms May Fail if Registry Is Edited</span></span>  
 <span data-ttu-id="53e7b-150">使用本地安全设置 Microsoft 管理控制台 (MMC) 管理单元，可以启用和禁用与美国联邦信息处理标准 (FIPS) 兼容的算法。</span><span class="sxs-lookup"><span data-stu-id="53e7b-150">You can enable and disable Federal Information Processing Standards (FIPS)-compliant algorithms by using the Local Security Settings Microsoft Management Console (MMC) snap-in.</span></span> <span data-ttu-id="53e7b-151">您还可以在注册表中访问该设置。</span><span class="sxs-lookup"><span data-stu-id="53e7b-151">You can also access the setting in the registry.</span></span> <span data-ttu-id="53e7b-152">但是，请注意，WCF 不支持使用注册表来重置的设置。</span><span class="sxs-lookup"><span data-stu-id="53e7b-152">Note, however, that WCF does not support using the registry to reset the setting.</span></span> <span data-ttu-id="53e7b-153">如果该值设置为除 1 或 0 之外的任何值，CLR 和操作系统之间就可能出现不一致的结果。</span><span class="sxs-lookup"><span data-stu-id="53e7b-153">If the value is set to anything other than 1 or 0, inconsistent results can occur between the CLR and the operating system.</span></span>  
  
### <a name="fips-compliant-aes-encryption-limitation"></a><span data-ttu-id="53e7b-154">与 FIPS 兼容的 AES 加密限制</span><span class="sxs-lookup"><span data-stu-id="53e7b-154">FIPS-Compliant AES Encryption Limitation</span></span>  
 <span data-ttu-id="53e7b-155">与 FIPS 兼容的 AES 加密无法在标识级模拟下以双工回调模式工作。</span><span class="sxs-lookup"><span data-stu-id="53e7b-155">FIPS compliant AES encryption does not work in duplex callbacks under identification level impersonation.</span></span>  
  
### <a name="cngksp-certificates"></a><span data-ttu-id="53e7b-156">CNG/KSP 证书</span><span class="sxs-lookup"><span data-stu-id="53e7b-156">CNG/KSP Certificates</span></span>  
 <span data-ttu-id="53e7b-157">*加密 API: Next Generation (CNG)* 是 CryptoAPI 的长期替代。</span><span class="sxs-lookup"><span data-stu-id="53e7b-157">*Cryptography API: Next Generation (CNG)* is the long-term replacement for the CryptoAPI.</span></span> <span data-ttu-id="53e7b-158">此 API 现已推出上的非托管代码[!INCLUDE[wv](../../../../includes/wv-md.md)]，[!INCLUDE[lserver](../../../../includes/lserver-md.md)]和更高版本的 Windows 版本。</span><span class="sxs-lookup"><span data-stu-id="53e7b-158">This API is available in unmanaged code on [!INCLUDE[wv](../../../../includes/wv-md.md)],  [!INCLUDE[lserver](../../../../includes/lserver-md.md)] and later Windows versions.</span></span>  
  
 <span data-ttu-id="53e7b-159">因为它们使用旧的 CryptoAPI 来处理 CNG/KSP 证书，.NET framework 4.6.1 及更早版本不支持这些证书。</span><span class="sxs-lookup"><span data-stu-id="53e7b-159">.NET Framework 4.6.1 and earlier versions do not support these certificates because they use the legacy CryptoAPI to handle CNG/KSP certificates.</span></span> <span data-ttu-id="53e7b-160">使用.NET Framework 4.6.1 及更早版本使用这些证书将导致异常。</span><span class="sxs-lookup"><span data-stu-id="53e7b-160">The use of these certificates with   .NET Framework 4.6.1 and earlier versions will cause an exception.</span></span>  
  
 <span data-ttu-id="53e7b-161">以下是判断证书是否使用 KSP 的两种可行方法：</span><span class="sxs-lookup"><span data-stu-id="53e7b-161">There are two possible ways to tell if a certificate uses KSP:</span></span>  
  
-   <span data-ttu-id="53e7b-162">对 `p/invoke` 执行 `CertGetCertificateContextProperty`，并对返回的 `dwProvType` 检查 `CertGetCertificateContextProperty`。</span><span class="sxs-lookup"><span data-stu-id="53e7b-162">Do a `p/invoke` of `CertGetCertificateContextProperty`, and inspect `dwProvType` on the returned `CertGetCertificateContextProperty`.</span></span>  
  
-   <span data-ttu-id="53e7b-163">使用`certutil`命令从命令行来查询证书。</span><span class="sxs-lookup"><span data-stu-id="53e7b-163">Use the  `certutil` command from the command line for querying certificates.</span></span> <span data-ttu-id="53e7b-164">有关详细信息，请参阅[证书疑难解答的 Certutil 任务](https://go.microsoft.com/fwlink/?LinkId=120056)。</span><span class="sxs-lookup"><span data-stu-id="53e7b-164">For more information, see [Certutil tasks for troubleshooting certificates](https://go.microsoft.com/fwlink/?LinkId=120056).</span></span>  
  
## <a name="message-security-fails-if-using-aspnet-impersonation-and-aspnet-compatibility-is-required"></a><span data-ttu-id="53e7b-165">如果要求使用 ASP.NET 模拟和 ASP.NET 兼容性，消息安全将失败</span><span class="sxs-lookup"><span data-stu-id="53e7b-165">Message Security Fails if Using ASP.NET Impersonation and ASP.NET Compatibility Is Required</span></span>  
 <span data-ttu-id="53e7b-166">WCF 不支持以下设置组合，因为它们可能会阻止客户端身份验证的发生：</span><span class="sxs-lookup"><span data-stu-id="53e7b-166">WCF does not support the following combination of settings because they can prevent client authentication from occurring:</span></span>  
  
-   <span data-ttu-id="53e7b-167">启用了 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 模拟。</span><span class="sxs-lookup"><span data-stu-id="53e7b-167">[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] Impersonation is enabled.</span></span> <span data-ttu-id="53e7b-168">这通过 Web.config 文件中设置`impersonate`属性的 <`identity`> 元素`true`。</span><span class="sxs-lookup"><span data-stu-id="53e7b-168">This is done in the Web.config file by setting the `impersonate` attribute of the <`identity`> element to `true`.</span></span>  
  
-   [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] <span data-ttu-id="53e7b-169">通过设置启用兼容性模式`aspNetCompatibilityEnabled`的属性[ \<serviceHostingEnvironment >](../../../../docs/framework/configure-apps/file-schema/wcf/servicehostingenvironment.md)到`true`。</span><span class="sxs-lookup"><span data-stu-id="53e7b-169"> compatibility mode is enabled by setting the `aspNetCompatibilityEnabled` attribute of the [\<serviceHostingEnvironment>](../../../../docs/framework/configure-apps/file-schema/wcf/servicehostingenvironment.md) to `true\`.</span></span>  
  
-   <span data-ttu-id="53e7b-170">使用了消息模式安全。</span><span class="sxs-lookup"><span data-stu-id="53e7b-170">Message mode security is used.</span></span>  
  
 <span data-ttu-id="53e7b-171">解决办法是禁用 [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] 兼容模式。</span><span class="sxs-lookup"><span data-stu-id="53e7b-171">The work-around is to turn off the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] compatibility mode.</span></span> <span data-ttu-id="53e7b-172">或者，如果[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]是必需的兼容性模式下，禁用[!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)]模拟功能，并改为使用 WCF 提供的模拟。</span><span class="sxs-lookup"><span data-stu-id="53e7b-172">Or, if the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] compatibility mode is required, disable the [!INCLUDE[vstecasp](../../../../includes/vstecasp-md.md)] impersonation feature and use WCF-provided impersonation instead.</span></span> <span data-ttu-id="53e7b-173">有关详细信息，请参阅[委托和模拟](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)。</span><span class="sxs-lookup"><span data-stu-id="53e7b-173">For more information, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
## <a name="ipv6-literal-address-failure"></a><span data-ttu-id="53e7b-174">IPv6 文本地址失败</span><span class="sxs-lookup"><span data-stu-id="53e7b-174">IPv6 Literal Address Failure</span></span>  
 <span data-ttu-id="53e7b-175">当客户端和服务位于同一台计算机上，并且为服务使用了 IPv6 文本地址时，安全请求将失败。</span><span class="sxs-lookup"><span data-stu-id="53e7b-175">Security requests fail when the client and service are on the same machine, and IPv6 literal addresses are used for the service.</span></span>  
  
 <span data-ttu-id="53e7b-176">如果服务和客户端位于不同的计算机上，IPv6 文本地址有效。</span><span class="sxs-lookup"><span data-stu-id="53e7b-176">Literal IPv6 addresses work if the service and client are on different machines.</span></span>  
  
## <a name="wsdl-retrieval-failures-with-federated-trust"></a><span data-ttu-id="53e7b-177">涉及联合信任的 WSDL 检索失败问题</span><span class="sxs-lookup"><span data-stu-id="53e7b-177">WSDL Retrieval Failures with Federated Trust</span></span>  
 <span data-ttu-id="53e7b-178">WCF 联合的信任链中每个节点需要一个 WSDL 文档。</span><span class="sxs-lookup"><span data-stu-id="53e7b-178">WCF requires exactly one WSDL document for each node in the federated trust chain.</span></span> <span data-ttu-id="53e7b-179">指定终结点时，务必不要设置循环。</span><span class="sxs-lookup"><span data-stu-id="53e7b-179">Be careful not to set up a loop when specifying endpoints.</span></span> <span data-ttu-id="53e7b-180">可能导致循环的一种情形是，将联合信任链的 WSDL 下载用于同一 WSDL 文档中的两个或多个链接。</span><span class="sxs-lookup"><span data-stu-id="53e7b-180">One way in which loops can arise is using a WSDL download of federated trust chains with two or more links in the same WSDL document.</span></span> <span data-ttu-id="53e7b-181">可能产生此问题的一个常见方案是联合服务，其中安全令牌服务器和服务包含在同一 ServiceHost 内。</span><span class="sxs-lookup"><span data-stu-id="53e7b-181">A common scenario that can produce this problem is a federated service where the Security Token Server and the service are contained inside the same ServiceHost.</span></span>  
  
 <span data-ttu-id="53e7b-182">举例来说，若某个服务具有以下三个终结点地址，便可能出现此情况：</span><span class="sxs-lookup"><span data-stu-id="53e7b-182">An example of this situation is a service with the following three endpoint addresses:</span></span>  
  
- <span data-ttu-id="53e7b-183">`http://localhost/CalculatorService/service` （服务）</span><span class="sxs-lookup"><span data-stu-id="53e7b-183">`http://localhost/CalculatorService/service` (the service)</span></span>  
  
- <span data-ttu-id="53e7b-184">`http://localhost/CalculatorService/issue_ticket` (STS)</span><span class="sxs-lookup"><span data-stu-id="53e7b-184">`http://localhost/CalculatorService/issue_ticket` (the STS)</span></span>  
  
- <span data-ttu-id="53e7b-185">`http://localhost/CalculatorService/mex` （元数据终结点）</span><span class="sxs-lookup"><span data-stu-id="53e7b-185">`http://localhost/CalculatorService/mex` (the metadata endpoint)</span></span>  
  
 <span data-ttu-id="53e7b-186">这将引发异常。</span><span class="sxs-lookup"><span data-stu-id="53e7b-186">This throws an exception.</span></span>  
  
 <span data-ttu-id="53e7b-187">若将 `issue_ticket` 终结点放在其他地方，此方案便可正常工作。</span><span class="sxs-lookup"><span data-stu-id="53e7b-187">You can make this scenario work by putting the `issue_ticket` endpoint elsewhere.</span></span>  
  
## <a name="wsdl-import-attributes-can-be-lost"></a><span data-ttu-id="53e7b-188">WSDL 导入属性可能会丢失</span><span class="sxs-lookup"><span data-stu-id="53e7b-188">WSDL Import Attributes can be Lost</span></span>  
 <span data-ttu-id="53e7b-189">执行 WSDL 导入时，WCF 丢失了对 `<wst:Claims>` 模板中 `RST` 元素的属性的跟踪。</span><span class="sxs-lookup"><span data-stu-id="53e7b-189">WCF loses track of the attributes on a `<wst:Claims>` element in an `RST` template when doing a WSDL import.</span></span> <span data-ttu-id="53e7b-190">如果在 `<Claims>` 或 `WSFederationHttpBinding.Security.Message.TokenRequestParameters` 中直接指定 `IssuedSecurityTokenRequestParameters.AdditionalRequestParameters`，而不是直接使用声明类型集合，则在 WSDL 导入期间会发生此情况。</span><span class="sxs-lookup"><span data-stu-id="53e7b-190">This happens during a WSDL import if you specify `<Claims>` directly in `WSFederationHttpBinding.Security.Message.TokenRequestParameters` or `IssuedSecurityTokenRequestParameters.AdditionalRequestParameters` instead of using the claim type collections directly.</span></span>  <span data-ttu-id="53e7b-191">由于导入丢失了特性，绑定没有通过 WSDL 正确地往返，因此它在客户端上是不正确的。</span><span class="sxs-lookup"><span data-stu-id="53e7b-191">Since the import loses the attributes, the binding does not round trip properly through WSDL and hence is incorrect on the client side.</span></span>  
  
 <span data-ttu-id="53e7b-192">解决方法是，导入完毕后直接在客户端上修改绑定。</span><span class="sxs-lookup"><span data-stu-id="53e7b-192">The fix is to modify the binding directly on the client after doing the import.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="53e7b-193">请参阅</span><span class="sxs-lookup"><span data-stu-id="53e7b-193">See Also</span></span>  
 [<span data-ttu-id="53e7b-194">安全注意事项</span><span class="sxs-lookup"><span data-stu-id="53e7b-194">Security Considerations</span></span>](../../../../docs/framework/wcf/feature-details/security-considerations-in-wcf.md)  
 [<span data-ttu-id="53e7b-195">信息泄漏</span><span class="sxs-lookup"><span data-stu-id="53e7b-195">Information Disclosure</span></span>](../../../../docs/framework/wcf/feature-details/information-disclosure.md)  
 [<span data-ttu-id="53e7b-196">特权提升</span><span class="sxs-lookup"><span data-stu-id="53e7b-196">Elevation of Privilege</span></span>](../../../../docs/framework/wcf/feature-details/elevation-of-privilege.md)  
 [<span data-ttu-id="53e7b-197">拒绝服务</span><span class="sxs-lookup"><span data-stu-id="53e7b-197">Denial of Service</span></span>](../../../../docs/framework/wcf/feature-details/denial-of-service.md)  
 [<span data-ttu-id="53e7b-198">篡改</span><span class="sxs-lookup"><span data-stu-id="53e7b-198">Tampering</span></span>](../../../../docs/framework/wcf/feature-details/tampering.md)  
 [<span data-ttu-id="53e7b-199">重放攻击</span><span class="sxs-lookup"><span data-stu-id="53e7b-199">Replay Attacks</span></span>](../../../../docs/framework/wcf/feature-details/replay-attacks.md)
