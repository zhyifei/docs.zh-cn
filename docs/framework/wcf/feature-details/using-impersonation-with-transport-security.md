---
title: "将模拟用于传输安全"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.technology: dotnet-clr
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 426df8cb-6337-4262-b2c0-b96c2edf21a9
caps.latest.revision: "12"
author: BrucePerlerMS
ms.author: bruceper
manager: mbaldwin
ms.workload: dotnet
ms.openlocfilehash: 57b40493d0e9bcbbaaf1366c74ff116343f6ee96
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/22/2017
---
# <a name="using-impersonation-with-transport-security"></a><span data-ttu-id="914fd-102">将模拟用于传输安全</span><span class="sxs-lookup"><span data-stu-id="914fd-102">Using Impersonation with Transport Security</span></span>
<span data-ttu-id="914fd-103">*模拟*是客户端的标识对其执行的服务器应用程序的功能。</span><span class="sxs-lookup"><span data-stu-id="914fd-103">*Impersonation* is the ability of a server application to take on the identity of the client.</span></span> <span data-ttu-id="914fd-104">服务在验证对资源的访问时常常使用模拟。</span><span class="sxs-lookup"><span data-stu-id="914fd-104">It is common for services to use impersonation when validating access to resources.</span></span> <span data-ttu-id="914fd-105">服务器应用程序使用服务帐户运行，但当服务器接受客户端连接时，它模拟客户端，以便使用客户端凭据执行访问检查。</span><span class="sxs-lookup"><span data-stu-id="914fd-105">The server application runs using a service account, but when the server accepts a client connection, it impersonates the client so that access checks are performed using the client's credentials.</span></span> <span data-ttu-id="914fd-106">传输安全是一种传递凭据和使用这些凭据确保通信安全的机制。</span><span class="sxs-lookup"><span data-stu-id="914fd-106">Transport security is a mechanism both for passing credentials and securing communication using those credentials.</span></span> <span data-ttu-id="914fd-107">本主题介绍如何将 [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] 中的传输安全性与模拟功能结合使用。</span><span class="sxs-lookup"><span data-stu-id="914fd-107">This topic describes using transport security in [!INCLUDE[indigo1](../../../../includes/indigo1-md.md)] with the impersonation feature.</span></span> [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="914fd-108">模拟使用消息安全，请参阅[委托和模拟](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)。</span><span class="sxs-lookup"><span data-stu-id="914fd-108"> impersonation using message security, see [Delegation and Impersonation](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md).</span></span>  
  
## <a name="five-impersonation-levels"></a><span data-ttu-id="914fd-109">五个模拟级别</span><span class="sxs-lookup"><span data-stu-id="914fd-109">Five Impersonation Levels</span></span>  
 <span data-ttu-id="914fd-110">传输安全使用五级模拟，如下表所述。</span><span class="sxs-lookup"><span data-stu-id="914fd-110">Transport security makes use of five levels of impersonation, as described in the following table.</span></span>  
  
|<span data-ttu-id="914fd-111">模拟级别</span><span class="sxs-lookup"><span data-stu-id="914fd-111">Impersonation level</span></span>|<span data-ttu-id="914fd-112">描述</span><span class="sxs-lookup"><span data-stu-id="914fd-112">Description</span></span>|  
|-------------------------|-----------------|  
|<span data-ttu-id="914fd-113">无</span><span class="sxs-lookup"><span data-stu-id="914fd-113">None</span></span>|<span data-ttu-id="914fd-114">服务器应用程序不尝试模拟客户端。</span><span class="sxs-lookup"><span data-stu-id="914fd-114">The server application does not attempt to impersonate the client.</span></span>|  
|<span data-ttu-id="914fd-115">匿名</span><span class="sxs-lookup"><span data-stu-id="914fd-115">Anonymous</span></span>|<span data-ttu-id="914fd-116">服务器应用程序可以对照客户端凭据执行访问检查，但不接收有关客户端标识的任何信息。</span><span class="sxs-lookup"><span data-stu-id="914fd-116">The server application can perform access checks against the client's credentials, but does not receive any information about the client's identity.</span></span> <span data-ttu-id="914fd-117">此模拟级别仅对计算机上的通信（例如命名管道）有意义。</span><span class="sxs-lookup"><span data-stu-id="914fd-117">This impersonation level is meaningful only for on-machine communication, such as named pipes.</span></span> <span data-ttu-id="914fd-118">将 `Anonymous` 用于远程连接会将模拟级别提高到 Identify。</span><span class="sxs-lookup"><span data-stu-id="914fd-118">Using `Anonymous` with a remote connection promotes the impersonation level to Identify.</span></span>|  
|<span data-ttu-id="914fd-119">Identify</span><span class="sxs-lookup"><span data-stu-id="914fd-119">Identify</span></span>|<span data-ttu-id="914fd-120">服务器应用程序知道客户端的标识，并且可以对照客户端凭据执行访问验证，但不能模拟客户端。</span><span class="sxs-lookup"><span data-stu-id="914fd-120">The server application knows the client's identity and can perform access validation against the client's credentials, but cannot impersonate the client.</span></span> <span data-ttu-id="914fd-121">在 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中，Identify 是用于 SSPI 凭据的默认模拟级别，除非令牌提供程序提供其他模拟级别。</span><span class="sxs-lookup"><span data-stu-id="914fd-121">Identify is the default impersonation level used with SSPI credentials in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] unless the token provider provides a different impersonation level.</span></span>|  
|<span data-ttu-id="914fd-122">Impersonate</span><span class="sxs-lookup"><span data-stu-id="914fd-122">Impersonate</span></span>|<span data-ttu-id="914fd-123">服务器应用程序除了执行访问检查以外，还可以像客户端一样访问服务器计算机上的资源。</span><span class="sxs-lookup"><span data-stu-id="914fd-123">The server application can access resources on the server machine as the client in addition to performing access checks.</span></span> <span data-ttu-id="914fd-124">服务器应用程序不能使用客户端标识访问远程计算机上的资源，这是因为模拟的令牌没有网络凭据</span><span class="sxs-lookup"><span data-stu-id="914fd-124">The server application cannot access resources on remote machines using the client's identity because the impersonated token does not have network credentials</span></span>|  
|<span data-ttu-id="914fd-125">委托</span><span class="sxs-lookup"><span data-stu-id="914fd-125">Delegate</span></span>|<span data-ttu-id="914fd-126">Delegate 模拟级别具有 `Impersonate` 的功能，此外，服务器应用程序通过该模拟级别，还可以使用客户端标识访问远程计算机上的资源，并可将标识传递给其他应用程序。</span><span class="sxs-lookup"><span data-stu-id="914fd-126">In addition to having the same capabilities as `Impersonate`, the Delegate impersonation level also enables the server application to access resources on remote machines using the client's identity and to pass the identity to other applications.</span></span><br /><br /> <span data-ttu-id="914fd-127">**重要**服务器域帐户必须标记为受信任，才能使用这些附加功能的域控制器上的委托。</span><span class="sxs-lookup"><span data-stu-id="914fd-127">**Important** The server domain account must be marked as trusted for delegation on the domain controller to use these additional features.</span></span> <span data-ttu-id="914fd-128">模拟级别不能用于标记为敏感的客户端域帐户。</span><span class="sxs-lookup"><span data-stu-id="914fd-128">This level of impersonation cannot be used with client domain accounts marked as sensitive.</span></span>|  
  
 <span data-ttu-id="914fd-129">最常用于传输安全的级别是`Identify`和`Impersonate`。</span><span class="sxs-lookup"><span data-stu-id="914fd-129">The levels most commonly used with transport security are `Identify` and `Impersonate`.</span></span> <span data-ttu-id="914fd-130">在典型用法中，不建议使用 `None` 和 `Anonymous` 级别，许多传输协议不支持在身份验证中使用这些级别。</span><span class="sxs-lookup"><span data-stu-id="914fd-130">The levels `None` and `Anonymous` are not recommended for typical use, and many transports do not support using those levels with authentication.</span></span> <span data-ttu-id="914fd-131">`Delegate` 级别功能强大，应谨慎使用。</span><span class="sxs-lookup"><span data-stu-id="914fd-131">The `Delegate` level is a powerful feature that should be used with care.</span></span> <span data-ttu-id="914fd-132">只应向受信任的服务器应用程序授予委托凭据的权限。</span><span class="sxs-lookup"><span data-stu-id="914fd-132">Only trusted server applications should be given the permission to delegate credentials.</span></span>  
  
 <span data-ttu-id="914fd-133">若要使用 `Impersonate` 或 `Delegate` 级别的模拟，服务器应用程序需要具有 `SeImpersonatePrivilege` 权限。</span><span class="sxs-lookup"><span data-stu-id="914fd-133">Using impersonation at the `Impersonate` or `Delegate` levels requires the server application to have the `SeImpersonatePrivilege` privilege.</span></span> <span data-ttu-id="914fd-134">如果在 Administrators 组中的帐户下运行，或在具有服务 SID（网络服务、本地服务或本地系统）的帐户下运行，则默认情况下，应用程序具有此权限。</span><span class="sxs-lookup"><span data-stu-id="914fd-134">An application has this privilege by default if it is running on an account in the Administrators group or on an account with a Service SID (Network Service, Local Service, or Local System).</span></span> <span data-ttu-id="914fd-135">模拟不要求客户端和服务器相互进行身份验证。</span><span class="sxs-lookup"><span data-stu-id="914fd-135">Impersonation does not require mutual authentication of the client and server.</span></span> <span data-ttu-id="914fd-136">某些支持模拟的身份验证方案（例如 NTLM）不能用于相互身份验证。</span><span class="sxs-lookup"><span data-stu-id="914fd-136">Some authentication schemes that support impersonation, such as NTLM, cannot be used with mutual authentication.</span></span>  
  
## <a name="transport-specific-issues-with-impersonation"></a><span data-ttu-id="914fd-137">特定于传输协议的模拟问题</span><span class="sxs-lookup"><span data-stu-id="914fd-137">Transport-Specific Issues with Impersonation</span></span>  
 <span data-ttu-id="914fd-138">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中选择的传输协议会影响可选的模拟。</span><span class="sxs-lookup"><span data-stu-id="914fd-138">The choice of a transport in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] affects the possible choices for impersonation.</span></span> <span data-ttu-id="914fd-139">本节介绍在 [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中影响标准 HTTP 和命名管道传输协议的一些问题。</span><span class="sxs-lookup"><span data-stu-id="914fd-139">This section describes issues affecting the standard HTTP and named pipe transports in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)].</span></span> <span data-ttu-id="914fd-140">自定义传输协议在对模拟的支持上有自己的限制。</span><span class="sxs-lookup"><span data-stu-id="914fd-140">Custom transports have their own restrictions on support for impersonation.</span></span>  
  
### <a name="named-pipe-transport"></a><span data-ttu-id="914fd-141">命名管道传输协议</span><span class="sxs-lookup"><span data-stu-id="914fd-141">Named Pipe Transport</span></span>  
 <span data-ttu-id="914fd-142">使用命名管道传输协议时，请注意以下事项：</span><span class="sxs-lookup"><span data-stu-id="914fd-142">The following items are used with the named pipe transport:</span></span>  
  
-   <span data-ttu-id="914fd-143">命名管道传输协议应仅用在本地计算机上。</span><span class="sxs-lookup"><span data-stu-id="914fd-143">The named pipe transport is intended for use only on the local machine.</span></span> <span data-ttu-id="914fd-144">[!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] 中的命名管道传输协议显式禁止跨计算机连接。</span><span class="sxs-lookup"><span data-stu-id="914fd-144">The named pipe transport in [!INCLUDE[indigo2](../../../../includes/indigo2-md.md)] explicitly disallows cross-machine connections.</span></span>  
  
-   <span data-ttu-id="914fd-145">命名管道不能用在 `Impersonate` 或 `Delegate` 模拟级别上。</span><span class="sxs-lookup"><span data-stu-id="914fd-145">Named pipes cannot be used with the `Impersonate` or `Delegate` impersonation level.</span></span> <span data-ttu-id="914fd-146">命名管道不能在这些模拟级别实施计算机上的保证。</span><span class="sxs-lookup"><span data-stu-id="914fd-146">The named pipe cannot enforce the on-machine guarantee at these impersonation levels.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="914fd-147">命名管道，请参阅[选择传输](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)。</span><span class="sxs-lookup"><span data-stu-id="914fd-147"> named pipes, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span></span>  
  
### <a name="http-transport"></a><span data-ttu-id="914fd-148">HTTP 传输协议</span><span class="sxs-lookup"><span data-stu-id="914fd-148">HTTP Transport</span></span>  
 <span data-ttu-id="914fd-149">使用 HTTP 传输的绑定 (<xref:System.ServiceModel.WSHttpBinding>和<xref:System.ServiceModel.BasicHttpBinding>) 中所述支持多个身份验证方案，[了解 HTTP 身份验证](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md)。</span><span class="sxs-lookup"><span data-stu-id="914fd-149">The bindings that use the HTTP transport (<xref:System.ServiceModel.WSHttpBinding> and <xref:System.ServiceModel.BasicHttpBinding>) support several authentication schemes, as explained in [Understanding HTTP Authentication](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md).</span></span> <span data-ttu-id="914fd-150">支持的模拟级别取决于身份验证方案。</span><span class="sxs-lookup"><span data-stu-id="914fd-150">The impersonation level supported depends on the authentication scheme.</span></span> <span data-ttu-id="914fd-151">使用 HTTP 传输协议时，请注意以下事项：</span><span class="sxs-lookup"><span data-stu-id="914fd-151">The following items are used with the HTTP transport:</span></span>  
  
-   <span data-ttu-id="914fd-152">`Anonymous` 身份验证方案忽略模拟。</span><span class="sxs-lookup"><span data-stu-id="914fd-152">The `Anonymous` authentication scheme ignores impersonation.</span></span>  
  
-   <span data-ttu-id="914fd-153">`Basic`身份验证方案仅支持`Delegate`级别。</span><span class="sxs-lookup"><span data-stu-id="914fd-153">The `Basic` authentication scheme supports only the `Delegate` level.</span></span> <span data-ttu-id="914fd-154">所有低于此级别的模拟级别都会升级。</span><span class="sxs-lookup"><span data-stu-id="914fd-154">All lower impersonation levels are upgraded.</span></span>  
  
-   <span data-ttu-id="914fd-155">`Digest` 身份验证方案仅支持 `Impersonate` 和 `Delegate` 级别。</span><span class="sxs-lookup"><span data-stu-id="914fd-155">The `Digest` authentication scheme supports only the `Impersonate` and `Delegate` levels.</span></span>  
  
-   <span data-ttu-id="914fd-156">`NTLM` 身份验证方案（可直接选择或通过协商选择）仅在本地计算机上支持 `Delegate` 级别。</span><span class="sxs-lookup"><span data-stu-id="914fd-156">The `NTLM` authentication scheme, selectable either directly or through negotiation, supports only the `Delegate` level on the local machine.</span></span>  
  
-   <span data-ttu-id="914fd-157">Kerberos 身份验证方案（只能通过协商选择）可用于任何受支持的模拟级别。</span><span class="sxs-lookup"><span data-stu-id="914fd-157">The Kerberos authentication scheme, which can only be selected through negotiation, can be used with any supported impersonation level.</span></span>  
  
 [!INCLUDE[crabout](../../../../includes/crabout-md.md)]<span data-ttu-id="914fd-158">HTTP 传输，请参阅[选择传输](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md)。</span><span class="sxs-lookup"><span data-stu-id="914fd-158"> the HTTP transport, see [Choosing a Transport](../../../../docs/framework/wcf/feature-details/choosing-a-transport.md).</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="914fd-159">请参阅</span><span class="sxs-lookup"><span data-stu-id="914fd-159">See Also</span></span>  
 [<span data-ttu-id="914fd-160">委托和模拟</span><span class="sxs-lookup"><span data-stu-id="914fd-160">Delegation and Impersonation</span></span>](../../../../docs/framework/wcf/feature-details/delegation-and-impersonation-with-wcf.md)  
 [<span data-ttu-id="914fd-161">授权</span><span class="sxs-lookup"><span data-stu-id="914fd-161">Authorization</span></span>](../../../../docs/framework/wcf/feature-details/authorization-in-wcf.md)  
 [<span data-ttu-id="914fd-162">如何：在服务上模拟客户端</span><span class="sxs-lookup"><span data-stu-id="914fd-162">How to: Impersonate a Client on a Service</span></span>](../../../../docs/framework/wcf/how-to-impersonate-a-client-on-a-service.md)  
 [<span data-ttu-id="914fd-163">了解 HTTP 身份验证</span><span class="sxs-lookup"><span data-stu-id="914fd-163">Understanding HTTP Authentication</span></span>](../../../../docs/framework/wcf/feature-details/understanding-http-authentication.md)
