---
title: 在 Windows 服务应用程序中承载
ms.date: 03/30/2017
ms.assetid: f4199998-27f3-4dd9-aee4-0a4addfa9f24
ms.openlocfilehash: a07aade4619b644dadd1d5acdcb5252b305b94d0
ms.sourcegitcommit: c01c18755bb7b0f82c7232314ccf7955ea7834db
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/15/2020
ms.locfileid: "75964493"
---
# <a name="hosting-in-a-windows-service-application"></a><span data-ttu-id="e80eb-102">在 Windows 服务应用程序中承载</span><span class="sxs-lookup"><span data-stu-id="e80eb-102">Hosting in a Windows Service Application</span></span>
<span data-ttu-id="e80eb-103">Windows 服务（以前称为 Windows NT 服务）提供了一种尤其适合于下面这样的应用程序的进程模型：必须在长时间运行的可执行程序中生存，并且不显示任何形式的用户界面。</span><span class="sxs-lookup"><span data-stu-id="e80eb-103">Windows services (formerly known as Windows NT services) provide a process model particularly suited to applications that must live in a long-running executable and do not display any form of user interface.</span></span> <span data-ttu-id="e80eb-104">Windows 服务应用程序的进程生存期由服务控制管理器 (SCM) 管理，您可以通过该管理器启动、停止和暂停 Windows 服务应用程序。</span><span class="sxs-lookup"><span data-stu-id="e80eb-104">The process lifetime of a Windows service application is managed by the service control manager (SCM), which allows you to start, stop, and pause Windows service applications.</span></span> <span data-ttu-id="e80eb-105">你可以将 Windows 服务进程配置为在计算机启动时自动启动，使其成为适用于 "alwayson" 应用程序的合适宿主环境。</span><span class="sxs-lookup"><span data-stu-id="e80eb-105">You can configure a Windows service process to start automatically when the computer starts, making it a suitable hosting environment for "always on" applications.</span></span> <span data-ttu-id="e80eb-106">有关 Windows 服务应用程序的详细信息，请参阅[Windows 服务应用程序](https://go.microsoft.com/fwlink/?LinkId=89450)。</span><span class="sxs-lookup"><span data-stu-id="e80eb-106">For more information about Windows service applications, see [Windows Service Applications](https://go.microsoft.com/fwlink/?LinkId=89450).</span></span>  
  
 <span data-ttu-id="e80eb-107">承载长时间运行的 Windows Communication Foundation （WCF）服务的应用程序与 Windows 服务共享许多特性。</span><span class="sxs-lookup"><span data-stu-id="e80eb-107">Applications that host long-running Windows Communication Foundation (WCF) services share many characteristics with Windows services.</span></span> <span data-ttu-id="e80eb-108">特别是，WCF 服务是长时间运行的服务器可执行文件，这些可执行文件不会直接与用户交互，因此不实现任何形式的用户界面。</span><span class="sxs-lookup"><span data-stu-id="e80eb-108">In particular, WCF services are long-running server executables that do not interact directly with the user and therefore do not implement any form of user interface.</span></span> <span data-ttu-id="e80eb-109">同样，在 Windows 服务应用程序中托管 WCF 服务是一种用于生成可靠、长时间运行的 WCF 应用程序的选项。</span><span class="sxs-lookup"><span data-stu-id="e80eb-109">As such, hosting WCF services inside of a Windows service application is one option for building robust, long-running, WCF applications.</span></span>  
  
 <span data-ttu-id="e80eb-110">通常，WCF 开发人员必须决定是在 Windows 服务应用程序内部还是在 Internet Information Services （IIS）或 Windows 进程激活服务（WAS）宿主环境内承载其 WCF 应用程序。</span><span class="sxs-lookup"><span data-stu-id="e80eb-110">Often, WCF developers must decide whether to host their WCF application inside of a Windows service application or inside of the Internet Information Services (IIS) or Windows Process Activation Service (WAS) hosting environment.</span></span> <span data-ttu-id="e80eb-111">在下列条件下，应考虑使用 Windows 服务应用程序：</span><span class="sxs-lookup"><span data-stu-id="e80eb-111">You should consider using Windows service applications under the following conditions:</span></span>  
  
- <span data-ttu-id="e80eb-112">应用程序要求显式激活。</span><span class="sxs-lookup"><span data-stu-id="e80eb-112">Your application requires explicit activation.</span></span> <span data-ttu-id="e80eb-113">例如，在服务器启动时应用程序必须自动启动（而不是动态启动以响应第一个传入消息）的条件下，应使用 Windows 服务。</span><span class="sxs-lookup"><span data-stu-id="e80eb-113">For example, you should use Windows services when your application must start automatically when the server starts instead of being dynamically started in response to the first incoming message.</span></span>  
  
- <span data-ttu-id="e80eb-114">承载应用程序的进程必须在启动后保持运行状态。</span><span class="sxs-lookup"><span data-stu-id="e80eb-114">The process that hosts your application must remain running once started.</span></span> <span data-ttu-id="e80eb-115">Windows 服务进程一旦启动将一直保持运行状态，直到服务器管理员使用服务控制管理器显式关闭该进程。</span><span class="sxs-lookup"><span data-stu-id="e80eb-115">Once started, a Windows service process remains running unless explicitly shut down by a server administrator using the service control manager.</span></span> <span data-ttu-id="e80eb-116">在 IIS 或 WAS 中承载的应用程序可能会动态地启动和停止，以便最佳地使用系统资源。</span><span class="sxs-lookup"><span data-stu-id="e80eb-116">Applications hosted in IIS or WAS may be started and stopped dynamically to make optimal use of system resources.</span></span> <span data-ttu-id="e80eb-117">需要显式控制其托管进程的生存期的应用程序应使用 Windows 服务而非 IIS 或 WAS。</span><span class="sxs-lookup"><span data-stu-id="e80eb-117">Applications that require explicit control over the lifetime of their hosting process should use Windows services instead of IIS or WAS.</span></span>  
  
- <span data-ttu-id="e80eb-118">WCF 服务必须在 Windows Server 2003 上运行，并使用 HTTP 以外的其他传输。</span><span class="sxs-lookup"><span data-stu-id="e80eb-118">Your WCF service must run on Windows Server 2003 and use transports other than HTTP.</span></span> <span data-ttu-id="e80eb-119">在 Windows Server 2003 上，IIS 6.0 宿主环境仅限于 HTTP 通信。</span><span class="sxs-lookup"><span data-stu-id="e80eb-119">On Windows Server 2003, the IIS 6.0 hosting environment is restricted to HTTP communication only.</span></span> <span data-ttu-id="e80eb-120">Windows 服务应用程序不受此限制的限制，可以使用任何传输 WCF 支持，包括 net.tcp、net.pipe 和 net.tcp。</span><span class="sxs-lookup"><span data-stu-id="e80eb-120">Windows service applications are not subject to this restriction and can use any transport WCF supports, including net.tcp, net.pipe, and net.msmq.</span></span>  
  
### <a name="to-host-wcf-inside-of-a-windows-service-application"></a><span data-ttu-id="e80eb-121">在 Windows 服务应用程序内承载 WCF</span><span class="sxs-lookup"><span data-stu-id="e80eb-121">To host WCF inside of a Windows service application</span></span>  
  
1. <span data-ttu-id="e80eb-122">创建 Windows 服务应用程序。</span><span class="sxs-lookup"><span data-stu-id="e80eb-122">Create a Windows service application.</span></span> <span data-ttu-id="e80eb-123">可以使用 <xref:System.ServiceProcess> 命名空间中的类以托管代码的形式编写 Windows 服务应用程序。</span><span class="sxs-lookup"><span data-stu-id="e80eb-123">You can write Windows service applications in managed code using the classes in the <xref:System.ServiceProcess> namespace.</span></span> <span data-ttu-id="e80eb-124">此应用程序必须包含一个继承自 <xref:System.ServiceProcess.ServiceBase> 的类。</span><span class="sxs-lookup"><span data-stu-id="e80eb-124">This application must include one class that inherits from <xref:System.ServiceProcess.ServiceBase>.</span></span>  
  
2. <span data-ttu-id="e80eb-125">将 WCF 服务的生存期链接到 Windows 服务应用程序的生存期。</span><span class="sxs-lookup"><span data-stu-id="e80eb-125">Link the lifetime of the WCF services to the lifetime of the Windows service application.</span></span> <span data-ttu-id="e80eb-126">通常，你希望 Windows 服务应用程序中托管的 WCF 服务在宿主服务启动时变为活动状态，停止在托管服务上侦听消息，并在 WCF 服务遇到错误时关闭宿主进程。</span><span class="sxs-lookup"><span data-stu-id="e80eb-126">Typically, you want WCF services hosted in a Windows service application to become active when the hosting service starts, stop listening for messages when the hosting service is stopped, and shut down the hosting process when the WCF service encounters an error.</span></span> <span data-ttu-id="e80eb-127">这可以通过以下操作实现：</span><span class="sxs-lookup"><span data-stu-id="e80eb-127">This can be accomplished as follows:</span></span>  
  
    - <span data-ttu-id="e80eb-128">重写 <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> 以打开一个或多个 <xref:System.ServiceModel.ServiceHost> 实例。</span><span class="sxs-lookup"><span data-stu-id="e80eb-128">Override <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29> to open one or more instances of <xref:System.ServiceModel.ServiceHost>.</span></span> <span data-ttu-id="e80eb-129">单个 Windows 服务应用程序可以托管多个以组的形式启动和停止的 WCF 服务。</span><span class="sxs-lookup"><span data-stu-id="e80eb-129">A single Windows service application can host multiple WCF services that start and stop as a group.</span></span>  
  
    - <span data-ttu-id="e80eb-130">重写 <xref:System.ServiceProcess.ServiceBase.OnStop%2A>，以对在 <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>期间启动的任何正在运行的 WCF 服务 <xref:System.ServiceModel.ServiceHost> 调用 <xref:System.ServiceModel.Channels.CommunicationObject.Closed>。</span><span class="sxs-lookup"><span data-stu-id="e80eb-130">Override <xref:System.ServiceProcess.ServiceBase.OnStop%2A> to call <xref:System.ServiceModel.Channels.CommunicationObject.Closed> on the <xref:System.ServiceModel.ServiceHost> any running WCF services that were started during <xref:System.ServiceProcess.ServiceBase.OnStart%28System.String%5B%5D%29>.</span></span>  
  
    - <span data-ttu-id="e80eb-131">订阅 <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> 的 <xref:System.ServiceModel.ServiceHost> 事件，并使用 <xref:System.ServiceProcess.ServiceController> 类以在出现错误时关闭 Windows 服务应用程序。</span><span class="sxs-lookup"><span data-stu-id="e80eb-131">Subscribe to the <xref:System.ServiceModel.Channels.CommunicationObject.Faulted> event of <xref:System.ServiceModel.ServiceHost> and use the <xref:System.ServiceProcess.ServiceController> class to shut down the Windows service application in case of error.</span></span>  
  
     <span data-ttu-id="e80eb-132">部署和管理承载 WCF 服务的 windows 服务应用程序的方式与未使用 WCF 的 Windows 服务应用程序相同。</span><span class="sxs-lookup"><span data-stu-id="e80eb-132">Windows service applications that host WCF services are deployed and managed in the same way as Windows service applications that do not make use of WCF.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="e80eb-133">另请参阅</span><span class="sxs-lookup"><span data-stu-id="e80eb-133">See also</span></span>

- <xref:System.ServiceProcess>
- [<span data-ttu-id="e80eb-134">演练：在组件设计器中创建 Windows 服务应用程序</span><span class="sxs-lookup"><span data-stu-id="e80eb-134">Walkthrough: Creating a Windows Service Application in the Component Designer</span></span>](https://go.microsoft.com/fwlink/?LinkId=94875)
- [<span data-ttu-id="e80eb-135">如何：在托管 Windows 服务中承载 WCF 服务</span><span class="sxs-lookup"><span data-stu-id="e80eb-135">How to: Host a WCF Service in a Managed Windows Service</span></span>](../../../../docs/framework/wcf/feature-details/how-to-host-a-wcf-service-in-a-managed-windows-service.md)
- [<span data-ttu-id="e80eb-136">Windows 服务主机</span><span class="sxs-lookup"><span data-stu-id="e80eb-136">Windows Service Host</span></span>](../../../../docs/framework/wcf/samples/windows-service-host.md)
- [<span data-ttu-id="e80eb-137">服务应用程序编程体系结构</span><span class="sxs-lookup"><span data-stu-id="e80eb-137">Service Application Programming Architecture</span></span>](https://go.microsoft.com/fwlink/?LinkId=94876)
- <span data-ttu-id="e80eb-138">[Windows Server App Fabric 承载功能](https://docs.microsoft.com/previous-versions/appfabric/ee677189(v=azure.10))</span><span class="sxs-lookup"><span data-stu-id="e80eb-138">[Windows Server App Fabric Hosting Features](https://docs.microsoft.com/previous-versions/appfabric/ee677189(v=azure.10))</span></span>
