---
title: "PNRP 缓存"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 270068d9-1b6b-4eb9-9e14-e02326bb88df
caps.latest.revision: "4"
author: mcleblanc
ms.author: markl
manager: markl
ms.workload: dotnet
ms.openlocfilehash: dc9476b546ea55234c536a34416efc2bff0166de
ms.sourcegitcommit: 16186c34a957fdd52e5db7294f291f7530ac9d24
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/22/2017
---
# <a name="pnrp-caches"></a>PNRP 缓存
对等名称解析协议 (PNRP) 缓存是对等机上维护的算法选择的对等终结点的本地集合。  
  
## <a name="pnrp-cache-initialization"></a>PNRP 缓存初始化  
 若要初始化 PNRP 缓存或对等名称记录集合，当对等节点启动时节点可以使用以下方法：  
  
-   从硬盘存储中加载节点关闭时出现的持久性缓存条目。  
  
-   如果应用程序使用 P2P 协作基础结构，将在该节点的联系人管理器中提供协作信息。  
  
## <a name="scaling-peer-name-resolution-with-a-multi-level-cache"></a>使用多级别缓存缩放对等名称解析  
 若要保持较小的 PNRP 缓存大小，对等节点将使用多级别缓存，其中每个级别包含最大数目的条目。 缓存中的每个级别代表 PNRP ID 数值空间 (2<sup>256</sup>) 的十分之一较小部分。 缓存中最低的级别包含本地注册的 PNRP ID 和其他数字上相近的 PNRP ID。 当缓存级别填充了多达 20 个条目时，会创建新的较低级别。 缓存中级别的最大数目近似于 log10(云中 PNRP ID 的总数)。 例如，对于有 1 亿 PNRP ID 的全局云，存在不超过 8 (=log10(100,000,000)) 个的缓存级别，以及相似数量的跃点以在名称解析期间解析 PNRP ID。 这一机制允许分布式哈希表，可为此哈希表通过以下方式解析任意 PNRP ID：将 PNRP 请求消息转发到下个最近的对等机，直到找到具有相应 CPA 的对等机。  
  
 若要确保解析的完成，每次节点将条目添加到其缓存的最低级别时，都将条目的副本传到缓存的最后级别中的所有节点。  
  
 缓存条目随着时间推移进行刷新。 陈旧条目会从缓存中移除。 结果是 PNRP ID 的分布式哈希表基于活动的终结点，不像 DNS 中地址记录和 DNS 协议不保障与地址相关的节点活跃在网络上。  
  
## <a name="other-pnrp-caches"></a>其他 PNRP 缓存  
 另一个永久性数据存储是本地缓存。  除了 PNRP 活动需要的其他对象，它可包括与 PNRP 云或协作会话相关联的记录，这些记录在云的所有成员间安全地进行发布和同步。 这一复制的存储代表了组数据的视图，它应在所有组成员间保持相同。 从技术上来讲，这些对象本质上不是记录，而是去往本地缓存的应用程序、状态和对象数据。 使用 PNRP 云确保对象传播到协作会话或 PNRP 云中的所有节点。  云成员间的记录副本使用 SSL 提供加密和数据完整性。  
  
 当对等机加入云时，它们不会自动接收来自其附加于的主机对等机的本地缓存数据，它们必须订阅主机对等机以接收应用程序、状态和对象数据中的更新。 初始同步后，对等机定期重新同步其复制的存储，确保所有组成员始终有相同的视图。  协作会话或协作会话中的应用程序也可执行相同的功能。  
  
 协作会话为云启动后，应用程序可以使用云范围定义的安全性注册对等机并开始发布其信息。 对等机加入云时，云的安全性机制会应用到对等机，为其提供要加入的范围。  然后它的记录可以在云的范围内安全发布。 请注意云范围可能和协作应用程序范围不相同。  
  
 对等机可以登记从其他对等机接收对象的偏好。 当对象更新时，协作应用程序收到通知，新的对象传递给应用程序的所有订阅者。 例如，组聊天应用程序中的对等程序可以登记接收应用程序信息的偏好，这会向其发送所有聊天记录作为应用程序数据。  这使得它可以监视云内的聊天活动。  
  
## <a name="see-also"></a>请参阅  
 <xref:System.Net.PeerToPeer>
