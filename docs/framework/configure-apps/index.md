---
title: 使用配置文件配置应用
ms.date: 03/30/2017
f1_keywords:
- AutoGeneratedOrientationPage
helpviewer_keywords:
- security configuration files
- end tags
- configuration files [.NET Framework], application
- machine configuration files
- .NET Framework application configuration, configuration files
- applications [.NET Framework], configuration files
- application configuration files, security
- application configuration files, format
- configuration files [.NET Framework]
- hosts, application
- application configuration files, machine
- ASP.NET, configuring
- configuration files [.NET Framework], security
- application configuration files, about
- application configuration files
- <runtime> element
- start tags
- configuration files [.NET Framework], machine
- configuration files [.NET Framework], format
ms.assetid: 86bd26d3-737e-4484-9782-19b17f34cd1f
author: mcleblanc
ms.author: markl
manager: markl
ms.openlocfilehash: 4bd30b26a3e05f97904200cab40234d00924820c
ms.sourcegitcommit: 4b6490b2529707627ad77c3a43fbe64120397175
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/10/2018
ms.locfileid: "44274444"
---
# <a name="configuring-apps-by-using-configuration-files"></a><span data-ttu-id="ac408-102">使用配置文件配置应用</span><span class="sxs-lookup"><span data-stu-id="ac408-102">Configuring Apps by using Configuration Files</span></span>
<span data-ttu-id="ac408-103">.NET Framework 通过配置文件为开发人员和管理员提供了对应用程序运行方式的控制权和灵活性。</span><span class="sxs-lookup"><span data-stu-id="ac408-103">The .NET Framework, through configuration files, gives developers and administrators control and flexibility over the way applications run.</span></span> <span data-ttu-id="ac408-104">配置文件是可以按需要更改的 XML 文件。</span><span class="sxs-lookup"><span data-stu-id="ac408-104">Configuration files are XML files that can be changed as needed.</span></span> <span data-ttu-id="ac408-105">管理员能够控制应用程序可以访问哪些受保护的资源，应用程序将使用哪些版本的程序集，以及远程应用程序和对象位于何处。</span><span class="sxs-lookup"><span data-stu-id="ac408-105">An administrator can control which protected resources an application can access, which versions of assemblies an application will use, and where remote applications and objects are located.</span></span> <span data-ttu-id="ac408-106">开发人员可以将设置置于配置文件中，从而没有必要在每次设置更改时重新编译应用程序。</span><span class="sxs-lookup"><span data-stu-id="ac408-106">Developers can put settings in configuration files, eliminating the need to recompile an application every time a setting changes.</span></span> <span data-ttu-id="ac408-107">本节说明可以对什么进行配置以及为什么对应用程序进行配置会有用。</span><span class="sxs-lookup"><span data-stu-id="ac408-107">This section describes what can be configured and why configuring an application might be useful.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ac408-108">托管代码可以使用 <xref:System.Configuration> 命名空间中的类从配置文件中读取设置，但不向这些文件写入设置。</span><span class="sxs-lookup"><span data-stu-id="ac408-108">Managed code can use the classes in the <xref:System.Configuration> namespace to read settings from the configuration files, but not to write settings to those files.</span></span>  
  
 <span data-ttu-id="ac408-109">本主题描述配置文件的语法，并提供有关三种配置文件的信息：计算机配置文件、应用程序配置文件和安全配置文件。</span><span class="sxs-lookup"><span data-stu-id="ac408-109">This topic describes the syntax of configuration files and provides information about the three types of configuration files: machine, application, and security.</span></span>  
  
## <a name="configuration-file-format"></a><span data-ttu-id="ac408-110">配置文件格式</span><span class="sxs-lookup"><span data-stu-id="ac408-110">Configuration File Format</span></span>  
 <span data-ttu-id="ac408-111">配置文件包含元素，它们是用来设置配置信息的逻辑数据结构。</span><span class="sxs-lookup"><span data-stu-id="ac408-111">Configuration files contain elements, which are logical data structures that set configuration information.</span></span> <span data-ttu-id="ac408-112">在配置文件内，使用标记来标记元素的开头和结尾。</span><span class="sxs-lookup"><span data-stu-id="ac408-112">Within a configuration file, you use tags to mark the beginning and end of an element.</span></span> <span data-ttu-id="ac408-113">例如，`<runtime>` 元素包括`<runtime>`子元素`</runtime>`。</span><span class="sxs-lookup"><span data-stu-id="ac408-113">For example, the `<runtime>` element consists of `<runtime>`*child elements*`</runtime>`.</span></span> <span data-ttu-id="ac408-114">空元素将写为 `<runtime/>` 或 `<runtime></runtime>`。</span><span class="sxs-lookup"><span data-stu-id="ac408-114">An empty element would be written as `<runtime/>` or `<runtime></runtime>`.</span></span>  
  
 <span data-ttu-id="ac408-115">与所有 XML 文件一样，配置文件中的语法区分大小写。</span><span class="sxs-lookup"><span data-stu-id="ac408-115">As with all XML files, the syntax in configuration files is case-sensitive.</span></span>  
  
 <span data-ttu-id="ac408-116">使用预定义特性来指定配置设置，这些特性是元素开始标记内的名称/值对。</span><span class="sxs-lookup"><span data-stu-id="ac408-116">You specify configuration settings using predefined attributes, which are name/value pairs inside an element's start tag.</span></span> <span data-ttu-id="ac408-117">下面的示例为 `<codeBase>` 元素指定两个特性（`version` 和 `href`），该元素指定运行时在何处可以找到程序集（有关详细信息，请参阅[指定程序集的位置](../../../docs/framework/configure-apps/specify-assembly-location.md)）。</span><span class="sxs-lookup"><span data-stu-id="ac408-117">The following example specifies two attributes (`version` and `href`) for the `<codeBase>` element, which specifies where the runtime can locate an assembly (for more information, see [Specifying an Assembly's Location](../../../docs/framework/configure-apps/specify-assembly-location.md)).</span></span>  
  
```xml  
<codeBase version="2.0.0.0"  
          href="http://www.litwareinc.com/myAssembly.dll"/>  
```  
  
## <a name="machine-configuration-files"></a><span data-ttu-id="ac408-118">计算机配置文件</span><span class="sxs-lookup"><span data-stu-id="ac408-118">Machine Configuration Files</span></span>  
 <span data-ttu-id="ac408-119">计算机配置文件 Machine.config 包含应用于整个计算机的设置。</span><span class="sxs-lookup"><span data-stu-id="ac408-119">The machine configuration file, Machine.config, contains settings that apply to an entire computer.</span></span> <span data-ttu-id="ac408-120">此文件位于 %*runtime install path*%\Config 目录中。</span><span class="sxs-lookup"><span data-stu-id="ac408-120">This file is located in the %*runtime install path*%\Config directory.</span></span> <span data-ttu-id="ac408-121">Machine.config 包含整个计算机范围内的程序集绑定、内置[远程处理信道](https://msdn.microsoft.com/library/6e9b60e0-9bc0-47b4-a8ef-3b78585f9a18)和 ASP.NET 的配置设置。</span><span class="sxs-lookup"><span data-stu-id="ac408-121">Machine.config contains configuration settings for machine-wide assembly binding, built-in [remoting channels](https://msdn.microsoft.com/library/6e9b60e0-9bc0-47b4-a8ef-3b78585f9a18), and ASP.NET.</span></span>  
  
 <span data-ttu-id="ac408-122">配置系统首先查看计算机配置文件，查找 [**\<appSettings>** 元素](~/docs/framework/configure-apps/file-schema/appsettings/index.md)，然后查看开发人员可能定义的其他配置节。</span><span class="sxs-lookup"><span data-stu-id="ac408-122">The configuration system first looks in the machine configuration file for the [**\<appSettings>** element](~/docs/framework/configure-apps/file-schema/appsettings/index.md) and other configuration sections that a developer might define.</span></span> <span data-ttu-id="ac408-123">然后查看应用程序配置文件。</span><span class="sxs-lookup"><span data-stu-id="ac408-123">It then looks in the application configuration file.</span></span> <span data-ttu-id="ac408-124">为使计算机配置文件可管理，最好将这些设置放在应用程序配置文件中。</span><span class="sxs-lookup"><span data-stu-id="ac408-124">To keep the machine configuration file manageable, it is best to put these settings in the application configuration file.</span></span> <span data-ttu-id="ac408-125">但是，将这些设置放在计算机配置文件中可以使系统更易维护。</span><span class="sxs-lookup"><span data-stu-id="ac408-125">However, putting the settings in the machine configuration file can make your system more maintainable.</span></span> <span data-ttu-id="ac408-126">例如，如果有第三方组件，且客户端和服务器应用程序同时使用该组件，那么将该组件的设置放在一个位置更方便。</span><span class="sxs-lookup"><span data-stu-id="ac408-126">For example, if you have a third-party component that both your client and server application uses, it is easier to put the settings for that component in one place.</span></span> <span data-ttu-id="ac408-127">在这种情况下，计算机配置文件是存放设置的合适位置，这样就不会将相同的设置放在两个不同的文件中。</span><span class="sxs-lookup"><span data-stu-id="ac408-127">In this case, the machine configuration file is the appropriate place for the settings, so you don't have the same settings in two different files.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ac408-128">使用 XCOPY 部署应用程序将不会复制计算机配置文件中的设置。</span><span class="sxs-lookup"><span data-stu-id="ac408-128">Deploying an application using XCOPY will not copy the settings in the machine configuration file.</span></span>  
  
 <span data-ttu-id="ac408-129">若要深入了解公共语言运行时如何使用计算机配置文件进行程序集绑定，请参阅[运行时如何定位程序集](../../../docs/framework/deployment/how-the-runtime-locates-assemblies.md)。</span><span class="sxs-lookup"><span data-stu-id="ac408-129">For more information about how the common language runtime uses the machine configuration file for assembly binding, see [How the Runtime Locates Assemblies](../../../docs/framework/deployment/how-the-runtime-locates-assemblies.md).</span></span>  
  
## <a name="application-configuration-files"></a><span data-ttu-id="ac408-130">应用程序配置文件</span><span class="sxs-lookup"><span data-stu-id="ac408-130">Application Configuration Files</span></span>  
 <span data-ttu-id="ac408-131">应用程序配置文件包含应用特定的设置。</span><span class="sxs-lookup"><span data-stu-id="ac408-131">An application configuration file contains settings that are specific to an app.</span></span> <span data-ttu-id="ac408-132">该文件包含公共语言运行时读取的配置设置（如程序集绑定策略、远程处理对象等）以及应用可以读取的设置。</span><span class="sxs-lookup"><span data-stu-id="ac408-132">This file includes configuration settings that the common language runtime reads (such as assembly binding policy, remoting objects, and so on), and settings that the app can read.</span></span>  
  
 <span data-ttu-id="ac408-133">应用程序配置文件的名称和位置取决于应用的主机，可以是下列项之一：</span><span class="sxs-lookup"><span data-stu-id="ac408-133">The name and location of the application configuration file depend on the app's host, which can be one of the following:</span></span>  
  
-   <span data-ttu-id="ac408-134">可执行文件承载的应用。</span><span class="sxs-lookup"><span data-stu-id="ac408-134">Executable–hosted app.</span></span>  
  
     <span data-ttu-id="ac408-135">这些应用具有两个配置文件：一个开发人员在开发过程中修改的源配置文件，一个随应用一起分发的输出文件。</span><span class="sxs-lookup"><span data-stu-id="ac408-135">These apps have two configuration files:  a source configuration file, which is modified by the developer during development, and an output file that is distributed with the app.</span></span>  
  
     <span data-ttu-id="ac408-136">在 Visual Studio 中进行开发时，将应用的源配置文件放置在项目目录中，并将其“复制到输出目录”属性设置为“始终复制”或“如果较新则复制”。</span><span class="sxs-lookup"><span data-stu-id="ac408-136">When you develop in Visual Studio, place the source configuration file for your app in the project directory and set its **Copy To Output Directory** property to **Copy always** or **Copy if newer**.</span></span> <span data-ttu-id="ac408-137">配置文件的名称是带 .config 扩展名的应用名。</span><span class="sxs-lookup"><span data-stu-id="ac408-137">The name of the configuration file is the name of the app with a .config extension.</span></span> <span data-ttu-id="ac408-138">例如，名为 myApp.exe 的应用应具有名为 myApp.exe.config 的源配置文件。</span><span class="sxs-lookup"><span data-stu-id="ac408-138">For example, an app called myApp.exe should have a source configuration file called myApp.exe.config.</span></span>  
  
     <span data-ttu-id="ac408-139">Visual Studio 会自动将源配置文件复制到已编译程序集所在的目录中，以便创建随应用程序一起部署的输出配置文件。</span><span class="sxs-lookup"><span data-stu-id="ac408-139">Visual Studio automatically copies the source configuration file to the directory where the compiled assembly is placed to create the output configuration file, which is deployed with the app.</span></span> <span data-ttu-id="ac408-140">在某些情况下，Visual Studio 可能修改输出配置文件；有关详细信息，请参阅[重定向程序集版本](../../../docs/framework/configure-apps/redirect-assembly-versions.md)文章中的[重定向应用级别的程序集版本](../../../docs/framework/configure-apps/redirect-assembly-versions.md#BKMK_Redirectingassemblyversionsattheapplevel)一节。</span><span class="sxs-lookup"><span data-stu-id="ac408-140">In some cases, Visual Studio may modify the output configuration file; for more information, see the [Redirecting assembly versions at the app level](../../../docs/framework/configure-apps/redirect-assembly-versions.md#BKMK_Redirectingassemblyversionsattheapplevel) section of the [Redirecting Assembly Versions](../../../docs/framework/configure-apps/redirect-assembly-versions.md) article.</span></span>  
  
-   <span data-ttu-id="ac408-141">ASP.NET 承载的应用。</span><span class="sxs-lookup"><span data-stu-id="ac408-141">ASP.NET-hosted app.</span></span>  
  
     <span data-ttu-id="ac408-142">有关 ASP.NET 配置文件的详细信息，请参阅 [ASP.NET 配置设置](https://msdn.microsoft.com/library/116608f3-c03d-4413-9fc7-978703e18b0f(v=vs.100))</span><span class="sxs-lookup"><span data-stu-id="ac408-142">For more information about ASP.NET configuration files, see [ASP.NET Configuration Settings](https://msdn.microsoft.com/library/116608f3-c03d-4413-9fc7-978703e18b0f(v=vs.100))</span></span>  
  
-   <span data-ttu-id="ac408-143">Internet Explorer 承载的应用。</span><span class="sxs-lookup"><span data-stu-id="ac408-143">Internet Explorer-hosted app.</span></span>  
  
     <span data-ttu-id="ac408-144">如果 Internet Explorer 中承载的应用具有配置文件，则该文件的位置是在 `<link>` 标记中使用以下语法指定的：</span><span class="sxs-lookup"><span data-stu-id="ac408-144">If an app hosted in Internet Explorer has a configuration file, the location of this file is specified in a `<link>` tag with the following syntax:</span></span>  
  
     <span data-ttu-id="ac408-145">\<link rel="*ConfigurationFileName*" href="*location*"></span><span class="sxs-lookup"><span data-stu-id="ac408-145">\<link rel="*ConfigurationFileName*" href="*location*"></span></span>  
  
     <span data-ttu-id="ac408-146">在该标记中，`location` 是指向该配置文件的 URL。</span><span class="sxs-lookup"><span data-stu-id="ac408-146">In this tag, `location` is a URL to the configuration file.</span></span> <span data-ttu-id="ac408-147">这将设置应用基。</span><span class="sxs-lookup"><span data-stu-id="ac408-147">This sets the app base.</span></span> <span data-ttu-id="ac408-148">配置文件必须位于应用所在的网站上。</span><span class="sxs-lookup"><span data-stu-id="ac408-148">The configuration file must be located on the same website as the app.</span></span>  
  
## <a name="security-configuration-files"></a><span data-ttu-id="ac408-149">安全配置文件</span><span class="sxs-lookup"><span data-stu-id="ac408-149">Security Configuration Files</span></span>  
 <span data-ttu-id="ac408-150">安全配置文件包含有关与策略级别关联的代码组层次结构和权限集的信息。</span><span class="sxs-lookup"><span data-stu-id="ac408-150">Security configuration files contain information about the code group hierarchy and permission sets associated with a policy level.</span></span> <span data-ttu-id="ac408-151">强烈建议使用[代码访问安全性策略工具 (Caspol.exe)](../../../docs/framework/tools/caspol-exe-code-access-security-policy-tool.md) 修改安全策略，确保策略更改不会损坏安全配置文件。</span><span class="sxs-lookup"><span data-stu-id="ac408-151">We strongly recommend that you use the [Code Access Security Policy tool (Caspol.exe)](../../../docs/framework/tools/caspol-exe-code-access-security-policy-tool.md) to modify security policy to ensure that policy changes do not corrupt the security configuration files.</span></span>  
  
> [!NOTE]
>  <span data-ttu-id="ac408-152">从 [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)] 开始，仅在安全策略发生更改时提供安全配置文件。</span><span class="sxs-lookup"><span data-stu-id="ac408-152">Starting with the [!INCLUDE[net_v40_short](../../../includes/net-v40-short-md.md)], the security configuration files are present only if security policy has been changed.</span></span>  
  
 <span data-ttu-id="ac408-153">安全配置文件位于以下位置：</span><span class="sxs-lookup"><span data-stu-id="ac408-153">The security configuration files are in the following locations:</span></span>  
  
-   <span data-ttu-id="ac408-154">企业策略配置文件：%runtime-install-path%\Config\Enterprisesec.config</span><span class="sxs-lookup"><span data-stu-id="ac408-154">Enterprise policy configuration file: %*runtime-install-path*%\Config\Enterprisesec.config</span></span>  
  
-   <span data-ttu-id="ac408-155">计算机策略配置文件：%runtime-install-path%\Config\Security.config</span><span class="sxs-lookup"><span data-stu-id="ac408-155">Machine policy configuration file: %*runtime-install-path*%\Config\Security.config</span></span>  
  
-   <span data-ttu-id="ac408-156">用户策略配置文件：%USERPROFILE%\Application data\Microsoft\CLR security config\vxx.xx\Security.config</span><span class="sxs-lookup"><span data-stu-id="ac408-156">User policy configuration file: %USERPROFILE%\Application data\Microsoft\CLR security config\v*xx.xx*\Security.config</span></span>  
  
## <a name="in-this-section"></a><span data-ttu-id="ac408-157">本节内容</span><span class="sxs-lookup"><span data-stu-id="ac408-157">In This Section</span></span>  
 [<span data-ttu-id="ac408-158">如何：使用 DEVPATH 查找程序集</span><span class="sxs-lookup"><span data-stu-id="ac408-158">How to: Locate Assemblies by Using DEVPATH</span></span>](../../../docs/framework/configure-apps/how-to-locate-assemblies-by-using-devpath.md)  
 <span data-ttu-id="ac408-159">描述如何指示运行时在搜索程序集时使用 DEVPATH 环境变量。</span><span class="sxs-lookup"><span data-stu-id="ac408-159">Describes how to direct the runtime to use the DEVPATH environment variable when searching for assemblies.</span></span>  
  
 [<span data-ttu-id="ac408-160">重定向程序集版本</span><span class="sxs-lookup"><span data-stu-id="ac408-160">Redirecting Assembly Versions</span></span>](../../../docs/framework/configure-apps/redirect-assembly-versions.md)  
 <span data-ttu-id="ac408-161">描述如何指定程序集的位置以及要使用程序集的哪一版本。</span><span class="sxs-lookup"><span data-stu-id="ac408-161">Describes how to specify the location of an assembly and which version of an assembly to use.</span></span>  
  
 [<span data-ttu-id="ac408-162">指定程序集的位置</span><span class="sxs-lookup"><span data-stu-id="ac408-162">Specifying an Assembly's Location</span></span>](../../../docs/framework/configure-apps/specify-assembly-location.md)  
 <span data-ttu-id="ac408-163">描述如何指定运行时应搜索程序集的位置。</span><span class="sxs-lookup"><span data-stu-id="ac408-163">Describes how to specify where the runtime should search for an assembly.</span></span>  
  
 [<span data-ttu-id="ac408-164">配置加密类</span><span class="sxs-lookup"><span data-stu-id="ac408-164">Configuring Cryptography Classes</span></span>](../../../docs/framework/configure-apps/configure-cryptography-classes.md)  
 <span data-ttu-id="ac408-165">描述如何将算法名称映射到加密类，以及如何将对象标识符映射到加密算法。</span><span class="sxs-lookup"><span data-stu-id="ac408-165">Describes how to map an algorithm name to a cryptography class and an object identifier to a cryptography algorithm.</span></span>  
  
 [<span data-ttu-id="ac408-166">如何：创建发行者策略</span><span class="sxs-lookup"><span data-stu-id="ac408-166">How to: Create a Publisher Policy</span></span>](../../../docs/framework/configure-apps/how-to-create-a-publisher-policy.md)  
 <span data-ttu-id="ac408-167">描述应当在何时以及如何添加发行者策略文件，以指定程序集重定向和基本代码设置。</span><span class="sxs-lookup"><span data-stu-id="ac408-167">Describes when and how you should add a publisher policy file to specify assembly redirection and code base settings.</span></span>  
  
 [<span data-ttu-id="ac408-168">配置文件架构</span><span class="sxs-lookup"><span data-stu-id="ac408-168">Configuration File Schema</span></span>](../../../docs/framework/configure-apps/file-schema/index.md)  
 <span data-ttu-id="ac408-169">描述架构的层次结构：启动、运行时、网络和其他配置设置类型。</span><span class="sxs-lookup"><span data-stu-id="ac408-169">Describes the schema hierarchy for startup, runtime, network, and other types of configuration settings.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="ac408-170">请参阅</span><span class="sxs-lookup"><span data-stu-id="ac408-170">See Also</span></span>  
 [<span data-ttu-id="ac408-171">配置文件架构</span><span class="sxs-lookup"><span data-stu-id="ac408-171">Configuration File Schema</span></span>](../../../docs/framework/configure-apps/file-schema/index.md)  
 [<span data-ttu-id="ac408-172">指定程序集的位置</span><span class="sxs-lookup"><span data-stu-id="ac408-172">Specifying an Assembly's Location</span></span>](../../../docs/framework/configure-apps/specify-assembly-location.md)  
 [<span data-ttu-id="ac408-173">重定向程序集版本</span><span class="sxs-lookup"><span data-stu-id="ac408-173">Redirecting Assembly Versions</span></span>](../../../docs/framework/configure-apps/redirect-assembly-versions.md)  
 [<span data-ttu-id="ac408-174">使用配置文件注册远程对象</span><span class="sxs-lookup"><span data-stu-id="ac408-174">Registering Remote Objects Using Configuration Files</span></span>](https://msdn.microsoft.com/library/bc503ee1-c811-4f82-9525-470343326adc)  
 [<span data-ttu-id="ac408-175">ASP.NET 网站管理</span><span class="sxs-lookup"><span data-stu-id="ac408-175">ASP.NET Web Site Administration</span></span>](https://msdn.microsoft.com/library/1298034b-5f7d-464d-abd1-ad9e6b3eeb7e)  
 [<span data-ttu-id="ac408-176">NIB： 安全策略管理</span><span class="sxs-lookup"><span data-stu-id="ac408-176">NIB: Security Policy Management</span></span>](https://msdn.microsoft.com/library/d754e05d-29dc-4d3a-a2c2-95eaaf1b82b9)  
 [<span data-ttu-id="ac408-177">Caspol.exe（代码访问安全策略工具）</span><span class="sxs-lookup"><span data-stu-id="ac408-177">Caspol.exe (Code Access Security Policy Tool)</span></span>](../../../docs/framework/tools/caspol-exe-code-access-security-policy-tool.md)  
 <span data-ttu-id="ac408-178">[Assemblies in the Common Language Runtime](../../../docs/framework/app-domains/assemblies-in-the-common-language-runtime.md)（公共语言运行时中的程序集）</span><span class="sxs-lookup"><span data-stu-id="ac408-178">[Assemblies in the Common Language Runtime](../../../docs/framework/app-domains/assemblies-in-the-common-language-runtime.md)</span></span>  
 [<span data-ttu-id="ac408-179">远程对象</span><span class="sxs-lookup"><span data-stu-id="ac408-179">Remote Objects</span></span>](https://msdn.microsoft.com/library/515686e6-0a8d-42f7-8188-73abede57c58)
