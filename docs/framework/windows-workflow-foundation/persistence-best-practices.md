---
title: 持久性最佳做法
ms.date: 03/30/2017
ms.assetid: 6974c5a4-1af8-4732-ab53-7d694608a3a0
ms.openlocfilehash: fdbf61e559efbd978df1c5a46fcbbbbc528ec98a
ms.sourcegitcommit: 2eceb05f1a5bb261291a1f6a91c5153727ac1c19
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 09/04/2018
ms.locfileid: "43558870"
---
# <a name="persistence-best-practices"></a><span data-ttu-id="0344d-102">持久性最佳做法</span><span class="sxs-lookup"><span data-stu-id="0344d-102">Persistence Best Practices</span></span>
<span data-ttu-id="0344d-103">本文档介绍了针对与工作流持久性相关的工作流设计和配置的最佳实践。</span><span class="sxs-lookup"><span data-stu-id="0344d-103">This document covers best practices for workflow design and configuration related to workflow persistence.</span></span>  
  
## <a name="design-and-implementation-of-durable-workflows"></a><span data-ttu-id="0344d-104">持久工作流的设计和实现</span><span class="sxs-lookup"><span data-stu-id="0344d-104">Design and Implementation of Durable Workflows</span></span>  
 <span data-ttu-id="0344d-105">通常，工作流会在较短的时段内执行工作，这些时段将与工作流因等待事件而处于空闲状态的时段交错。</span><span class="sxs-lookup"><span data-stu-id="0344d-105">In general, workflows perform work in short periods that are interleaved with times during which the workflow is idle because it is waiting for an event.</span></span> <span data-ttu-id="0344d-106">此事件可以是消息或过期计时器之类的内容。</span><span class="sxs-lookup"><span data-stu-id="0344d-106">This event can be such things as a message or an expiring timer.</span></span> <span data-ttu-id="0344d-107">若要能在工作流的状态变成空闲时卸载工作流，则服务主机必须保留工作流实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-107">To be able to unload the workflow instance when it becomes idle, the service host must persist the workflow instance.</span></span> <span data-ttu-id="0344d-108">仅在工作流实例未位于非持久性区域中时（例如，等待交易完成或等待异步回调）可能出现此情况。</span><span class="sxs-lookup"><span data-stu-id="0344d-108">This is possible only if the workflow instance is not in a no-persist zone (for example, waiting for a transaction to complete, or waiting for an asynchronous callback).</span></span> <span data-ttu-id="0344d-109">若要允许卸载空闲工作流实例，工作流作者应仅对生存期较短的操作使用事务范围和异步活动。</span><span class="sxs-lookup"><span data-stu-id="0344d-109">To allow an idle workflow instance to unload, the workflow author should use transaction scopes and asynchronous activities for short-lived actions only.</span></span> <span data-ttu-id="0344d-110">具体而言，作者应尽可能缩短延迟活动在这些非持久性区域中的保留时间。</span><span class="sxs-lookup"><span data-stu-id="0344d-110">In particular, the author should keep delay activities within these no-persist zones as short as possible.</span></span>  
  
 <span data-ttu-id="0344d-111">只有在可序列化工作流使用的所有数据类型时，才能保留工作流。</span><span class="sxs-lookup"><span data-stu-id="0344d-111">A workflow can only be persisted if all of the data types used by the workflow are serializable.</span></span> <span data-ttu-id="0344d-112">此外，持久化工作流中使用的自定义类型必须可通过 <xref:System.Runtime.Serialization.NetDataContractSerializer> 进行序列化，以便 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 能保留它们。</span><span class="sxs-lookup"><span data-stu-id="0344d-112">In addition, custom types used in persisted workflows must be serializable with <xref:System.Runtime.Serialization.NetDataContractSerializer> in order to be persisted by <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore>.</span></span>  
  
 <span data-ttu-id="0344d-113">如果尚未保留某个工作流实例，则在主机或计算机出现故障时，将无法恢复此工作流实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-113">A workflow instance cannot be recovered in case of a host or computer failure if it has not been persisted.</span></span> <span data-ttu-id="0344d-114">通常，建议您在工作流生命周期的早期保留工作流实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-114">In general, we recommend that you persist a workflow instance early in the workflow’s life cycle.</span></span>  
  
 <span data-ttu-id="0344d-115">如果工作流长时间处于忙碌状态，则建议您在工作流实例的忙碌时段中定期保留工作流实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-115">If your workflow is busy for a long time, we recommend that you persist the workflow instance regularly throughout its busy period.</span></span> <span data-ttu-id="0344d-116">可以通过在一系列使工作流实例处于忙碌状态的活动中添加 <xref:System.Activities.Statements.Persist> 活动来执行此操作。</span><span class="sxs-lookup"><span data-stu-id="0344d-116">You can do this by adding <xref:System.Activities.Statements.Persist> activities throughout the sequence of activities that keep the workflow instance busy.</span></span> <span data-ttu-id="0344d-117">通过这种方式，应用程序域回收、主机故障或计算机故障便不会导致系统回滚到忙碌时段的开头。</span><span class="sxs-lookup"><span data-stu-id="0344d-117">In this manner, application domain recycling, host failures, or computer failures do not cause the system to be rolled back to the start of the busy period.</span></span> <span data-ttu-id="0344d-118">请注意，将 <xref:System.Activities.Statements.Persist> 活动添加到工作流可能会导致性能降低。</span><span class="sxs-lookup"><span data-stu-id="0344d-118">Be aware that adding <xref:System.Activities.Statements.Persist> activities to your workflow could lead to a degradation of performance.</span></span>  
  
 <span data-ttu-id="0344d-119">Windows Server App Fabric 大大简化了持久性的配置和使用。</span><span class="sxs-lookup"><span data-stu-id="0344d-119">Windows Server App Fabric greatly simplifies the configuration and use of persistence.</span></span> <span data-ttu-id="0344d-120">有关详细信息，请参阅[Windows Server App Fabric 持久性](https://go.microsoft.com/fwlink/?LinkID=201200&clcid=0x409)</span><span class="sxs-lookup"><span data-stu-id="0344d-120">For more information, see [Windows Server App Fabric Persistence](https://go.microsoft.com/fwlink/?LinkID=201200&clcid=0x409)</span></span>  
  
## <a name="configuration-of-scalability-parameters"></a><span data-ttu-id="0344d-121">可伸缩性参数的配置</span><span class="sxs-lookup"><span data-stu-id="0344d-121">Configuration of Scalability Parameters</span></span>  
 <span data-ttu-id="0344d-122">可伸缩性和性能要求将决定以下参数的设置：</span><span class="sxs-lookup"><span data-stu-id="0344d-122">Scalability and performance requirements determine the settings of the following parameters:</span></span>  
  
-   <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A>  
  
-   <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A>  
  
-   <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A>  
  
 <span data-ttu-id="0344d-123">应根据当前方案设置这些参数，如下所示。</span><span class="sxs-lookup"><span data-stu-id="0344d-123">These parameters should be set as follows, according to the current scenario.</span></span>  
  
### <a name="scenario-a-small-number-of-workflow-instances-that-require-optimal-response-time"></a><span data-ttu-id="0344d-124">方案：少量工作流实例需要最佳响应时间</span><span class="sxs-lookup"><span data-stu-id="0344d-124">Scenario: A Small Number of Workflow Instances That Require Optimal Response Time</span></span>  
 <span data-ttu-id="0344d-125">在此方案中，所有工作流实例应在其状态变成空闲时保持被加载。</span><span class="sxs-lookup"><span data-stu-id="0344d-125">In this scenario, all workflow instances should remain loaded when they become idle.</span></span> <span data-ttu-id="0344d-126">将 <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> 设置为较大的值。</span><span class="sxs-lookup"><span data-stu-id="0344d-126">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to a large value.</span></span> <span data-ttu-id="0344d-127">使用此设置可阻止工作流实例在计算机间移动。</span><span class="sxs-lookup"><span data-stu-id="0344d-127">The use of this setting prevents a workflow instance from moving between computers.</span></span> <span data-ttu-id="0344d-128">仅在满足以下一个或多个条件时使用此设置：</span><span class="sxs-lookup"><span data-stu-id="0344d-128">Use this setting only if one or more of the following are true:</span></span>  
  
-   <span data-ttu-id="0344d-129">工作流实例在其整个生存期内收到一条消息。</span><span class="sxs-lookup"><span data-stu-id="0344d-129">A workflow instance receives a single message throughout its lifetime.</span></span>  
  
-   <span data-ttu-id="0344d-130">所有工作流实例都在一台计算机上运行。</span><span class="sxs-lookup"><span data-stu-id="0344d-130">All workflow instances run on a single computer</span></span>  
  
-   <span data-ttu-id="0344d-131">工作流实例收到的所有消息都通过同一台计算机接收。</span><span class="sxs-lookup"><span data-stu-id="0344d-131">All messages that are received by a workflow instance are received by the same computer.</span></span>  
  
 <span data-ttu-id="0344d-132">使用 <xref:System.Activities.Statements.Persist> 活动或将 <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> 设置为 0，可在服务主机或计算机出现故障后恢复工作流实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-132">Use <xref:System.Activities.Statements.Persist> activities or set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> to 0 to enable recovery of your workflow instance after service host or computer failures.</span></span>  
  
### <a name="scenario-workflow-instances-are-idle-for-long-periods-of-time"></a><span data-ttu-id="0344d-133">方案：工作流实例长时间处于空闲状态</span><span class="sxs-lookup"><span data-stu-id="0344d-133">Scenario: Workflow Instances Are Idle for Long Periods of Time</span></span>  
 <span data-ttu-id="0344d-134">在此方案中，将 <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> 设置为 0 可尽快释放资源。</span><span class="sxs-lookup"><span data-stu-id="0344d-134">In this scenario, set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 0 to release resources as soon as possible.</span></span>  
  
### <a name="scenario-workflow-instances-receive-multiple-messages-in-a-short-period-of-time"></a><span data-ttu-id="0344d-135">方案：工作流实例在短时间内收到多条消息</span><span class="sxs-lookup"><span data-stu-id="0344d-135">Scenario: Workflow Instances Receive Multiple Messages in a Short Period of Time</span></span>  
 <span data-ttu-id="0344d-136">在此方案中，如果这些消息都通过同一台计算机接收，则将 <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> 设置为 60 秒。</span><span class="sxs-lookup"><span data-stu-id="0344d-136">In this scenario, set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 60 seconds if these messages are received by the same computer.</span></span> <span data-ttu-id="0344d-137">这将阻止对工作流实例进行一系列快速卸载和加载。</span><span class="sxs-lookup"><span data-stu-id="0344d-137">This prevents a rapid sequence of unloading and loading of a workflow instance.</span></span> <span data-ttu-id="0344d-138">同时也不会在内存中将该实例保留过长时间。</span><span class="sxs-lookup"><span data-stu-id="0344d-138">This also does not keep the instance in memory for too long.</span></span>  
  
 <span data-ttu-id="0344d-139">如果这些消息可通过不同的计算机接收，则将 <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> 设置为 0，并将 <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A> 设置为 BasicRetry 或 AggressiveRetry。</span><span class="sxs-lookup"><span data-stu-id="0344d-139">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to 0, and set <xref:System.ServiceModel.Activities.Description.SqlWorkflowInstanceStoreBehavior.InstanceLockedExceptionAction%2A> to BasicRetry or AggressiveRetry if these messages may be received by different computers.</span></span> <span data-ttu-id="0344d-140">这样做将允许工作流实例由其他计算机加载。</span><span class="sxs-lookup"><span data-stu-id="0344d-140">This allows the workflow instance to be loaded by another computer.</span></span>  
  
### <a name="scenario-workflow-uses-delay-activities-with-short-durations"></a><span data-ttu-id="0344d-141">方案：工作流在较短时间内使用延迟活动</span><span class="sxs-lookup"><span data-stu-id="0344d-141">Scenario: Workflow Uses Delay Activities with Short Durations</span></span>  
 <span data-ttu-id="0344d-142">在此方案中，<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 将定期轮询因过期的 <xref:System.Activities.Statements.Delay> 活动而应加载的实例的持久性数据库。</span><span class="sxs-lookup"><span data-stu-id="0344d-142">In this scenario, the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> regularly polls the persistence database for instances that should be loaded because of an expired <xref:System.Activities.Statements.Delay> activity.</span></span> <span data-ttu-id="0344d-143">如果 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 找到一个将在下一个轮询时间间隔中过期的计时器，则 SQL 工作流实例存储将缩短轮询时间间隔。</span><span class="sxs-lookup"><span data-stu-id="0344d-143">If the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> finds a timer that will expire in the next polling interval, the SQL Workflow Instance Store shortens the polling interval.</span></span> <span data-ttu-id="0344d-144">之后，下一次轮询将在计时器过期后发生。</span><span class="sxs-lookup"><span data-stu-id="0344d-144">The next poll will then occur right after the timer has expired.</span></span> <span data-ttu-id="0344d-145">这样一来，SQL 工作流实例存储将实现运行时间长于轮询时间间隔（由 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> 设置）的计时器的高精度。</span><span class="sxs-lookup"><span data-stu-id="0344d-145">This way, the SQL Workflow Instance Store achieves a high accuracy of timers that run longer than the polling interval, which is set by <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>.</span></span> <span data-ttu-id="0344d-146">若要启用较短延迟的及时处理，工作流实例必须至少在内存中保留一个轮询时间间隔。</span><span class="sxs-lookup"><span data-stu-id="0344d-146">To enable timely processing of shorter delays, the workflow instance must remain in memory for at least one polling interval.</span></span>  
  
 <span data-ttu-id="0344d-147">将 <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> 设置为 0 可将过期时间写入持久性数据库。</span><span class="sxs-lookup"><span data-stu-id="0344d-147">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToPersist%2A> to 0 to write the expiration time to the persistence database.</span></span>  
  
 <span data-ttu-id="0344d-148">将 <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> 设置为大于或等于 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> 的值可在内存中将实例保留至少一个轮询时间间隔。</span><span class="sxs-lookup"><span data-stu-id="0344d-148">Set <xref:System.ServiceModel.Activities.Description.WorkflowIdleBehavior.TimeToUnload%2A> to longer than or equal to <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to keep the instance in memory for at least one polling interval.</span></span>  
  
 <span data-ttu-id="0344d-149">建议不要减少 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>，因为这将会增加持久性数据库的负载。</span><span class="sxs-lookup"><span data-stu-id="0344d-149">We do not recommend reducing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> because this leads to an increased load on the persistence database.</span></span> <span data-ttu-id="0344d-150">每台使用 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 的服务主机在每个检测周期轮询数据库一次。</span><span class="sxs-lookup"><span data-stu-id="0344d-150">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the database one time per detection period.</span></span> <span data-ttu-id="0344d-151">如果服务主机的数目过多，则将 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> 设置为过短的时间间隔可能会导致系统性能下降。</span><span class="sxs-lookup"><span data-stu-id="0344d-151">Setting <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to too small a time interval may cause your system's performance to decrease if the number of service hosts is large.</span></span>  
  
## <a name="configuring-the-sql-workflow-instance-store"></a><span data-ttu-id="0344d-152">配置 SQL 工作流实例存储</span><span class="sxs-lookup"><span data-stu-id="0344d-152">Configuring the SQL Workflow Instance Store</span></span>  
 <span data-ttu-id="0344d-153">SQL 工作流实例存储具有以下配置参数：</span><span class="sxs-lookup"><span data-stu-id="0344d-153">The SQL Workflow Instance Store has the following configuration parameters:</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceEncodingOption%2A>  
 <span data-ttu-id="0344d-154">此参数指示 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 压缩工作流实例状态。</span><span class="sxs-lookup"><span data-stu-id="0344d-154">This parameter instructs the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to compress the workflow instance state.</span></span> <span data-ttu-id="0344d-155">压缩可减少持久性数据库中存储的数据的数量，并可在持久性数据库位于专用数据库服务器上时减少网络流量。</span><span class="sxs-lookup"><span data-stu-id="0344d-155">Compression reduces the amount of data that is stored in the persistence database and reduces network traffic in case the persistence database resides on a dedicated database server.</span></span> <span data-ttu-id="0344d-156">如果使用压缩，则需要计算资源来压缩和提取实例状态。</span><span class="sxs-lookup"><span data-stu-id="0344d-156">If compression is used, it requires computational resources to compress and extract the instance state.</span></span> <span data-ttu-id="0344d-157">在大多数情况下，压缩可提高性能。</span><span class="sxs-lookup"><span data-stu-id="0344d-157">In most cases, compression yields increased performance.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceCompletionAction%2A>  
 <span data-ttu-id="0344d-158">此参数指示 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 保留或删除已完成的实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-158">This parameter instructs the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to either keep or delete completed instances.</span></span> <span data-ttu-id="0344d-159">保留已完成的实例将提高持久性数据库存储要求并导致生成大型表，从而增加表查找时间。</span><span class="sxs-lookup"><span data-stu-id="0344d-159">Keeping completed instances increases the persistence database storage requirements and leads to larger tables, which increases table lookup times.</span></span> <span data-ttu-id="0344d-160">除非已完成的实例是进行调试或审核所必需的，否则最好是指示 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 删除已完成的实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-160">Unless completed instances are required for debugging or auditing, it is best to instruct the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> to delete completed instances.</span></span> <span data-ttu-id="0344d-161">应仅在用户创建用于最终移除已删除的实例的过程时保留这些实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-161">Deleted instances should be kept only if the user establishes a process for eventually removing them.</span></span> <span data-ttu-id="0344d-162">请注意，只要已完成的工作流示例位于实例存储中，就无法重用相关键。</span><span class="sxs-lookup"><span data-stu-id="0344d-162">Note that correlation keys cannot be reused as long as the completed workflow instance resides in the instance store.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>  
 <span data-ttu-id="0344d-163">此参数定义了一个最大时间间隔，<xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 将按照此时间间隔轮询应在 <xref:System.Activities.Statements.Delay> 活动过期时加载的实例的持久性数据库。</span><span class="sxs-lookup"><span data-stu-id="0344d-163">This parameter defines the maximum interval with which the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the persistence database for instances that should be loaded when a <xref:System.Activities.Statements.Delay> activity expires.</span></span> <span data-ttu-id="0344d-164">如果 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 找到一个将在下一个轮询时间间隔中过期的计时器，则它将缩短轮询时间间隔，以使下一次轮询在该计时器过期后发生。</span><span class="sxs-lookup"><span data-stu-id="0344d-164">If the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> finds a timer that will expire in the next polling interval, it shortens the polling interval so that the next poll will occur right after the timer has expired.</span></span> <span data-ttu-id="0344d-165">这样一来，SQL 工作流实例存储将实现运行时间长于 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> 的计时器的高精度。</span><span class="sxs-lookup"><span data-stu-id="0344d-165">This way, the SQL Workflow Instance Store achieves a high accuracy of timers that run longer than <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>.</span></span>  
  
 <span data-ttu-id="0344d-166">建议不要减少 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>，因为这将会增加持久性数据库的负载。</span><span class="sxs-lookup"><span data-stu-id="0344d-166">We do not recommend reducing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A>, because this leads to an increased load on the persistence database.</span></span> <span data-ttu-id="0344d-167">每台使用 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 的服务主机在每个检测周期轮询数据库一次。</span><span class="sxs-lookup"><span data-stu-id="0344d-167">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> polls the database one time per detection period.</span></span> <span data-ttu-id="0344d-168">如果服务主机的数量过大，则将 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> 设置为过短的时间间隔可能会导致系统性能下降。</span><span class="sxs-lookup"><span data-stu-id="0344d-168">Setting <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.RunnableInstancesDetectionPeriod%2A> to too small an interval may cause your system's performance to decrease if the number of service hosts is large.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A>  
 <span data-ttu-id="0344d-169">此参数定义主机续订其持久性数据库中的锁定的间隔。</span><span class="sxs-lookup"><span data-stu-id="0344d-169">This parameter defines the interval with which the host renews its lock in the persistence database.</span></span> <span data-ttu-id="0344d-170">通过缩短此间隔，将使工作流实例能够在主机或计算机出现故障时更快地恢复。</span><span class="sxs-lookup"><span data-stu-id="0344d-170">Shortening this interval will enable a quicker recovery of the workflow instances in case a host or computer fails.</span></span> <span data-ttu-id="0344d-171">另一方面，较短的锁定续订期将增加持久性数据库的负载。</span><span class="sxs-lookup"><span data-stu-id="0344d-171">On the other hand, a short lock renewal period increases the load on the persistence database.</span></span> <span data-ttu-id="0344d-172">每台使用 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 的服务主机将在每个续订期更新其数据库中的锁定一次。</span><span class="sxs-lookup"><span data-stu-id="0344d-172">Each service host that uses the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> will update its locks in the database one time per renewal period.</span></span> <span data-ttu-id="0344d-173">如果一台计算机运行多个服务主机，请确保锁定续订所产生的负载不会降低系统的性能。</span><span class="sxs-lookup"><span data-stu-id="0344d-173">If a computer runs many service hosts, make sure that the load caused by lock renewal does not decrease your system's performance.</span></span> <span data-ttu-id="0344d-174">如果出现此情况，请考虑增加 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A>。</span><span class="sxs-lookup"><span data-stu-id="0344d-174">If it does, consider increasing the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.HostLockRenewalPeriod%2A>.</span></span>  
  
 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A>  
 <span data-ttu-id="0344d-175">如果启用此参数，则 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> 将在下个 30 秒内重试加载锁定实例。</span><span class="sxs-lookup"><span data-stu-id="0344d-175">If enabled, the <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore> retries to load a locked instance for the next 30 seconds.</span></span> <span data-ttu-id="0344d-176">如果工作流在短时间内收到多条消息，并且这些消息通过不同的计算机接收，则将 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> 设置为 BasicRetry 或 AggressiveRetry。</span><span class="sxs-lookup"><span data-stu-id="0344d-176">Set <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> to BasicRetry or AggressiveRetry if the workflow receives multiple messages in a short time, and these messages are received by different computers.</span></span>  
  
 <span data-ttu-id="0344d-177">由于只要未尝试加载重试，加载重试机制就不会产生任何性能开销，因此应始终启用 <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A>。</span><span class="sxs-lookup"><span data-stu-id="0344d-177">Because the load retry mechanism does not introduce any performance overhead as long as load retries are not tried, <xref:System.Activities.DurableInstancing.SqlWorkflowInstanceStore.InstanceLockedExceptionAction%2A> should always be enabled.</span></span>
