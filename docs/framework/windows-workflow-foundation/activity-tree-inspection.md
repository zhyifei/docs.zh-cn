---
title: "活动树检查"
ms.custom: 
ms.date: 03/30/2017
ms.prod: .net-framework
ms.reviewer: 
ms.suite: 
ms.tgt_pltfrm: 
ms.topic: article
ms.assetid: 100d00e4-8c1d-4233-8fbb-dd443a01155d
caps.latest.revision: "10"
author: dotnet-bot
ms.author: dotnetcontent
manager: wpickett
ms.openlocfilehash: 91f706b527551bd66bfa18dc926f9453ea9b30fe
ms.sourcegitcommit: ce279f2d7fe2220e6ea0a25a8a7a5370ddf8d9f0
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 12/02/2017
---
# <a name="activity-tree-inspection"></a><span data-ttu-id="ac717-102">活动树检查</span><span class="sxs-lookup"><span data-stu-id="ac717-102">Activity Tree Inspection</span></span>
<span data-ttu-id="ac717-103">活动树检查由工作流应用程序作者用于检查由应用程序承载的工作流。</span><span class="sxs-lookup"><span data-stu-id="ac717-103">Activity tree inspection is used by workflow application authors to inspect the workflows hosted by the application.</span></span> <span data-ttu-id="ac717-104">使用 <xref:System.Activities.WorkflowInspectionServices>，可以在工作流中搜索特定子活动、单个活动并可以枚举其属性，还可以在特定时间缓存活动的运行时元数据。</span><span class="sxs-lookup"><span data-stu-id="ac717-104">By using <xref:System.Activities.WorkflowInspectionServices>, workflows can be searched for specific child activities, individual activities and their properties can be enumerated, and runtime metadata of the activities can be cached at a specific time.</span></span> <span data-ttu-id="ac717-105">此主题概述 <xref:System.Activities.WorkflowInspectionServices> 以及如何将其用于检查活动树。</span><span class="sxs-lookup"><span data-stu-id="ac717-105">This topic provides an overview of <xref:System.Activities.WorkflowInspectionServices> and how to use it to inspect an activity tree.</span></span>  
  
## <a name="using-workflowinspectionservices"></a><span data-ttu-id="ac717-106">使用 WorkflowInspectionServices</span><span class="sxs-lookup"><span data-stu-id="ac717-106">Using WorkflowInspectionServices</span></span>  
 <span data-ttu-id="ac717-107"><xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> 方法用于枚举指定活动树中的所有活动。</span><span class="sxs-lookup"><span data-stu-id="ac717-107">The <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> method is used to enumerate all of the activities in the specified activity tree.</span></span> <span data-ttu-id="ac717-108"><xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> 返回一个可枚举对象，该对象涉及树中包括子活动在内的所有活动、委托处理程序、变量默认值和参数表达式。</span><span class="sxs-lookup"><span data-stu-id="ac717-108"><xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> returns an enumerable that touches all activities within the tree including children, delegate handlers, variable defaults, and argument expressions.</span></span> <span data-ttu-id="ac717-109">在下面的示例中，使用 <xref:System.Activities.Statements.Sequence>、<xref:System.Activities.Statements.While>、<xref:System.Activities.Statements.ForEach%601>、<xref:System.Activities.Statements.WriteLine> 和表达式创建一个工作流定义。</span><span class="sxs-lookup"><span data-stu-id="ac717-109">In the following example, a workflow definition is created by using a <xref:System.Activities.Statements.Sequence>, <xref:System.Activities.Statements.While>, <xref:System.Activities.Statements.ForEach%601>, <xref:System.Activities.Statements.WriteLine>, and expressions.</span></span> <span data-ttu-id="ac717-110">在创建工作流定义后，将调用此定义，然后再调用 `InspectActivity` 方法。</span><span class="sxs-lookup"><span data-stu-id="ac717-110">After the workflow definition is created, it is invoked and then the `InspectActivity` method is called.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#45](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#45)]  
  
 <span data-ttu-id="ac717-111">为了枚举活动，在根活动上调用了 <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A>，并在返回的每个活动上重新递归调用。</span><span class="sxs-lookup"><span data-stu-id="ac717-111">To enumerate the activities, the <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> is called on the root activity, and again recursively on each returned activity.</span></span> <span data-ttu-id="ac717-112">在下面的示例中，将活动树中每个活动和表达式的 <xref:System.Activities.Activity.DisplayName%2A> 写入控制台。</span><span class="sxs-lookup"><span data-stu-id="ac717-112">In the following example, the <xref:System.Activities.Activity.DisplayName%2A> of each activity and expression in the activity tree is written to the console.</span></span>  
  
 [!code-csharp[CFX_WorkflowApplicationExample#46](../../../samples/snippets/csharp/VS_Snippets_CFX/cfx_workflowapplicationexample/cs/program.cs#46)]  
  
 <span data-ttu-id="ac717-113">此示例代码提供以下输出。</span><span class="sxs-lookup"><span data-stu-id="ac717-113">This sample code provides the following output.</span></span>  
  
 <span data-ttu-id="ac717-114">**列表项 1**</span><span class="sxs-lookup"><span data-stu-id="ac717-114">**List Item 1**</span></span>  
<span data-ttu-id="ac717-115">**列表项 2** </span><span class="sxs-lookup"><span data-stu-id="ac717-115">**List Item 2** </span></span>  
<span data-ttu-id="ac717-116">**List Item 3** </span><span class="sxs-lookup"><span data-stu-id="ac717-116">**List Item 3** </span></span>  
<span data-ttu-id="ac717-117">**列表项 4** </span><span class="sxs-lookup"><span data-stu-id="ac717-117">**List Item 4** </span></span>  
<span data-ttu-id="ac717-118">**列表项 5** </span><span class="sxs-lookup"><span data-stu-id="ac717-118">**List Item 5** </span></span>  
<span data-ttu-id="ac717-119">**添加到集合的项。** </span><span class="sxs-lookup"><span data-stu-id="ac717-119">**Items added to collection.** </span></span>  
<span data-ttu-id="ac717-120">**序列** </span><span class="sxs-lookup"><span data-stu-id="ac717-120">**Sequence** </span></span>  
 <span data-ttu-id="ac717-121">**文本 < 列表\<字符串 >>**</span><span class="sxs-lookup"><span data-stu-id="ac717-121">**Literal<List\<String>>**</span></span>  
 <span data-ttu-id="ac717-122">**While**</span><span class="sxs-lookup"><span data-stu-id="ac717-122">**While**</span></span>  
 <span data-ttu-id="ac717-123">**AddToCollection\<字符串 >**</span><span class="sxs-lookup"><span data-stu-id="ac717-123">**AddToCollection\<String>**</span></span>  
 <span data-ttu-id="ac717-124">**VariableValue < ICollection\<字符串 >>**</span><span class="sxs-lookup"><span data-stu-id="ac717-124">**VariableValue<ICollection\<String>>**</span></span>  
 <span data-ttu-id="ac717-125">**LambdaValue\<字符串 >**</span><span class="sxs-lookup"><span data-stu-id="ac717-125">**LambdaValue\<String>**</span></span>  
 <span data-ttu-id="ac717-126">**LocationReferenceValue < 列表\<字符串 >>**</span><span class="sxs-lookup"><span data-stu-id="ac717-126">**LocationReferenceValue<List\<String>>**</span></span>  
 <span data-ttu-id="ac717-127">**LambdaValue\<布尔 >**</span><span class="sxs-lookup"><span data-stu-id="ac717-127">**LambdaValue\<Boolean>**</span></span>  
 <span data-ttu-id="ac717-128">**LocationReferenceValue < 列表\<字符串 >>**</span><span class="sxs-lookup"><span data-stu-id="ac717-128">**LocationReferenceValue<List\<String>>**</span></span>  
 <span data-ttu-id="ac717-129">**ForEach\<字符串 >**</span><span class="sxs-lookup"><span data-stu-id="ac717-129">**ForEach\<String>**</span></span>  
 <span data-ttu-id="ac717-130">**VariableValue < IEnumerable\<字符串 >>**</span><span class="sxs-lookup"><span data-stu-id="ac717-130">**VariableValue<IEnumerable\<String>>**</span></span>  
 <span data-ttu-id="ac717-131">WriteLine</span><span class="sxs-lookup"><span data-stu-id="ac717-131">**WriteLine**</span></span>  
 <span data-ttu-id="ac717-132">**DelegateArgumentValue\<字符串 >**</span><span class="sxs-lookup"><span data-stu-id="ac717-132">**DelegateArgumentValue\<String>**</span></span>  
 <span data-ttu-id="ac717-133">**序列**</span><span class="sxs-lookup"><span data-stu-id="ac717-133">**Sequence**</span></span>  
 <span data-ttu-id="ac717-134">WriteLine</span><span class="sxs-lookup"><span data-stu-id="ac717-134">**WriteLine**</span></span>  
 <span data-ttu-id="ac717-135">**文本\<字符串 >**检索特定活动而不是枚举的所有活动，<xref:System.Activities.WorkflowInspectionServices.Resolve%2A>使用。</span><span class="sxs-lookup"><span data-stu-id="ac717-135">**Literal\<String>**  To retrieve a specific activity instead of enumerating all of the activities, <xref:System.Activities.WorkflowInspectionServices.Resolve%2A> is used.</span></span> <span data-ttu-id="ac717-136">如果以前没有调用过 <xref:System.Activities.WorkflowInspectionServices.Resolve%2A>，则 <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> 和 `WorkflowInspectionServices.CacheMetadata` 均会执行元数据缓存。</span><span class="sxs-lookup"><span data-stu-id="ac717-136">Both <xref:System.Activities.WorkflowInspectionServices.Resolve%2A> and <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> perform metadata caching if `WorkflowInspectionServices.CacheMetadata` has not been previously called.</span></span> <span data-ttu-id="ac717-137">如果已调用过 <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A>，则 <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> 基于现有元数据。</span><span class="sxs-lookup"><span data-stu-id="ac717-137">If <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> has been called then <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> is based on the existing metadata.</span></span> <span data-ttu-id="ac717-138">因此，如果自上次调用 <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> 以来对树进行了更改，则 <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> 可能会产生意外的结果。</span><span class="sxs-lookup"><span data-stu-id="ac717-138">Therefore, if tree changes have been made since the last call to <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A>, <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A> might give unexpected results.</span></span> <span data-ttu-id="ac717-139">如果在调用之后到工作流进行更改<xref:System.Activities.WorkflowInspectionServices.GetActivities%2A>，可以通过调用重新缓存元数据<xref:System.Activities.Validation.ActivityValidationServices><xref:System.Activities.Validation.ActivityValidationServices.Validate%2A>方法。</span><span class="sxs-lookup"><span data-stu-id="ac717-139">If changes have been made to the workflow after calling <xref:System.Activities.WorkflowInspectionServices.GetActivities%2A>, metadata can be re-cached by calling the <xref:System.Activities.Validation.ActivityValidationServices> <xref:System.Activities.Validation.ActivityValidationServices.Validate%2A> method.</span></span> <span data-ttu-id="ac717-140">缓存元数据在下一节中讨论。</span><span class="sxs-lookup"><span data-stu-id="ac717-140">Caching metadata is discussed in the next section.</span></span>  
  
### <a name="caching-metadata"></a><span data-ttu-id="ac717-141">缓存元数据</span><span class="sxs-lookup"><span data-stu-id="ac717-141">Caching Metadata</span></span>  
 <span data-ttu-id="ac717-142">缓存某个活动的元数据将生成并验证活动的参数、变量、子活动和活动委托的描述。</span><span class="sxs-lookup"><span data-stu-id="ac717-142">Caching the metadata for an activity builds and validates a description of the activity’s arguments, variables, child activities, and activity delegates.</span></span> <span data-ttu-id="ac717-143">默认情况下，元数据在准备执行某个活动时由运行时缓存。</span><span class="sxs-lookup"><span data-stu-id="ac717-143">Metadata, by default, is cached by the runtime when an activity is prepared for execution.</span></span> <span data-ttu-id="ac717-144">例如，如果工作流宿主作者希望在此之前缓存某个活动或活动树的元数据，以便提前使用所有开销，则可使用 <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> 在需要时缓存元数据。</span><span class="sxs-lookup"><span data-stu-id="ac717-144">If a workflow host author wants to cache the metadata for an activity or activity tree before this, for example to take all of the cost upfront, then <xref:System.Activities.WorkflowInspectionServices.CacheMetadata%2A> can be used to cache the metadata at the desired time.</span></span>
