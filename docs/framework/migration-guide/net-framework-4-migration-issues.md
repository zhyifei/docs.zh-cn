---
title: .NET Framework 4 迁移问题
ms.date: 05/02/2017
helpviewer_keywords:
- .NET Framework 4, migration
- application compatibility
ms.assetid: df478548-8c05-4de2-8ba7-adcdbe1c2a60
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: aa8cbe0cc87e656eeb8cd0234875a87ade9c05f5
ms.sourcegitcommit: 3d5d33f384eeba41b2dff79d096f47ccc8d8f03d
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 05/04/2018
ms.locfileid: "33393596"
---
# <a name="net-framework-4-migration-issues"></a><span data-ttu-id="ad5e9-102">.NET Framework 4 迁移问题</span><span class="sxs-lookup"><span data-stu-id="ad5e9-102">.NET Framework 4 migration issues</span></span>

<span data-ttu-id="ad5e9-103">本主题描述 .NET Framework 3.5 Service Pack 1 和 .NET Framework 4 之间的迁移问题，包括针对标准符合性和安全性的修复和更改以及基于客户反馈的更改。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-103">This topic describes migration issues between the .NET Framework version 3.5 Service Pack 1 and the .NET Framework version 4, including fixes, changes for standards compliance and security, and changes based on customer feedback.</span></span> <span data-ttu-id="ad5e9-104">这些更改中的大多数更改不需要在应用程序中进行任何编程修改。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-104">Most of these changes do not require any programming modifications in your applications.</span></span> <span data-ttu-id="ad5e9-105">有关可能涉及这些修改的更改，请参阅表的“建议的更改”一列。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-105">For those that may involve modifications, see the Recommended changes column of the table.</span></span>

<span data-ttu-id="ad5e9-106">本主题描述以下几个方面的重大更改：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-106">This topic describes notable changes in the following areas:</span></span>

* [<span data-ttu-id="ad5e9-107">ASP.NET 和 Web</span><span class="sxs-lookup"><span data-stu-id="ad5e9-107">ASP.NET and Web</span></span>](#asp-net-and-web)

* [<span data-ttu-id="ad5e9-108">核心</span><span class="sxs-lookup"><span data-stu-id="ad5e9-108">Core</span></span>](#core)

* [<span data-ttu-id="ad5e9-109">Data</span><span class="sxs-lookup"><span data-stu-id="ad5e9-109">Data</span></span>](#data)

* [<span data-ttu-id="ad5e9-110">Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="ad5e9-110">Windows Communication Foundation (WCF)</span></span>](#windows-communication-foundation-wcf)

* [<span data-ttu-id="ad5e9-111">Windows Presentation Foundation (WPF)</span><span class="sxs-lookup"><span data-stu-id="ad5e9-111">Windows Presentation Foundation (WPF)</span></span>](#windows-presentation-foundation-wpf)

* [<span data-ttu-id="ad5e9-112">XML</span><span class="sxs-lookup"><span data-stu-id="ad5e9-112">XML</span></span>](#xml)

<span data-ttu-id="ad5e9-113">有关本主题中问题的更高级概述，请参阅 [Migration Guide to the .NET Framework 4](https://msdn.microsoft.com/library/ff657133(v=vs.100).aspx)（.NET Framework 4 的迁移指南）。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-113">For an higher-level overview of the issues in this topic, see the [Migration Guide to the .NET Framework 4](https://msdn.microsoft.com/library/ff657133(v=vs.100).aspx).</span></span>

<span data-ttu-id="ad5e9-114">有关 Beta 2 之后的迁移问题，请参阅 [Migration Issues for .NET Framework 4 Applications: Beta 2 to RTM](http://go.microsoft.com/fwlink/?LinkId=191505)（.NET Framework 4 应用程序的迁移问题：Beta 2 到 RTM）。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-114">For migration issues after Beta 2, see [Migration Issues for .NET Framework 4 Applications: Beta 2 to RTM](http://go.microsoft.com/fwlink/?LinkId=191505).</span></span>

<span data-ttu-id="ad5e9-115">有关新增功能的信息，请参阅 [.NET Framework 4 中的新增功能](https://msdn.microsoft.com/library/ms171868(v=vs.100).aspx)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-115">For information about new features, see [What's New in the .NET Framework 4](https://msdn.microsoft.com/library/ms171868(v=vs.100).aspx).</span></span>

## <a name="aspnet-and-web"></a><span data-ttu-id="ad5e9-116">ASP.NET 和 Web</span><span class="sxs-lookup"><span data-stu-id="ad5e9-116">ASP.NET and Web</span></span>

<span data-ttu-id="ad5e9-117">命名空间：<xref:System.Web>、<xref:System.Web.Mobile>、<xref:System.Web.Security>、<xref:System.Web.UI.WebControls>；程序集：System.Web（在 System.Web.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-117">Namespaces: <xref:System.Web>, <xref:System.Web.Mobile>, <xref:System.Web.Security>, <xref:System.Web.UI.WebControls>; assembly: System.Web (in System.Web.dll)</span></span>

| <span data-ttu-id="ad5e9-118">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-118">Feature</span></span> | <span data-ttu-id="ad5e9-119">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-119">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-120">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-120">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-121">**浏览器定义文件**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-121">**Browser definition files**</span></span> | <span data-ttu-id="ad5e9-122">浏览器定义文件已更新，以包括有关新的和已更新的浏览器和设备的信息。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-122">The browser definition files have been updated to include information about new and updated browsers and devices.</span></span> <span data-ttu-id="ad5e9-123">旧式浏览器和设备（如 Netscape Navigator）已被删除，并且已添加更新的浏览器和设备（如 Google Chrome 和 Apple iPhone）。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-123">Older browsers and devices such as Netscape Navigator have been removed, and newer browsers and devices such as Google Chrome and Apple iPhone have been added.</span></span><br><br><span data-ttu-id="ad5e9-124">如果应用程序包含的自定义浏览器定义继承自一个已删除的浏览器定义，将会出现错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-124">If your application contains custom browser definitions that inherit from one of the browser definitions that have been removed, you will see an error.</span></span><br><br><span data-ttu-id="ad5e9-125"><xref:System.Web.HttpBrowserCapabilities> 对象（由页的 `Request.Browse` 属性公开）由浏览器定义文件驱动。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-125">The <xref:System.Web.HttpBrowserCapabilities> object (which is exposed by the page's `Request.Browse` property) is driven by the browser definition files.</span></span> <span data-ttu-id="ad5e9-126">因此，通过在 ASP.NET 4 中访问此对象的属性返回的信息可能与早期版本的 ASP.NET 中已返回的信息不同。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-126">Therefore, the information that is returned by accessing a property of this object in ASP.NET 4 might be different than the information that was returned in an earlier version of ASP.NET.</span></span> | <span data-ttu-id="ad5e9-127">如果应用程序依赖于旧式浏览器定义文件，可从以下文件夹复制这些文件：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-127">If your application relies on the old browser definition files, you can copy them from the following folder:</span></span><br><br><span data-ttu-id="ad5e9-128">Windows\\Microsoft.NET\\Framework\\v2.0.50727\\CONFIG\\Browsers</span><span class="sxs-lookup"><span data-stu-id="ad5e9-128">*Windows\\Microsoft.NET\\Framework\\v2.0.50727\\CONFIG\\Browsers*</span></span><br><br><span data-ttu-id="ad5e9-129">将这些文件复制到 ASP.NET 4 对应的 \\CONFIG\\Browsers 文件夹中。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-129">Copy the files into the corresponding *\\CONFIG\\Browsers* folder for ASP.NET 4.</span></span> <span data-ttu-id="ad5e9-130">复制这些文件之后，请运行 [Aspnet_regbrowsers.exe](https://msdn.microsoft.com/library/ms229858.aspx) 命令行工具。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-130">After you copy the files, run the [Aspnet_regbrowsers.exe](https://msdn.microsoft.com/library/ms229858.aspx) command-line tool.</span></span> <span data-ttu-id="ad5e9-131">有关详细信息，请参阅 [http://www.asp.net/mobile](http://go.microsoft.com/fwlink/?LinkId=182900) 网站。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-131">For more information, see the [http://www.asp.net/mobile](http://go.microsoft.com/fwlink/?LinkId=182900) Web site.</span></span> |
| <span data-ttu-id="ad5e9-132">**在混合版本的 ASP.NET 下运行的子应用程序**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-132">**Child applications running under mixed versions of ASP.NET**</span></span> | <span data-ttu-id="ad5e9-133">由于配置或编译错误，配置为运行 ASP.NET 早期版本的应用程序子级的 ASP.NET 4 应用程序可能无法启动。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-133">ASP.NET 4 applications that are configured as children of applications that run earlier versions of ASP.NET might fail to start because of configuration or compilation errors.</span></span> <span data-ttu-id="ad5e9-134">发生的具体错误取决于应用程序是在 IIS 6.0、IIS 7 还是 IIS 7.5 下运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-134">The specific error that occurs depends on whether the application runs under IIS 6.0, or under IIS 7 or IIS 7.5.</span></span> | <span data-ttu-id="ad5e9-135">可对受影响应用程序的配置文件进行更改，以便配置系统能正确识别 ASP.NET 4 应用程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-135">You can make changes to the configuration files of the affected applications so that the configuration system correctly recognizes the ASP.NET 4 application.</span></span> <span data-ttu-id="ad5e9-136">有关必须进行的更改的信息，请参阅 ASP.NET 网站上的 [ASP.NET 4 Breaking Changes](http://go.microsoft.com/fwlink/?LinkId=182908)（ASP.NET 4 重大更改）文档中“ASP.NET 4 子应用程序在 ASP.NET 2.0 或 ASP.NET 3.5 应用程序下启动失败”一节。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-136">For information about the changes you must make, see the section "ASP.NET 4 Child Applications Fail to Start When Under ASP.NET 2.0 or ASP.NET 3.5 Applications" in the document [ASP.NET 4 Breaking Changes](http://go.microsoft.com/fwlink/?LinkId=182908) on the ASP.NET Web site.</span></span> |
| <span data-ttu-id="ad5e9-137">**ClientID 更改**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-137">**ClientID changes**</span></span> | <span data-ttu-id="ad5e9-138">利用 ASP.NET 4 中的新 `clientIDMode` 设置，可指定 ASP.NET 生成 HTML 元素的 `id` 特性的方式。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-138">The new `clientIDMode` setting in ASP.NET 4 lets you specify how ASP.NET generates the `id` attribute for HTML elements.</span></span> <span data-ttu-id="ad5e9-139">在 ASP.NET 的早期版本中，默认行为与 `clientIDMode` 的 `AutoID` 设置等效。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-139">In previous versions of ASP.NET, the default behavior was equivalent to the `AutoID` setting of `clientIDMode`.</span></span> <span data-ttu-id="ad5e9-140">现在的默认设置为 `Predictable`。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-140">The default setting is now `Predictable`.</span></span> <span data-ttu-id="ad5e9-141">有关详细信息，请参阅 [ASP.NET Web 服务器控件标识](https://msdn.microsoft.com/library/1d04y8ss(v=vs.100).aspx)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-141">For more information, see [ASP.NET Web Server Control Identification](https://msdn.microsoft.com/library/1d04y8ss(v=vs.100).aspx).</span></span> | <span data-ttu-id="ad5e9-142">如果使用 Visual Studio 2010 从 ASP.NET 2.0 或 ASP.NET 3.5 升级应用程序，则此工具会自动向 Web.config 文件添加设置，保留早期版本的 .NET Framework 的行为。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-142">If you use Visual Studio 2010 to upgrade your application from ASP.NET 2.0 or ASP.NET 3.5, the tool automatically adds a setting to the Web.config file that preserves the behavior of earlier versions of the .NET Framework.</span></span> <span data-ttu-id="ad5e9-143">但是，如果通过在 IIS 中将应用程序池更改为面向 .NET Framework 4 来升级应用程序，ASP.NET 默认使用新的模式。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-143">However, if you upgrade an application by changing the application pool in IIS to target the .NET Framework 4, ASP.NET uses the new mode by default.</span></span> <span data-ttu-id="ad5e9-144">若要禁用新的客户端 ID 模式，请将以下设置添加到 Web.config 文件：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-144">To disable the new client ID mode, add the following setting to the Web.config file:</span></span><br><br>`<pages clientIDMode="AutoID" />` |
| <span data-ttu-id="ad5e9-145">**代码访问安全性 (CAS)**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-145">**Code access security (CAS)**</span></span> | <span data-ttu-id="ad5e9-146">ASP.NET 3.5 中已添加的 ASP.NET 2.0 NET 功能使用 .NET Framework 1.1 和 .NET Framework 2.0 代码访问安全性 (CAS) 模型。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-146">ASP.NET 2.0 NET features that were added in ASP.NET 3.5 use the .NET Framework 1.1 and .NET Framework 2.0 code access security (CAS) model.</span></span> <span data-ttu-id="ad5e9-147">但是，实质上已对 ASP.NET 4 中的 CAS 实现进行了检查。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-147">However, the implementation of CAS in ASP.NET 4 has been substantially overhauled.</span></span> <span data-ttu-id="ad5e9-148">因此，依赖于在全局程序集缓存中运行的受信任代码的部分信任 ASP.NET 应用程序可能失败，并引发各种安全异常。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-148">As a result, partial-trust ASP.NET applications that rely on trusted code running in the global assembly cache might fail with various security exceptions.</span></span> <span data-ttu-id="ad5e9-149">此外，依赖于对计算机 CAS 策略进行的大量修改的部分信任应用程序也可能失败，并引发安全异常。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-149">Partial-trust applications that rely on extensive modifications to machine CAS policy might also fail and throw security exceptions.</span></span> | <span data-ttu-id="ad5e9-150">可通过使用 `trust` 配置元素中的新 `legacyCasModel` 特性，将部分信任 ASP.NET 4 应用程序还原为 ASP.NET 1.1 和 2.0 的行为，如下面的示例所示：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-150">You can revert partial-trust ASP.NET 4 applications to the behavior of ASP.NET 1.1 and 2.0 by using the new `legacyCasModel` attribute in the `trust` configuration element, as shown in the following example:</span></span><br><br>`<trust level= "Medium" legacyCasModel="true" />`<br><br><span data-ttu-id="ad5e9-151">重要说明：还原为早期 CAS 模型可能会降低安全性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-151">Important: Reverting to the older CAS model might represent reduced security.</span></span><br><br><span data-ttu-id="ad5e9-152">有关新 ASP.NET 4 代码访问安全性模型的详细信息，请参阅 [ASP.NET 4 应用程序中的代码访问安全性](https://msdn.microsoft.com/library/dd984947.aspx)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-152">For more information about the new ASP.NET 4 code access security model, see [Code Access Security in ASP.NET 4 Applications](https://msdn.microsoft.com/library/dd984947.aspx).</span></span> |
| <span data-ttu-id="ad5e9-153">**配置文件**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-153">**Configuration files**</span></span> | <span data-ttu-id="ad5e9-154">.NET Framework 和 ASP.NET 4 的根配置文件（machine.config 文件和根 Web.config 文件）已经更新，包含在 ASP.NET 3.5 的应用程序 Web.config 文件中找到的大多数样本配置信息。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-154">The root configuration files (the machine.config file and the root Web.config file) for the .NET Framework and ASP.NET 4 have been updated to include most of the boilerplate configuration information that was found in the application Web.config files in ASP.NET 3.5.</span></span> <span data-ttu-id="ad5e9-155">由于托管 IIS 7 和 IIS 7.5 配置系统的复杂性，在 ASP.NET 4 下以及在 IIS 7 和 IIS 7.5 下运行 ASP.NET 3.5 应用程序会导致 ASP.NET 出错或 IIS 出错。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-155">Because of the complexity of the managed IIS 7 and IIS 7.5 configuration systems, running ASP.NET 3.5 applications under ASP.NET 4 and under IIS 7 and IIS 7.5 can result in either ASP.NET errors or IIS errors.</span></span> | <span data-ttu-id="ad5e9-156">使用 Visual Studio 2010 中的项目升级工具将 ASP.NET 3.5 应用程序升级到 ASP.NET 4。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-156">Upgrade ASP.NET 3.5 applications to ASP.NET 4 by using the project upgrade tools in Visual Studio 2010.</span></span> <span data-ttu-id="ad5e9-157">Visual Studio 2010 自动修改 ASP.NET 3.5 应用程序的 Web.config 文件，以包含 ASP.NET 4 的相应设置。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-157">Visual Studio 2010 automatically modifies the ASP.NET 3.5 application's Web.config file to contain the appropriate settings for ASP.NET 4.</span></span><br><br><span data-ttu-id="ad5e9-158">不过，可使用 .NET Framework 4 运行 ASP.NET 3.5 应用程序，而无需重新编译。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-158">However, you can run ASP.NET 3.5 applications using the .NET Framework 4 without recompilation.</span></span> <span data-ttu-id="ad5e9-159">在此情况下，可能必须先手动修改应用程序的 Web.config 文件，然后在 .NET Framework 4 和 IIS 7 或 IIS 7.5 下运行应用程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-159">In that case, you might have to manually modify the application's Web.config file before you run the application under the .NET Framework 4 and under IIS 7 or IIS 7.5.</span></span> <span data-ttu-id="ad5e9-160">必须进行的特定更改取决于所使用的软件组合，包括 Service Pack (SP) 版本。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-160">The specific change you must make depends on the combination of software you are working with, including Service Pack (SP) releases.</span></span> <span data-ttu-id="ad5e9-161">有关受此更改影响的可能软件组合以及如何解决特定组合相关问题的信息，请参阅 ASP.NET 网站上的 [ASP.NET 4 Breaking Changes](http://go.microsoft.com/fwlink/?LinkId=182908)（ASP.NET 4 重大更改）文档中“有关新的 ASP.NET 4 根配置的配置错误”一节。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-161">For information about the possible software combinations that are affected by this change and how to resolve problems with specific combinations, see the section "Configuration Errors Related to New ASP.NET 4 Root Configuration" in the document [ASP.NET 4 Breaking Changes](http://go.microsoft.com/fwlink/?LinkId=182908) on the ASP.NET Web site.</span></span> |
| <span data-ttu-id="ad5e9-162">**控件呈现**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-162">**Control rendering**</span></span> | <span data-ttu-id="ad5e9-163">在 ASP.NET 的早期版本中，某些控件发出了无法禁用的标记。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-163">In previous versions of ASP.NET, some controls emitted markup that you could not disable.</span></span> <span data-ttu-id="ad5e9-164">默认情况下，ASP.NET 4 中不再生成此类标记。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-164">By default, this type of markup is no longer generated in ASP.NET 4.</span></span> <span data-ttu-id="ad5e9-165">呈现更改将影响下列控件：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-165">The rendering changes affect the following controls:</span></span><br><br><span data-ttu-id="ad5e9-166">\* `Image` 和 `ImageButton` 控件不再呈现 `border="0"` 特性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-166">\* The `Image` and `ImageButton` controls no longer render a `border="0"` attribute.</span></span><br><span data-ttu-id="ad5e9-167">\* 默认情况下，`BaseValidator` 类和派生自该类的验证控件不再呈现红色文本。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-167">\* The `BaseValidator` class and validation controls that derive from it no longer render red text by default.</span></span><br><span data-ttu-id="ad5e9-168">\* `HtmlForm` 控件不呈现 `name` 特性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-168">\* The `HtmlForm` control does not render a `name` attribute.</span></span><br><span data-ttu-id="ad5e9-169">\* `Table` 控件不再呈现 `border="0"` 特性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-169">\* The `Table` control no longer renders a `border="0"` attribute.</span></span><br><br><span data-ttu-id="ad5e9-170">对于并不设计用于用户输入的控件（例如，`Label` 控件），如果其 `Enabled` 属性设置为 `false`（或者它们从容器控件继承此设置），则这些控件不再呈现 `disabled="disabled"` 特性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-170">Controls that are not designed for user input (for example, the `Label` control) no longer render the `disabled="disabled"` attribute if their `Enabled` property is set to `false` (or if they inherit this setting from a container control).</span></span> | <span data-ttu-id="ad5e9-171">如果使用 Visual Studio 2010 从 ASP.NET 2.0 或 ASP.NET 3.5 升级应用程序，此工具会自动向 Web.config 文件添加设置，保留旧式呈现方式。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-171">If you use Visual Studio 2010 to upgrade your application from ASP.NET 2.0 or ASP.NET 3.5, the tool automatically adds a setting to the Web.config file that preserves legacy rendering.</span></span> <span data-ttu-id="ad5e9-172">但是，如果通过在 IIS 中将应用程序池更改为面向 .NET Framework 4 来升级应用程序，ASP.NET 默认使用新的呈现模式。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-172">However, if you upgrade an application by changing the application pool in IIS to target the .NET Framework 4, ASP.NET uses the new rendering mode by default.</span></span> <span data-ttu-id="ad5e9-173">若要禁用新的呈现模式，请将以下设置添加到 Web.config 文件：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-173">To disable the new rendering mode, add the following setting to the Web.config file:</span></span><br><br>`<pages controlRenderingCompatibilityVersion="3.5" />` |
| <span data-ttu-id="ad5e9-174">**默认文档中的事件处理程序**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-174">**Event handlers in default documents**</span></span> | <span data-ttu-id="ad5e9-175">在对无扩展的 URL 发出请求（此 URL 具有已映射到它的默认文档）时，ASP.NET 4 会将 HTML `form` 元素的 `action` 特性呈现为空字符串。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-175">ASP.NET  4 renders the HTML `form` element's `action` attribute value as an empty string when a request is made to an extensionless URL that has a default document mapped to it.</span></span> <span data-ttu-id="ad5e9-176">在 ASP.NET 的早期版本中，对 `http://contoso.com` 的请求会导致对 Default.aspx 的请求。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-176">In earlier releases of ASP.NET, a request to `http://contoso.com` would result in a request to Default.aspx.</span></span> <span data-ttu-id="ad5e9-177">在该文档中，开始 `form` 标记的呈现方式如以下示例所示：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-177">In that document, the opening `form` tag would be rendered as in the following example:</span></span><br><br>`<form action="Default.aspx" />`<br><br><span data-ttu-id="ad5e9-178">在 ASP.NET 4 中，对 `http://contoso.com` 的请求还会导致对 Default.aspx 的请求，但此时 ASP.NET 会按以下示例所示方式呈现 HTML 开始 `form` 标记：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-178">In ASP.NET 4, a request to `http://contoso.com` also results in a request to Default.aspx, but ASP.NET now renders the HTML opening `form` tag as in the following example:</span></span><br><br>`<form action="" />`<br><br><span data-ttu-id="ad5e9-179">当 `action` 特性为空字符串时，IIS `DefaultDocumentModule` 对象将创建对 Default.aspx 的子请求。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-179">When the `action` attribute is an empty string, the IIS `DefaultDocumentModule` object creates a child request to Default.aspx.</span></span> <span data-ttu-id="ad5e9-180">在大多数情况下，此子请求对于应用程序代码是透明的，并且 Default.aspx 页会正常运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-180">Under most conditions, this child request is transparent to application code, and the Default.aspx page runs normally.</span></span> <span data-ttu-id="ad5e9-181">但托管代码和 IIS 7 或 IIS 7.5 集成模式之间可能的交互会导致托管 .aspx 页在子请求期间停止正常工作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-181">However, a potential interaction between managed code and IIS 7 or IIS 7.5 Integrated mode can cause managed .aspx pages to stop working properly during the child request.</span></span> <span data-ttu-id="ad5e9-182">如果出现以下情况，则对默认 .aspx 文档的子请求将导致发生错误或意外行为：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-182">If the following conditions occur, the child request to a default .aspx document will result in an error or in unexpected behavior:</span></span><br><br><span data-ttu-id="ad5e9-183">\* 将 .aspx 页发送到其 `form` 元素的 `action` 特性设置为 "" 的浏览器。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-183">\* An .aspx page is sent to the browser with the `form` element's `action` attribute set to "".</span></span><br><span data-ttu-id="ad5e9-184">\* 将窗体回发到 ASP.NET。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-184">\* The form is posted back to ASP.NET.</span></span><br><span data-ttu-id="ad5e9-185">\* 托管 HTTP 模块读取实体正文的某一部分，如 `Request.Form` 或 `Request.Params`。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-185">\* A managed HTTP module reads some part of the entity body, such as `Request.Form` or `Request.Params`.</span></span> <span data-ttu-id="ad5e9-186">这会使 POST 请求的实体正文读入托管内存中。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-186">This causes the entity body of the POST request to be read into managed memory.</span></span> <span data-ttu-id="ad5e9-187">因此，实体正文不再对在 IIS 7 或 IIS 7.5 集成模式中运行的任何本机代码模块可用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-187">As a result, the entity body is no longer available to any native code modules that are running in IIS 7 or IIS 7.5 Integrated mode.</span></span><br><span data-ttu-id="ad5e9-188">\* IIS `DefaultDocumentModule` 对象最终运行并创建对 Default.aspx 文档的子请求。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-188">\* The IIS `DefaultDocumentModule` object eventually runs and creates a child request to the Default.aspx document.</span></span> <span data-ttu-id="ad5e9-189">但由于一段托管代码已读取实体正文，因此没有可发送给子请求的实体正文。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-189">However, because the entity body has already been read by a piece of managed code, there is no entity body available to send to the child request.</span></span><br><span data-ttu-id="ad5e9-190">\* 在对子请求运行 HTTP 管道时，将在处理程序执行阶段运行 .aspx 文件的处理程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-190">\* When the HTTP pipeline runs for the child request, the handler for .aspx files runs during the handler-execute phase.</span></span><br><br><span data-ttu-id="ad5e9-191">由于没有实体正文，因此不存在窗体变量和视图状态。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-191">Because there is no entity body, there are no form variables and no view state.</span></span> <span data-ttu-id="ad5e9-192">这样一来，便没有可供 .aspx 页处理程序用来确定应引发哪个事件（如果有）的信息。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-192">Therefore there is no information available for the .aspx page handler to determine what event (if any) should be raised.</span></span> <span data-ttu-id="ad5e9-193">因此，不会运行针对受影响 .aspx 页的任何回发事件处理程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-193">As a result, none of the postback event handlers for the affected .aspx page run.</span></span> | <span data-ttu-id="ad5e9-194">有关解决可能因为此更改而引发的问题的方法，请参阅 ASP.NET 网站上的 [ASP.NET 4 Breaking Changes](http://go.microsoft.com/fwlink/?LinkId=182908)（ASP.NET 4 重大更改）文档中“可能会在 IIS 7 或 IIS 7.5 集成模式下的默认文档中引发的事件处理程序”。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-194">For information about ways to work around problems that might arise as a result of this change, see "Event Handlers Might Not Be Not Raised in a Default Document in IIS 7 or IIS 7.5 Integrated Mode" in the document [ASP.NET 4 Breaking Changes](http://go.microsoft.com/fwlink/?LinkId=182908) on the ASP.NET Web site.</span></span> |
| <span data-ttu-id="ad5e9-195">**哈希算法**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-195">**Hashing algorithm**</span></span> | <span data-ttu-id="ad5e9-196">ASP.NET 使用加密算法和哈希算法来帮助保护数据（如窗体身份验证 Cookie 和视图状态）。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-196">ASP.NET uses both encryption and hashing algorithms to help secure data such as forms authentication cookies and view state.</span></span> <span data-ttu-id="ad5e9-197">默认情况下，ASP.NET 4 使用 <xref:System.Security.Cryptography.HMACSHA256> 算法对 Cookie 和视图状态进行哈希操作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-197">By default, ASP.NET 4 uses the <xref:System.Security.Cryptography.HMACSHA256> algorithm for hash operations on cookies and view state.</span></span> <span data-ttu-id="ad5e9-198">早期版本的 ASP.NET 使用较早的 <xref:System.Security.Cryptography.HMACSHA1> 算法。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-198">Earlier versions of ASP.NET used the older <xref:System.Security.Cryptography.HMACSHA1> algorithm.</span></span> | <span data-ttu-id="ad5e9-199">如果运行混合了 ASP.NET 2.0 和 ASP.NET 4 的应用程序，其中的数据（如窗体身份验证 Cookie）必须跨多个 .NET Framework 版本工作，请通过在 Web.config 文件中添加以下设置，将 ASP.NET 4 Web 应用程序配置为使用较早的 <xref:System.Security.Cryptography.HMACSHA1> 算法：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-199">If you run applications that mix ASP.NET 2.0 and ASP.NET 4, where data such as forms authentication cookies must work across .NET Framework versions, configure an ASP.NET 4 Web application to use the older <xref:System.Security.Cryptography.HMACSHA1> algorithm by adding the following setting in the Web.config file:</span></span><br><br>`<machineKey validation="SHA1" />` |
| <span data-ttu-id="ad5e9-200">**在 Internet Explorer 中托管控件**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-200">**Hosting controls in Internet Explorer**</span></span> | <span data-ttu-id="ad5e9-201">无法再使用 Internet Explorer 来托管 Windows 窗体控件，因为可通过更优的解决方案在 Web 上托管控件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-201">You can no longer host Windows Forms controls in the Internet Explorer, because there are better solutions for hosting controls on the Web.</span></span> <span data-ttu-id="ad5e9-202">因此，已从 .NET Framework 中删除 IEHost.dll 和 IEExec.exe 程序集。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-202">Therefore, the IEHost.dll and IEExec.exe assemblies have been removed from the .NET Framework.</span></span> | <span data-ttu-id="ad5e9-203">可使用以下技术在 Web 应用程序中进行自定义控件开发：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-203">You can use the following technologies for custom control development in Web applications:</span></span><br><br><span data-ttu-id="ad5e9-204">\* 可创建 Silverlight 应用程序并将其配置为在浏览器外部运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-204">\* You can create a Silverlight application and configure it to run outside the browser.</span></span> <span data-ttu-id="ad5e9-205">有关详细信息，请参阅[浏览器外支持](https://msdn.microsoft.com/library/dd550721(v=vs.100).aspx)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-205">For more information, see [Out-of-Browser Support](https://msdn.microsoft.com/library/dd550721(v=vs.100).aspx).</span></span><br><span data-ttu-id="ad5e9-206">\* 可生成 XAML 浏览器应用程序 (XBAP) 来利用 WPF 功能（需要客户端计算机上装有 .NET Framework）。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-206">\* You can build a XAML browser application (XBAP) to take advantage of WPF capabilities (requires the .NET Framework on client machines).</span></span> <span data-ttu-id="ad5e9-207">有关详细信息，请参阅 [WPF XAML 浏览器应用程序概述](/dotnet/framework/wpf/app-development/wpf-xaml-browser-applications-overview)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-207">For more information, see [WPF XAML Browser Applications Overview](/dotnet/framework/wpf/app-development/wpf-xaml-browser-applications-overview).</span></span> |
| <span data-ttu-id="ad5e9-208">**HtmlEncode 和 UrlEncode 方法**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-208">**HtmlEncode and UrlEncode methods**</span></span> | <span data-ttu-id="ad5e9-209"><xref:System.Web.HttpUtility> 和 <xref:System.Web.HttpServerUtility> 类的 `HtmlEncode` 和 `UrlEncode` 方法已更新，现可按如下方式对单引号字符 (') 进行编码：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-209">The `HtmlEncode` and `UrlEncode` methods of the <xref:System.Web.HttpUtility> and <xref:System.Web.HttpServerUtility> classes have been updated to encode the single quotation mark character (') as follows:</span></span><br><br><span data-ttu-id="ad5e9-210">\* `HtmlEncode` 方法将单引号的实例编码为 `&#39;`</span><span class="sxs-lookup"><span data-stu-id="ad5e9-210">\* The `HtmlEncode` method encodes instances of the single quotation mark as `&#39;`</span></span><br><span data-ttu-id="ad5e9-211">\* `UrlEncode` 方法将单引号的实例编码为 `%27`</span><span class="sxs-lookup"><span data-stu-id="ad5e9-211">\* The `UrlEncode` method encodes instances of the single quotation mark as `%27`</span></span> | <span data-ttu-id="ad5e9-212">检查使用 `HtmlEncode` 和 `UrlEncode` 方法的位置的代码，并确保对编码进行的更改不会导致将影响应用程序的更改。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-212">Examine your code for places where you use the `HtmlEncode` and `UrlEncode` methods, and make sure that the change in encoding does not result in a change that would affect your application.</span></span> |
| <span data-ttu-id="ad5e9-213">**ASP.NET 2.0 应用程序中的 HttpException 错误**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-213">**HttpException errors in ASP.NET 2.0 applications**</span></span> | <span data-ttu-id="ad5e9-214">在 IIS 6 上启用 ASP.NET 4 后，IIS 6 上运行的 ASP.NET 2.0 应用程序（在 Windows Server 2003 或 Windows Server 2003 R2 中）可能会生成错误，如下所示：`System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.`</span><span class="sxs-lookup"><span data-stu-id="ad5e9-214">After ASP.NET 4 has been enabled on IIS 6, ASP.NET 2.0 applications that run on IIS 6 (in either Windows Server 2003 or Windows Server 2003 R2) might generate errors such as the following: `System.Web.HttpException: Path '/[yourApplicationRoot]/eurl.axd/[Value]' was not found.`</span></span> | <span data-ttu-id="ad5e9-215">\* 如果无需 ASP.NET 4 即可运行网站，请重新映射该网站以改用 ASP.NET 2.0。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-215">\* If ASP.NET 4 is not required in order to run the Web site, remap the site to use ASP.NET 2.0 instead.</span></span><br><br><span data-ttu-id="ad5e9-216">或</span><span class="sxs-lookup"><span data-stu-id="ad5e9-216">-or-</span></span><br><br><span data-ttu-id="ad5e9-217">\* 如果需要 ASP.NET 4 才能运行网站，请将所有子 ASP.NET 2.0 虚拟目录移至映射到 ASP.NET 2.0 的其他网站。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-217">\* If ASP.NET 4 is required in order to run the Web site, move any child ASP.NET 2.0 virtual directories to a different Web site that is mapped to ASP.NET 2.0.</span></span><br><br><span data-ttu-id="ad5e9-218">或</span><span class="sxs-lookup"><span data-stu-id="ad5e9-218">-or-</span></span><br><br><span data-ttu-id="ad5e9-219">\* 禁用无扩展 URL。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-219">\* Disable extensionless URLs.</span></span> <span data-ttu-id="ad5e9-220">有关详细信息，请参阅 ASP.NET 网站上的 [ASP.NET 4 Breaking Changes](http://go.microsoft.com/fwlink/?LinkId=182908)（ASP.NET 4 重大更改）文档中“ASP.NET 2.0 应用程序可能生成引用 eurl.axd 的 HttpException 错误”。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-220">For more information, see "ASP.NET 2.0 Applications Might Generate HttpException Errors That Reference eurl.axd" in the document [ASP.NET 4 Breaking Changes](http://go.microsoft.com/fwlink/?LinkId=182908) on the ASP.NET Web site.</span></span> |
| <span data-ttu-id="ad5e9-221">**成员资格类型**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-221">**Membership types**</span></span> | <span data-ttu-id="ad5e9-222">已将 ASP.NET 成员资格中使用的某些类型（例如 <xref:System.Web.Security.MembershipProvider>）从 System.Web.dll 移至 System.Web.ApplicationServices.dll 程序集。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-222">Some types (for example, <xref:System.Web.Security.MembershipProvider>) that are used in ASP.NET membership have been moved from System.Web.dll to the System.Web.ApplicationServices.dll assembly.</span></span> <span data-ttu-id="ad5e9-223">移动这些类型是为了解析客户端中的类型与扩展的 .NET Framework SKU 中的类型之间的体系结构层依赖关系。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-223">The types were moved in order to resolve architectural layering dependencies between types in the client and in extended .NET Framework SKUs.</span></span> | <span data-ttu-id="ad5e9-224">对于已从早期版本的 ASP.NET 升级的类库以及使用已移动的成员资格类型的类库，在 ASP.NET 4 项目中使用这些类库时，可能无法编译它们。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-224">Class libraries that have been upgraded from earlier versions of ASP.NET and that use membership types that have been moved might fail to compile when used in an ASP.NET 4 project.</span></span> <span data-ttu-id="ad5e9-225">如果是这样，请在类库项目中添加对 System.Web.ApplicationServices.dll 的引用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-225">If so, add a reference in the class library project to System.Web.ApplicationServices.dll.</span></span> |
| <span data-ttu-id="ad5e9-226">**Menu 控件更改**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-226">**Menu control changes**</span></span> | <span data-ttu-id="ad5e9-227">对 <xref:System.Web.UI.WebControls.Menu> 控件进行更改会导致发生以下行为：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-227">Changes to the <xref:System.Web.UI.WebControls.Menu> control result in the following behavior:</span></span><br><br><span data-ttu-id="ad5e9-228">\* 如果 <xref:System.Web.UI.WebControls.MenuRenderingMode> 设置为 `List`，或者 <xref:System.Web.UI.WebControls.MenuRenderingMode> 设置为 `Default`，且 <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> 设置为 `4.0` 或更高版本，则 <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> 属性不起作用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-228">\* If <xref:System.Web.UI.WebControls.MenuRenderingMode> is set to `List`, or if <xref:System.Web.UI.WebControls.MenuRenderingMode> is set to `Default` and <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> is set to `4.0` or later, the <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> property has no effect.</span></span><br><span data-ttu-id="ad5e9-229">\* 如果在 <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> 和 <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> 属性中设置的路径包含反斜杠 (\\)，则图像不会呈现。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-229">\* If the path that is set in the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> and <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> properties contains a backslash (\\), the images do not render.</span></span> <span data-ttu-id="ad5e9-230">（在 ASP.NET 的早期版本中，路径可包含反斜杠。）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-230">(In earlier versions of ASP.NET, the path could include a backslash.)</span></span> | <span data-ttu-id="ad5e9-231">\* 设置父 <xref:System.Web.UI.WebControls.Menu> 控件的 <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> 或 <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl>，而不是设置单个菜单项的 <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> 属性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-231">\* Instead of setting the <xref:System.Web.UI.WebControls.MenuItem.PopOutImageUrl> property for individual menu items, set the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> or <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> of the parent <xref:System.Web.UI.WebControls.Menu> control.</span></span><br><br><span data-ttu-id="ad5e9-232">或</span><span class="sxs-lookup"><span data-stu-id="ad5e9-232">-or-</span></span><br><br><span data-ttu-id="ad5e9-233">将 <xref:System.Web.UI.WebControls.MenuRenderingMode> 设置为 `Table`，或者将 <xref:System.Web.UI.WebControls.MenuRenderingMode> 设置为 `Default`，并将 <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> 设置为 `3.5`。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-233">Set <xref:System.Web.UI.WebControls.MenuRenderingMode> to `Table`, or set <xref:System.Web.UI.WebControls.MenuRenderingMode> to `Default` and set <xref:System.Web.Configuration.PagesSection.ControlRenderingCompatibilityVersion> to `3.5`.</span></span> <span data-ttu-id="ad5e9-234">这些设置会导致 <xref:System.Web.UI.WebControls.Menu> 控件使用在早期版本的 ASP.NET 中使用的基于 HTML 表的布局。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-234">These settings cause the <xref:System.Web.UI.WebControls.Menu> control to use the HTML table-based layout that it used in earlier versions of ASP.NET.</span></span><br><span data-ttu-id="ad5e9-235">\* 如果 <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> 或 <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> 属性中的路径包含反斜杠 (\\)，请替换为斜杠字符 (/)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-235">\* If the path in the <xref:System.Web.UI.WebControls.Menu.StaticPopOutImageUrl%2A> or <xref:System.Web.UI.WebControls.Menu.DynamicPopOutImageUrl> property contains a backslash (\\), substitute a slash character (/).</span></span> |
| <span data-ttu-id="ad5e9-236">**Web.config 文件中的移动程序集**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-236">**Mobile assembly in Web.config file**</span></span> | <span data-ttu-id="ad5e9-237">在早期版本的 ASP.NET 中，对 System.Web.Mobile.dll 程序集的引用位于根 Web.config 文件 `assemblies` 节中的 `system.web`/`compilation` 下。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-237">In previous versions of ASP.NET, a reference to the System.Web.Mobile.dll assembly was included in the root Web.config file in the `assemblies` section under `system.web`/`compilation`.</span></span> <span data-ttu-id="ad5e9-238">为了提高性能，已删除对此程序集的引用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-238">To improve performance, the reference to this assembly has been removed.</span></span><br><br><span data-ttu-id="ad5e9-239">注意：System.Web.Mobile.dll 程序集和 ASP.NET 移动控件包含在 ASP.NET 4 中，但它们已被弃用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-239">Note: The System.Web.Mobile.dll assembly and the ASP.NET mobile controls are included in ASP.NET 4, but they are deprecated.</span></span> | <span data-ttu-id="ad5e9-240">若要使用此程序集中的类型，请在根 Web.config 文件或应用程序 Web.config 文件中添加对此程序集的引用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-240">If you want to use types from this assembly, add a reference to the assembly in either the root Web.config file or in an application Web.config file.</span></span> |
| <span data-ttu-id="ad5e9-241">**输出缓存**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-241">**Output caching**</span></span> | <span data-ttu-id="ad5e9-242">在 ASP.NET 1.0 中，Bug 会导致缓存页（这些页指定 `Location="ServerAndClient"` 作为输出缓存设置）在响应中发出 `Vary:*` HTTP 标头。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-242">In ASP.NET 1.0, a bug caused cached pages that specified `Location="ServerAndClient"` as an output€“cache setting to emit a `Vary:*` HTTP header in the response.</span></span> <span data-ttu-id="ad5e9-243">这还能起到告知客户端浏览器绝不要本地对页进行缓存的作用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-243">This had the effect of telling client browsers to never cache the page locally.</span></span> <span data-ttu-id="ad5e9-244">ASP.NET 1.1 中已添加 <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> 方法，可调用此方法来禁止显示 `Vary:*` 标头。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-244">In ASP.NET 1.1, the <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> method was added, which could be called in order to suppress the `Vary:*` header.</span></span> <span data-ttu-id="ad5e9-245">但 Bug 报告表明开发人员不了解现有 `SetOmitVaryStar` 行为。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-245">However, bug reports suggest that developers are unaware of the existing `SetOmitVaryStar` behavior.</span></span><br><br><span data-ttu-id="ad5e9-246">在 ASP.NET 4 中，不再从指定以下指令的响应中发出 `Vary:*` HTTP 标头：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-246">In ASP.NET 4, the `Vary:*` HTTP header is no longer emitted from responses that specify the following directive:</span></span><br><br>`<%@ OutputCache Location="ServerAndClient" %>`<br><br><span data-ttu-id="ad5e9-247">因此，不再需要使用 <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> 方法即可禁止显示 `Vary:*` 标头。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-247">As a result, the <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A> method is no longer needed in order to suppress the `Vary:*` header.</span></span> <span data-ttu-id="ad5e9-248">在为 `Location` 特性指定“ServerAndClient”的应用程序中，可在浏览器中对页进行缓存而无需调用 <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-248">In applications that specify "ServerAndClient" for the `Location` attribute, pages will be cacheable in the browser without requiring that you call <xref:System.Web.HttpCachePolicy.SetOmitVaryStar%2A>.</span></span> | <span data-ttu-id="ad5e9-249">如果应用程序中的页必须发出 `Vary:*`，请调用 <xref:System.Web.HttpResponse.AppendHeader%2A> 方法，如以下示例所示：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-249">If pages in the application must emit `Vary:*`, call the <xref:System.Web.HttpResponse.AppendHeader%2A> method as shown in the following example:</span></span><br><br>`System.Web.HttpResponse.AppendHeader("Vary","*");`<br><br><span data-ttu-id="ad5e9-250">或者，可将输出缓存 `Location` 特性的值更改为“Server”。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-250">Alternatively, you can change the value of the output caching `Location` attribute to "Server".</span></span> |
| <span data-ttu-id="ad5e9-251">**页分析**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-251">**Page parsing**</span></span> | <span data-ttu-id="ad5e9-252">ASP.NET 4 中针对 ASP.NET 网页（.aspx 文件）和用户控件（.aspx 文件）的页分析器不仅比早期版本的 ASP.NET 中的页分析器更为严格，而且会将更多的标记设为无效。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-252">The page parser for ASP.NET Web pages (.aspx files) and user controls (.ascx files) is stricter in ASP.NET 4 than in earlier versions of ASP.NET, and it flags more markup as invalid than in earlier versions.</span></span> | <span data-ttu-id="ad5e9-253">检查在页运行时产生的错误消息并纠正因无效标记导致的错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-253">Examine error messages that are produced when a page runs and fix errors that result from invalid markup.</span></span> |
| <span data-ttu-id="ad5e9-254">**Passport 类型**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-254">**Passport types**</span></span> | <span data-ttu-id="ad5e9-255">由于 Passport（现在为 Live ID SDK）中的更改，ASP.NET 2.0 中内置的 Passport 支持已过时且不受支持。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-255">The Passport support built into ASP.NET 2.0 is obsolete and is unsupported due to changes in Passport (now Live ID SDK).</span></span> <span data-ttu-id="ad5e9-256">因此，现在用 `ObsoleteAttribute` 特性标记 <xref:System.Web.Security> 中与 Passport 相关的类型。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-256">As a result, the types related to Passport in <xref:System.Web.Security> are now marked with the `ObsoleteAttribute` attribute.</span></span> | <span data-ttu-id="ad5e9-257">更改使用 <xref:System.Web.Security> 命名空间中的 Passport 类型（例如，<xref:System.Web.Security.PassportIdentity>）的所有代码，以使用 [SDK](http://go.microsoft.com/fwlink/?LinkId=106346)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-257">Change any code you have that uses Passport types in the <xref:System.Web.Security> namespace (for example, <xref:System.Web.Security.PassportIdentity>) to use the [SDK](http://go.microsoft.com/fwlink/?LinkId=106346).</span></span> |
| <span data-ttu-id="ad5e9-258">**FilePath 属性中的 PathInfo 信息**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-258">**PathInfo information in the FilePath property**</span></span> | <span data-ttu-id="ad5e9-259">ASP.NET 4 不再将 `PathInfo` 值加入从属性（如 <xref:System.Web.HttpRequest.FilePath>、<xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath> 和 <xref:System.Web.HttpRequest.CurrentExecutionFilePath>）返回的值中。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-259">ASP.NET 4 no longer includes the `PathInfo` value in the return values from properties such as <xref:System.Web.HttpRequest.FilePath>, <xref:System.Web.HttpRequest.AppRelativeCurrentExecutionFilePath>, and <xref:System.Web.HttpRequest.CurrentExecutionFilePath>.</span></span> <span data-ttu-id="ad5e9-260">而是在 <xref:System.Web.HttpRequest.PathInfo> 中提供 `PathInfo` 信息。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-260">Instead, the `PathInfo` information is available in <xref:System.Web.HttpRequest.PathInfo>.</span></span> <span data-ttu-id="ad5e9-261">例如，假定以下 URL 片段：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-261">For example, imagine the following URL fragment:</span></span><br><br>`/testapp/Action.mvc/SomeAction`<br><br><span data-ttu-id="ad5e9-262">在 ASP.NET 的早期版本中，<xref:System.Web.HttpRequest> 属性具有以下值：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-262">In earlier versions of ASP.NET, <xref:System.Web.HttpRequest> properties have the following values:</span></span><br><br><span data-ttu-id="ad5e9-263">\* <xref:System.Web.HttpRequest.FilePath>：`/testapp/Action.mvc/SomeAction`</span><span class="sxs-lookup"><span data-stu-id="ad5e9-263">\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc/SomeAction`</span></span><br><span data-ttu-id="ad5e9-264">\* <xref:System.Web.HttpRequest.PathInfo>：（空）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-264">\* <xref:System.Web.HttpRequest.PathInfo>: (empty)</span></span><br><br><span data-ttu-id="ad5e9-265">而在 ASP.NET 4 中，<xref:System.Web.HttpRequest> 属性具有以下值：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-265">In ASP.NET 4, <xref:System.Web.HttpRequest> properties instead have the following values:</span></span><br><br><span data-ttu-id="ad5e9-266">\* <xref:System.Web.HttpRequest.FilePath>：`/testapp/Action.mvc`</span><span class="sxs-lookup"><span data-stu-id="ad5e9-266">\* <xref:System.Web.HttpRequest.FilePath>: `/testapp/Action.mvc`</span></span><br><span data-ttu-id="ad5e9-267">\* <xref:System.Web.HttpRequest.PathInfo>：`SomeAction`</span><span class="sxs-lookup"><span data-stu-id="ad5e9-267">\* <xref:System.Web.HttpRequest.PathInfo>: `SomeAction`</span></span> | <span data-ttu-id="ad5e9-268">检查所依赖 <xref:System.Web.HttpRequest> 类的属性所在位置的代码以返回路径信息；更改代码以反映对返回路径信息的方式的更改。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-268">Examine your code for places where you rely on properties of the <xref:System.Web.HttpRequest> class to return path information; change the code to reflect the changes in how path information is returned.</span></span> |
| <span data-ttu-id="ad5e9-269">**请求验证**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-269">**Request validation**</span></span> | <span data-ttu-id="ad5e9-270">为了改进请求验证，将在请求生命周期中提早调用 ASP.NET 请求验证。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-270">To improve request validation, the ASP.NET request validation is invoked earlier in the request life cycle.</span></span> <span data-ttu-id="ad5e9-271">因此，将为不是针对 .aspx 文件的请求（如针对 Web 服务调用和自定义处理程序的请求）运行请求验证。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-271">As a result, request validation runs for requests that are not for .aspx files, such as for Web service calls and for custom handlers.</span></span> <span data-ttu-id="ad5e9-272">此外，在请求处理管道中运行自定义 HTTP 模块时，请求验证也处于活动状态。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-272">Request validation will also be active when custom HTTP modules are running in the request processing pipeline.</span></span><br><br><span data-ttu-id="ad5e9-273">进行此更改后，针对 .aspx 文件之外的资源的请求可能会引发请求验证错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-273">As a result of this change, requests for resources other than .aspx files might throw request validation errors.</span></span> <span data-ttu-id="ad5e9-274">在请求管道（例如，自定义 HTTP 模块）中运行的自定义代码也可能会引发请求验证错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-274">Custom code that runs in the request pipeline (for example, custom HTTP modules) might also throw request validation errors.</span></span> | <span data-ttu-id="ad5e9-275">如有必要，可通过使用 Web 配置文件中的以下设置，还原为仅让 .aspx 页触发请求验证这一旧行为：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-275">If necessary, you can revert to the old behavior of having only .aspx pages triggering request validation by using the following setting in the Web configuration file:</span></span><br><br>`<httpRuntime requestValidationMode="2.0" />`<br><br><span data-ttu-id="ad5e9-276">警告：如果还原为旧行为，请确保现有处理程序中的所有代码、模块和其他自定义代码对潜在的不安全 HTTP 输入（可能是 XSS 攻击途径）进行检查。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-276">Warning: If you revert to the old behavior, make sure that all code in existing handlers, modules, and other custom code performs checks for potentially unsafe HTTP inputs that could be XSS attack vectors.\`</span></span> |
| <span data-ttu-id="ad5e9-277">**路由**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-277">**Routing**</span></span> | <span data-ttu-id="ad5e9-278">如果在 Visual Studio 2010 中创建一个文件系统网站，并且该网站位于其名称包含点 (.) 的文件夹中，则 URL 路由不会可靠地工作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-278">If you create a file system Web site in Visual Studio 2010 and the Web site is in a folder that contains a dot (.) in the folder name, URL routing will not work reliably.</span></span> <span data-ttu-id="ad5e9-279">从某些虚拟路径返回 HTTP 404 错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-279">An HTTP 404 error is returned from some virtual paths.</span></span> <span data-ttu-id="ad5e9-280">发生此情况的原因是，Visual Studio 2010 使用错误的根虚拟目录路径启动了 Visual Studio 开发服务器 (Cassini)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-280">This occurs because Visual Studio 2010 launches the Visual Studio Development Server (Cassini) using an incorrect path for the root virtual directory.</span></span> | <span data-ttu-id="ad5e9-281">\* 在基于文件的网站的“属性”页中，将“虚拟路径”特性更改为“/”。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-281">\* In the **Properties** page for the file-based Web site, change the **Virtual Path** attribute to "/".</span></span><br><br><span data-ttu-id="ad5e9-282">或</span><span class="sxs-lookup"><span data-stu-id="ad5e9-282">-or-</span></span><br><br><span data-ttu-id="ad5e9-283">\* 创建 Web 应用程序项目而非网站项目。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-283">\* Create a Web application project instead of a Web site project.</span></span> <span data-ttu-id="ad5e9-284">Web 应用程序项目不会出现此问题，并且 URL 路由会正常工作，即使项目文件夹的名称中包含点也是如此。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-284">Web application projects do not have this issue, and URL routing works even if the project folder has a dot in its name.</span></span><br><br><span data-ttu-id="ad5e9-285">或</span><span class="sxs-lookup"><span data-stu-id="ad5e9-285">-or-</span></span><br><br><span data-ttu-id="ad5e9-286">\* 创建在 IIS 中托管的基于 HTTP 的网站。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-286">\* Create an HTTP-based Web site that is hosted in IIS.</span></span> <span data-ttu-id="ad5e9-287">IIS 托管的网站可在虚拟路径和项目文件文件夹中包含点。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-287">IIS-hosted Web sites can have dots in the virtual path as well as in the project file folder.</span></span> |
| <span data-ttu-id="ad5e9-288">**SharePoint 站点**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-288">**SharePoint sites**</span></span> | <span data-ttu-id="ad5e9-289">如果尝试运行部署为 SharePoint 网站（包含名为 `WSS_Minimal` 的自定义部分信任级别）的子级的 ASP.NET 4 网站，将出现以下错误：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-289">If you try to run an ASP.NET 4 Web site that is deployed as a child of a SharePoint Web site that contains a custom partial-trust level named `WSS_Minimal`, you will see the following error:</span></span><br><br>`Could not find permission set named 'ASP.Net'.` | <span data-ttu-id="ad5e9-290">目前，所有版本的 SharePoint 都与 ASP.NET 不兼容。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-290">Currently, no versions of SharePoint are compatible with ASP.NET.</span></span> <span data-ttu-id="ad5e9-291">因此，不应尝试将 ASP.NET 4 网站作为 SharePoint 网站的子级运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-291">As a result, you should not attempt to run an ASP.NET 4 Web site as a child of a SharePoint Web site.</span></span> |
| <span data-ttu-id="ad5e9-292">**XHTML 1.1 标准**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-292">**XHTML 1.1 standards**</span></span> | <span data-ttu-id="ad5e9-293">为了实现新网站的 XHTML 1.1 符合性，.NET Framework 4 中的 ASP.NET 控件将生成符合 XHTML 1.1 的 HTML。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-293">To enable XHTML 1.1 compliance for new Web sites, the ASP.NET controls in the .NET Framework 4 will generate XHTML 1.1 compliant HTML.</span></span> <span data-ttu-id="ad5e9-294">使用 `<system.Web>` 元素内 Web.config 文件中的以下选项可启用此呈现：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-294">This rendering is enabled using the following option in the Web.config file inside the `<system.Web>` element:</span></span><br><br>`<pages controlRenderingCompatibilityVersion="4.0"/>`<br><br><span data-ttu-id="ad5e9-295">默认情况下，此选项设置为 4.0。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-295">This option is set by default to 4.0.</span></span> <span data-ttu-id="ad5e9-296">从 Visual Studio 2008 升级到 Visual Studio 的 Web 项目将启用 3.5 设置以实现兼容性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-296">Web projects that are upgraded to Visual Studio from Visual Studio 2008 will have the 3.5 setting enabled for compatibility.</span></span> | <span data-ttu-id="ad5e9-297">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-297">None.</span></span> |

## <a name="core"></a><span data-ttu-id="ad5e9-298">核心</span><span class="sxs-lookup"><span data-stu-id="ad5e9-298">Core</span></span>

### <a name="general-features"></a><span data-ttu-id="ad5e9-299">常规功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-299">General features</span></span>

| <span data-ttu-id="ad5e9-300">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-300">Feature</span></span> | <span data-ttu-id="ad5e9-301">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-301">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-302">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-302">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-303">**CardSpace**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-303">**CardSpace**</span></span> | <span data-ttu-id="ad5e9-304">Windows CardSpace 不再包含在 .NET Framework 中，而是单独提供。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-304">Windows CardSpace is no longer included in the .NET Framework; it is provided separately.</span></span> | <span data-ttu-id="ad5e9-305">从 [Microsoft 下载中心](http://go.microsoft.com/fwlink/?LinkId=199868)下载 Windows CardSpace。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-305">Download Windows CardSpace from the [Microsoft Download Center](http://go.microsoft.com/fwlink/?LinkId=199868).</span></span> |
| <span data-ttu-id="ad5e9-306">**配置文件**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-306">**Configuration files**</span></span> | <span data-ttu-id="ad5e9-307">已对 .NET Framework 访问应用程序配置文件的方式进行了纠正。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-307">Corrections have been made in how the .NET Framework accesses application configuration files.</span></span> | <span data-ttu-id="ad5e9-308">如果应用程序配置文件名为 application-name.config，则将它重命名为 application-name.exe.config。例如，将 MyApp.config 重命名为 MyApp.exe.config。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-308">If your application configuration file is named *application-name.config*, rename it to *application-name.exe.config*. For example, rename *MyApp.config* to *MyApp.exe.config*.</span></span> |
| <span data-ttu-id="ad5e9-309">**C# 代码编译器**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-309">**C# code compiler**</span></span> | <span data-ttu-id="ad5e9-310"><xref:Microsoft.CSharp> 命名空间中的 `Compiler`、`CompilerError` 和 `ErrorLevel` 类不再可用，并且其程序集 (cscompmgd.dll) 不再包含在 .NET Framework 中。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-310">The `Compiler`, `CompilerError`, and `ErrorLevel` classes that were in the <xref:Microsoft.CSharp> namespace are no longer available, and their assembly (cscompmgd.dll) is no longer included in the .NET Framework.</span></span> | <span data-ttu-id="ad5e9-311">使用 <xref:System.CodeDom.Compiler.CodeDomProvider> 类和 <xref:System.CodeDom.Compiler> 命名空间中的其他类。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-311">Use the <xref:System.CodeDom.Compiler.CodeDomProvider> class and other classes in the <xref:System.CodeDom.Compiler> namespace.</span></span> <span data-ttu-id="ad5e9-312">有关详细信息，请参阅[使用 CodeDOM](https://msdn.microsoft.com/library/y2k85ax6(v=vs.100).aspx)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-312">For more information, see [Using the CodeDOM](https://msdn.microsoft.com/library/y2k85ax6(v=vs.100).aspx).</span></span> |
| <span data-ttu-id="ad5e9-313">**承载**（非托管 API）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-313">**Hosting** (unmanaged API)</span></span> | <span data-ttu-id="ad5e9-314">为了改进承载功能，一些承载激活 API 已被弃用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-314">To improve hosting capabilities, some of the hosting activation APIs have been deprecated.</span></span> <span data-ttu-id="ad5e9-315">利用进程内并行执行功能，应用程序能够在同一个进程中加载和启动多个版本的 .NET Framework。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-315">In-process side-by-side execution features enable an application to load and start multiple versions of the .NET Framework in the same process.</span></span> <span data-ttu-id="ad5e9-316">例如，可运行在同一进程中加载基于 .NET Framework 2.0 SP1 的外接程序（或组件）和基于 .NET Framework 4 的外接程序的应用程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-316">For example, you can run applications that load add-ins (or components) that are based on the .NET Framework 2.0 SP1 and add-ins that are based on the .NET Framework 4 in the same process.</span></span> <span data-ttu-id="ad5e9-317">较旧组件可继续使用 .NET Framework 的较旧版本，新组件则使用 .NET Framework 的新版本。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-317">Older components continue to use the older .NET Framework version, and new components use the new .NET Framework version.</span></span> | <span data-ttu-id="ad5e9-318">使用[进程内并行执行](/dotnet/framework/deployment/in-process-side-by-side-execution)中描述的配置。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-318">Use the configurations described in [In-Process Side-by-Side Execution](/dotnet/framework/deployment/in-process-side-by-side-execution).</span></span> |
| <span data-ttu-id="ad5e9-319">**新安全模型**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-319">**New security model**</span></span> | <span data-ttu-id="ad5e9-320">代码访问安全性 (CAS) 策略已关闭并替换为简化模型，如 [.NET Framework 4 中的安全性更改](https://msdn.microsoft.com/library/dd233103(v=vs.100).aspx)中所述。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-320">The code access security (CAS) policy has been turned off and replaced with a simplified model, as described in [Security Changes in the .NET Framework 4](https://msdn.microsoft.com/library/dd233103(v=vs.100).aspx).</span></span> | <span data-ttu-id="ad5e9-321">如果依赖于应用程序中的 CAS，则可能需要做出一些修改。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-321">Modifications may be required if you depend on CAS in your applications.</span></span> <span data-ttu-id="ad5e9-322">有关详细信息，请参阅[代码访问安全策略兼容性和迁移](/dotnet/framework/misc/code-access-security-policy-compatibility-and-migration)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-322">For more information, see [Code Access Security Policy Compatibility and Migration](/dotnet/framework/misc/code-access-security-policy-compatibility-and-migration).</span></span> |

### <a name="date-and-time"></a><span data-ttu-id="ad5e9-323">日期和时间</span><span class="sxs-lookup"><span data-stu-id="ad5e9-323">Date and time</span></span>

<span data-ttu-id="ad5e9-324">命名空间：<xref:System>；程序集：mscorlib（在 mscorlib.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-324">Namespace: <xref:System>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="ad5e9-325">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-325">Feature</span></span> | <span data-ttu-id="ad5e9-326">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-326">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-327">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-327">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-328">**夏时制**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-328">**Daylight savings**</span></span> | <span data-ttu-id="ad5e9-329">为了与系统时钟保持一致，时间属性（如 <xref:System.TimeZoneInfo.Local> 和 <xref:System.DateTime.Now>）现在使用操作系统规则而非其他 .NET Framework 数据进行夏时制操作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-329">To be consistent with the system clock, time properties (such as <xref:System.TimeZoneInfo.Local> and <xref:System.DateTime.Now>) now use operating system rules instead of other .NET Framework data for daylight saving time operations.</span></span> | <span data-ttu-id="ad5e9-330">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-330">None.</span></span> |
| <span data-ttu-id="ad5e9-331">**字符串格式设置**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-331">**Formatting strings**</span></span> | <span data-ttu-id="ad5e9-332">为了支持区分区域性的格式设置，<xref:System.TimeSpan> 结构包含了 `ToString`、`Parse` 和 `TryParse` 方法的新重载，以及新的 `ParseExact` 和 `TryParseExact` 方法。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-332">To support culture-sensitive formatting, the <xref:System.TimeSpan> structure includes new overloads of the `ToString`, `Parse`, and `TryParse` methods in addition to new `ParseExact` and `TryParseExact` methods.</span></span> | <span data-ttu-id="ad5e9-333">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-333">None.</span></span> |


### <a name="globalization"></a><span data-ttu-id="ad5e9-334">全球化</span><span class="sxs-lookup"><span data-stu-id="ad5e9-334">Globalization</span></span>

<span data-ttu-id="ad5e9-335">有关新的非特定区域性和特定区域性的列表，请参阅[全球化和本地化中的新增功能](https://msdn.microsoft.com/library/dd997383(v=vs.100).aspx)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-335">For a list of new neutral and specific cultures, see [What's New in Globalization and Localization](https://msdn.microsoft.com/library/dd997383(v=vs.100).aspx).</span></span>

<span data-ttu-id="ad5e9-336">命名空间：<xref:System.Globalization>；程序集：mscorlib（在 mscorlib.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-336">Namespace: <xref:System.Globalization>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="ad5e9-337">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-337">Feature</span></span> | <span data-ttu-id="ad5e9-338">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-338">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-339">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-339">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-340">**区域性名称**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-340">**Culture names**</span></span> | <span data-ttu-id="ad5e9-341">以下名称更改影响德语、第维埃语和非洲语区域性：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-341">The following name changes affect the German, Divehi, and African cultures:</span></span><br><br><span data-ttu-id="ad5e9-342">\* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>：德语（瑞士）(de-CH) 区域性的货币名称已从“sFr.”更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-342">\* <xref:System.Globalization.CultureAndRegionInfoBuilder.CurrencyEnglishName>: The currency name for the German (Switizerland) (de-CH) culture has changed from "sFr."</span></span> <span data-ttu-id="ad5e9-343">为“Fr.”。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-343">to "Fr.".</span></span><br><span data-ttu-id="ad5e9-344">\* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>：第维埃语（马尔代夫）(dv-MV) 区域性的长日期模式已从“dd/MMMM/yyyy”更改为“dd/MM/yyyy”。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-344">\* <xref:System.Globalization.DateTimeFormatInfo.LongDatePattern>: The long date pattern for the Divehi (Maldives) (dv-MV) culture has changed from "dd/MMMM/yyyy" to "dd/MM/yyyy".</span></span><br><span data-ttu-id="ad5e9-345">\* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-345">\* <xref:System.Globalization.DateTimeFormatInfo.PMDesignator>: The P.M.</span></span> <span data-ttu-id="ad5e9-346">南非荷兰语（南非）(af-ZA) 区域性的 P.M. 指示符已从“nm”更改为“PM”。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-346">designator of the Afrikaans (South Africa) (af-ZA) culture has changed from "nm" to "PM".</span></span> | <span data-ttu-id="ad5e9-347">注意区域性名称更改。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-347">Note culture name changes.</span></span> |
| <span data-ttu-id="ad5e9-348">**LCID 参数**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-348">**LCID parameter**</span></span> | <span data-ttu-id="ad5e9-349">为了与自动化服务器设置中的预期行为保持一致，CLR 不再将 `LCID` 参数的当前区域性传递给基于 COM 的非托管应用程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-349">To be consistent with expected behavior in automation server settings, the CLR no longer passes the current culture for the `LCID` parameter to unmanaged COM-based applications.</span></span> <span data-ttu-id="ad5e9-350">而是为区域性传递 1033 (en-us)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-350">Instead, it passes 1033 (en-us) for the culture.</span></span> | <span data-ttu-id="ad5e9-351">无需进行任何修改，只不过本机应用程序需要指定的区域性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-351">No modifications necessary except for native applications that require a specified culture.</span></span> |
| <span data-ttu-id="ad5e9-352">**已过时的区域性类型**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-352">**Obsolete culture types**</span></span> | <span data-ttu-id="ad5e9-353"><xref:System.Globalization.CultureTypes> 和 <xref:System.Globalization.CultureTypes> 区域性类型现已过时。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-353">The <xref:System.Globalization.CultureTypes> and <xref:System.Globalization.CultureTypes> culture types are now obsolete.</span></span><br><br><span data-ttu-id="ad5e9-354">为了实现向后兼容，<xref:System.Globalization.CultureTypes> 现返回 .NET Framework 早期版本中附带的非特定区域性和特定区域性，而 <xref:System.Globalization.CultureTypes> 现返回一个空列表。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-354">For backward compatibility, <xref:System.Globalization.CultureTypes> now returns neutral and specific cultures that were included with the previous .NET Framework, and <xref:System.Globalization.CultureTypes> now returns an empty list.</span></span> | <span data-ttu-id="ad5e9-355">使用 <xref:System.Globalization.CultureTypes> 枚举的其他值。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-355">Use other values of the <xref:System.Globalization.CultureTypes> enumeration.</span></span> |
| <span data-ttu-id="ad5e9-356">**检索区域性**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-356">**Retrieving culture**</span></span> | <span data-ttu-id="ad5e9-357">自 Windows 7 开始，.NET Framework 4 从操作系统检索区域性信息，而不是存储数据本身。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-357">Beginning with Windows 7, the .NET Framework 4 retrieves culture information from the operating system instead of storing the data itself.</span></span> <span data-ttu-id="ad5e9-358">此外，.NET Framework 与 Windows 同步，以便对数据进行排序并设置其大小写。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-358">In addition, the .NET Framework synchronizes with Windows for sorting and casing data.</span></span> | <span data-ttu-id="ad5e9-359">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-359">None.</span></span> |
| <span data-ttu-id="ad5e9-360">**Unicode 5.1 标准**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-360">**Unicode 5.1 standards**</span></span> | <span data-ttu-id="ad5e9-361">.NET Framework 目前支持所有 Unicode 5.1 字符，外加大约 1400 个字符。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-361">The .NET Framework now supports all Unicode 5.1 characters -- an addition of approximately 1400 characters.</span></span> <span data-ttu-id="ad5e9-362">这些额外的字符包括新符号、箭头、音调符号、标点、数学符号、CJK 笔划和象形文字、其他马拉雅拉姆语和泰卢固语数字字符以及各种缅甸语、拉丁语、阿拉伯语、希腊语、蒙古语和西里尔语字符。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-362">The additional characters include new symbols, arrows, diacritics, punctuation, mathematical symbols, CJK strokes and ideographs, additional Malayalam and Telugu numeric characters, and various Myanmar, Latin, Arabic, Greek, Mongolian, and Cyrillic characters.</span></span> <span data-ttu-id="ad5e9-363">Unicode 5.1 支持以下新文种：巽他语、列普查语、欧甘语、瓦依语、索拉什拉特语、克耶黎语、勒姜语、果鲁穆奇语、奥里雅语、泰米尔语、泰卢固语、马拉雅拉姆语字符和占语。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-363">The following new scripts are supported with Unicode 5.1: Sundanese, Lepcha, Ol Chiki, Vai, Saurashtra, Kayah Li, Rejang, Gurmukhi, Odia, Tamil, Telugu, and Malayalam characters and Cham.</span></span> | <span data-ttu-id="ad5e9-364">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-364">None.</span></span> |

### <a name="exceptions"></a><span data-ttu-id="ad5e9-365">异常</span><span class="sxs-lookup"><span data-stu-id="ad5e9-365">Exceptions</span></span>

<span data-ttu-id="ad5e9-366">命名空间：<xref:System>、<xref:System.Runtime.ExceptionServices>；程序集：mscorlib（在 mscorlib.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-366">Namespaces: <xref:System>, <xref:System.Runtime.ExceptionServices>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="ad5e9-367">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-367">Feature</span></span> | <span data-ttu-id="ad5e9-368">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-368">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-369">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-369">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-370">**损坏进程状态的异常**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-370">**Exceptions for corrupted process state**</span></span> | <span data-ttu-id="ad5e9-371">CLR 不再将损坏进程状态的异常传递给托管代码中的异常处理程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-371">The CLR no longer delivers exceptions for corrupted process state to exception handlers in managed code.</span></span> | <span data-ttu-id="ad5e9-372">这些异常指示进程状态已损坏。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-372">These exceptions indicate that the state of a process has been corrupted.</span></span> <span data-ttu-id="ad5e9-373">建议不要在此状态下运行应用程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-373">We do not recommend that you run your application in this state.</span></span><br><br><span data-ttu-id="ad5e9-374">有关详细信息，请参阅 <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> 和“CLR 完全介绍”博客中的条目[处理损坏状态异常](http://go.microsoft.com/fwlink/?LinkID=179681)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-374">For more information, see the <xref:System.Runtime.ExceptionServices.HandleProcessCorruptedStateExceptionsAttribute> and the entry [Handling Corrupted State Exceptions](http://go.microsoft.com/fwlink/?LinkID=179681) in the CLR Inside Out blog.</span></span> |
| <span data-ttu-id="ad5e9-375">**执行引擎异常**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-375">**Execution engine exceptions**</span></span> | <span data-ttu-id="ad5e9-376"><xref:System.ExecutionEngineException> 现已过时，因为可捕获的异常将允许不稳定的进程继续运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-376"><xref:System.ExecutionEngineException> is now obsolete, because a catchable exception will allow an unstable process to continue to run.</span></span> <span data-ttu-id="ad5e9-377">此更改提高了运行时中的可预见性和可靠性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-377">This change improves predictability and reliability in the runtime.</span></span> | <span data-ttu-id="ad5e9-378">使用 <xref:System.InvalidOperationException> 来表示此情况。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-378">Use an <xref:System.InvalidOperationException> to signal the condition.</span></span> |

### <a name="reflection"></a><span data-ttu-id="ad5e9-379">映像</span><span class="sxs-lookup"><span data-stu-id="ad5e9-379">Reflection</span></span>

<span data-ttu-id="ad5e9-380">命名空间：<xref:System.Reflection>；程序集：mscorlib（在 mscorlib.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-380">Namespace: <xref:System.Reflection>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="ad5e9-381">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-381">Feature</span></span> | <span data-ttu-id="ad5e9-382">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-382">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-383">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-383">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-384">**程序集哈希算法**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-384">**Assembly hash algorithms**</span></span> | <span data-ttu-id="ad5e9-385"><xref:System.Reflection.AssemblyName.HashAlgorithm> 属性现返回 <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>，因为在加载程序集时运行时不知道所引用的程序集的哈希算法。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-385">The <xref:System.Reflection.AssemblyName.HashAlgorithm> property now returns <xref:System.Configuration.Assemblies.AssemblyHashAlgorithm>, because the runtime does not know the hash algorithm of the referenced assembly when the assembly is not loaded.</span></span> <span data-ttu-id="ad5e9-386">（这表示使用所引用的程序集（如由 <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A> 方法返回的程序集）的属性。）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-386">(This refers to using the property on a referenced assembly such as that returned by the <xref:System.Reflection.Assembly.GetReferencedAssemblies%2A> method.)</span></span> | <span data-ttu-id="ad5e9-387">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-387">None.</span></span> |
| <span data-ttu-id="ad5e9-388">**程序集加载**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-388">**Assembly loading**</span></span> | <span data-ttu-id="ad5e9-389">为了阻止过多加载程序集并节省虚拟地址空间，CLR 现仅通过使用 Win32 `MapViewOfFile` 函数来加载程序集。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-389">To prevent redundant loading of assemblies and to save virtual address space, the CLR now loads assemblies by using only the Win32 `MapViewOfFile` function.</span></span> <span data-ttu-id="ad5e9-390">此外，它不再调用 `LoadLibrary` 函数。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-390">It no longer also calls the `LoadLibrary` function.</span></span><br><br><span data-ttu-id="ad5e9-391">此更改以以下方式影响诊断应用程序：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-391">This change affects diagnostic applications in the following ways:</span></span><br><br><span data-ttu-id="ad5e9-392">\* <xref:System.Diagnostics.ProcessModuleCollection> 将不再包含通过调用 `Process.GetCurrentProcess().Modules` 获取的类库（.dll 文件）中的任何模块。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-392">\* A <xref:System.Diagnostics.ProcessModuleCollection> will no longer contain any modules from a class library (.dll file), as obtained from a call to `Process.GetCurrentProcess().Modules`.</span></span><br><span data-ttu-id="ad5e9-393">\* 使用 `EnumProcessModules` 函数的 Win32 应用程序将看不到列出的所有托管模块。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-393">\* Win32 applications that use the `EnumProcessModules` function will not see all managed modules listed.</span></span> | <span data-ttu-id="ad5e9-394">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-394">None.</span></span> |
| <span data-ttu-id="ad5e9-395">**声明类型**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-395">**Declaring type**</span></span> | <span data-ttu-id="ad5e9-396">当类型没有声明类型时，<xref:System.Type.DeclaringType> 属性现将正确返回 null。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-396">The <xref:System.Type.DeclaringType> property now correctly returns null when the type does not have a declaring type.</span></span> | <span data-ttu-id="ad5e9-397">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-397">None.</span></span> |
| <span data-ttu-id="ad5e9-398">**委托**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-398">**Delegates**</span></span> | <span data-ttu-id="ad5e9-399">在将 null 值传递给委托的构造函数时，委托现将引发 <xref:System.ArgumentNullException> 而不是 <xref:System.NullReferenceException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-399">A delegate now throws an <xref:System.ArgumentNullException> instead of a <xref:System.NullReferenceException> when a null value is passed to the delegate's constructor.</span></span> | <span data-ttu-id="ad5e9-400">确保任何异常处理捕获 <xref:System.ArgumentNullException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-400">Ensure that any exception handling catches <xref:System.ArgumentNullException>.</span></span> |
| <span data-ttu-id="ad5e9-401">**全局程序集缓存位置更改**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-401">**Global assembly cache location change**</span></span> | <span data-ttu-id="ad5e9-402">对于 .NET Framework 4 程序集，已将全局程序集缓存从 Windows 目录 (%WINDIR%) 移动到 Microsoft.Net 子目录 (%WINDIR%\\Microsoft.Net)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-402">For .NET Framework 4 assemblies, the global assembly cache has been moved from the Windows directory (%WINDIR%) to the Microsoft.Net subdirectory (*%WINDIR%\\Microsoft.Net*).</span></span> <span data-ttu-id="ad5e9-403">早期版本中的程序集保留在较早的目录中。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-403">Assemblies from earlier versions remain in the older directory.</span></span><br><br><span data-ttu-id="ad5e9-404">非托管 [ASM_CACHE_FLAGS](https://msdn.microsoft.com/library/ms231621(v=vs.100).aspx) 枚举包含新的 `ASM_CACHE_ROOT_EX` 标志。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-404">The unmanaged [ASM_CACHE_FLAGS](https://msdn.microsoft.com/library/ms231621(v=vs.100).aspx) enumeration contains the new `ASM_CACHE_ROOT_EX` flag.</span></span> <span data-ttu-id="ad5e9-405">此标志可获得 .NET Framework 4 程序集的缓存位置，可通过 [GetCachePath](/dotnet/framework/unmanaged-api/fusion/getcachepath-function) 函数获取此位置。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-405">This flag gets the cache location for .NET Framework 4 assemblies, which can be obtained by the [GetCachePath](/dotnet/framework/unmanaged-api/fusion/getcachepath-function) function.</span></span> | <span data-ttu-id="ad5e9-406">无，假定应用程序不使用程序集的显式路径（不建议这样做）。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-406">None, assuming that applications do not use explicit paths to assemblies, which is not a recommended practice.</span></span> |
| <span data-ttu-id="ad5e9-407">**全局程序集缓存工具**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-407">**Global assembly cache tool**</span></span> | <span data-ttu-id="ad5e9-408">[Gacutil.exe（全局程序集缓存工具）](https://msdn.microsoft.com/library/ex0ss12c(v=vs.100).aspx)不再支持 shell 插件查看器。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-408">The [Gacutil.exe (Global Assembly Cache Tool)](https://msdn.microsoft.com/library/ex0ss12c(v=vs.100).aspx) no longer supports the shell plugin viewer.</span></span> | <span data-ttu-id="ad5e9-409">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-409">None.</span></span> |

### <a name="interoperability"></a><span data-ttu-id="ad5e9-410">互操作性</span><span class="sxs-lookup"><span data-stu-id="ad5e9-410">Interoperability</span></span>

<span data-ttu-id="ad5e9-411">命名空间：<xref:System.Runtime.InteropServices>；程序集：mscorlib（在 mscorlib.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-411">Namespace: <xref:System.Runtime.InteropServices>; assembly: mscorlib (in mscorlib.dll)</span></span>

| <span data-ttu-id="ad5e9-412">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-412">Feature</span></span> | <span data-ttu-id="ad5e9-413">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-413">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-414">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-414">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-415">**缓冲区长度**（非托管 API）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-415">**Buffer length** (unmanaged API)</span></span> | <span data-ttu-id="ad5e9-416">为了节省内存，已更改 [ICorProfilerInfo2::GetStringLayout](/dotnet/framework/unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method) 方法的 `pBufferLengthOffset` 参数的功能，以匹配 `pStringLengthOffset` 参数。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-416">To save memory, the functionality for the `pBufferLengthOffset` parameter for the [ICorProfilerInfo2::GetStringLayout](/dotnet/framework/unmanaged-api/profiling/icorprofilerinfo2-getstringlayout-method) method has been changed to match the `pStringLengthOffset` parameter.</span></span> <span data-ttu-id="ad5e9-417">这两个参数目前都指向字符串长度的偏移量位置。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-417">Both parameters now point to the offset location of the string's length.</span></span> <span data-ttu-id="ad5e9-418">已从字符串类的表示形式中删除缓冲区长度。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-418">Buffer length has been removed from the representation of the string class.</span></span> | <span data-ttu-id="ad5e9-419">删除缓冲区长度的任何依赖项。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-419">Remove any dependency on the buffer length.</span></span> |
| <span data-ttu-id="ad5e9-420">**JIT 调试**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-420">**JIT debugging**</span></span> | <span data-ttu-id="ad5e9-421">为了简化实时 (JIT) 调试的注册过程，.NET Framework 调试器现仅使用 AeDebug 注册表项，此注册表项可控制本机代码的 JIT 调试行为。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-421">To simplify registration for just-in-time (JIT) debugging, the .NET Framework debugger now uses only the AeDebug registry key, which controls the JIT debugging behavior for native code.</span></span> <span data-ttu-id="ad5e9-422">此更改产生以下结果：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-422">This change results in the following:</span></span><br><br><span data-ttu-id="ad5e9-423">\* 不再能够为托管代码和本机代码注册两个不同的调试器。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-423">\* You can no longer register two different debuggers for managed and native code.</span></span><br><span data-ttu-id="ad5e9-424">\* 不再能够为非交互式进程自动启动调试器，但可就交互式进程提示用户。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-424">\* You can no longer start the debugger automatically for a non-interactive process, but you can prompt the user for an interactive process.</span></span><br><span data-ttu-id="ad5e9-425">\* 当调试器无法启动或当没有应启动的任何注册的调试器时，不再收到通知。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-425">\* You are no longer notified when the debugger fails to start, or when there is no registered debugger that should be started.</span></span><br><span data-ttu-id="ad5e9-426">\* 不再支持依赖于应用程序交互性的自动启动策略。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-426">\* Auto-launch policies that depend on the interactivity of the application are no longer supported.</span></span> | <span data-ttu-id="ad5e9-427">根据需要调整调试操作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-427">Adjust debugging operations as required.</span></span> |
| <span data-ttu-id="ad5e9-428">**平台调用**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-428">**Platform invoke**</span></span> | <span data-ttu-id="ad5e9-429">为了改进与非托管代码的互操作性的性能，平台调用中不正确的调用约定会导致应用程序失败。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-429">To improve performance in interoperability with unmanaged code, incorrect calling conventions in a platform invoke now cause the application to fail.</span></span> <span data-ttu-id="ad5e9-430">在早期版本中，封送层在堆栈中向上解析这些错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-430">In previous versions, the marshaling layer resolved these errors up the stack.</span></span> | <span data-ttu-id="ad5e9-431">在 Microsoft Visual Studio 2010 中调试应用程序时，将向用户通知这些错误，以便能够纠正它们。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-431">Debugging your applications in Microsoft Visual Studio 2010 will alert you to these errors so you can correct them.</span></span><br><br><span data-ttu-id="ad5e9-432">如果二进制文件无法更新，可将 [\<NetFx40_PInvokeStackResilience>](/dotnet/framework/configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element) 元素包含在应用程序的配置文件中，以便能够在早期版本中的堆栈上解析这些调用错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-432">If you have binaries that cannot be updated, you can include the [\<NetFx40_PInvokeStackResilience>](/dotnet/framework/configure-apps/file-schema/runtime/netfx40-pinvokestackresilience-element) element in your application's configuration file to enable calling errors to be resolved up the stack as in earlier versions.</span></span> <span data-ttu-id="ad5e9-433">但这可能会影响应用程序的性能。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-433">However, this may affect the performance of your application.</span></span> |
| <span data-ttu-id="ad5e9-434">**移除的接口**（非托管 API）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-434">**Removed interfaces** (unmanaged API)</span></span> | <span data-ttu-id="ad5e9-435">为了避免开发人员产生困惑，已移除以下接口，因为这些接口不提供任何有用的运行时方案，并且 CLR 不提供或接受任何实现：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-435">To avoid developer confusion, the following interfaces were removed, because they did not provide any useful run-time scenarios, and the CLR did not provide or accept any implementations:</span></span><br><br><span data-ttu-id="ad5e9-436">\* INativeImageINativeImageDependency</span><span class="sxs-lookup"><span data-stu-id="ad5e9-436">\* **INativeImageINativeImageDependency**</span></span><br><span data-ttu-id="ad5e9-437">\* INativeImageInstallInfo</span><span class="sxs-lookup"><span data-stu-id="ad5e9-437">\* **INativeImageInstallInfo**</span></span><br><span data-ttu-id="ad5e9-438">\* INativeImageEvaluate</span><span class="sxs-lookup"><span data-stu-id="ad5e9-438">\* **INativeImageEvaluate**</span></span><br><span data-ttu-id="ad5e9-439">\* INativeImageConverter</span><span class="sxs-lookup"><span data-stu-id="ad5e9-439">\* **INativeImageConverter**</span></span><br><span data-ttu-id="ad5e9-440">\* ICorModule</span><span class="sxs-lookup"><span data-stu-id="ad5e9-440">\* **ICorModule**</span></span><br><span data-ttu-id="ad5e9-441">\* IMetaDataConverter</span><span class="sxs-lookup"><span data-stu-id="ad5e9-441">\* **IMetaDataConverter**</span></span> | <span data-ttu-id="ad5e9-442">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-442">None.</span></span> |

## <a name="data"></a><span data-ttu-id="ad5e9-443">数据</span><span class="sxs-lookup"><span data-stu-id="ad5e9-443">Data</span></span>

<span data-ttu-id="ad5e9-444">本节介绍有关使用数据集和 SQL 客户端、实体框架、LINQ to SQL 和 WCF 数据服务器（以前称作 ADO.NET 数据服务）的迁移问题。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-444">This section describes migration issues for using data sets and SQL clients, the Entity Framework, LINQ to SQL, and WCF Data Servers (formerly known as ADO.NET Data Services).</span></span>

### <a name="dataset-and-sql-client"></a><span data-ttu-id="ad5e9-445">数据集和 SQL 客户端</span><span class="sxs-lookup"><span data-stu-id="ad5e9-445">DataSet and SQL Client</span></span>

<span data-ttu-id="ad5e9-446">下表介绍了对之前具有限制或其他问题的功能的改进。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-446">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="ad5e9-447">命名空间：<xref:System.Data>、<xref:System.Data.Objects.DataClasses>、<xref:System.Data.SqlClient>；程序集：System.Data（在 System.Data.dll 中）、System.Data.Entity（在 System.Data.Entity.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-447">Namespaces: <xref:System.Data>, <xref:System.Data.Objects.DataClasses>, <xref:System.Data.SqlClient>; assemblies: System.Data (in System.Data.dll), System.Data.Entity (in System.Data.Entity.dll)</span></span>

| <span data-ttu-id="ad5e9-448">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-448">Feature</span></span> | <span data-ttu-id="ad5e9-449">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-449">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="ad5e9-450">**POCO 方案**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-450">**POCO Scenarios**</span></span> | <span data-ttu-id="ad5e9-451"><xref:System.Data.Objects.DataClasses.IRelatedEnd> 接口具有的新方法提高了它在普通旧 CLR 对象 (POCO) 方案中的可用性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-451">The <xref:System.Data.Objects.DataClasses.IRelatedEnd> interface has new methods to improve its usability in Plain Old CLR Object (POCO) scenarios.</span></span> <span data-ttu-id="ad5e9-452">这些新方法采用 <xref:System.Object> 而非 <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> 实体作为参数。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-452">These new methods take an <xref:System.Object> instead of an <xref:System.Data.Objects.DataClasses.IEntityWithRelationships> entity as a parameter.</span></span> |
| <span data-ttu-id="ad5e9-453">**编辑行**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-453">**Editing Rows**</span></span> | <span data-ttu-id="ad5e9-454">由 <xref:System.Data.DataView> 类实现的 <xref:System.Collections.IList.IndexOf%2A> 方法现正确返回要编辑的行的值，而不是返回 -1。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-454">The <xref:System.Collections.IList.IndexOf%2A> method, as implemented by the <xref:System.Data.DataView> class, now correctly returns the value of a row that is being edited, instead of returning -1.</span></span> |
| <span data-ttu-id="ad5e9-455">**事件**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-455">**Events**</span></span> | <span data-ttu-id="ad5e9-456">在某个行处于已修改状态并调用了 <xref:System.Data.DataRow.RejectChanges%2A> 方法时，现引发 <xref:System.Data.DataRowView.PropertyChanged> 事件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-456">The <xref:System.Data.DataRowView.PropertyChanged> event is now raised when a row is in a modified state and the <xref:System.Data.DataRow.RejectChanges%2A> method is called.</span></span> <span data-ttu-id="ad5e9-457">此更改使创建用于公开 <xref:System.Data.DataSet> 对象的内容的 UI 控件变得更容易。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-457">This change makes it easier to create UI controls that expose the contents of a <xref:System.Data.DataSet> object.</span></span> |
| <span data-ttu-id="ad5e9-458">**异常**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-458">**Exceptions**</span></span> | <span data-ttu-id="ad5e9-459">在未设置或打开连接时，<xref:System.Data.SqlClient.SqlCommand.Prepare%2A> 方法现引发 <xref:System.InvalidOperationException> 而非 <xref:System.NullReferenceException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-459">The <xref:System.Data.SqlClient.SqlCommand.Prepare%2A> method now throws an <xref:System.InvalidOperationException> when a connection is not set or open instead of a <xref:System.NullReferenceException>.</span></span> |
| <span data-ttu-id="ad5e9-460">**映射视图**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-460">**Mapping Views**</span></span> | <span data-ttu-id="ad5e9-461">现在，在设计时捕获查询视图映射错误，而不是在运行时引发 <xref:System.NullReferenceException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-461">Query view mapping errors are now caught at design time instead of throwing a <xref:System.NullReferenceException> at run time.</span></span><br><br><span data-ttu-id="ad5e9-462">映射验证现在会捕获总体架构 (CSDL) 中的两个关联集映射到同一列这一错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-462">Mapping validation now catches the error in which two association sets in Conceptual Schema (CSDL) are mapped to the same column.</span></span> |
| <span data-ttu-id="ad5e9-463">**事务**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-463">**Transactions**</span></span> | <span data-ttu-id="ad5e9-464">如果应用程序尝试在完成事务（包括中止或回退）后对连接执行某个语句，现将引发 <xref:System.InvalidOperationException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-464">If an application tries to execute a statement on a connection after a transaction has been completed (including aborted or rolled back), an <xref:System.InvalidOperationException> is now thrown.</span></span> <span data-ttu-id="ad5e9-465">早期版本不会引发异常，并允许执行其他命令，即使事务已中止也是如此。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-465">Previous versions did not throw an exception and let you execute additional commands even if a transaction was aborted.</span></span> |

### <a name="entity-framework"></a><span data-ttu-id="ad5e9-466">Entity Framework</span><span class="sxs-lookup"><span data-stu-id="ad5e9-466">Entity Framework</span></span>

<span data-ttu-id="ad5e9-467">下表介绍了对之前具有限制或其他问题的功能的改进。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-467">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="ad5e9-468">命名空间：<xref:System.Data>、<xref:System.Data.Objects> 和 <xref:System.Data.Objects.DataClasses>；程序集：System.Data.Entity（在 System.Data.Entity.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-468">Namespaces: <xref:System.Data>, <xref:System.Data.Objects>, <xref:System.Data.Objects.DataClasses>; assembly: System.Data.Entity (in System.Data.Entity.dll)</span></span>

| <span data-ttu-id="ad5e9-469">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-469">Feature</span></span> | <span data-ttu-id="ad5e9-470">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-470">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="ad5e9-471">**实体对象**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-471">**Entity objects**</span></span> | <span data-ttu-id="ad5e9-472">在调用 <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> 方法时，<xref:System.Data.Objects.ObjectContext.Detach%2A> 方法和实体对象的状态之间现存在奇偶校验。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-472">There is now parity between the <xref:System.Data.Objects.ObjectContext.Detach%2A> method and the state of the entity object when the <xref:System.Data.Objects.ObjectContext.SaveChanges%2A> method is called.</span></span> <span data-ttu-id="ad5e9-473">这可提高一致性，防止引发意外的异常。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-473">This improved consistency prevents unexpected exceptions from being thrown.</span></span> |
| <span data-ttu-id="ad5e9-474">**实体 SQL**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-474">**Entity SQL**</span></span> | <span data-ttu-id="ad5e9-475">已针对实体 SQL 中的标识符解析改进规则。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-475">Rules have been improved for identifier resolutions in Entity SQL.</span></span><br><br><span data-ttu-id="ad5e9-476">实体 SQL 分析器已改进用于解析多部分标识符的逻辑。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-476">The Entity SQL parser has improved logic for resolving multipart identifiers.</span></span> |
| <span data-ttu-id="ad5e9-477">**结构化批注**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-477">**Structural annotations**</span></span> | <span data-ttu-id="ad5e9-478">实体框架现可识别结构化批注。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-478">The Entity Framework now recognizes structural annotations.</span></span> |
| <span data-ttu-id="ad5e9-479">**查询**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-479">**Queries**</span></span> | <span data-ttu-id="ad5e9-480">已在查询中进行以下改进：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-480">The following improvements were made in queries:</span></span><br><br><span data-ttu-id="ad5e9-481">\* 对空集合使用空键的 `GroupBy` 查询不会返回任何行，不管查询中是否有任何其他选择。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-481">\* A `GroupBy` query using a null key over an empty collection will not return any rows, regardless if there are any additional selects in the query.</span></span><br><span data-ttu-id="ad5e9-482">\* 默认情况下，LINQ 和 Entity-SQL 查询中生成的 SQL 会将字符串参数视为非 Unicode 值。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-482">\* Generated SQL in LINQ and Entity-SQL queries now treat string parameters as non-Unicode values by default.</span></span> |

### <a name="linq-to-sql"></a><span data-ttu-id="ad5e9-483">LINQ to SQL</span><span class="sxs-lookup"><span data-stu-id="ad5e9-483">LINQ to SQL</span></span>

<span data-ttu-id="ad5e9-484">下表介绍了对之前具有限制或其他问题的功能的改进。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-484">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="ad5e9-485">命名空间：<xref:System.Data.Linq>；程序集：System.Data.Linq（在 System.Data.Linq.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-485">Namespace: <xref:System.Data.Linq>; assembly: System.Data.Linq (in System.Data.Linq.dll)</span></span>

| <span data-ttu-id="ad5e9-486">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-486">Feature</span></span> | <span data-ttu-id="ad5e9-487">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-487">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="ad5e9-488">**事件**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-488">**Events**</span></span> | <span data-ttu-id="ad5e9-489">除了在加载 <xref:System.Data.Linq.EntitySet%601> 时会引发 <xref:System.Data.Linq.EntitySet%601.ListChanged> 事件外，卸载时，<xref:System.Data.Linq.EntitySet%601> 集合现在也会引发该事件以进行添加和删除操作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-489">A <xref:System.Data.Linq.EntitySet%601> collection now raises the <xref:System.Data.Linq.EntitySet%601.ListChanged> event for add and remove operations if the <xref:System.Data.Linq.EntitySet%601> is unloaded, in addition to raising the event when the collection is loaded.</span></span> |
| <span data-ttu-id="ad5e9-490">**查询**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-490">**Queries**</span></span> | <span data-ttu-id="ad5e9-491">LINQ to SQL 查询中不再忽略 `Skip(0)`。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-491">`Skip(0)` is no longer ignored in LINQ to SQL queries.</span></span> <span data-ttu-id="ad5e9-492">因此，具有此方法的查询的行为可能不同。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-492">As a result, queries that have this method might behave differently.</span></span> <span data-ttu-id="ad5e9-493">例如，在某些情况下，`OrderBy` 子句对于 `Skip(0)` 是必需的，如果未包含 `OrderBy` 子句，则查询现将引发 <xref:System.NotSupportedException> 异常。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-493">For example in some cases, an `OrderBy` clause is required with `Skip(0)`, and the query will now throw a <xref:System.NotSupportedException> exception if the `OrderBy` clause was not included.</span></span> |

### <a name="wcf-data-services"></a><span data-ttu-id="ad5e9-494">WCF 数据服务</span><span class="sxs-lookup"><span data-stu-id="ad5e9-494">WCF Data Services</span></span>

<span data-ttu-id="ad5e9-495">下表介绍了对之前具有限制或其他问题的功能的改进。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-495">The following table describes improvements to features that previously had limitations or other issues.</span></span>

<span data-ttu-id="ad5e9-496">命名空间：<xref:System.Data.Services>、<xref:System.Data.Services.Client>、<xref:System.Data.Services.Common> 和 <xref:System.Data.Services.Providers>；程序集：System.Data.Services（在 System.Data.dll 中）、System.Data.Services.Client（在 System.Data.Entity.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-496">Namespaces: <xref:System.Data.Services>, <xref:System.Data.Services.Client>, <xref:System.Data.Services.Common>, <xref:System.Data.Services.Providers>; assemblies: System.Data.Services (in System.Data.Services.dll), System.Data.Services.Client (in System.Data.Services.Client.dll)</span></span>

| <span data-ttu-id="ad5e9-497">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-497">Feature</span></span> | <span data-ttu-id="ad5e9-498">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-498">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="ad5e9-499">**批处理二进制内容**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-499">**Batched Binary Content**</span></span> | <span data-ttu-id="ad5e9-500">WCF 数据服务现支持请求和响应中的批处理二进制内容。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-500">WCF Data Services now supports batched binary content in requests and responses.</span></span> |
| <span data-ttu-id="ad5e9-501">**更改侦听器**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-501">**Change interceptors**</span></span> | <span data-ttu-id="ad5e9-502">现在会为删除请求执行更改侦听器。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-502">Change interceptors are now executed for a delete request.</span></span><br><br><span data-ttu-id="ad5e9-503">更改侦听器是一个方法，此方法在服务器收到修改实体集中某个实体的请求时运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-503">A change interceptor is a method that runs every time a request is received by the server to modify an entity in the entity set.</span></span> <span data-ttu-id="ad5e9-504">此方法在执行传入请求之前运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-504">It runs before the incoming request is executed.</span></span> <span data-ttu-id="ad5e9-505">更改侦听器提供对要更改的实体和要对该实体执行的操作的访问权限。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-505">The change interceptor provides access to the entity that is being changed and the operation that is being performed on it.</span></span> |
| <span data-ttu-id="ad5e9-506">**异常**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-506">**Exceptions**</span></span> | <span data-ttu-id="ad5e9-507">以下情况现引发更有用的异常而不是 <xref:System.NullReferenceException>：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-507">The following conditions now throw more useful exceptions instead of a <xref:System.NullReferenceException>:</span></span><br><br><span data-ttu-id="ad5e9-508">\* 如果对数据服务的调用超时，引发 <xref:System.ServiceProcess.TimeoutException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-508">\* A <xref:System.ServiceProcess.TimeoutException> when a call to a data service times out.</span></span><br><span data-ttu-id="ad5e9-509">\* 在对数据服务发出错误请求时，引发 <xref:System.Data.Services.Client.DataServiceRequestException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-509">\* A <xref:System.Data.Services.Client.DataServiceRequestException> when a bad request is made to a data service.</span></span><br><br><span data-ttu-id="ad5e9-510">应更改应用程序中的异常处理方式以捕获新的异常。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-510">In your applications, you should change exception handling to catch the new exceptions.</span></span> |
| <span data-ttu-id="ad5e9-511">**标头**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-511">**Headers**</span></span> | <span data-ttu-id="ad5e9-512">已对标头进行以下改进：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-512">The following improvements were made to headers:</span></span><br><br><span data-ttu-id="ad5e9-513">\* WCF 数据服务现会正确地拒绝具有未指定的值的 `eTag` 标头。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-513">\* WCF Data Services now correctly rejects an `eTag` header that has an unspecified value.</span></span><br><span data-ttu-id="ad5e9-514">* WCF 数据服务现将返回一个错误，并且不会执行针对链接的删除请求的请求（如果该请求中包含 `if-*` 标头）。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-514">* WCF Data Services now returns an error and does not execute the request for a delete request to a link when an `if-*` header is in the request.</span></span><br><span data-ttu-id="ad5e9-515">\* WCF Data Services 现以客户端在 Accept 标头中指定的格式（Atom、JSON）将错误返回给客户端。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-515">\* WCF Data Services now returns an error to the client in the format (Atom, JSON) that the client specified in the Accept header.</span></span> |
| <span data-ttu-id="ad5e9-516">**JSON 读取器**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-516">**JSON Reader**</span></span> | <span data-ttu-id="ad5e9-517">如果 JavaScript 对象表示法 (JSON) 读取器在处理发送到 WCF 数据服务的 JSON 负载时读取到单个反斜杠（“\\”）转义字符，它现将正确返回一个错误。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-517">The JavaScript Object Notation (JSON) reader now correctly returns an error when it reads the single backslash ("\\") escape character, when it processes JSON payloads sent to a WCF Data Service.</span></span> |
| <span data-ttu-id="ad5e9-518">**合并**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-518">**Merges**</span></span> | <span data-ttu-id="ad5e9-519">已对 <xref:System.Data.Services.Client.MergeOption> 枚举进行以下改进：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-519">The following improvements were made to the <xref:System.Data.Services.Client.MergeOption> enumeration:</span></span><br><br><span data-ttu-id="ad5e9-520">\* <xref:System.Data.Services.Client.MergeOption> 合并选项不再修改客户端上的实体作为来自数据服务的任何后续响应的结果。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-520">\* The <xref:System.Data.Services.Client.MergeOption> merge option no longer modifies the entity on the client as a result of any subsequent response from a data service.</span></span><br><span data-ttu-id="ad5e9-521">\* <xref:System.Data.Services.Client.MergeOption> 选项目前在动态 SQL 和已存储的基于过程的更新之间保持一致。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-521">\* The <xref:System.Data.Services.Client.MergeOption> option is now consistent between dynamic SQL and stored procedure-based updates.</span></span> |
| <span data-ttu-id="ad5e9-522">**请求**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-522">**Requests**</span></span> | <span data-ttu-id="ad5e9-523">在处理对数据服务的请求前，现在会调用 <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-523">The <xref:System.Data.Services.DataService%601.OnStartProcessingRequest%2A> method is now called before a request to data services is processed.</span></span> <span data-ttu-id="ad5e9-524">这可使该请求对 <xref:System.Data.Services.Providers.ServiceOperation> 服务正常工作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-524">This enables the request to work correctly for <xref:System.Data.Services.Providers.ServiceOperation> services.</span></span> |
| <span data-ttu-id="ad5e9-525">**流**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-525">**Streams**</span></span> | <span data-ttu-id="ad5e9-526">WCF 数据服务不再为读取和写入操作关闭基础流。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-526">WCF Data Services no longer closes the underlying stream for read and write operations.</span></span> |
| <span data-ttu-id="ad5e9-527">**URI**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-527">**URIs**</span></span> | <span data-ttu-id="ad5e9-528">已纠正 WCF 数据服务客户端对 URI 进行的转义。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-528">The escaping of URIs by WCF Data Services client has been corrected.</span></span> |

## <a name="windows-communication-foundation-wcf"></a><span data-ttu-id="ad5e9-529">Windows Communication Foundation (WCF)</span><span class="sxs-lookup"><span data-stu-id="ad5e9-529">Windows Communication Foundation (WCF)</span></span>

<span data-ttu-id="ad5e9-530">下表介绍了对之前具有限制或其他问题的功能的改进。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-530">The following table describes improvements to features that previously had limitations or other issues.</span></span>

| <span data-ttu-id="ad5e9-531">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-531">Feature</span></span> | <span data-ttu-id="ad5e9-532">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-532">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="ad5e9-533">**配置文件**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-533">**Configuration files**</span></span> | <span data-ttu-id="ad5e9-534">为了能够通过配置文件层次结构继承行为，WCF 现支持跨配置文件进行合并。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-534">To enable inheritance of behaviors through the configuration file hierarchy, WCF now supports merging across configuration files.</span></span><br><br><span data-ttu-id="ad5e9-535">现已扩展配置继承模型，允许用户定义将应用于计算机上运行的所有服务的行为。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-535">The configuration inheritance model is now expanded to let users define behaviors that will be applied to all the services that are running on the computer.</span></span><br><br><span data-ttu-id="ad5e9-536">如果在层次结构的不同级别上存在同名的行为，则可能会遇到行为更改。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-536">You may encounter behavioral changes if there are behaviors with the same name at different levels of the hierarchy.</span></span> |
| <span data-ttu-id="ad5e9-537">**服务承载**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-537">**Service hosting**</span></span> | <span data-ttu-id="ad5e9-538">通过向元素定义添加特性 `allowDefinition="MachineToApplication"`，可不再指定服务级别的 `<serviceHostingEnvironment>` 配置元素。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-538">You can no longer specify the `<serviceHostingEnvironment>` configuration element at the service level by adding the attribute `allowDefinition="MachineToApplication"` to the element definition.</span></span><br><br><span data-ttu-id="ad5e9-539">从技术上说，指定服务级别的 `<serviceHostingEnvironment>` 元素是错误的，会导致不一致的行为。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-539">Specifying the `<serviceHostingEnvironment>` element at the service level is technically incorrect and causes inconsistent behavior.</span></span> |

## <a name="windows-presentation-foundation-wpf"></a><span data-ttu-id="ad5e9-540">Windows Presentation Foundation (WPF)</span><span class="sxs-lookup"><span data-stu-id="ad5e9-540">Windows Presentation Foundation (WPF)</span></span>

### <a name="applications"></a><span data-ttu-id="ad5e9-541">应用程序</span><span class="sxs-lookup"><span data-stu-id="ad5e9-541">Applications</span></span>

<span data-ttu-id="ad5e9-542">命名空间：<xref:System.Windows>、<xref:System.Windows.Controls>；程序集：PresentationFramework（在 PresentationFramework.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-542">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>; assembly: PresentationFramework (in PresentationFramework.dll)</span></span>

| <span data-ttu-id="ad5e9-543">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-543">Feature</span></span> | <span data-ttu-id="ad5e9-544">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-544">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-545">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-545">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-546">**异常处理**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-546">**Exception handling**</span></span> | <span data-ttu-id="ad5e9-547">为了能够提前检测错误，WPF 引发 <xref:System.Reflection.TargetInvocationException> 并将 <xref:System.Exception.InnerException> 属性设置为严重异常（例如 <xref:System.NullReferenceException>、<xref:System.OutOfMemoryException>、<xref:System.StackOverflowException> 和 <xref:System.Security.SecurityException>），而不是捕获原始异常。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-547">To enable errors to be detected earlier, WPF throws a <xref:System.Reflection.TargetInvocationException> and sets the <xref:System.Exception.InnerException> property to critical exceptions, such as <xref:System.NullReferenceException>, <xref:System.OutOfMemoryException>, <xref:System.StackOverflowException>, and <xref:System.Security.SecurityException>, instead of catching the original exception.</span></span> | <span data-ttu-id="ad5e9-548">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-548">None.</span></span> |
| <span data-ttu-id="ad5e9-549">**链接的资源**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-549">**Linked resources**</span></span> | <span data-ttu-id="ad5e9-550">为了简化链接，位于项目文件夹结构以外的资源文件（例如图像）在生成应用程序时使用其完整路径（而不仅是其文件名）作为资源 ID。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-550">To make linking easier, resource files (such as images) that are located in a location other than the project's folder structure use the resource file's full path instead of just its file name as the resource ID when the application is built.</span></span> <span data-ttu-id="ad5e9-551">应用程序就能够在运行时找到这些文件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-551">The application will be able to locate the files at run time.</span></span> | <span data-ttu-id="ad5e9-552">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-552">None.</span></span> |
| <span data-ttu-id="ad5e9-553">**部分信任应用程序**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-553">**Partial-trust applications**</span></span> | <span data-ttu-id="ad5e9-554">为了安全起见，如果基于 Windows 的应用程序以部分信任的方式运行，并包含带有 HTML 的 <xref:System.Windows.Controls.WebBrowser> 控件或 <xref:System.Windows.Controls.Frame> 控件，则该应用程序会在创建该控件时引发 <xref:System.Security.SecurityException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-554">For security considerations, Windows-based applications that run in partial trust and contain a <xref:System.Windows.Controls.WebBrowser> control or a <xref:System.Windows.Controls.Frame> control that contains HTML will throw a <xref:System.Security.SecurityException> when the control is created.</span></span><br><br><span data-ttu-id="ad5e9-555">如果满足以下所有条件，则浏览器应用程序引发异常并显示一条消息：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-555">Browser applications will throw an exception and display a message if all of the following conditions are met:</span></span><br><br><span data-ttu-id="ad5e9-556">\* 该应用程序在 Firefox 中运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-556">\* The application is running in Firefox.</span></span><br><span data-ttu-id="ad5e9-557">\* 该应用程序在来自不受信任站点的 Internet 区域中以部分信任的方式运行。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-557">\* The application is running in partial trust in the Internet zone from non-trusted sites.</span></span><br><span data-ttu-id="ad5e9-558">\* 该应用程序包含带有 HTML 的 <xref:System.Windows.Controls.WebBrowser> 控件或 <xref:System.Windows.Controls.Frame> 控件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-558">\* The application contains a <xref:System.Windows.Controls.WebBrowser> control or a <xref:System.Windows.Controls.Frame> control that contains HTML.</span></span><br><br><span data-ttu-id="ad5e9-559">请注意，从受信任站点或 Intranet 区域运行的应用程序不会受到影响。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-559">Note that applications that run from trusted sites or from the intranet zone will not be affected.</span></span> | <span data-ttu-id="ad5e9-560">在浏览器应用程序中，可通过执行下列操作之一来减轻此更改的影响：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-560">In your browser applications, you can ease this change by doing one of the following:</span></span><br><br><span data-ttu-id="ad5e9-561">\* 以完全信任的方式运行浏览器应用程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-561">\* Run the browser application in full trust.</span></span><br><span data-ttu-id="ad5e9-562">\* 让客户将该应用程序的站点添加到受信任的站点区域。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-562">\* Have customers add the application's site to the trusted sites zone.</span></span><br><span data-ttu-id="ad5e9-563">\* 让客户在 Internet Explorer 中运行该应用程序。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-563">\* Have customers run the application in Internet Explorer.</span></span> |
| <span data-ttu-id="ad5e9-564">**资源字典**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-564">**Resource dictionaries**</span></span> | <span data-ttu-id="ad5e9-565">为了改进主题级资源字典并防止它们发生更改，在资源字典中定义且合并到主题级别字典中的可冻结资源现始终标记为已冻结，因而是不可变的。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-565">To improve theme-level resource dictionaries and prevent them from changing, freezable resources that are defined in a resource dictionary and merged into a theme-level dictionary are now always marked as frozen and are immutable.</span></span> <span data-ttu-id="ad5e9-566">这是可冻结资源的预期行为。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-566">This is the expected behavior for freezable resources.</span></span> | <span data-ttu-id="ad5e9-567">修改主题级别合并字典中所定义资源的应用程序应克隆该资源，并修改克隆的副本。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-567">Applications that modify a resource that is defined in a theme-level merged dictionary should clone the resource and modify the cloned copy.</span></span> <span data-ttu-id="ad5e9-568">或者，也可将该资源标记为 `x:Shared="false"`，以便每次查询该资源时 <xref:System.Windows.ResourceDictionary> 都会创建新副本。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-568">Alternatively, the resource can be marked `x:Shared="false"` so that the <xref:System.Windows.ResourceDictionary> creates a new copy every time the resource is queried.</span></span> |
| <span data-ttu-id="ad5e9-569">**Windows 7**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-569">**Windows 7**</span></span> | <span data-ttu-id="ad5e9-570">为了使 WPF 应用程序更适用于 Windows 7，已做出以下改进以纠正窗口的行为：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-570">To make WPF applications work better on Windows 7, the following improvements were made to correct the behavior of a window:</span></span><br><br><span data-ttu-id="ad5e9-571">\* 停靠和笔势状态现基于用户交互按预期方式工作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-571">\* Dock and gesture states now work as expected based on user interactions.</span></span><br><span data-ttu-id="ad5e9-572">\* 任务栏命令“层叠窗口”、“堆叠显示窗口”和“以并行方式显示窗口”现具有正确的行为并更新相应的属性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-572">\* The taskbar commands **Cascade windows, Show windows stacked**, and **Show windows side-by-side** now have the correct behavior and update the appropriate properties.</span></span><br><span data-ttu-id="ad5e9-573">\* 最大化或最小化窗口的 `Top`、`Left`、`Width` 和 `Height` 属性现包含窗口的正确还原位置，而不是其他值，具体取决于监视器。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-573">\* The `Top`, `Left`, `Width`, and `Height` properties for a maximized or minimized window now contain the correct restore location of the window instead of other values, depending on the monitor.</span></span> | <span data-ttu-id="ad5e9-574">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-574">None.</span></span> |
| <span data-ttu-id="ad5e9-575">**窗口样式和透明度**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-575">**Windows style and transparency**</span></span> | <span data-ttu-id="ad5e9-576">当 <xref:System.Windows.Window.AllowsTransparency> 为 `true` 且 <xref:System.Windows.WindowState> 为 <xref:System.Windows.WindowState> 时，如果尝试将 <xref:System.Windows.Window.WindowStyle> 设置为 <xref:System.Windows.WindowStyle> 以外的值，则会引发 <xref:System.InvalidOperationException>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-576">An <xref:System.InvalidOperationException> is thrown if you try to set <xref:System.Windows.Window.WindowStyle> to a value other than <xref:System.Windows.WindowStyle> when <xref:System.Windows.Window.AllowsTransparency> is `true` and <xref:System.Windows.WindowState> is <xref:System.Windows.WindowState>.</span></span> | <span data-ttu-id="ad5e9-577">当 <xref:System.Windows.Window.AllowsTransparency> 为 `true` 时，如果必须更改 <xref:System.Windows.Window.WindowStyle>，则可以调用 Win32 `SetWindowLongPtr` 函数。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-577">If you must change the <xref:System.Windows.Window.WindowStyle> when <xref:System.Windows.Window.AllowsTransparency> is `true`, you can call the Win32 `SetWindowLongPtr` function.</span></span> |
| <span data-ttu-id="ad5e9-578">**XPS 查看器**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-578">**XPS Viewer**</span></span> | <span data-ttu-id="ad5e9-579">WPF 不包含 Microsoft XML 纸张规范 Essentials Pack (XPSEP)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-579">WPF does not include the Microsoft XML Paper Specification Essentials Pack (XPSEP).</span></span> <span data-ttu-id="ad5e9-580">Windows 7 和 Windows Vista 附带 XPSEP。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-580">XPSEP is included with Windows 7 and Windows Vista.</span></span><br><br><span data-ttu-id="ad5e9-581">在运行 Windows XP 但未安装 .NET Framework 3.5 SP1 的计算机上，使用 <xref:System.Windows.Controls.PrintDialog> 中以外的 WPF API 进行打印将依赖于 WINSPOOL。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-581">On a computer that is running Windows XP without the .NET Framework 3.5 SP1 installed, printing by using a WPF API other than those in <xref:System.Windows.Controls.PrintDialog> will rely on the WINSPOOL.</span></span> <span data-ttu-id="ad5e9-582">有些打印机功能不会被报告出来，有些打印机设置也不会在打印期间应用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-582">Some printer capabilities will not be reported and some printer settings will not be applied during printing.</span></span> | <span data-ttu-id="ad5e9-583">如果需要，请安装 [Microsoft XML 纸张规范 Essentials Pack](http://go.microsoft.com/fwlink/?LinkId=178895)。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-583">If needed, install the [Microsoft XML Paper Specification Essentials Pack](http://go.microsoft.com/fwlink/?LinkId=178895).</span></span> |

### <a name="controls"></a><span data-ttu-id="ad5e9-584">控件</span><span class="sxs-lookup"><span data-stu-id="ad5e9-584">Controls</span></span>

<span data-ttu-id="ad5e9-585">命名空间：<xref:System.Windows>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input>；程序集：PresentationFramework（在 PresentationFramework.dll 中）、PresentationCore（在 PresentationCore.dll 中）、WindowsBase（在 WindowsBase.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-585">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="ad5e9-586">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-586">Feature</span></span> | <span data-ttu-id="ad5e9-587">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-587">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-588">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-588">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-589">**对话框**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-589">**Dialog boxes**</span></span> | <span data-ttu-id="ad5e9-590">为了提高可靠性，对创建了 <xref:Microsoft.Win32.FileDialog> 控件的同一线程调用 <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-590">To improve reliability, the <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> method is called on the same thread that created the <xref:Microsoft.Win32.FileDialog> control.</span></span> | <span data-ttu-id="ad5e9-591">确保创建 <xref:Microsoft.Win32.FileDialog> 控件并对同一线程调用 <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> 方法。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-591">Be sure to create a <xref:Microsoft.Win32.FileDialog> control and call the <xref:Microsoft.Win32.CommonDialog.ShowDialog%2A> method on the same thread.</span></span> |
| <span data-ttu-id="ad5e9-592">**浮动窗口**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-592">**Floating windows**</span></span> | <span data-ttu-id="ad5e9-593">为了修复错误地保持对浮点窗口的重新激活（使窗口看上去像一个模式对话框）的焦点还原逻辑，如果候选项不是窗口的子级，现将会阻止焦点还原。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-593">To fix focus restoration logic that incorrectly keeps reactivating a floating window (making it appear like a modal dialog box), focus restoration is now prevented if the candidate is not a child of the window.</span></span> | <span data-ttu-id="ad5e9-594">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-594">None.</span></span> |
| <span data-ttu-id="ad5e9-595">**集合中的项**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-595">**Items in collections**</span></span> | <span data-ttu-id="ad5e9-596">当在基础集合中移动或添加某一项时，如果 <xref:System.Windows.Data.CollectionView> 未进行排序，则该项会显示在 <xref:System.Windows.Data.CollectionView> 中的同一相对位置。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-596">When an item is moved or added to an underlying collection, it appears in the <xref:System.Windows.Data.CollectionView> in the same relative location if the <xref:System.Windows.Data.CollectionView> is not sorted.</span></span> <span data-ttu-id="ad5e9-597">这会确保集合中项的位置与关联的 <xref:System.Windows.Data.CollectionView> 之间的一致性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-597">This provides consistency between the item's position in the collection and in the associated <xref:System.Windows.Data.CollectionView>.</span></span> | <span data-ttu-id="ad5e9-598">使用 <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> 或 <xref:System.Windows.Data.CollectionView.IndexOf%2A> 方法查找项在 <xref:System.Windows.Data.CollectionView> 中的位置，而不是依赖于项的固定位置。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-598">Use the <xref:System.Windows.Controls.ItemContainerGenerator.ContainerFromItem%2A> or <xref:System.Windows.Data.CollectionView.IndexOf%2A> method to find the location of an item in a <xref:System.Windows.Data.CollectionView> instead of relying on a fixed location of an item.</span></span> |
| <span data-ttu-id="ad5e9-599">**布局**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-599">**Layouts**</span></span> | <span data-ttu-id="ad5e9-600">为了消除不必要的重新布局，更改 <xref:System.Windows.Controls.Page.ShowsNavigationUI> 不再会使布局失效或导致执行另一个布局处理过程。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-600">To eliminate unnecessary re-layouts, changing the <xref:System.Windows.Controls.Page.ShowsNavigationUI> no longer invalidates layout or causes another layout pass.</span></span> | <span data-ttu-id="ad5e9-601">如果预期更改 <xref:System.Windows.Controls.Page.ShowsNavigationUI> 会导致执行另一个布局处理过程，请在设置该属性后调用 <xref:System.Windows.UIElement.InvalidateVisual%2A>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-601">If you expect that changing <xref:System.Windows.Controls.Page.ShowsNavigationUI> will cause another layout pass, call <xref:System.Windows.UIElement.InvalidateVisual%2A> after you set the property.</span></span> |
| <span data-ttu-id="ad5e9-602">**菜单**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-602">**Menus**</span></span> | <span data-ttu-id="ad5e9-603">为了在弹出菜单中启用 ClearType 文本，已对 <xref:System.Windows.Controls.ControlTemplate> 类和 <xref:System.Windows.Controls.MenuItem> 控件以及其他控件做出修改。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-603">To enable ClearType text in menu pop-ups, modifications were made to the <xref:System.Windows.Controls.ControlTemplate> class and to the <xref:System.Windows.Controls.MenuItem> control and other controls.</span></span> | <span data-ttu-id="ad5e9-604">应用程序不应依赖于控件模板的可视化结构。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-604">Applications should not rely on the visual structure of control templates.</span></span> <span data-ttu-id="ad5e9-605">只有 <xref:System.Windows.Controls.ControlTemplate> 的已命名部分才包含在公共协定中。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-605">Only named parts of a <xref:System.Windows.Controls.ControlTemplate> are part of the public contract.</span></span> <span data-ttu-id="ad5e9-606">如果应用程序必须在 <xref:System.Windows.Controls.ControlTemplate> 中查找某个对象，则应在可视化树中搜索特定类型的对象，而不是依赖于对象在该树中的固定位置。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-606">If an application must find a certain object in a <xref:System.Windows.Controls.ControlTemplate>, search the visual tree for a specific type instead of relying on a fixed location of an object in the tree.</span></span> |
| <span data-ttu-id="ad5e9-607">**导航**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-607">**Navigating**</span></span> | <span data-ttu-id="ad5e9-608">如果 <xref:System.Windows.Controls.Frame> 直接导航到某一位置，则在初次导航后 <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> 属性为 `true`。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-608">If a <xref:System.Windows.Controls.Frame> directly navigates to a location, the <xref:System.Windows.Navigation.NavigatingCancelEventArgs.IsNavigationInitiator> property is `true` after the initial navigation.</span></span> <span data-ttu-id="ad5e9-609">此更改阻止在启动方案中引发其他事件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-609">This change prevents additional events from being raised during startup scenarios.</span></span> | <span data-ttu-id="ad5e9-610">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-610">None.</span></span> |
| <span data-ttu-id="ad5e9-611">**弹出窗口**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-611">**Pop-ups**</span></span> | <span data-ttu-id="ad5e9-612">在布局处理过程中现可多次调用 <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> 委托，而不是仅调用一次。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-612">The <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegate can now be called multiple times during a layout pass instead of only once.</span></span> | <span data-ttu-id="ad5e9-613">如果 <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> 委托根据其以前的位置计算 <xref:System.Windows.Controls.Primitives.Popup> 的位置，则仅当 `popupSize`、`targetSize` 或 `offset` 参数的值发生更改时才需重新计算该位置。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-613">If your <xref:System.Windows.Controls.Primitives.CustomPopupPlacementCallback> delegate calculates the position of a <xref:System.Windows.Controls.Primitives.Popup> based on its previous position, recalculate the position only if the values of the `popupSize`, `targetSize`, or `offset` parameters change.</span></span> |
| <span data-ttu-id="ad5e9-614">**属性值**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-614">**Property values**</span></span> | <span data-ttu-id="ad5e9-615"><xref:System.Windows.DependencyObject.SetCurrentValue%2A> 方法现允许将属性设置为有效值，但它将继续遵从影响该属性的任何绑定、样式或触发器。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-615">The <xref:System.Windows.DependencyObject.SetCurrentValue%2A> method now lets you set a property to an effective value, although it continues to respects any binding, style, or trigger that affects the property.</span></span> | <span data-ttu-id="ad5e9-616">只要属性值因另一种操作（包括用户操作）的副作用而发生变化，控件作者就应使用 <xref:System.Windows.DependencyObject.SetCurrentValue%2A>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-616">Control authors should use <xref:System.Windows.DependencyObject.SetCurrentValue%2A> whenever the property value changes as a side-effect of some other action, including user manipulation.</span></span> |
| <span data-ttu-id="ad5e9-617">**文本框**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-617">**Text boxes**</span></span> | <span data-ttu-id="ad5e9-618">为了安全起见，在以部分信任的方式调用 <xref:System.Windows.Forms.TextBoxBase.Copy%2A> 和 <xref:System.Windows.Forms.TextBoxBase.Cut%2A> 方法时，这两种方法会失败，且不给出提示。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-618">For security considerations, the <xref:System.Windows.Forms.TextBoxBase.Copy%2A> and <xref:System.Windows.Forms.TextBoxBase.Cut%2A> methods silently fail when they are called in partial trust.</span></span><br><br><span data-ttu-id="ad5e9-619">此外，在部分信任的方式下，还会禁止以编程方式对继承自 <xref:System.Windows.Controls.Primitives.TextBoxBase> 的控件执行 <xref:System.Windows.Input.ApplicationCommands.Copy> 或 <xref:System.Windows.Input.ApplicationCommands.Cut> 属性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-619">In addition, programmatic execution of the <xref:System.Windows.Input.ApplicationCommands.Copy> or <xref:System.Windows.Input.ApplicationCommands.Cut> property on a control that inherits from <xref:System.Windows.Controls.Primitives.TextBoxBase> will be blocked in partial trust.</span></span> <span data-ttu-id="ad5e9-620">不过，用户启动的复制和剪切命令（例如，单击其 <xref:System.Windows.Controls.Primitives.ButtonBase.Command> 属性绑定到其中一个命令的按钮）仍有效。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-620">However, user-initiated copy and cut commands, such as clicking a button whose <xref:System.Windows.Controls.Primitives.ButtonBase.Command> property is bound to one of these commands, will work.</span></span> <span data-ttu-id="ad5e9-621">在部分信任方式下，通过键盘快捷方式和上下文菜单执行的标准复制和剪切仍像之前一样有效。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-621">Standard copy and cut through keyboard shortcuts and the context menu will still work as before in partial trust.</span></span> | <span data-ttu-id="ad5e9-622">将 <xref:System.Windows.Input.ApplicationCommands.Copy> 或 <xref:System.Windows.Input.ApplicationCommands.Cut> 命令绑定到用户启动的操作，例如单击按钮。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-622">Bind the <xref:System.Windows.Input.ApplicationCommands.Copy> or <xref:System.Windows.Input.ApplicationCommands.Cut> command to a user-initiated action, such as clicking a button.</span></span> |

### <a name="graphics"></a><span data-ttu-id="ad5e9-623">图形</span><span class="sxs-lookup"><span data-stu-id="ad5e9-623">Graphics</span></span>

<span data-ttu-id="ad5e9-624">命名空间：<xref:System.Windows>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input> 和 <xref:System.Windows.Media.Effects>；程序集：PresentationFramework（在 PresentationFramework.dll 中）、PresentationCore（在 PresentationCore.dll 中）和 WindowsBase（在 WindowsBase.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-624">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Media.Effects>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="ad5e9-625">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-625">Feature</span></span> | <span data-ttu-id="ad5e9-626">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-626">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-627">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-627">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-628">**位图效果**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-628">**Bitmap effects**</span></span> | <span data-ttu-id="ad5e9-629">为了改进性能，<xref:System.Windows.Media.Effects.BitmapEffect> 类和继承自 <xref:System.Windows.Media.Effects.BitmapEffect> 类的类虽然仍存在，但已被禁用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-629">To improve performance, the <xref:System.Windows.Media.Effects.BitmapEffect> class and the classes that inherit from the <xref:System.Windows.Media.Effects.BitmapEffect> class, although still present, are disabled.</span></span> <span data-ttu-id="ad5e9-630">如果以下条件为 true，则将使用硬件加速呈现管道呈现该效果：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-630">The effect will render by using the hardware-accelerated rendering pipeline if the following conditions are true:</span></span><br><br><span data-ttu-id="ad5e9-631">\* 应用程序会使用 <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> 或半径属性设置为小于 100 DIU 的 <xref:System.Windows.Media.Effects.BlurBitmapEffect>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-631">\* The application uses a <xref:System.Windows.Media.Effects.DropShadowBitmapEffect> or a <xref:System.Windows.Media.Effects.BlurBitmapEffect> that has a radius property set less than 100 DIU.</span></span><br><span data-ttu-id="ad5e9-632">\* 运行应用程序的计算机上的视频卡支持像素着色器 2.0。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-632">\* The video card on the computer that runs the application supports pixel shader 2.0.</span></span><br><br><span data-ttu-id="ad5e9-633">如果不满足以上条件，则 <xref:System.Windows.Media.Effects.BitmapEffect> 对象将不起作用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-633">If these conditions are not met, a <xref:System.Windows.Media.Effects.BitmapEffect> object will have no effect.</span></span><br><br><span data-ttu-id="ad5e9-634">此外，Visual Studio 2010 在遇到 <xref:System.Windows.Media.Effects.BitmapEffect> 对象或子类时还会生成一条编译器警告。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-634">Also, Visual Studio 2010 will produce a compiler warning when it encounters the <xref:System.Windows.Media.Effects.BitmapEffect> object or a subclass.</span></span><br><br><span data-ttu-id="ad5e9-635"><xref:System.Windows.Media.DrawingContext.PushEffect%2A> 方法被标记为已过时。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-635">The <xref:System.Windows.Media.DrawingContext.PushEffect%2A> method is marked obsolete.</span></span> | <span data-ttu-id="ad5e9-636">停止使用旧的 <xref:System.Windows.Media.Effects.BitmapEffect> 及派生类，改用派生自 <xref:System.Windows.Media.Effects.Effect> 的新类：<xref:System.Windows.Media.Effects.BlurEffect>、<xref:System.Windows.Media.Effects.DropShadowEffect> 和 <xref:System.Windows.Media.Effects.ShaderEffect>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-636">Discontinue using the legacy <xref:System.Windows.Media.Effects.BitmapEffect> and derived classes and instead use the new classes derived from <xref:System.Windows.Media.Effects.Effect>: <xref:System.Windows.Media.Effects.BlurEffect>, <xref:System.Windows.Media.Effects.DropShadowEffect>, and <xref:System.Windows.Media.Effects.ShaderEffect>.</span></span><br><br><span data-ttu-id="ad5e9-637">此外，还可通过从 <xref:System.Windows.Media.Effects.ShaderEffect> 类继承，创建自己的效果。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-637">You can also create your own effects by inheriting from the <xref:System.Windows.Media.Effects.ShaderEffect> class.</span></span> |
| <span data-ttu-id="ad5e9-638">**位图帧**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-638">**Bitmap frames**</span></span> | <span data-ttu-id="ad5e9-639">克隆的 <xref:System.Windows.Media.Imaging.BitmapFrame> 对象现会接收 <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>、<xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> 和 <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> 事件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-639">The cloned <xref:System.Windows.Media.Imaging.BitmapFrame> objects now receive the <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, and <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> events.</span></span> <span data-ttu-id="ad5e9-640">这使从网站下载并通过 <xref:System.Windows.Style> 应用于 <xref:System.Windows.Controls.Image> 控件的图像可正常工作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-640">This enables images that are downloaded from the Web and applied to the <xref:System.Windows.Controls.Image> control through a <xref:System.Windows.Style> to work correctly.</span></span><br><br><span data-ttu-id="ad5e9-641">仅当以下所有表述均成立时，才会看到行为更改：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-641">You will see a change in behavior only if all of the following statements are true:</span></span><br><br><span data-ttu-id="ad5e9-642">\* 订阅了 <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>、<xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted> 或 <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> 事件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-642">\* You subscribe to the <xref:System.Windows.Media.Imaging.BitmapSource.DownloadProgress>, <xref:System.Windows.Media.Imaging.BitmapSource.DownloadCompleted>, or <xref:System.Windows.Media.Imaging.BitmapSource.DownloadFailed> event.</span></span><br><span data-ttu-id="ad5e9-643">\* <xref:System.Windows.Media.Imaging.BitmapFrame> 的源来自 Web。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-643">\* The source of the <xref:System.Windows.Media.Imaging.BitmapFrame> is from the Web.</span></span><br><span data-ttu-id="ad5e9-644">\* 在下载仍在进行时对 <xref:System.Windows.Media.Imaging.BitmapFrame> 进行了克隆。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-644">\* The <xref:System.Windows.Media.Imaging.BitmapFrame> is cloned while the download is still in progress.</span></span> | <span data-ttu-id="ad5e9-645">检查事件处理程序中的发送方，并仅在该发送方为原始 <xref:System.Windows.Media.Imaging.BitmapFrame> 时才采取操作。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-645">Check the sender in the event handler and take action only if the sender is the original <xref:System.Windows.Media.Imaging.BitmapFrame>.</span></span> |
| <span data-ttu-id="ad5e9-646">**解码图像**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-646">**Decoding images**</span></span> | <span data-ttu-id="ad5e9-647">为了防止在图像无法解码时不会处理 <xref:System.IO.IOException>，<xref:System.Windows.Media.Imaging.BitmapSource> 类将在不解码图像时引发 <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> 事件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-647">To prevent an <xref:System.IO.IOException> from not being handled when images may not decode, the <xref:System.Windows.Media.Imaging.BitmapSource> class will raise the <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> event when it does not decode an image.</span></span> | <span data-ttu-id="ad5e9-648">删除针对 <xref:System.IO.IOException> 的任何异常处理并使用 <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> 事件检查解码失败。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-648">Remove any exception handling for <xref:System.IO.IOException>, and use the <xref:System.Windows.Media.Imaging.BitmapSource.DecodeFailed> event to check for decode failure.</span></span> |

### <a name="input"></a><span data-ttu-id="ad5e9-649">输入</span><span class="sxs-lookup"><span data-stu-id="ad5e9-649">Input</span></span>

<span data-ttu-id="ad5e9-650">命名空间：<xref:System.Windows>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input>；程序集：PresentationFramework（在 PresentationFramework.dll 中）、PresentationCore（在 PresentationCore.dll 中）、WindowsBase（在 WindowsBase.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-650">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="ad5e9-651">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-651">Feature</span></span> | <span data-ttu-id="ad5e9-652">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-652">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-653">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-653">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-654">**绑定命令实例**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-654">**Binding command instances**</span></span> | <span data-ttu-id="ad5e9-655">为了提供一种机制，用于将基于视图模型的命令实例绑定到基于视图的输入笔势，<xref:System.Windows.Input.InputBinding> 类现从 <xref:System.Windows.Freezable> 而非 <xref:System.Windows.DependencyObject> 继承。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-655">To provide a mechanism to bind View-Model-based command instances to View-based input gestures, the <xref:System.Windows.Input.InputBinding> class now inherits from <xref:System.Windows.Freezable> instead of <xref:System.Windows.DependencyObject>.</span></span> <span data-ttu-id="ad5e9-656">以下属性现为依赖项属性：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-656">The following properties are now dependency properties:</span></span><br><br>* <xref:System.Windows.Input.InputBinding.Command><br>* <xref:System.Windows.Input.InputBinding.CommandParameter><br>* <xref:System.Windows.Input.InputBinding.CommandTarget><br><br><span data-ttu-id="ad5e9-657">此更改产生以下结果：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-657">This change results in the following:</span></span><br><br><span data-ttu-id="ad5e9-658">\* 注册之后，<xref:System.Windows.Input.InputBinding> 对象现处于冻结状态，而不是仍可变。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-658">\* An <xref:System.Windows.Input.InputBinding> object is now frozen when it is registered instead of remaining mutable.</span></span><br><span data-ttu-id="ad5e9-659">\* 无法从多个线程访问实例级别的 <xref:System.Windows.Input.InputBinding> 对象，因为存在 <xref:System.Windows.DependencyObject> 类的限制。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-659">\* You cannot access instance-level <xref:System.Windows.Input.InputBinding> objects from multiple threads, due to the restrictions of the <xref:System.Windows.DependencyObject> class.</span></span><br><span data-ttu-id="ad5e9-660">\* 无法在注册类级别的输入绑定后对其进行转换，因为存在 <xref:System.Windows.Freezable> 类的限制。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-660">\* You cannot mutate class-level input bindings after their registration, due to the restrictions of the <xref:System.Windows.Freezable> class.</span></span><br><span data-ttu-id="ad5e9-661">\* 无法对视图模型中创建的命令实例指定输入绑定。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-661">\* You cannot specify input bindings on command instances that are created in a View-Model.</span></span> | <span data-ttu-id="ad5e9-662">如果绑定可变，则在单独的线程上创建 <xref:System.Windows.Input.InputBinding> 类的单独实例，否则请冻结这些绑定。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-662">Create separate instances of an <xref:System.Windows.Input.InputBinding> class on separate threads if bindings are to be mutable, or freeze them otherwise.</span></span> <span data-ttu-id="ad5e9-663">不要在注册类级别静态 <xref:System.Windows.Input.InputBinding> 后更改它。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-663">Do not mutate a class-level static <xref:System.Windows.Input.InputBinding> after it has been registered.</span></span> |
| <span data-ttu-id="ad5e9-664">**浏览器应用程序**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-664">**Browser applications**</span></span> | <span data-ttu-id="ad5e9-665">WPF 浏览器应用程序 (.XBAP) 现使用与独立 WPF 应用程序相同的方式处理键事件，以便对象以正确顺序接收路由键事件。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-665">WPF Browser applications (.XBAP) now process key events just like stand-alone WPF applications so that objects receive routed key events in the correct order.</span></span> | <span data-ttu-id="ad5e9-666">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-666">None.</span></span> |
| <span data-ttu-id="ad5e9-667">**语音符号键组合**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-667">**Dead key combinations**</span></span> | <span data-ttu-id="ad5e9-668">WPF 会对语音符号键进行模糊处理，这不会生成任何可见字符，而是指示该键将与下一个字母键组合使用以生成一个字符。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-668">WPF obfuscates dead keys, which produce no visible character, but instead indicates that the key is to be combined with the next letter key to produce one character.</span></span> <span data-ttu-id="ad5e9-669">通过将 <xref:System.Windows.Input.KeyEventArgs.Key> 属性设置为 <xref:System.Windows.Input.Key> 值，键输入事件（如 <xref:System.Windows.Input.Keyboard.KeyDownEvent> 事件）会在键成为语音符号键时进行报告。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-669">The key input events, such as the <xref:System.Windows.Input.Keyboard.KeyDownEvent> event, report when a key is a dead key by setting the <xref:System.Windows.Input.KeyEventArgs.Key> property to the <xref:System.Windows.Input.Key> value.</span></span> <span data-ttu-id="ad5e9-670">这通常属于预期行为，因为应用程序一般不会对创建组合字符的键盘输入做出响应。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-670">This is usually expected behavior because applications usually do not intend to respond to keyboard input that creates a combined character.</span></span> | <span data-ttu-id="ad5e9-671">期望读取组合字符组成键的应用程序可通过使用 <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey> 属性，获取现经过模糊处理的键。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-671">Applications that expect to read keys that were part of combined characters can get the now obfuscated key by using the <xref:System.Windows.Input.KeyEventArgs.DeadCharProcessedKey> property.</span></span> |
| <span data-ttu-id="ad5e9-672">**焦点管理器**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-672">**Focus manager**</span></span> | <span data-ttu-id="ad5e9-673">如果向 <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> 方法传递将 [IsFocusScope](https://msdn.microsoft.com/library/system.windows.input.focusmanager.isfocusscope.aspx) 附加属性设置为 `true` 的元素，那么当且仅当返回的元素与传递给此方法的元素属于同一 <xref:System.Windows.PresentationSource> 对象时，此方法返回的元素才是相应焦点范围内的上一个键盘焦点元素。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-673">When the <xref:System.Windows.Input.FocusManager.GetFocusedElement(System.Windows.DependencyObject)?displayProperty=nameWithType> method is passed an element that has the [IsFocusScope](https://msdn.microsoft.com/library/system.windows.input.focusmanager.isfocusscope.aspx) attached property set to `true`, the method returns an element that is the last keyboard-focused element within that focus scope if and only if the returned element belongs to the same <xref:System.Windows.PresentationSource> object as the element that is passed to the method.</span></span> | <span data-ttu-id="ad5e9-674">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-674">None.</span></span> |

### <a name="ui-automation"></a><span data-ttu-id="ad5e9-675">UI 自动化</span><span class="sxs-lookup"><span data-stu-id="ad5e9-675">UI Automation</span></span>

<span data-ttu-id="ad5e9-676">命名空间：<xref:System.Windows>、<xref:System.Windows.Automation.Peers>、<xref:System.Windows.Automation.Provider>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input>；程序集：PresentationFramework（在 PresentationFramework.dll 中）、PresentationCore（在 PresentationCore.dll 中）、UIAutomationProvider（在 UIAutomationProvider.dll 中）、WindowsBase（在 WindowsBase.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-676">Namespace: <xref:System.Windows>, <xref:System.Windows.Automation.Peers>, <xref:System.Windows.Automation.Provider>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), UIAutomationProvider (in UIAutomationProvider.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="ad5e9-677">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-677">Feature</span></span> | <span data-ttu-id="ad5e9-678">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-678">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-679">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-679">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-680">**视图的类层次结构**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-680">**Class hierarchy of views**</span></span> | <span data-ttu-id="ad5e9-681"><xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> 和 <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> 类继承自 <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> 而不是 <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-681">The <xref:System.Windows.Automation.Peers.TreeViewAutomationPeer> and <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> classes inherit from <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> instead of <xref:System.Windows.Automation.Peers.FrameworkElementAutomationPeer>.</span></span> | <span data-ttu-id="ad5e9-682">如果继承自 <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> 类并重写 <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A> 方法，请考虑返回继承自新 <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer> 类的对象。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-682">If you inherit from the <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer> classes and override the <xref:System.Windows.Automation.Peers.TreeViewItemAutomationPeer.GetChildrenCore%2A> method, consider returning an object that inherits from the new <xref:System.Windows.Automation.Peers.TreeViewDataItemAutomationPeer> class.</span></span> |
| <span data-ttu-id="ad5e9-683">**离开屏幕的容器**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-683">**Containers off screen**</span></span> | <span data-ttu-id="ad5e9-684">为了纠正错误的返回值，如果项容器滚动到视图之外，<xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> 方法现正确返回 `false`。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-684">To fix an incorrect return value, the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.IsOffscreenCore%2A> method now correctly returns `false` for item containers that are scrolled out of view.</span></span> <span data-ttu-id="ad5e9-685">此外，该方法的值不受被其他窗口封闭或元素是否在特定监视器上可见的影响。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-685">Also, the value of the method is not affected by occlusion by other windows, or by whether the element is visible on a specific monitor.</span></span> | <span data-ttu-id="ad5e9-686">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-686">None.</span></span> |
| <span data-ttu-id="ad5e9-687">**菜单和子对象**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-687">**Menus and child objects**</span></span> | <span data-ttu-id="ad5e9-688">对于包含 <xref:System.Windows.Controls.MenuItem> 对象以外的子级的菜单，为了实现其 UI 自动化，<xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> 方法现返回子 <xref:System.Windows.UIElement> 对象的 <xref:System.Windows.Automation.Peers.AutomationPeer> 对象，而不是 <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer> 对象。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-688">To enable UI automation of menus that contain children other than <xref:System.Windows.Controls.MenuItem> objects, the <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer.GetChildrenCore%2A> method now returns the <xref:System.Windows.Automation.Peers.AutomationPeer> object of a child <xref:System.Windows.UIElement> object, instead of a <xref:System.Windows.Automation.Peers.MenuItemAutomationPeer> object.</span></span> | <span data-ttu-id="ad5e9-689">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-689">None.</span></span> |
| <span data-ttu-id="ad5e9-690">**新接口和程序集**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-690">**New interfaces and assembly**</span></span> | <span data-ttu-id="ad5e9-691">为了实现新功能的 UI 自动化，添加了以下接口：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-691">To enable new features for UI automation, the following interfaces were added:</span></span><br><br>* <xref:System.Windows.Automation.Provider.IItemContainerProvider><br>* <xref:System.Windows.Automation.Provider.ISynchronizedInputProvider><br>* <xref:System.Windows.Automation.Provider.IVirtualizedItemProvider> | <span data-ttu-id="ad5e9-692">生成 WPF 自动化对等的任何项目都必须添加对 UIAutomationProvider.dll 的显式引用。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-692">Any project that builds WPF automation peers must add an explicit reference to UIAutomationProvider.dll.</span></span> |
| <span data-ttu-id="ad5e9-693">**Thumb**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-693">**Thumbs**</span></span> | <span data-ttu-id="ad5e9-694"><xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> 方法返回一个值，而不是 Null。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-694">The <xref:System.Windows.Automation.Peers.ThumbAutomationPeer.GetClassNameCore%2A> method returns a value instead of null.</span></span> <span data-ttu-id="ad5e9-695">因此，继承自 <xref:System.Windows.Controls.Primitives.Thumb> 类的控件（例如 <xref:System.Windows.Controls.GridSplitter>）会将名称报告给 UI 自动化。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-695">Therefore, controls controls such as <xref:System.Windows.Controls.GridSplitter> that inherit from the <xref:System.Windows.Controls.Primitives.Thumb> class will report a name to UI Automation.</span></span> | <span data-ttu-id="ad5e9-696">无。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-696">None.</span></span> |
| <span data-ttu-id="ad5e9-697">**虚拟化元素**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-697">**Virtualized elements**</span></span> | <span data-ttu-id="ad5e9-698">为了改进性能，<xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> 方法只返回确实位于可视化树中的子对象而不是所有子对象，无论它们是否已虚拟化。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-698">To improve performance, the <xref:System.Windows.Automation.Peers.UIElementAutomationPeer.GetChildrenCore%2A> method returns only the child objects that are actually in the visual tree, instead of all child objects, regardless of whether they are virtualized.</span></span> | <span data-ttu-id="ad5e9-699">使用 <xref:System.Windows.Automation.ItemContainerPattern> 循环访问 <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer> 的所有项。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-699">Use <xref:System.Windows.Automation.ItemContainerPattern> to iterate over all items of an <xref:System.Windows.Automation.Peers.ItemsControlAutomationPeer>.</span></span> |

### <a name="xaml"></a><span data-ttu-id="ad5e9-700">XAML</span><span class="sxs-lookup"><span data-stu-id="ad5e9-700">XAML</span></span>

<span data-ttu-id="ad5e9-701">命名空间：<xref:System.Windows>、<xref:System.Windows.Controls>、<xref:System.Windows.Data>、<xref:System.Windows.Input> 和 <xref:System.Windows.Markup>；程序集：PresentationFramework（在 PresentationFramework.dll 中）、PresentationCore（在 PresentationCore.dll 中）和 WindowsBase（在 WindowsBase.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-701">Namespaces: <xref:System.Windows>, <xref:System.Windows.Controls>, <xref:System.Windows.Data>, <xref:System.Windows.Input>, <xref:System.Windows.Markup>; assemblies: PresentationFramework (in PresentationFramework.dll), PresentationCore (in PresentationCore.dll), WindowsBase (in WindowsBase.dll)</span></span>

| <span data-ttu-id="ad5e9-702">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-702">Feature</span></span> | <span data-ttu-id="ad5e9-703">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-703">Differences from 3.5 SP1</span></span> | <span data-ttu-id="ad5e9-704">建议的更改</span><span class="sxs-lookup"><span data-stu-id="ad5e9-704">Recommended changes</span></span> |
| ------- | ------------------------ | ------------------- |
| <span data-ttu-id="ad5e9-705">**标记扩展**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-705">**Markup extension**</span></span> | <span data-ttu-id="ad5e9-706">使用标记扩展在集合中设置属性或创建项时，WPF 现始终正确使用 <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> 方法中的值，而不是在某些情况下返回 <xref:System.Windows.Markup.MarkupExtension> 对象。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-706">WPF now correctly always uses the value from the <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> method instead of returning the <xref:System.Windows.Markup.MarkupExtension> object in certain cases when a markup extension is used to set a property or to create an item in a collection.</span></span> <span data-ttu-id="ad5e9-707">标记扩展在某些情况下可能会返回自身。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-707">A markup extension might return itself in some cases.</span></span> | <span data-ttu-id="ad5e9-708">如果在早期版本中应用程序访问返回了 <xref:System.Windows.Markup.MarkupExtension> 对象的资源，则引用从 <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A> 返回的对象，而不是 <xref:System.Windows.Markup.MarkupExtension> 对象。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-708">If your application accesses a resource that returned a <xref:System.Windows.Markup.MarkupExtension> object in earlier versions, reference the object that is returned from <xref:System.Windows.Markup.MarkupExtension.ProvideValue%2A>, instead of the <xref:System.Windows.Markup.MarkupExtension> object.</span></span> |
| <span data-ttu-id="ad5e9-709">**分析特性**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-709">**Parsing attributes**</span></span> | <span data-ttu-id="ad5e9-710">XAML 中的特性现可只具有一个句点。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-710">Attributes in XAML can now have only one period.</span></span> <span data-ttu-id="ad5e9-711">例如，以下特性有效：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-711">For example, the following are valid:</span></span><br><br><span data-ttu-id="ad5e9-712">`<Button Background="Red"/>`（无句点）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-712">`<Button Background="Red"/>` (no periods)</span></span><br><br><span data-ttu-id="ad5e9-713">`<Button Button.Background = "Red"/>`（一个句点）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-713">`<Button Button.Background = "Red"/>` (one period)</span></span><br><br><span data-ttu-id="ad5e9-714">以下特性不再有效：</span><span class="sxs-lookup"><span data-stu-id="ad5e9-714">The following is no longer valid:</span></span><br><br><span data-ttu-id="ad5e9-715">`<Button Control.Button.Background = "Red"/>`（多个句点）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-715">`<Button Control.Button.Background = "Red"/>` (more than one period)</span></span> | <span data-ttu-id="ad5e9-716">更正具有多个句点的 XAML 特性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-716">Correct XAML attributes that have more than one period.</span></span> |

## <a name="xml"></a><span data-ttu-id="ad5e9-717">XML</span><span class="sxs-lookup"><span data-stu-id="ad5e9-717">XML</span></span>

<span data-ttu-id="ad5e9-718">此表中的各行介绍了对之前具有限制或其他问题的功能的改进。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-718">The rows in this table describe improvements to features that previously had limitations or other issues.</span></span>

### <a name="schema-and-transforms"></a><span data-ttu-id="ad5e9-719">架构和转换</span><span class="sxs-lookup"><span data-stu-id="ad5e9-719">Schema and transforms</span></span>

<span data-ttu-id="ad5e9-720">命名空间：<xref:System.Xml.Linq>、<xref:System.Xml.Schema>、<xref:System.Xml.XPath>；程序集：System.Xml（在 System.Xml.dll 中）、System.Xml.Linq（在 System.Xml.Linq.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-720">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="ad5e9-721">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-721">Feature</span></span> | <span data-ttu-id="ad5e9-722">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-722">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="ad5e9-723">**Chameleon 架构**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-723">**Chameleon schemas**</span></span> | <span data-ttu-id="ad5e9-724">为了防止数据损坏，当 Chameleon 架构随附于多个架构，现可正确克隆。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-724">To prevent data corruption, chameleon schemas are now cloned correctly when they are included with multiple schemas.</span></span><br><br><span data-ttu-id="ad5e9-725">Chameleon 架构是一些不具有目标命名空间的架构，当这些架构包含在另一个 XSD 中时，它们采用导入架构的目标命名空间。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-725">Chameleon schemas are schemas that do not have a target namespace, and when they are included in another XSD, they take on the target namespace of the importing schema.</span></span> <span data-ttu-id="ad5e9-726">它们通常用于将一般类型包含在架构中。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-726">They are often used to include common types into a schema.</span></span> |
| <span data-ttu-id="ad5e9-727">**ID 函数**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-727">**ID functions**</span></span> | <span data-ttu-id="ad5e9-728">向 XLST 传递 <xref:System.Xml.XmlReader> 对象时，XSLT [id 函数](/sql/xquery/functions-on-sequences-id)现在返回正确的值而不是 Null。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-728">The XSLT [id function](/sql/xquery/functions-on-sequences-id) now returns the correct value instead of null when an <xref:System.Xml.XmlReader> object is passed to an XLST.</span></span><br><br><span data-ttu-id="ad5e9-729">如果用户使用 <xref:System.Xml.Linq.XNode.CreateReader%2A> 方法从 LINQ to XML 类创建了 <xref:System.Xml.XmlReader> 对象，且已将此 <xref:System.Xml.XmlReader> 对象传递给 XSLT，则 XSLT 中 `id` 函数的任何实例先前返回了 Null。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-729">If the user created an <xref:System.Xml.XmlReader> object from a LINQ to XML class by using the <xref:System.Xml.Linq.XNode.CreateReader%2A> method, and this <xref:System.Xml.XmlReader> object was passed to an XSLT, any instances of the `id` function in the XSLT previously returned null.</span></span> <span data-ttu-id="ad5e9-730">此值不是 `id` 函数允许的返回值。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-730">This is not an allowed return value for the `id` function.</span></span> |
| <span data-ttu-id="ad5e9-731">**命名空间特性**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-731">**Namespace attribute**</span></span> | <span data-ttu-id="ad5e9-732">为了防止数据损坏，<xref:System.Xml.XPath.XPathNavigator> 对象现正确返回 `x:xmlns` 特性的本地名称。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-732">To prevent data corruption, an <xref:System.Xml.XPath.XPathNavigator> object now returns the local name of the `x:xmlns` attribute correctly.</span></span> |
| <span data-ttu-id="ad5e9-733">**命名空间声明**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-733">**Namespace declarations**</span></span> | <span data-ttu-id="ad5e9-734">子树中的 <xref:System.Xml.XmlReader> 对象不再在单个 XML 元素中创建重复的命名空间声明。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-734">An <xref:System.Xml.XmlReader> object on a sub-tree no longer creates duplicate namespace declarations within one XML element.</span></span> |
| <span data-ttu-id="ad5e9-735">**架构验证**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-735">**Schema validation**</span></span> | <span data-ttu-id="ad5e9-736">为了阻止错误的架构验证，<xref:System.Xml.Schema.XmlSchemaSet> 类确保 XSD 架构编译的正确性和一致性。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-736">To prevent erroneous schema validation, the <xref:System.Xml.Schema.XmlSchemaSet> class allows for XSD schemas to be compiled correctly and consistently.</span></span> <span data-ttu-id="ad5e9-737">这些架构可包含其他架构；例如，`A.xsd` 可包含 `B.xsd`，而后者又可包含 `C.xsd`。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-737">These schemas can include other schemas; for example, `A.xsd` can include `B.xsd`, which can include `C.xsd`.</span></span> <span data-ttu-id="ad5e9-738">编译上述任意架构会导致遍历依赖项图。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-738">Compiling any one of these causes this graph of dependencies to be traversed.</span></span> |
| <span data-ttu-id="ad5e9-739">**脚本函数**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-739">**Script functions**</span></span> | <span data-ttu-id="ad5e9-740">当 [function-available 函数](https://msdn.microsoft.com/library/ms256124(v=vs.110).aspx) 实际可用时，它不再错误返回 `false`。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-740">The [function-available function](https://msdn.microsoft.com/library/ms256124(v=vs.110).aspx) no longer incorrectly returns `false` when the function is actually available.</span></span> |
| <span data-ttu-id="ad5e9-741">**URI**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-741">**URIs**</span></span> | <span data-ttu-id="ad5e9-742"><xref:System.Xml.Linq.XElement.Load%2A> 方法现会在 LINQ 查询中返回正确的 BaseURI。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-742">The <xref:System.Xml.Linq.XElement.Load%2A> method now returns the correct BaseURI in LINQ queries.</span></span> |

### <a name="validation"></a><span data-ttu-id="ad5e9-743">验证</span><span class="sxs-lookup"><span data-stu-id="ad5e9-743">Validation</span></span>

<span data-ttu-id="ad5e9-744">命名空间：<xref:System.Xml.Linq>、<xref:System.Xml.Schema>、<xref:System.Xml.XPath>；程序集：System.Xml（在 System.Xml.dll 中）、System.Xml.Linq（在 System.Xml.Linq.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-744">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="ad5e9-745">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-745">Feature</span></span> | <span data-ttu-id="ad5e9-746">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-746">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="ad5e9-747">**命名空间解析器**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-747">**Namespace resolvers**</span></span> | <span data-ttu-id="ad5e9-748"><xref:System.Xml.XmlReader.ReadContentAs%2A> 方法不再忽略传递给它的 <xref:System.Xml.IXmlNamespaceResolver> 解析器。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-748">The <xref:System.Xml.XmlReader.ReadContentAs%2A> method no longer ignores the <xref:System.Xml.IXmlNamespaceResolver> resolver passed to it.</span></span><br><br><span data-ttu-id="ad5e9-749">在早期版本中，忽略了指定的命名空间解析器，而改用 <xref:System.Xml.XmlReader>。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-749">In previous versions, the specified namespace resolver was ignored, and the <xref:System.Xml.XmlReader> was used instead.</span></span> |
| <span data-ttu-id="ad5e9-750">**空格**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-750">**White space**</span></span> | <span data-ttu-id="ad5e9-751">为了在创建读取器时防止数据丢失，<xref:System.Xml.XmlReader.Create%2A> 方法不再丢弃有意义的空格。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-751">To prevent data loss when you are creating a reader, the <xref:System.Xml.XmlReader.Create%2A> method no longer discards significant white space.</span></span><br><br><span data-ttu-id="ad5e9-752">XML 验证识别混合内容模式，文本可在其中与 XML 标记混合。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-752">XML validation recognizes mixed-content mode, where text can be intermixed with XML markup.</span></span> <span data-ttu-id="ad5e9-753">在混合模式下，所有空格都是有意义的，应该报告出来。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-753">In mixed mode, all white space is significant and should be reported.</span></span> |

### <a name="writing"></a><span data-ttu-id="ad5e9-754">写入</span><span class="sxs-lookup"><span data-stu-id="ad5e9-754">Writing</span></span>

<span data-ttu-id="ad5e9-755">命名空间：<xref:System.Xml.Linq>、<xref:System.Xml.Schema>、<xref:System.Xml.XPath>；程序集：System.Xml（在 System.Xml.dll 中）、System.Xml.Linq（在 System.Xml.Linq.dll 中）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-755">Namespaces: <xref:System.Xml.Linq>; <xref:System.Xml.Schema>, <xref:System.Xml.XPath>; assemblies: System.Xml (in System.Xml.dll), System.Xml.Linq (in System.Xml.Linq.dll)</span></span>

| <span data-ttu-id="ad5e9-756">功能</span><span class="sxs-lookup"><span data-stu-id="ad5e9-756">Feature</span></span> | <span data-ttu-id="ad5e9-757">与 3.5 SP1 的差异</span><span class="sxs-lookup"><span data-stu-id="ad5e9-757">Differences from 3.5 SP1</span></span> |
| ------- | ------------------------ |
| <span data-ttu-id="ad5e9-758">**实体引用**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-758">**Entity references**</span></span> | <span data-ttu-id="ad5e9-759">为了防止数据损坏，不再在 XML 特性中对实体引用实体化两次。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-759">To prevent data corruption, entity references are no longer entitized twice in XML attributes.</span></span><br><br><span data-ttu-id="ad5e9-760">如果用户尝试使用 <xref:System.Xml.XmlWriter.WriteEntityRef%2A> 方法将实体写入 `xmlns` 特性、`xml:lang` 特性或 `xml:space` 特性中，则会在输出中实体化实体两次，从而将损坏数据。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-760">If the user tried to write an entity into an `xmlns` attribute or into an `xml:lang` or `xml:space` attribute by using the <xref:System.Xml.XmlWriter.WriteEntityRef%2A> method, the entity was entitized twice in the output, therefore corrupting the data.</span></span> |
| <span data-ttu-id="ad5e9-761">**新行处理**</span><span class="sxs-lookup"><span data-stu-id="ad5e9-761">**New line handling**</span></span> | <span data-ttu-id="ad5e9-762">为了防止数据损坏，<xref:System.Xml.XmlWriter> 对象遵循 <xref:System.Xml.NewLineHandling> 选项。</span><span class="sxs-lookup"><span data-stu-id="ad5e9-762">To prevent data corruption, <xref:System.Xml.XmlWriter> objects respect the <xref:System.Xml.NewLineHandling> option.</span></span> |

## <a name="see-also"></a><span data-ttu-id="ad5e9-763">请参阅</span><span class="sxs-lookup"><span data-stu-id="ad5e9-763">See also</span></span>

### <a name="reference"></a><span data-ttu-id="ad5e9-764">参考</span><span class="sxs-lookup"><span data-stu-id="ad5e9-764">Reference</span></span>

<span data-ttu-id="ad5e9-765">[.NET Framework 4 中的新增类型和成员](https://msdn.microsoft.com/library/ff641764(v=vs.100).aspx)</span><span class="sxs-lookup"><span data-stu-id="ad5e9-765">[New Types and Members in the .NET Framework 4](https://msdn.microsoft.com/library/ff641764(v=vs.100).aspx)</span></span>

### <a name="concepts"></a><span data-ttu-id="ad5e9-766">概念</span><span class="sxs-lookup"><span data-stu-id="ad5e9-766">Concepts</span></span>

<span data-ttu-id="ad5e9-767">[.NET Framework 4 的迁移指南](https://msdn.microsoft.com/library/ff657133(v=vs.100).aspx) </span><span class="sxs-lookup"><span data-stu-id="ad5e9-767">[Migration Guide to the .NET Framework 4](https://msdn.microsoft.com/library/ff657133(v=vs.100).aspx) </span></span>  
<span data-ttu-id="ad5e9-768">[.NET Framework 4 中的新增功能](https://msdn.microsoft.com/library/ms171868(v=vs.100).aspx) </span><span class="sxs-lookup"><span data-stu-id="ad5e9-768">[What's New in the .NET Framework 4](https://msdn.microsoft.com/library/ms171868(v=vs.100).aspx) </span></span>  
<span data-ttu-id="ad5e9-769">[.NET Framework 的版本兼容性](../../../docs/framework/migration-guide/version-compatibility.md) </span><span class="sxs-lookup"><span data-stu-id="ad5e9-769">[Version Compatibility in the .NET Framework](../../../docs/framework/migration-guide/version-compatibility.md) </span></span>  
[<span data-ttu-id="ad5e9-770">将 Office 解决方案迁移到 .NET Framework 4</span><span class="sxs-lookup"><span data-stu-id="ad5e9-770">Migrating Office Solutions to the .NET Framework 4</span></span>](https://msdn.microsoft.com/library/ee207231.aspx)

### <a name="other-resources"></a><span data-ttu-id="ad5e9-771">其他资源</span><span class="sxs-lookup"><span data-stu-id="ad5e9-771">Other resources</span></span>

<span data-ttu-id="ad5e9-772">[.NET Framework 中的过时功能](https://msdn.microsoft.com/library/ee461502(v=vs.110).aspx) </span><span class="sxs-lookup"><span data-stu-id="ad5e9-772">[What's Obsolete in the .NET Framework](https://msdn.microsoft.com/library/ee461502(v=vs.110).aspx) </span></span>  
<span data-ttu-id="ad5e9-773">[Migration Issues for .NET Framework 4 Applications: Beta 2 to RTM](http://go.microsoft.com/fwlink/?LinkId=191505)（.NET Framework 4 应用程序的迁移问题：Beta 2 到 RTM）</span><span class="sxs-lookup"><span data-stu-id="ad5e9-773">[Migration Issues for .NET Framework 4 Applications: Beta 2 to RTM](http://go.microsoft.com/fwlink/?LinkId=191505)</span></span>
