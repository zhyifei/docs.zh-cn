---
title: 在 LINQ to DataSet 中查询
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: c1a78fa8-9f0c-40bc-a372-5575a48708fe
ms.openlocfilehash: f4458639aa2c78e7c78bdae66fa2b20d5546743c
ms.sourcegitcommit: 5b6d778ebb269ee6684fb57ad69a8c28b06235b9
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/08/2019
ms.locfileid: "59102539"
---
# <a name="queries-in-linq-to-dataset"></a><span data-ttu-id="7000f-102">在 LINQ to DataSet 中查询</span><span class="sxs-lookup"><span data-stu-id="7000f-102">Queries in LINQ to DataSet</span></span>
<span data-ttu-id="7000f-103">查询是一种从数据源检索数据的表达式。</span><span class="sxs-lookup"><span data-stu-id="7000f-103">A query is an expression that retrieves data from a data source.</span></span> <span data-ttu-id="7000f-104">查询通常用专用查询语言表示，如用于关系数据库的 SQL 和用于 XML 的 XQuery。</span><span class="sxs-lookup"><span data-stu-id="7000f-104">Queries are usually expressed in a specialized query language, such as SQL for relational databases and XQuery for XML.</span></span> <span data-ttu-id="7000f-105">因此，开发人员对于他们查询的每种类型的数据源或数据格式，都不得不学习一种新的查询语言。</span><span class="sxs-lookup"><span data-stu-id="7000f-105">Therefore, developers have had to learn a new query language for each type of data source or data format that they query.</span></span> [!INCLUDE[vbteclinqext](../../../../includes/vbteclinqext-md.md)] <span data-ttu-id="7000f-106">提供了更简单的一致模型，用于跨各种数据源和格式处理数据。</span><span class="sxs-lookup"><span data-stu-id="7000f-106">offers a simpler, consistent model for working with data across various kinds of data sources and formats.</span></span> <span data-ttu-id="7000f-107">在 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 查询中，您始终使用编程对象。</span><span class="sxs-lookup"><span data-stu-id="7000f-107">In a [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] query, you always work with programming objects.</span></span>  
  
 <span data-ttu-id="7000f-108">一个 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 查询操作包含三个操作：获取数据源、创建查询和执行查询。</span><span class="sxs-lookup"><span data-stu-id="7000f-108">A [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] query operation consists of three actions: obtain the data source or sources, create the query, and execute the query.</span></span>  
  
 <span data-ttu-id="7000f-109">实现 <xref:System.Collections.Generic.IEnumerable%601> 泛型接口的数据源可以通过 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 进行查询。</span><span class="sxs-lookup"><span data-stu-id="7000f-109">Data sources that implement the <xref:System.Collections.Generic.IEnumerable%601> generic interface can be queried through [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)].</span></span> <span data-ttu-id="7000f-110">对 <xref:System.Data.DataTableExtensions.AsEnumerable%2A> 调用 <xref:System.Data.DataTable> 将返回实现泛型 <xref:System.Collections.Generic.IEnumerable%601> 接口的对象，作为 [!INCLUDE[linq_dataset](../../../../includes/linq-dataset-md.md)] 查询的数据源。</span><span class="sxs-lookup"><span data-stu-id="7000f-110">Calling <xref:System.Data.DataTableExtensions.AsEnumerable%2A> on a <xref:System.Data.DataTable> returns an object which implements the generic <xref:System.Collections.Generic.IEnumerable%601> interface, which serves as the data source for [!INCLUDE[linq_dataset](../../../../includes/linq-dataset-md.md)] queries.</span></span>  
  
 <span data-ttu-id="7000f-111">在查询中，您可以确切指定要从数据源检索哪些信息。</span><span class="sxs-lookup"><span data-stu-id="7000f-111">In the query, you specify exactly the information that you want to retrieve from the data source.</span></span> <span data-ttu-id="7000f-112">查询也可以指定返回信息之前信息的排序、分组和表现方式。</span><span class="sxs-lookup"><span data-stu-id="7000f-112">A query can also specify how that information should be sorted, grouped, and shaped before it is returned.</span></span> <span data-ttu-id="7000f-113">在 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 中，查询存储在变量中。</span><span class="sxs-lookup"><span data-stu-id="7000f-113">In [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)], a query is stored in a variable.</span></span> <span data-ttu-id="7000f-114">如果查询旨在返回一系列值，则查询变量本身也必须为可枚举类型。</span><span class="sxs-lookup"><span data-stu-id="7000f-114">If the query is designed to return a sequence of values, the query variable itself must be a enumerable type.</span></span> <span data-ttu-id="7000f-115">此查询变量不执行任何操作，也不返回任何数据；它只存储查询信息。</span><span class="sxs-lookup"><span data-stu-id="7000f-115">This query variable takes no action and returns no data; it only stores the query information.</span></span> <span data-ttu-id="7000f-116">创建查询后必须执行该查询以检索任何数据。</span><span class="sxs-lookup"><span data-stu-id="7000f-116">After you create a query you must execute that query to retrieve any data.</span></span>  
  
 <span data-ttu-id="7000f-117">在返回一系列值的查询中，查询变量本身从不保存查询结果，它只存储查询命令。</span><span class="sxs-lookup"><span data-stu-id="7000f-117">In a query that returns a sequence of values, the query variable itself never holds the query results and only stores the query commands.</span></span> <span data-ttu-id="7000f-118">查询的执行将推迟到在 `foreach` 或 `For Each` 循环中循环访问查询变量之后进行。</span><span class="sxs-lookup"><span data-stu-id="7000f-118">Execution of the query is deferred until the query variable is iterated over in a `foreach` or `For Each` loop.</span></span> <span data-ttu-id="7000f-119">这称为*延迟执行*; 也就是说，查询会执行的一段时间后，查询构造。</span><span class="sxs-lookup"><span data-stu-id="7000f-119">This is called *deferred execution*; that is, query execution occurs some time after the query is constructed.</span></span> <span data-ttu-id="7000f-120">这意味着您可以根据需要频繁地执行查询。</span><span class="sxs-lookup"><span data-stu-id="7000f-120">This means that you can execute a query as often as you want to.</span></span> <span data-ttu-id="7000f-121">例如，当您的数据库由其他应用程序不断更新时，此功能将会很有用。</span><span class="sxs-lookup"><span data-stu-id="7000f-121">This is useful when, for example, you have a database that is being updated by other applications.</span></span> <span data-ttu-id="7000f-122">在您的应用程序中，您可以创建查询以检索最新信息并重复执行查询，每次返回更新的信息。</span><span class="sxs-lookup"><span data-stu-id="7000f-122">In your application, you can create a query to retrieve the latest information and repeatedly execute the query, returning the updated information every time.</span></span>  
  
 <span data-ttu-id="7000f-123">与返回一系列值的延迟查询相反，返回单一实例值的查询将立即执行。</span><span class="sxs-lookup"><span data-stu-id="7000f-123">In contrast to deferred queries, which return a sequence of values, queries that return a singleton value are executed immediately.</span></span> <span data-ttu-id="7000f-124"><xref:System.Linq.Enumerable.Count%2A>、<xref:System.Linq.Enumerable.Max%2A>、<xref:System.Linq.Enumerable.Average%2A> 和 <xref:System.Linq.Enumerable.First%2A> 是单一实例查询的一些示例。</span><span class="sxs-lookup"><span data-stu-id="7000f-124">Some examples of singleton queries are <xref:System.Linq.Enumerable.Count%2A>, <xref:System.Linq.Enumerable.Max%2A>, <xref:System.Linq.Enumerable.Average%2A>, and <xref:System.Linq.Enumerable.First%2A>.</span></span> <span data-ttu-id="7000f-125">因为需要查询结果来计算单一实例结果，因此这些查询将会立即执行。</span><span class="sxs-lookup"><span data-stu-id="7000f-125">These execute immediately because the query results are required to calculate the singleton result.</span></span> <span data-ttu-id="7000f-126">例如，若要计算查询结果的平均值，则必须执行查询，以便求平均值函数具有要使用的输入数据。</span><span class="sxs-lookup"><span data-stu-id="7000f-126">For example, in order to find the average of the query results the query must be executed so that the averaging function has input data to work with.</span></span> <span data-ttu-id="7000f-127">您也可以对查询使用 <xref:System.Linq.Enumerable.ToList%2A> 或 <xref:System.Linq.Enumerable.ToArray%2A> 方法以强制立即执行不生成单一实例值的查询。</span><span class="sxs-lookup"><span data-stu-id="7000f-127">You can also use the <xref:System.Linq.Enumerable.ToList%2A> or <xref:System.Linq.Enumerable.ToArray%2A> methods on a query to force immediate execution of a query that does not produce a singleton value.</span></span> <span data-ttu-id="7000f-128">当想要缓存查询结果时，这些强制立即执行的技术可能会很有用。</span><span class="sxs-lookup"><span data-stu-id="7000f-128">These techniques to force immediate execution can be useful when you want to cache the results of a query.</span></span>
  
## <a name="queries"></a><span data-ttu-id="7000f-129">查询</span><span class="sxs-lookup"><span data-stu-id="7000f-129">Queries</span></span>  
 [!INCLUDE[linq_dataset](../../../../includes/linq-dataset-md.md)] <span data-ttu-id="7000f-130">查询可以在两个不同的语法进行表述： 查询表达式语法和基于方法的查询语法。</span><span class="sxs-lookup"><span data-stu-id="7000f-130">queries can be formulated in two different syntaxes: query expression syntax and method-based query syntax.</span></span>  
  
### <a name="query-expression-syntax"></a><span data-ttu-id="7000f-131">查询表达式语法</span><span class="sxs-lookup"><span data-stu-id="7000f-131">Query Expression Syntax</span></span>  
 <span data-ttu-id="7000f-132">查询表达式是一种声明性查询语法。</span><span class="sxs-lookup"><span data-stu-id="7000f-132">Query expressions are a declarative query syntax.</span></span> <span data-ttu-id="7000f-133">此语法使开发人员能够以类似于 SQL 的格式用 C# 或 Visual Basic 编写查询。</span><span class="sxs-lookup"><span data-stu-id="7000f-133">This syntax enables a developer to write queries in C# or Visual Basic in a format similar to SQL.</span></span> <span data-ttu-id="7000f-134">通过使用查询表达式语法，你可以用最少的代码对数据源执行复杂的筛选、排序和分组操作。</span><span class="sxs-lookup"><span data-stu-id="7000f-134">By using query expression syntax, you can perform even complex filtering, ordering, and grouping operations on data sources with minimal code.</span></span> <span data-ttu-id="7000f-135">有关详细信息，请参阅[LINQ 查询表达式](../../../csharp/linq/index.md#query-expression-overview)并[基本查询操作 (Visual Basic)](../../../visual-basic/programming-guide/concepts/linq/basic-query-operations.md)。</span><span class="sxs-lookup"><span data-stu-id="7000f-135">For more information, see [LINQ Query Expressions](../../../csharp/linq/index.md#query-expression-overview) and [Basic Query Operations (Visual Basic)](../../../visual-basic/programming-guide/concepts/linq/basic-query-operations.md).</span></span>
  
 <span data-ttu-id="7000f-136">查询表达式语法是 C# 3.0 和 [!INCLUDE[vb_orcas_long](../../../../includes/vb-orcas-long-md.md)] 中的新功能。</span><span class="sxs-lookup"><span data-stu-id="7000f-136">Query expression syntax is new in C# 3.0 and [!INCLUDE[vb_orcas_long](../../../../includes/vb-orcas-long-md.md)].</span></span> <span data-ttu-id="7000f-137">不过，[!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] 公共语言运行库 (CLR) 无法读取查询表达式语法本身。</span><span class="sxs-lookup"><span data-stu-id="7000f-137">However, the [!INCLUDE[dnprdnshort](../../../../includes/dnprdnshort-md.md)] common language runtime (CLR) cannot read the query expression syntax itself.</span></span> <span data-ttu-id="7000f-138">因此，在编译时，查询表达式将转换为 CLR 能理解的形式，即方法调用。</span><span class="sxs-lookup"><span data-stu-id="7000f-138">Therefore, at compile time, query expressions are translated to something that the CLR does understand: method calls.</span></span> <span data-ttu-id="7000f-139">这些方法称为“标准查询运算符”。</span><span class="sxs-lookup"><span data-stu-id="7000f-139">These methods are referred to as the *standard query operators*.</span></span> <span data-ttu-id="7000f-140">作为开发人员，您可以选择使用方法语法而不使用查询语法直接调用这些方法。</span><span class="sxs-lookup"><span data-stu-id="7000f-140">As a developer, you have the option of calling them directly by using method syntax, instead of using query syntax.</span></span> <span data-ttu-id="7000f-141">有关详细信息，请参阅 [LINQ 中的查询语法和方法语法](~/docs/csharp/programming-guide/concepts/linq/query-syntax-and-method-syntax-in-linq.md)。</span><span class="sxs-lookup"><span data-stu-id="7000f-141">For more information, see [Query Syntax and Method Syntax in LINQ](~/docs/csharp/programming-guide/concepts/linq/query-syntax-and-method-syntax-in-linq.md).</span></span> <span data-ttu-id="7000f-142">有关标准查询运算符的详细信息，请参阅[标准查询运算符概述](../../../csharp/programming-guide/concepts/linq/standard-query-operators-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="7000f-142">For more information about the standard query operators, see [Standard Query Operators Overview](../../../csharp/programming-guide/concepts/linq/standard-query-operators-overview.md).</span></span>  
  
 <span data-ttu-id="7000f-143">下面的示例使用 <xref:System.Linq.Enumerable.Select%2A> 返回 `Product` 表中的所有行并显示产品名称。</span><span class="sxs-lookup"><span data-stu-id="7000f-143">The following example uses <xref:System.Linq.Enumerable.Select%2A> to return all the rows from `Product` table and display the product names.</span></span>  
  
 [!code-csharp[DP LINQ to DataSet Examples#SelectSimple1](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/CS/Program.cs#selectsimple1)]
 [!code-vb[DP LINQ to DataSet Examples#SelectSimple1](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/VB/Module1.vb#selectsimple1)]  
  
### <a name="method-based-query-syntax"></a><span data-ttu-id="7000f-144">基于方法的查询语法</span><span class="sxs-lookup"><span data-stu-id="7000f-144">Method-Based Query Syntax</span></span>  
 <span data-ttu-id="7000f-145">表述 [!INCLUDE[linq_dataset](../../../../includes/linq-dataset-md.md)] 查询的另一种方法是使用基于方法的查询。</span><span class="sxs-lookup"><span data-stu-id="7000f-145">The other way to formulate [!INCLUDE[linq_dataset](../../../../includes/linq-dataset-md.md)] queries is by using method-based queries.</span></span> <span data-ttu-id="7000f-146">基于方法的查询语法是对 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 运算符方法的一系列直接方法调用，将 Lambda 表达式作为参数进行传递。</span><span class="sxs-lookup"><span data-stu-id="7000f-146">The method-based query syntax is a sequence of direct method calls to [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] operator methods, passing lambda expressions as the parameters.</span></span> <span data-ttu-id="7000f-147">有关详细信息，请参阅 [Lambda 表达式](~/docs/csharp/programming-guide/statements-expressions-operators/lambda-expressions.md)。</span><span class="sxs-lookup"><span data-stu-id="7000f-147">For more information, see [Lambda Expressions](~/docs/csharp/programming-guide/statements-expressions-operators/lambda-expressions.md).</span></span>  
  
 <span data-ttu-id="7000f-148">此示例使用 <xref:System.Linq.Enumerable.Select%2A> 返回 `Product` 中的所有行并显示产品名称。</span><span class="sxs-lookup"><span data-stu-id="7000f-148">This example uses <xref:System.Linq.Enumerable.Select%2A> to return all the rows from `Product` and display the product names.</span></span>  
  
 [!code-csharp[DP LINQ to DataSet Examples#SelectAnonymousTypes_MQ](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/CS/Program.cs#selectanonymoustypes_mq)]
 [!code-vb[DP LINQ to DataSet Examples#SelectAnonymousTypes_MQ](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/VB/Module1.vb#selectanonymoustypes_mq)]  
  
## <a name="composing-queries"></a><span data-ttu-id="7000f-149">编写查询</span><span class="sxs-lookup"><span data-stu-id="7000f-149">Composing Queries</span></span>  
 <span data-ttu-id="7000f-150">如本主题前面所述，当查询旨在返回一系列值时，查询变量本身只存储查询命令。</span><span class="sxs-lookup"><span data-stu-id="7000f-150">As mentioned earlier in this topic, the query variable itself only stores the query commands when the query is designed to return a sequence of values.</span></span> <span data-ttu-id="7000f-151">如果查询不包含可使查询立即执行的方法，则查询的实际执行将会推迟，直到在 `foreach` 或 `For Each` 循环中循环访问查询变量。</span><span class="sxs-lookup"><span data-stu-id="7000f-151">If the query does not contain a method that will cause immediate execution, the actual execution of the query is deferred until you iterate over the query variable in a `foreach` or `For Each` loop.</span></span> <span data-ttu-id="7000f-152">延迟执行可使多个查询组合在一起或使查询得到扩展。</span><span class="sxs-lookup"><span data-stu-id="7000f-152">Deferred execution enables multiple queries to be combined or a query to be extended.</span></span> <span data-ttu-id="7000f-153">扩展查询时，将修改查询以包括新操作，最终执行将反映这些更改。</span><span class="sxs-lookup"><span data-stu-id="7000f-153">When a query is extended, it is modified to include the new operations, and the eventual execution will reflect the changes.</span></span> <span data-ttu-id="7000f-154">在下面的示例中，第一个查询返回所有产品。</span><span class="sxs-lookup"><span data-stu-id="7000f-154">In the following example, the first query returns all the products.</span></span> <span data-ttu-id="7000f-155">第二个查询通过使用 `Where` 扩展第一个查询，以返回大小为“L”的所有产品：</span><span class="sxs-lookup"><span data-stu-id="7000f-155">The second query extends the first by using `Where` to return all the products of size "L":</span></span>  
  
 [!code-csharp[DP LINQ to DataSet Examples#Composing](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/CS/Program.cs#composing)]
 [!code-vb[DP LINQ to DataSet Examples#Composing](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/VB/Module1.vb#composing)]  
  
 <span data-ttu-id="7000f-156">执行一个查询后，不会再编写其他查询，并且所有后续查询都将使用驻留在内存中的 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 运算符。</span><span class="sxs-lookup"><span data-stu-id="7000f-156">After a query has been executed, no additional queries can be composed, and all subsequent queries will use the in-memory [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] operators.</span></span> <span data-ttu-id="7000f-157">当在 `foreach` 或 `For Each` 语句中循环访问查询变量或通过调用可导致立即执行的 [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] 转换运算符之一时，查询将会开始执行。</span><span class="sxs-lookup"><span data-stu-id="7000f-157">Query execution will occur when you iterate over the query variable in a `foreach` or `For Each` statement, or by a call to one of the [!INCLUDE[vbteclinq](../../../../includes/vbteclinq-md.md)] conversion operators that cause immediate execution.</span></span> <span data-ttu-id="7000f-158">这些运算符包括：<xref:System.Linq.Enumerable.ToList%2A>、<xref:System.Linq.Enumerable.ToArray%2A>、<xref:System.Linq.Enumerable.ToLookup%2A> 和 <xref:System.Linq.Enumerable.ToDictionary%2A>。</span><span class="sxs-lookup"><span data-stu-id="7000f-158">These operators include the following: <xref:System.Linq.Enumerable.ToList%2A>, <xref:System.Linq.Enumerable.ToArray%2A>, <xref:System.Linq.Enumerable.ToLookup%2A>, and <xref:System.Linq.Enumerable.ToDictionary%2A>.</span></span>  
  
 <span data-ttu-id="7000f-159">在下面的示例中，第一个查询返回按定价排序的所有产品。</span><span class="sxs-lookup"><span data-stu-id="7000f-159">In the following example, the first query returns all the products ordered by list price.</span></span> <span data-ttu-id="7000f-160"><xref:System.Linq.Enumerable.ToArray%2A> 方法用于强制立即执行查询：</span><span class="sxs-lookup"><span data-stu-id="7000f-160">The <xref:System.Linq.Enumerable.ToArray%2A> method is used to force immediate query execution:</span></span>  
  
 [!code-csharp[DP LINQ to DataSet Examples#ToArray2](../../../../samples/snippets/csharp/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/CS/Program.cs#toarray2)]
 [!code-vb[DP LINQ to DataSet Examples#ToArray2](../../../../samples/snippets/visualbasic/VS_Snippets_ADO.NET/DP LINQ to DataSet Examples/VB/Module1.vb#toarray2)]  
  
## <a name="see-also"></a><span data-ttu-id="7000f-161">请参阅</span><span class="sxs-lookup"><span data-stu-id="7000f-161">See also</span></span>

- [<span data-ttu-id="7000f-162">编程指南</span><span class="sxs-lookup"><span data-stu-id="7000f-162">Programming Guide</span></span>](../../../../docs/framework/data/adonet/programming-guide-linq-to-dataset.md)
- [<span data-ttu-id="7000f-163">查询数据集</span><span class="sxs-lookup"><span data-stu-id="7000f-163">Querying DataSets</span></span>](../../../../docs/framework/data/adonet/querying-datasets-linq-to-dataset.md)
- [<span data-ttu-id="7000f-164">C# 中的 LINQ 入门</span><span class="sxs-lookup"><span data-stu-id="7000f-164">Getting Started with LINQ in C#</span></span>](~/docs/csharp/programming-guide/concepts/linq/getting-started-with-linq.md)
- [<span data-ttu-id="7000f-165">Visual Basic 中的 LINQ 入门</span><span class="sxs-lookup"><span data-stu-id="7000f-165">Getting Started with LINQ in Visual Basic</span></span>](~/docs/visual-basic/programming-guide/concepts/linq/getting-started-with-linq.md)
