---
title: Serialization2
ms.date: 03/30/2017
dev_langs:
- csharp
- vb
ms.assetid: a15ae411-8dc2-4ca3-84d2-01c9d5f1972a
ms.openlocfilehash: b6778522b5757c0ece899f7465d3ab500038fc49
ms.sourcegitcommit: 9b552addadfb57fab0b9e7852ed4f1f1b8a42f8e
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/23/2019
ms.locfileid: "62037032"
---
# <a name="serialization"></a><span data-ttu-id="65393-102">序列化</span><span class="sxs-lookup"><span data-stu-id="65393-102">Serialization</span></span>
<span data-ttu-id="65393-103">本主题介绍[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]序列化功能。</span><span class="sxs-lookup"><span data-stu-id="65393-103">This topic describes [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] serialization capabilities.</span></span> <span data-ttu-id="65393-104">下面几段提供了有关在设计时如何在代码生成期间添加序列化以及 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] 类的运行时序列化行为的信息。</span><span class="sxs-lookup"><span data-stu-id="65393-104">The paragraphs that follow provide information about how to add serialization during code generation at design time and the run-time serialization behavior of [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] classes.</span></span>  
  
 <span data-ttu-id="65393-105">您可以通过以下任一方法在设计时添加序列化代码：</span><span class="sxs-lookup"><span data-stu-id="65393-105">You can add serialization code at design time by either of the following methods:</span></span>  
  
- <span data-ttu-id="65393-106">在中[!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)]，更改**序列化模式**属性设置为**Unidirectional**。</span><span class="sxs-lookup"><span data-stu-id="65393-106">In the [!INCLUDE[vs_ordesigner_long](../../../../../../includes/vs-ordesigner-long-md.md)], change the **Serialization Mode** property to **Unidirectional**.</span></span>  
  
- <span data-ttu-id="65393-107">在 SQLMetal 命令行中，添加 **/serialization**选项。</span><span class="sxs-lookup"><span data-stu-id="65393-107">On the SQLMetal command line, add the **/serialization** option.</span></span> <span data-ttu-id="65393-108">有关详细信息，请参阅 [SqlMetal.exe（代码生成工具）](../../../../../../docs/framework/tools/sqlmetal-exe-code-generation-tool.md)。</span><span class="sxs-lookup"><span data-stu-id="65393-108">For more information, see [SqlMetal.exe (Code Generation Tool)](../../../../../../docs/framework/tools/sqlmetal-exe-code-generation-tool.md).</span></span>  
  
## <a name="overview"></a><span data-ttu-id="65393-109">概述</span><span class="sxs-lookup"><span data-stu-id="65393-109">Overview</span></span>  
 <span data-ttu-id="65393-110">生成的代码[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)]默认情况下提供延迟的加载功能。</span><span class="sxs-lookup"><span data-stu-id="65393-110">The code generated by [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] provides deferred loading capabilities by default.</span></span> <span data-ttu-id="65393-111">延迟加载对在中间层以透明方式根据需要加载数据而言非常方便。</span><span class="sxs-lookup"><span data-stu-id="65393-111">Deferred loading is very convenient on the mid-tier for transparent loading of data on demand.</span></span> <span data-ttu-id="65393-112">但是，它会给序列化过程带来问题，原因是不论是否需要进行延迟加载，序列化程序都会触发延迟加载。</span><span class="sxs-lookup"><span data-stu-id="65393-112">However, it is problematic for serialization, because the serializer triggers deferred loading whether deferred loading is intended or not.</span></span> <span data-ttu-id="65393-113">实际上，对对象进行序列化时，会对其在所有出站延迟加载引用下的可传递闭包进行序列化。</span><span class="sxs-lookup"><span data-stu-id="65393-113">In effect, when an object is serialized, its transitive closure under all outbound defer-loaded references is serialized.</span></span>  
  
 <span data-ttu-id="65393-114">[!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] 的序列化功能主要通过以下两种机制来解决此问题：</span><span class="sxs-lookup"><span data-stu-id="65393-114">The [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] serialization feature addresses this problem, primarily through two mechanisms:</span></span>  
  
- <span data-ttu-id="65393-115">用于关闭延迟加载的 <xref:System.Data.Linq.DataContext> 模式 (<xref:System.Data.Linq.DataContext.ObjectTrackingEnabled%2A>)。</span><span class="sxs-lookup"><span data-stu-id="65393-115">A <xref:System.Data.Linq.DataContext> mode for turning off deferred loading (<xref:System.Data.Linq.DataContext.ObjectTrackingEnabled%2A>).</span></span> <span data-ttu-id="65393-116">有关详细信息，请参阅 <xref:System.Data.Linq.DataContext>。</span><span class="sxs-lookup"><span data-stu-id="65393-116">For more information, see <xref:System.Data.Linq.DataContext>.</span></span>  
  
- <span data-ttu-id="65393-117">用于在生成的实体中生成 <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> 和 <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> 属性的代码生成开关。</span><span class="sxs-lookup"><span data-stu-id="65393-117">A code-generation switch to generate <xref:System.Runtime.Serialization.DataContractAttribute?displayProperty=nameWithType> and <xref:System.Runtime.Serialization.DataMemberAttribute?displayProperty=nameWithType> attributes on generated entities.</span></span> <span data-ttu-id="65393-118">这方面（包括处于序列化过程中的延迟加载类的行为）是本主题的主要介绍对象。</span><span class="sxs-lookup"><span data-stu-id="65393-118">This aspect, including the behavior of defer-loading classes under serialization, is the major subject of this topic.</span></span>  
  
### <a name="definitions"></a><span data-ttu-id="65393-119">定义</span><span class="sxs-lookup"><span data-stu-id="65393-119">Definitions</span></span>  
  
- <span data-ttu-id="65393-120">*DataContract 序列化程序*:默认序列化程序使用的.NET Framework 3.0 或更高版本的 Windows Communication Framework (WCF) 组件。</span><span class="sxs-lookup"><span data-stu-id="65393-120">*DataContract serializer*: Default serializer used by the Windows Communication Framework (WCF) component of the .NET Framework 3.0 or later versions.</span></span>  
  
- <span data-ttu-id="65393-121">*单向序列化*:只包含单向关联属性 （为避免出现循环） 类的序列化的版本。</span><span class="sxs-lookup"><span data-stu-id="65393-121">*Unidirectional serialization*: The serialized version of a class that contains only a one-way association property (to avoid a cycle).</span></span> <span data-ttu-id="65393-122">按照约定，主键-外键关系的父级端的属性标记为序列化。</span><span class="sxs-lookup"><span data-stu-id="65393-122">By convention, the property on the parent side of a primary-foreign key relationship is marked for serialization.</span></span> <span data-ttu-id="65393-123">双向关联中的另一端不进行序列化。</span><span class="sxs-lookup"><span data-stu-id="65393-123">The other side in a bidirectional association is not serialized.</span></span>  
  
     <span data-ttu-id="65393-124">单向序列化是 [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)] 支持的唯一一种序列化。</span><span class="sxs-lookup"><span data-stu-id="65393-124">Unidirectional serialization is the only type of serialization supported by [!INCLUDE[vbtecdlinq](../../../../../../includes/vbtecdlinq-md.md)].</span></span>  
  
## <a name="code-example"></a><span data-ttu-id="65393-125">代码示例</span><span class="sxs-lookup"><span data-stu-id="65393-125">Code Example</span></span>  
 <span data-ttu-id="65393-126">下面的代码使用 Northwind 示例数据库中的传统 `Customer` 和 `Order` 类，并演示了如何用序列化属性修饰这些类。</span><span class="sxs-lookup"><span data-stu-id="65393-126">The following code uses the traditional `Customer` and `Order` classes from the Northwind sample database, and shows how these classes are decorated with serialization attributes.</span></span>  
  
 [!code-csharp[DLinqSerialization#1](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#1)]
 [!code-vb[DLinqSerialization#1](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#1)]  
  
 [!code-csharp[DLinqSerialization#2](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#2)]
 [!code-vb[DLinqSerialization#2](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#2)]  
  
 [!code-csharp[DLinqSerialization#3](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#3)]
 [!code-vb[DLinqSerialization#3](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#3)]  
  
 <span data-ttu-id="65393-127">对于下例中的 `Order` 类，为简洁起见，只显示与 `Customer` 类对应的反向关联属性。</span><span class="sxs-lookup"><span data-stu-id="65393-127">For the `Order` class in the following example, only the reverse association property corresponding to the `Customer` class is shown for brevity.</span></span> <span data-ttu-id="65393-128">它没有用来避免出现循环的 <xref:System.Runtime.Serialization.DataMemberAttribute> 属性。</span><span class="sxs-lookup"><span data-stu-id="65393-128">It does not have a <xref:System.Runtime.Serialization.DataMemberAttribute> attribute to avoid a cycle.</span></span>  
  
 [!code-csharp[DLinqSerialization#4](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#4)]
 [!code-vb[DLinqSerialization#4](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#4)]  
  
 [!code-csharp[DLinqSerialization#5](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#5)]
 [!code-vb[DLinqSerialization#5](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#5)]  
  
### <a name="how-to-serialize-the-entities"></a><span data-ttu-id="65393-129">如何序列化实体</span><span class="sxs-lookup"><span data-stu-id="65393-129">How to Serialize the Entities</span></span>  
 <span data-ttu-id="65393-130">你可以按如下方式序列化上一节中显示的代码中的实体：</span><span class="sxs-lookup"><span data-stu-id="65393-130">You can serialize the entities in the codes shown in the previous section as follows;</span></span>  
  
 [!code-csharp[DLinqSerialization#6](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/Program.cs#6)]
 [!code-vb[DLinqSerialization#6](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/Module1.vb#6)]  
  
### <a name="self-recursive-relationships"></a><span data-ttu-id="65393-131">自递归关系</span><span class="sxs-lookup"><span data-stu-id="65393-131">Self-Recursive Relationships</span></span>  
 <span data-ttu-id="65393-132">自递归关系遵循相同的模式。</span><span class="sxs-lookup"><span data-stu-id="65393-132">Self-recursive relationships follow the same pattern.</span></span> <span data-ttu-id="65393-133">与外键对应的关联属性 (Property) 不具有 <xref:System.Runtime.Serialization.DataMemberAttribute> 属性 (Attribute)，而父属性 (Property) 则具有。</span><span class="sxs-lookup"><span data-stu-id="65393-133">The association property corresponding to the foreign key does not have a <xref:System.Runtime.Serialization.DataMemberAttribute> attribute, whereas the parent property does.</span></span>  
  
 <span data-ttu-id="65393-134">请考虑以下具有两个自递归关系的类：Employee.manager/reports 和 employee.mentor /。</span><span class="sxs-lookup"><span data-stu-id="65393-134">Consider the following class that has two self-recursive relationships: Employee.Manager/Reports and Employee.Mentor/Mentees.</span></span>  
  
 [!code-csharp[DLinqSerialization#7](../../../../../../samples/snippets/csharp/VS_Snippets_Data/DLinqSerialization/cs/northwind-ser.cs#7)]
 [!code-vb[DLinqSerialization#7](../../../../../../samples/snippets/visualbasic/VS_Snippets_Data/DLinqSerialization/vb/northwind-ser.vb#7)]  
  
## <a name="see-also"></a><span data-ttu-id="65393-135">请参阅</span><span class="sxs-lookup"><span data-stu-id="65393-135">See also</span></span>

- [<span data-ttu-id="65393-136">背景信息</span><span class="sxs-lookup"><span data-stu-id="65393-136">Background Information</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/background-information.md)
- [<span data-ttu-id="65393-137">SqlMetal.exe（代码生成工具）</span><span class="sxs-lookup"><span data-stu-id="65393-137">SqlMetal.exe (Code Generation Tool)</span></span>](../../../../../../docs/framework/tools/sqlmetal-exe-code-generation-tool.md)
- [<span data-ttu-id="65393-138">如何：使实体可序列化</span><span class="sxs-lookup"><span data-stu-id="65393-138">How to: Make Entities Serializable</span></span>](../../../../../../docs/framework/data/adonet/sql/linq/how-to-make-entities-serializable.md)
