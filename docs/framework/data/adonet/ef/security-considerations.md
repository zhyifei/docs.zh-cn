---
title: 安全注意事项（实体框架）
ms.date: 03/30/2017
ms.assetid: 84758642-9b72-4447-86f9-f831fef46962
ms.openlocfilehash: d9adf4ed9e340ff589117f160e370c7d1595a207
ms.sourcegitcommit: ad800f019ac976cb669e635fb0ea49db740e6890
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 10/29/2019
ms.locfileid: "73039868"
---
# <a name="security-considerations-entity-framework"></a><span data-ttu-id="0a72f-102">安全注意事项（实体框架）</span><span class="sxs-lookup"><span data-stu-id="0a72f-102">Security Considerations (Entity Framework)</span></span>
<span data-ttu-id="0a72f-103">本主题介绍特定于开发、部署和运行实体框架应用程序的安全注意事项。</span><span class="sxs-lookup"><span data-stu-id="0a72f-103">This topic describes security considerations that are specific to developing, deploying, and running Entity Framework applications.</span></span> <span data-ttu-id="0a72f-104">还应遵循创建安全 .NET Framework 应用程序的建议。</span><span class="sxs-lookup"><span data-stu-id="0a72f-104">You should also follow recommendations for creating secure .NET Framework applications.</span></span> <span data-ttu-id="0a72f-105">有关详细信息，请参阅[安全性概述](../security-overview.md)。</span><span class="sxs-lookup"><span data-stu-id="0a72f-105">For more information, see [Security Overview](../security-overview.md).</span></span>  
  
## <a name="general-security-considerations"></a><span data-ttu-id="0a72f-106">一般安全注意事项</span><span class="sxs-lookup"><span data-stu-id="0a72f-106">General Security Considerations</span></span>  
 <span data-ttu-id="0a72f-107">以下安全注意事项适用于所有使用实体框架的应用程序。</span><span class="sxs-lookup"><span data-stu-id="0a72f-107">The following security considerations apply to all applications that use the Entity Framework.</span></span>  
  
#### <a name="use-only-trusted-data-source-providers"></a><span data-ttu-id="0a72f-108">仅使用可信的数据源提供程序。</span><span class="sxs-lookup"><span data-stu-id="0a72f-108">Use only trusted data source providers.</span></span>  
 <span data-ttu-id="0a72f-109">若要与数据源通信，提供程序必须执行下列操作：</span><span class="sxs-lookup"><span data-stu-id="0a72f-109">To communicate with the data source, a provider must do the following:</span></span>  
  
- <span data-ttu-id="0a72f-110">接收来自实体框架的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="0a72f-110">Receive the connection string from the Entity Framework.</span></span>  
  
- <span data-ttu-id="0a72f-111">将命令目录树转换为数据源的本机查询语言。</span><span class="sxs-lookup"><span data-stu-id="0a72f-111">Translate the command tree to the data source's native query language.</span></span>  
  
- <span data-ttu-id="0a72f-112">组合并返回结果集。</span><span class="sxs-lookup"><span data-stu-id="0a72f-112">Assemble and return result sets.</span></span>  
  
 <span data-ttu-id="0a72f-113">在登录操作过程中，将通过基础数据源的网络库将基于用户密码的信息传递给服务器。</span><span class="sxs-lookup"><span data-stu-id="0a72f-113">During the logon operation, information that is based on the user password is passed to the server through the network libraries of the underlying data source.</span></span> <span data-ttu-id="0a72f-114">恶意提供程序可能窃取用户凭据，生成恶意查询或篡改结果集。</span><span class="sxs-lookup"><span data-stu-id="0a72f-114">A malicious provider can steal user credentials, generate malicious queries, or tamper with the result set.</span></span>  
  
#### <a name="encrypt-your-connection-to-protect-sensitive-data"></a><span data-ttu-id="0a72f-115">对连接进行加密以保护敏感数据。</span><span class="sxs-lookup"><span data-stu-id="0a72f-115">Encrypt your connection to protect sensitive data.</span></span>  
 <span data-ttu-id="0a72f-116">实体框架不会直接处理数据加密。</span><span class="sxs-lookup"><span data-stu-id="0a72f-116">The Entity Framework does not directly handle data encryption.</span></span> <span data-ttu-id="0a72f-117">如果用户通过公共网络访问数据，应用程序应建立到数据源的加密连接以提高安全性。</span><span class="sxs-lookup"><span data-stu-id="0a72f-117">If users access data over a public network, your application should establish an encrypted connection to the data source to increase security.</span></span> <span data-ttu-id="0a72f-118">有关详细信息，请参见关于您所用数据源的安全性方面的文档。</span><span class="sxs-lookup"><span data-stu-id="0a72f-118">For more information, see the security-related documentation for your data source.</span></span> <span data-ttu-id="0a72f-119">有关 SQL Server 数据源，请参阅[加密到 SQL Server 的连接](https://go.microsoft.com/fwlink/?LinkId=119544)。</span><span class="sxs-lookup"><span data-stu-id="0a72f-119">For a SQL Server data source, see [Encrypting Connections to SQL Server](https://go.microsoft.com/fwlink/?LinkId=119544).</span></span>  
  
#### <a name="secure-the-connection-string"></a><span data-ttu-id="0a72f-120">保护连接字符串。</span><span class="sxs-lookup"><span data-stu-id="0a72f-120">Secure the connection string.</span></span>  
 <span data-ttu-id="0a72f-121">保护应用程序时，最重要的目标之一是保护对数据源的访问。</span><span class="sxs-lookup"><span data-stu-id="0a72f-121">Protecting access to your data source is one of the most important goals when securing an application.</span></span> <span data-ttu-id="0a72f-122">不受保护或构造不当的连接字符串会构成潜在的安全漏洞。</span><span class="sxs-lookup"><span data-stu-id="0a72f-122">A connection string presents a potential vulnerability if it is not secured or if it is improperly constructed.</span></span> <span data-ttu-id="0a72f-123">如果以纯文本形式存储连接信息或者将其保留在内存中，则可能危及整个系统的安全。</span><span class="sxs-lookup"><span data-stu-id="0a72f-123">When you store connection information in plain text or persist it in memory, you risk compromising your entire system.</span></span> <span data-ttu-id="0a72f-124">建议采用以下方法保护连接字符串：</span><span class="sxs-lookup"><span data-stu-id="0a72f-124">The following are the recommended methods for securing connection strings:</span></span>  
  
- <span data-ttu-id="0a72f-125">对 SQL Server 数据源使用 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="0a72f-125">Use Windows Authentication with a SQL Server data source.</span></span>  
  
     <span data-ttu-id="0a72f-126">如果使用 Windows 身份验证连接到 SQL Server 数据源，则连接字符串不包含登录和密码信息。</span><span class="sxs-lookup"><span data-stu-id="0a72f-126">When you use Windows Authentication to connect to a SQL Server data source, the connection string does not contain logon and password information.</span></span>  
  
- <span data-ttu-id="0a72f-127">使用受保护的配置加密配置文件节。</span><span class="sxs-lookup"><span data-stu-id="0a72f-127">Encrypt configuration file sections using protected configuration.</span></span>  
  
     <span data-ttu-id="0a72f-128">ASP.NET 提供了一项称为“受保护配置”的功能，您可以使用此功能对配置文件中的敏感信息进行加密。</span><span class="sxs-lookup"><span data-stu-id="0a72f-128">ASP.NET provides a feature called protected configuration that enables you to encrypt sensitive information in a configuration file.</span></span> <span data-ttu-id="0a72f-129">虽然受保护配置主要是为 ASP.NET 设计的，但您也可以使用该功能对 Windows 应用程序中的配置文件节进行加密。</span><span class="sxs-lookup"><span data-stu-id="0a72f-129">Although primarily designed for ASP.NET, you can also use protected configuration to encrypt sections of configuration files in Windows applications.</span></span> <span data-ttu-id="0a72f-130">有关新的受保护配置功能的详细说明，请参阅[使用受保护的配置加密配置信息](https://docs.microsoft.com/previous-versions/aspnet/53tyfkaw(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="0a72f-130">For a detailed description of the new protected configuration capabilities, see [Encrypting Configuration Information Using Protected Configuration](https://docs.microsoft.com/previous-versions/aspnet/53tyfkaw(v=vs.100)).</span></span>  
  
- <span data-ttu-id="0a72f-131">将连接字符串存储在受保护的配置文件中。</span><span class="sxs-lookup"><span data-stu-id="0a72f-131">Store connection strings in secured configuration files.</span></span>  
  
     <span data-ttu-id="0a72f-132">绝不应在源代码中嵌入连接字符串。</span><span class="sxs-lookup"><span data-stu-id="0a72f-132">You should never embed connection strings in your source code.</span></span> <span data-ttu-id="0a72f-133">你可以在配置文件中存储连接字符串，从而不必将其嵌入到应用程序的代码中。</span><span class="sxs-lookup"><span data-stu-id="0a72f-133">You can store connection strings in configuration files, which eliminates the need to embed them in your application's code.</span></span> <span data-ttu-id="0a72f-134">默认情况下，实体数据模型向导将连接字符串存储在应用程序配置文件中。</span><span class="sxs-lookup"><span data-stu-id="0a72f-134">By default, the Entity Data Model Wizard stores connection strings in the application configuration file.</span></span> <span data-ttu-id="0a72f-135">必须保护此文件，避免未经授权的访问。</span><span class="sxs-lookup"><span data-stu-id="0a72f-135">You must secure this file to prevent unauthorized access.</span></span>  
  
- <span data-ttu-id="0a72f-136">动态创建连接时使用连接字符串生成器。</span><span class="sxs-lookup"><span data-stu-id="0a72f-136">Use connection string builders when dynamically creating connections.</span></span>  
  
     <span data-ttu-id="0a72f-137">如果必须在运行时构造连接字符串，请使用 <xref:System.Data.EntityClient.EntityConnectionStringBuilder> 类。</span><span class="sxs-lookup"><span data-stu-id="0a72f-137">If you must construct connection strings at runtime, use the <xref:System.Data.EntityClient.EntityConnectionStringBuilder> class.</span></span> <span data-ttu-id="0a72f-138">此字符串生成器类可以验证并转义无效的输入信息，从而有助于防止连接字符串注入式攻击。</span><span class="sxs-lookup"><span data-stu-id="0a72f-138">This string builder class helps prevent connection string injection attacks by validating and escaping invalid input information.</span></span> <span data-ttu-id="0a72f-139">有关详细信息，请参阅[如何：生成 EntityConnection 连接字符串](how-to-build-an-entityconnection-connection-string.md)。</span><span class="sxs-lookup"><span data-stu-id="0a72f-139">For more information, see [How to: Build an EntityConnection Connection String](how-to-build-an-entityconnection-connection-string.md).</span></span> <span data-ttu-id="0a72f-140">还应使用适当的字符串生成器类构造作为实体框架连接字符串一部分的数据源连接字符串。</span><span class="sxs-lookup"><span data-stu-id="0a72f-140">Also use the appropriate string builder class to construct the data source connection string that is part of the Entity Framework connection string.</span></span> <span data-ttu-id="0a72f-141">有关 ADO.NET 提供程序的连接字符串生成器的信息，请参阅[连接字符串生成器](../connection-string-builders.md)。</span><span class="sxs-lookup"><span data-stu-id="0a72f-141">For information about connection string builders for ADO.NET providers, see [Connection String Builders](../connection-string-builders.md).</span></span>  
  
 <span data-ttu-id="0a72f-142">有关详细信息，请参阅[保护连接信息](../protecting-connection-information.md)。</span><span class="sxs-lookup"><span data-stu-id="0a72f-142">For more information, see [Protecting Connection Information](../protecting-connection-information.md).</span></span>  
  
#### <a name="do-not-expose-an-entityconnection-to-untrusted-users"></a><span data-ttu-id="0a72f-143">不要向不可信用户公开 EntityConnection。</span><span class="sxs-lookup"><span data-stu-id="0a72f-143">Do not expose an EntityConnection to untrusted users.</span></span>  
 <span data-ttu-id="0a72f-144"><xref:System.Data.EntityClient.EntityConnection> 对象公开基础连接的连接字符串。</span><span class="sxs-lookup"><span data-stu-id="0a72f-144">An <xref:System.Data.EntityClient.EntityConnection> object exposes the connection string of the underlying connection.</span></span> <span data-ttu-id="0a72f-145">有权访问 <xref:System.Data.EntityClient.EntityConnection> 对象的用户也可以更改基础连接的 <xref:System.Data.ConnectionState>。</span><span class="sxs-lookup"><span data-stu-id="0a72f-145">A user with access to an <xref:System.Data.EntityClient.EntityConnection> object can also change the <xref:System.Data.ConnectionState> of the underlying connection.</span></span> <span data-ttu-id="0a72f-146"><xref:System.Data.EntityClient.EntityConnection> 类不是线程安全的。</span><span class="sxs-lookup"><span data-stu-id="0a72f-146">The <xref:System.Data.EntityClient.EntityConnection> class is not thread safe.</span></span>  
  
#### <a name="do-not-pass-connections-outside-the-security-context"></a><span data-ttu-id="0a72f-147">不要在安全上下文以外传递连接。</span><span class="sxs-lookup"><span data-stu-id="0a72f-147">Do not pass connections outside the security context.</span></span>  
 <span data-ttu-id="0a72f-148">连接建立后，切勿在安全上下文以外传递它。</span><span class="sxs-lookup"><span data-stu-id="0a72f-148">After a connection has been established, you must not pass it outside the security context.</span></span> <span data-ttu-id="0a72f-149">例如，有权打开连接的线程不应将连接存储在全局位置。</span><span class="sxs-lookup"><span data-stu-id="0a72f-149">For example, one thread with permission to open a connection should not store the connection in a global location.</span></span> <span data-ttu-id="0a72f-150">如果连接位于全局位置，则其他恶意线程无需显式授权便可使用该打开的连接。</span><span class="sxs-lookup"><span data-stu-id="0a72f-150">If the connection is available in a global location, then another malicious thread can use the open connection without having that permission explicitly granted to it.</span></span>  
  
#### <a name="be-aware-that-logon-information-and-passwords-may-be-visible-in-a-memory-dump"></a><span data-ttu-id="0a72f-151">请注意，登录信息和密码可能在内存转储中是可见的。</span><span class="sxs-lookup"><span data-stu-id="0a72f-151">Be aware that logon information and passwords may be visible in a memory dump.</span></span>  
 <span data-ttu-id="0a72f-152">如果在连接字符串中提供数据源登录和密码信息，那么在垃圾回收机制回收这些资源之前，这些信息将一直保留在内存中。</span><span class="sxs-lookup"><span data-stu-id="0a72f-152">When data source logon and password information is supplied in the connection string, this information is maintained in memory until garbage collection reclaims the resources.</span></span> <span data-ttu-id="0a72f-153">这样，就无法确定密码字符串何时从内存中消失。</span><span class="sxs-lookup"><span data-stu-id="0a72f-153">This makes it impossible to determine when a password string is no longer in memory.</span></span> <span data-ttu-id="0a72f-154">如果应用程序崩溃，内存转储文件中有可能包含敏感的安全信息，而运行该应用程序的用户以及对计算机拥有管理员权限的任何用户都可以查看内存转储文件。</span><span class="sxs-lookup"><span data-stu-id="0a72f-154">If an application crashes, a memory dump file may contain sensitive security information, and the user running the application and any user with administrative access to the computer can view the memory dump file.</span></span> <span data-ttu-id="0a72f-155">请为到 Microsoft SQL Server 的连接使用 Windows 身份验证。</span><span class="sxs-lookup"><span data-stu-id="0a72f-155">Use Windows Authentication for connections to Microsoft SQL Server.</span></span>  
  
#### <a name="grant-users-only-the-necessary-permissions-in-the-data-source"></a><span data-ttu-id="0a72f-156">仅授予用户数据源的必要权限。</span><span class="sxs-lookup"><span data-stu-id="0a72f-156">Grant users only the necessary permissions in the data source.</span></span>  
 <span data-ttu-id="0a72f-157">数据源管理员应仅向用户授予必要的权限。</span><span class="sxs-lookup"><span data-stu-id="0a72f-157">A data source administrator should grant only the necessary permissions to users.</span></span> <span data-ttu-id="0a72f-158">尽管 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 不支持修改数据的 DML 语句（如 INSERT、UPDATE 或 DELETE），但用户仍可以访问到数据源的连接。</span><span class="sxs-lookup"><span data-stu-id="0a72f-158">Even though [!INCLUDE[esql](../../../../../includes/esql-md.md)] does not support DML statements that modify data, such as INSERT, UPDATE, or DELETE, users can still access the connection to the data source.</span></span> <span data-ttu-id="0a72f-159">恶意用户可使用此连接通过数据源的本机语言执行 DML 语句。</span><span class="sxs-lookup"><span data-stu-id="0a72f-159">A malicious user could use this connection to execute DML statements in the native language of the data source.</span></span>  
  
#### <a name="run-applications-with-the-minimum-permissions"></a><span data-ttu-id="0a72f-160">以最低权限运行应用程序。</span><span class="sxs-lookup"><span data-stu-id="0a72f-160">Run applications with the minimum permissions.</span></span>  
 <span data-ttu-id="0a72f-161">如果允许托管应用程序以完全信任权限运行，则 .NET Framework 不会限制应用程序访问您的计算机。</span><span class="sxs-lookup"><span data-stu-id="0a72f-161">When you allow a managed application to run with full-trust permission, the .NET Framework does not limit the application's access to your computer.</span></span> <span data-ttu-id="0a72f-162">这会在应用程序中造成安全漏洞而威胁整个系统。</span><span class="sxs-lookup"><span data-stu-id="0a72f-162">This may enable a security vulnerability in your application to compromise the entire system.</span></span> <span data-ttu-id="0a72f-163">若要在 .NET Framework 中使用代码访问安全性和其他安全机制，你应使用部分信任权限以及允许应用程序正常运行所需的最小权限集来运行应用程序。</span><span class="sxs-lookup"><span data-stu-id="0a72f-163">To use code access security and other security mechanisms in the .NET Framework, you should run applications by using partial-trust permissions and with the minimum set of permissions that are needed to enable the application to function.</span></span> <span data-ttu-id="0a72f-164">以下代码访问权限是实体框架应用程序所需的最低权限：</span><span class="sxs-lookup"><span data-stu-id="0a72f-164">The following code access permissions are the minimum permissions your Entity Framework application needs:</span></span>  
  
- <span data-ttu-id="0a72f-165"><xref:System.Security.Permissions.FileIOPermission>：使用 <xref:System.Security.Permissions.FileIOPermissionAccess.Write> 打开指定的元数据文件，或者使用 <xref:System.Security.Permissions.FileIOPermissionAccess.PathDiscovery> 在目录中搜索元数据文件。</span><span class="sxs-lookup"><span data-stu-id="0a72f-165"><xref:System.Security.Permissions.FileIOPermission>: <xref:System.Security.Permissions.FileIOPermissionAccess.Write> to open the specified metadata files or <xref:System.Security.Permissions.FileIOPermissionAccess.PathDiscovery> to search a directory for metadata files.</span></span>  
  
- <span data-ttu-id="0a72f-166"><xref:System.Security.Permissions.ReflectionPermission>：使用 <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> 支持 LINQ to Entities 查询。</span><span class="sxs-lookup"><span data-stu-id="0a72f-166"><xref:System.Security.Permissions.ReflectionPermission>: <xref:System.Security.Permissions.ReflectionPermissionFlag.RestrictedMemberAccess> to support LINQ to Entities queries.</span></span>  
  
- <span data-ttu-id="0a72f-167"><xref:System.Transactions.DistributedTransactionPermission>：使用 <xref:System.Security.Permissions.PermissionState.Unrestricted> 在 <xref:System.Transactions><xref:System.Transactions.Transaction> 中登记。</span><span class="sxs-lookup"><span data-stu-id="0a72f-167"><xref:System.Transactions.DistributedTransactionPermission>: <xref:System.Security.Permissions.PermissionState.Unrestricted> to enlist in a <xref:System.Transactions><xref:System.Transactions.Transaction>.</span></span>  
  
- <span data-ttu-id="0a72f-168"><xref:System.Security.Permissions.SecurityPermission>：使用 <xref:System.Security.Permissions.SecurityPermissionFlag.SerializationFormatter> 以通过 <xref:System.Runtime.Serialization.ISerializable> 接口对异常进行序列化。</span><span class="sxs-lookup"><span data-stu-id="0a72f-168"><xref:System.Security.Permissions.SecurityPermission>: <xref:System.Security.Permissions.SecurityPermissionFlag.SerializationFormatter> to serialize exceptions by using the <xref:System.Runtime.Serialization.ISerializable> interface.</span></span>  
  
- <span data-ttu-id="0a72f-169">打开数据库连接和对数据库执行命令的权限，如 SQL Server 数据库的 <xref:System.Data.SqlClient.SqlClientPermission>。</span><span class="sxs-lookup"><span data-stu-id="0a72f-169">Permission to open a database connection and execute commands against the database, such as <xref:System.Data.SqlClient.SqlClientPermission> for a SQL Server database.</span></span>  
  
 <span data-ttu-id="0a72f-170">有关更多信息，请参见 [Code Access Security and ADO.NET](../code-access-security.md)。</span><span class="sxs-lookup"><span data-stu-id="0a72f-170">For more information, see [Code Access Security and ADO.NET](../code-access-security.md).</span></span>  
  
#### <a name="do-not-install-untrusted-applications"></a><span data-ttu-id="0a72f-171">不要安装不可信的应用程序。</span><span class="sxs-lookup"><span data-stu-id="0a72f-171">Do not install untrusted applications.</span></span>  
 <span data-ttu-id="0a72f-172">实体框架不会强制实施任何安全权限，并将在进程中调用任何用户提供的数据对象代码，而不管它是否受信任。</span><span class="sxs-lookup"><span data-stu-id="0a72f-172">The Entity Framework does not enforce any security permissions and will invoke any user-supplied data object code in process regardless of whether it is trusted or not.</span></span> <span data-ttu-id="0a72f-173">确保数据存储和应用程序执行客户端身份验证和授权。</span><span class="sxs-lookup"><span data-stu-id="0a72f-173">Ensure that authentication and authorization of the client is performed by the data store and by your application.</span></span>  
  
#### <a name="restrict-access-to-all-configuration-files"></a><span data-ttu-id="0a72f-174">限制对所有配置文件的访问。</span><span class="sxs-lookup"><span data-stu-id="0a72f-174">Restrict access to all configuration files.</span></span>  
 <span data-ttu-id="0a72f-175">管理员必须限制对指定应用程序配置的所有文件的写访问权限，包括 enterprisesec、security .config、machine.config 和应用程序配置文件 \<*应用程序*>。exe。</span><span class="sxs-lookup"><span data-stu-id="0a72f-175">An administrator must restrict write access to all files that specify configuration for an application, including to enterprisesec.config, security.config, machine.conf, and the application configuration file \<*application*>.exe.config.</span></span>  
  
 <span data-ttu-id="0a72f-176">可在 app.config 中修改提供程序固定名称。客户端应用程序必须负责使用强名称通过标准提供程序工厂模型访问基础提供程序。</span><span class="sxs-lookup"><span data-stu-id="0a72f-176">The provider invariant name is modifiable in the app.config. The client application must take responsibility for accessing the underlying provider through the standard provider factory model by using a strong name.</span></span>  
  
#### <a name="restrict-permissions-to-the-model-and-mapping-files"></a><span data-ttu-id="0a72f-177">限制对模型和映射文件的访问权限。</span><span class="sxs-lookup"><span data-stu-id="0a72f-177">Restrict permissions to the model and mapping files.</span></span>  
 <span data-ttu-id="0a72f-178">管理员必须将对模型和映射文件（.edmx、.csdl、.ssdl 和 .msl）的写访问权限仅分配给负责修改模型或映射的用户。</span><span class="sxs-lookup"><span data-stu-id="0a72f-178">An administrator must restrict write access to the model and mapping files (.edmx, .csdl, .ssdl, and .msl) to only users who modify the model or mappings.</span></span> <span data-ttu-id="0a72f-179">实体框架只需要在运行时对这些文件具有读取权限。</span><span class="sxs-lookup"><span data-stu-id="0a72f-179">The Entity Framework only requires read access to these files at run time.</span></span> <span data-ttu-id="0a72f-180">管理员还应限制对由实体数据模型工具生成的对象层和预编译的查看源代码文件的访问权限。</span><span class="sxs-lookup"><span data-stu-id="0a72f-180">An administrator should also restrict access to object layer and pre-compiled view source code files that are generated by the Entity Data Model tools.</span></span>  
  
## <a name="security-considerations-for-queries"></a><span data-ttu-id="0a72f-181">有关查询的安全注意事项</span><span class="sxs-lookup"><span data-stu-id="0a72f-181">Security Considerations for Queries</span></span>  
 <span data-ttu-id="0a72f-182">查询概念模型时需要考虑下列安全注意事项。</span><span class="sxs-lookup"><span data-stu-id="0a72f-182">The following security considerations apply when querying a conceptual model.</span></span> <span data-ttu-id="0a72f-183">这些注意事项适用于使用 EntityClient 的 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 查询以及使用 LINQ、[!INCLUDE[esql](../../../../../includes/esql-md.md)] 和查询生成器方法的对象查询。</span><span class="sxs-lookup"><span data-stu-id="0a72f-183">These considerations apply to [!INCLUDE[esql](../../../../../includes/esql-md.md)] queries using EntityClient and to object queries using LINQ, [!INCLUDE[esql](../../../../../includes/esql-md.md)], and query builder methods.</span></span>  
  
#### <a name="prevent-sql-injection-attacks"></a><span data-ttu-id="0a72f-184">防范 SQL 注入式攻击。</span><span class="sxs-lookup"><span data-stu-id="0a72f-184">Prevent SQL injection attacks.</span></span>  
 <span data-ttu-id="0a72f-185">应用程序经常接受外部输入（来自用户或其他外部代理），并根据该输入执行操作。</span><span class="sxs-lookup"><span data-stu-id="0a72f-185">Applications frequently take external input (from a user or another external agent) and perform actions based on that input.</span></span> <span data-ttu-id="0a72f-186">任何直接或间接从用户或外部代理派生的输入都可能包含使用目标语言的语法来执行未授权操作的内容。</span><span class="sxs-lookup"><span data-stu-id="0a72f-186">Any input that is directly or indirectly derived from the user or an external agent might have content that uses the syntax of the target language in order to perform unauthorized actions.</span></span> <span data-ttu-id="0a72f-187">如果目标语言是结构化查询语言（SQL）（如 Transact-sql），则此操作称为 SQL 注入攻击。</span><span class="sxs-lookup"><span data-stu-id="0a72f-187">When the target language is a Structured Query Language (SQL), such as Transact-SQL, this manipulation is known as a SQL injection attack.</span></span> <span data-ttu-id="0a72f-188">恶意用户可直接向查询中注入命令并删除数据库表、引起拒绝服务或者更改所执行操作的性质。</span><span class="sxs-lookup"><span data-stu-id="0a72f-188">A malicious user can inject commands directly into the query and drop a database table, cause a denial of service, or otherwise change the nature of the operation being performed.</span></span>  
  
- [!INCLUDE[esql](../../../../../includes/esql-md.md)] <span data-ttu-id="0a72f-189">注入式攻击：</span><span class="sxs-lookup"><span data-stu-id="0a72f-189">injection attacks:</span></span>  
  
     <span data-ttu-id="0a72f-190">SQL 注入式攻击在 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 中的实施方法是向查询谓词和参数名称中使用的值提供恶意输入。</span><span class="sxs-lookup"><span data-stu-id="0a72f-190">SQL injection attacks can be performed in [!INCLUDE[esql](../../../../../includes/esql-md.md)] by supplying malicious input to values that are used in a query predicate and in parameter names.</span></span> <span data-ttu-id="0a72f-191">若要避免 SQL 注入风险，切勿组合用户输入与 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 命令文本。</span><span class="sxs-lookup"><span data-stu-id="0a72f-191">To avoid the risk of SQL injection, you should never combine user input with [!INCLUDE[esql](../../../../../includes/esql-md.md)] command text.</span></span>  
  
     [!INCLUDE[esql](../../../../../includes/esql-md.md)] <span data-ttu-id="0a72f-192">查询可在任何接受文本的位置接受参数。</span><span class="sxs-lookup"><span data-stu-id="0a72f-192">queries accept parameters everywhere that literals are accepted.</span></span> <span data-ttu-id="0a72f-193">应使用参数化查询，而不是将来自外部代理的文本直接注入查询。</span><span class="sxs-lookup"><span data-stu-id="0a72f-193">You should use parameterized queries instead of injecting literals from an external agent directly into the query.</span></span> <span data-ttu-id="0a72f-194">还应考虑使用[查询生成器方法](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896238(v=vs.100))安全地构造实体 SQL。</span><span class="sxs-lookup"><span data-stu-id="0a72f-194">You should also consider using [query builder methods](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb896238(v=vs.100)) to safely construct Entity SQL.</span></span>  
  
- <span data-ttu-id="0a72f-195">LINQ to Entities 注入攻击：</span><span class="sxs-lookup"><span data-stu-id="0a72f-195">LINQ to Entities injection attacks:</span></span>  
  
     <span data-ttu-id="0a72f-196">尽管可以在 LINQ to Entities 中进行查询撰写，但它是通过对象模型 API 执行的。</span><span class="sxs-lookup"><span data-stu-id="0a72f-196">Although query composition is possible in LINQ to Entities, it is performed through the object model API.</span></span> <span data-ttu-id="0a72f-197">与 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 查询不同，LINQ to Entities 查询不是通过使用字符串操作或串联来撰写的，它们不容易受到传统的 SQL 注入式攻击。</span><span class="sxs-lookup"><span data-stu-id="0a72f-197">Unlike [!INCLUDE[esql](../../../../../includes/esql-md.md)] queries, LINQ to Entities queries are not composed by using string manipulation or concatenation, and they are not susceptible to traditional SQL injection attacks.</span></span>  
  
#### <a name="prevent-very-large-result-sets"></a><span data-ttu-id="0a72f-198">避免结果集过大。</span><span class="sxs-lookup"><span data-stu-id="0a72f-198">Prevent very large result sets.</span></span>  
 <span data-ttu-id="0a72f-199">如果客户端执行的操作所消耗的资源与结果集的大小成正比，则过大的结果集会导致客户端系统关闭。</span><span class="sxs-lookup"><span data-stu-id="0a72f-199">A very large result set could cause the client system to shut down if the client is performing operations that consume resources proportional to the size of the result set.</span></span> <span data-ttu-id="0a72f-200">在下列情况下可能发生意外的过大结果集：</span><span class="sxs-lookup"><span data-stu-id="0a72f-200">Unexpectedly large result sets can occur under the following conditions:</span></span>  
  
- <span data-ttu-id="0a72f-201">针对大型数据库的查询未包含适当的筛选条件。</span><span class="sxs-lookup"><span data-stu-id="0a72f-201">In queries against a large database that do not include appropriate filter conditions.</span></span>  
  
- <span data-ttu-id="0a72f-202">查询在服务器上创建笛卡尔联接。</span><span class="sxs-lookup"><span data-stu-id="0a72f-202">In queries that create Cartesian joins on the server.</span></span>  
  
- <span data-ttu-id="0a72f-203">嵌套的 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 查询。</span><span class="sxs-lookup"><span data-stu-id="0a72f-203">In nested [!INCLUDE[esql](../../../../../includes/esql-md.md)] queries.</span></span>  
  
 <span data-ttu-id="0a72f-204">如果接受用户输入，则必须确保输入内容不会导致结果集过大以致超出系统的处理能力。</span><span class="sxs-lookup"><span data-stu-id="0a72f-204">When accepting user input, you must make sure that the input cannot cause result sets to become larger than what the system can handle.</span></span> <span data-ttu-id="0a72f-205">你还可以使用中的 <xref:System.Linq.Queryable.Take%2A> 方法 LINQ to Entities 或 [!INCLUDE[esql](../../../../../includes/esql-md.md)] 中的[limit](./language-reference/limit-entity-sql.md)运算符来限制结果集的大小。</span><span class="sxs-lookup"><span data-stu-id="0a72f-205">You can also use the <xref:System.Linq.Queryable.Take%2A> method in LINQ to Entities or the [LIMIT](./language-reference/limit-entity-sql.md) operator in [!INCLUDE[esql](../../../../../includes/esql-md.md)] to limit the size of the result set.</span></span>  
  
#### <a name="avoid-returning-iqueryable-results-when-exposing-methods-to-potentially-untrusted-callers"></a><span data-ttu-id="0a72f-206">避免在将方法公开给可能不受信任的调用方时返回 IQueryable 结果。</span><span class="sxs-lookup"><span data-stu-id="0a72f-206">Avoid Returning IQueryable Results When Exposing Methods to Potentially Untrusted Callers.</span></span>  
 <span data-ttu-id="0a72f-207">避免公开给可能不受信任的调用方的方法返回 <xref:System.Linq.IQueryable%601> 类型的原因如下：</span><span class="sxs-lookup"><span data-stu-id="0a72f-207">Avoid returning <xref:System.Linq.IQueryable%601> types from methods that are exposed to potentially untrusted callers for the following reasons:</span></span>  
  
- <span data-ttu-id="0a72f-208">公开 <xref:System.Linq.IQueryable%601> 类型的查询的使用方可以对公开安全数据或增大结果集大小的结果调用方法。</span><span class="sxs-lookup"><span data-stu-id="0a72f-208">A consumer of a query that exposes an <xref:System.Linq.IQueryable%601> type could call methods on the result that expose secure data or increase the size of the result set.</span></span> <span data-ttu-id="0a72f-209">例如，请考虑使用以下方法签名：</span><span class="sxs-lookup"><span data-stu-id="0a72f-209">For example, consider the following method signature:</span></span>  
  
    ```csharp  
    public IQueryable<Customer> GetCustomer(int customerId)  
    ```  
  
    <span data-ttu-id="0a72f-210">此查询的使用方可以对返回的 `.Include("Orders")` 调用 `IQueryable<Customer>`，以检索查询不打算公开的数据。</span><span class="sxs-lookup"><span data-stu-id="0a72f-210">A consumer of this query could call `.Include("Orders")` on the returned `IQueryable<Customer>` to retrieve data that the query did not intend to expose.</span></span> <span data-ttu-id="0a72f-211">通过将方法的返回类型更改为 <xref:System.Collections.Generic.IEnumerable%601> 并调用具体化结果的方法（如 `.ToList()`），可以避免此问题。</span><span class="sxs-lookup"><span data-stu-id="0a72f-211">This can be avoided by changing the return type of the method to <xref:System.Collections.Generic.IEnumerable%601> and calling a method (such as `.ToList()`) that materializes the results.</span></span>  
  
- <span data-ttu-id="0a72f-212">由于 <xref:System.Linq.IQueryable%601> 查询在循环访问结果时执行，因此公开 <xref:System.Linq.IQueryable%601> 类型的查询的使用方可能会捕捉引发的异常。</span><span class="sxs-lookup"><span data-stu-id="0a72f-212">Because <xref:System.Linq.IQueryable%601> queries are executed when the results are iterated over, a consumer of a query that exposes an <xref:System.Linq.IQueryable%601> type could catch exceptions that are thrown.</span></span> <span data-ttu-id="0a72f-213">这些异常可能包含不适用于使用方的信息。</span><span class="sxs-lookup"><span data-stu-id="0a72f-213">Exceptions could contain information not intended for the consumer.</span></span>  
  
## <a name="security-considerations-for-entities"></a><span data-ttu-id="0a72f-214">有关实体的安全注意事项</span><span class="sxs-lookup"><span data-stu-id="0a72f-214">Security Considerations for Entities</span></span>  
 <span data-ttu-id="0a72f-215">生成和处理实体类型时应考虑下列安全注意事项。</span><span class="sxs-lookup"><span data-stu-id="0a72f-215">The following security considerations apply when generating and working with entity types.</span></span>  
  
#### <a name="do-not-share-an-objectcontext-across-application-domains"></a><span data-ttu-id="0a72f-216">不要在应用程序域之间共享 ObjectContext。</span><span class="sxs-lookup"><span data-stu-id="0a72f-216">Do not share an ObjectContext across application domains.</span></span>  
 <span data-ttu-id="0a72f-217">在多个应用程序域之间共享 <xref:System.Data.Objects.ObjectContext> 可能会公开连接字符串中的信息。</span><span class="sxs-lookup"><span data-stu-id="0a72f-217">Sharing an <xref:System.Data.Objects.ObjectContext> with more than one application domain may expose information in the connection string.</span></span> <span data-ttu-id="0a72f-218">正确的做法是将序列化的对象或对象图传递给其他应用程序域，并将这些对象附加到该应用程序域中的 <xref:System.Data.Objects.ObjectContext>。</span><span class="sxs-lookup"><span data-stu-id="0a72f-218">Instead, you should transfer serialized objects or object graphs to the other application domain and then attach those objects to an <xref:System.Data.Objects.ObjectContext> in that application domain.</span></span> <span data-ttu-id="0a72f-219">有关详细信息，请参阅[序列化对象](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738446(v=vs.100))。</span><span class="sxs-lookup"><span data-stu-id="0a72f-219">For more information, see [Serializing Objects](https://docs.microsoft.com/previous-versions/dotnet/netframework-4.0/bb738446(v=vs.100)).</span></span>  
  
#### <a name="prevent-type-safety-violations"></a><span data-ttu-id="0a72f-220">避免类型安全冲突。</span><span class="sxs-lookup"><span data-stu-id="0a72f-220">Prevent type safety violations.</span></span>  
 <span data-ttu-id="0a72f-221">如果违反类型安全，则实体框架无法保证对象中数据的完整性。</span><span class="sxs-lookup"><span data-stu-id="0a72f-221">If type safety is violated, the Entity Framework cannot guarantee the integrity of data in objects.</span></span> <span data-ttu-id="0a72f-222">如果使用完全信任代码访问安全性运行不可信的应用程序，可能导致类型安全冲突。</span><span class="sxs-lookup"><span data-stu-id="0a72f-222">Type safety violations could occur if you allow untrusted applications to run with full-trust code access security.</span></span>  
  
#### <a name="handle-exceptions"></a><span data-ttu-id="0a72f-223">处理异常。</span><span class="sxs-lookup"><span data-stu-id="0a72f-223">Handle exceptions.</span></span>  
 <span data-ttu-id="0a72f-224">在 try-catch 块中访问 <xref:System.Data.Objects.ObjectContext> 的方法和属性。</span><span class="sxs-lookup"><span data-stu-id="0a72f-224">Access methods and properties of an <xref:System.Data.Objects.ObjectContext> within a try-catch block.</span></span> <span data-ttu-id="0a72f-225">捕获异常可防止未经处理的异常向应用程序的用户公开 <xref:System.Data.Objects.ObjectStateManager> 中的条目或模型信息（如，表名称）。</span><span class="sxs-lookup"><span data-stu-id="0a72f-225">Catching exceptions prevents unhandled exceptions from exposing entries in the <xref:System.Data.Objects.ObjectStateManager> or model information (such as table names) to users of your application.</span></span>  
  
## <a name="security-considerations-for-aspnet-applications"></a><span data-ttu-id="0a72f-226">有关 ASP.NET 应用程序的安全注意事项</span><span class="sxs-lookup"><span data-stu-id="0a72f-226">Security Considerations for ASP.NET Applications</span></span>  

<span data-ttu-id="0a72f-227">在 ASP.NET 应用程序中使用路径时，应考虑以下事项。</span><span class="sxs-lookup"><span data-stu-id="0a72f-227">You should consider the following when you work with paths in ASP.NET applications.</span></span>  
  
#### <a name="verify-whether-your-host-performs-path-checks"></a><span data-ttu-id="0a72f-228">检验主机是否执行路径检查。</span><span class="sxs-lookup"><span data-stu-id="0a72f-228">Verify whether your host performs path checks.</span></span>  
 <span data-ttu-id="0a72f-229">当使用 `|DataDirectory|` （包含在管道符号中）替换字符串时，ADO.NET 将验证是否支持解析的路径。</span><span class="sxs-lookup"><span data-stu-id="0a72f-229">When the `|DataDirectory|` (enclosed in pipe symbols) substitution string is used, ADO.NET verifies that the resolved path is supported.</span></span> <span data-ttu-id="0a72f-230">例如，`DataDirectory` 后面不允许出现“..”。</span><span class="sxs-lookup"><span data-stu-id="0a72f-230">For example, ".." is not allowed behind `DataDirectory`.</span></span> <span data-ttu-id="0a72f-231">用于解析 Web 应用程序根运算符（`~`）的相同检查由托管 ASP.NET 的进程执行。</span><span class="sxs-lookup"><span data-stu-id="0a72f-231">That same check for resolving the Web application root operator (`~`) is performed by the process hosting ASP.NET.</span></span> <span data-ttu-id="0a72f-232">IIS 执行此检查;但是，除 IIS 以外的主机不能验证是否支持解析的路径。</span><span class="sxs-lookup"><span data-stu-id="0a72f-232">IIS performs this check; however, hosts other than IIS may not verify that the resolved path is supported.</span></span> <span data-ttu-id="0a72f-233">你应该知道要在其上部署实体框架应用程序的主机的行为。</span><span class="sxs-lookup"><span data-stu-id="0a72f-233">You should know the behavior of the host on which you deploy an Entity Framework application.</span></span>  
  
#### <a name="do-not-make-assumptions-about-resolved-path-names"></a><span data-ttu-id="0a72f-234">不要对解析的路径名称做任何假定。</span><span class="sxs-lookup"><span data-stu-id="0a72f-234">Do not make assumptions about resolved path names.</span></span>  
 <span data-ttu-id="0a72f-235">尽管根运算符（`~`）和 `DataDirectory` 替换字符串解析的值在应用程序的运行时中应保持不变，但实体框架不会限制主机修改这些值。</span><span class="sxs-lookup"><span data-stu-id="0a72f-235">Although the values to which the root operator (`~`) and the `DataDirectory` substitution string resolve should remain constant during the application's runtime, the Entity Framework does not restrict the host from modifying these values.</span></span>  
  
#### <a name="verify-the-path-length-before-deployment"></a><span data-ttu-id="0a72f-236">部署前检查路径长度。</span><span class="sxs-lookup"><span data-stu-id="0a72f-236">Verify the path length before deployment.</span></span>  
 <span data-ttu-id="0a72f-237">在部署实体框架应用程序之前，应确保根运算符（~）和 `DataDirectory` 替换字符串的值不超过操作系统中路径长度的限制。</span><span class="sxs-lookup"><span data-stu-id="0a72f-237">Before deploying an Entity Framework application, you should ensure that the values of the root operator (~) and `DataDirectory` substitution string do not exceed the limits of the path length in the operating system.</span></span> <span data-ttu-id="0a72f-238">ADO.NET 数据访问接口不确保路径长度超出有效限制。</span><span class="sxs-lookup"><span data-stu-id="0a72f-238">ADO.NET data providers do not ensure that the path length is within valid limits.</span></span>  
  
## <a name="security-considerations-for-adonet-metadata"></a><span data-ttu-id="0a72f-239">有关 ADO.NET 元数据的安全注意事项</span><span class="sxs-lookup"><span data-stu-id="0a72f-239">Security Considerations for ADO.NET Metadata</span></span>  
 <span data-ttu-id="0a72f-240">生成和处理模型和映射文件时应考虑下列安全注意事项。</span><span class="sxs-lookup"><span data-stu-id="0a72f-240">The following security considerations apply when generating and working with model and mapping files.</span></span>  
  
#### <a name="do-not-expose-sensitive-information-through-logging"></a><span data-ttu-id="0a72f-241">不要通过日志公开敏感信息。</span><span class="sxs-lookup"><span data-stu-id="0a72f-241">Do not expose sensitive information through logging.</span></span>  
<span data-ttu-id="0a72f-242">ADO.NET 元数据服务组件不记录任何专用信息。</span><span class="sxs-lookup"><span data-stu-id="0a72f-242">ADO.NET metadata service components do not log any private information.</span></span> <span data-ttu-id="0a72f-243">如果由于访问限制而无法返回某些结果，则数据库管理系统和文件系统应返回零结果，而不是引发可能包含敏感信息的异常。</span><span class="sxs-lookup"><span data-stu-id="0a72f-243">If there are results that cannot be returned because of access restrictions, database management systems and file systems should return zero results instead of raising an exception that could contain sensitive information.</span></span>  
  
#### <a name="do-not-accept-metadataworkspace-objects-from-untrusted-sources"></a><span data-ttu-id="0a72f-244">不要接受来自不可信源的 MetadataWorkspace 对象。</span><span class="sxs-lookup"><span data-stu-id="0a72f-244">Do not accept MetadataWorkspace objects from untrusted sources.</span></span>  
 <span data-ttu-id="0a72f-245">应用程序不应接受来自不可信源的 <xref:System.Data.Metadata.Edm.MetadataWorkspace> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="0a72f-245">Applications should not accept instances of the <xref:System.Data.Metadata.Edm.MetadataWorkspace> class from untrusted sources.</span></span> <span data-ttu-id="0a72f-246">正确的做法是从这样的源显式构造并填充工作区。</span><span class="sxs-lookup"><span data-stu-id="0a72f-246">Instead, you should explicitly construct and populate a workspace from such a source.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="0a72f-247">请参阅</span><span class="sxs-lookup"><span data-stu-id="0a72f-247">See also</span></span>

- [<span data-ttu-id="0a72f-248">保证 ADO.NET 应用程序的安全</span><span class="sxs-lookup"><span data-stu-id="0a72f-248">Securing ADO.NET Applications</span></span>](../securing-ado-net-applications.md)
- [<span data-ttu-id="0a72f-249">部署注意事项</span><span class="sxs-lookup"><span data-stu-id="0a72f-249">Deployment Considerations</span></span>](deployment-considerations.md)
- [<span data-ttu-id="0a72f-250">迁移注意事项</span><span class="sxs-lookup"><span data-stu-id="0a72f-250">Migration Considerations</span></span>](migration-considerations.md)
