---
title: 对象具体化（WCF 数据服务）
ms.date: 03/30/2017
helpviewer_keywords:
- WCF Data Services, client library
- WCF Data Services, querying
ms.assetid: f0dbf7b0-0292-4e31-9ae4-b98288336dc1
ms.openlocfilehash: 7a2b201e5690c4304e663e9429c54f377e05f556
ms.sourcegitcommit: 79a2d6a07ba4ed08979819666a0ee6927bbf1b01
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 11/28/2019
ms.locfileid: "74568910"
---
# <a name="object-materialization-wcf-data-services"></a><span data-ttu-id="d4028-102">对象具体化（WCF 数据服务）</span><span class="sxs-lookup"><span data-stu-id="d4028-102">Object Materialization (WCF Data Services)</span></span>

<span data-ttu-id="d4028-103">使用**添加服务引用**对话框在基于 .NET Framework 的客户端应用程序中使用 Open Data Protocol （OData）源时，将为源公开的数据模型中的每个实体类型生成等效的数据类。</span><span class="sxs-lookup"><span data-stu-id="d4028-103">When you use the **Add Service Reference** dialog to consume an Open Data Protocol (OData) feed in a .NET Framework-based client application, equivalent data classes are generated for each entity type in the data model exposed by the feed.</span></span> <span data-ttu-id="d4028-104">有关详细信息，请参阅[生成数据服务客户端库](generating-the-data-service-client-library-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="d4028-104">For more information, see [Generating the Data Service Client Library](generating-the-data-service-client-library-wcf-data-services.md).</span></span> <span data-ttu-id="d4028-105">查询返回的实体数据将具体化为所生成的客户端数据服务类之一的实例。</span><span class="sxs-lookup"><span data-stu-id="d4028-105">Entity data that is returned by a query is materialized into an instance of one of these generated client data service classes.</span></span> <span data-ttu-id="d4028-106">有关跟踪对象的合并选项和标识解析的信息，请参阅[管理数据服务上下文](managing-the-data-service-context-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="d4028-106">For information about merge options and identity resolution for tracked objects, see [Managing the Data Service Context](managing-the-data-service-context-wcf-data-services.md).</span></span>

<span data-ttu-id="d4028-107">WCF 数据服务还允许您定义自己的客户端数据服务类，而不是使用工具生成的数据类。</span><span class="sxs-lookup"><span data-stu-id="d4028-107">WCF Data Services also enables you to define your own client data service classes rather than using the tool-generated data classes.</span></span> <span data-ttu-id="d4028-108">这样您便可以使用自己的数据类，也称为“纯旧式 CLR 对象”(POCO) 数据类。</span><span class="sxs-lookup"><span data-stu-id="d4028-108">This enables you to use your own data classes, also known as "plain-old CLR object" (POCO) data classes.</span></span> <span data-ttu-id="d4028-109">使用这些类型的自定义数据类时，应使用 <xref:System.Data.Services.Common.DataServiceKeyAttribute> 或 <xref:System.Data.Services.Common.DataServiceEntityAttribute> 来特性数据类，并确保客户端上的类型名称与数据服务的数据模型中的类型名称匹配。</span><span class="sxs-lookup"><span data-stu-id="d4028-109">When using these types of custom data classes, you should attribute the data class with either <xref:System.Data.Services.Common.DataServiceKeyAttribute> or <xref:System.Data.Services.Common.DataServiceEntityAttribute> and ensure that type names on the client match type names in the data model of the data service.</span></span>

<span data-ttu-id="d4028-110">在库收到查询响应消息后，它将返回的数据从 OData 源具体化为查询类型的客户端数据服务类的实例。</span><span class="sxs-lookup"><span data-stu-id="d4028-110">After the library receives the query response message, it materializes the returned data from the OData feed into instances of client data service classes that are of the type of the query.</span></span> <span data-ttu-id="d4028-111">以下是具体化这些对象的一般过程：</span><span class="sxs-lookup"><span data-stu-id="d4028-111">The general process for materializing these objects is as follows:</span></span>

1. <span data-ttu-id="d4028-112">客户端库从响应消息源中的 `entry` 元素读取序列化的类型，并尝试采用以下方法之一创建正确类型的新实例：</span><span class="sxs-lookup"><span data-stu-id="d4028-112">The client library reads the serialized type from the `entry` element in the response message feed and attempts to create a new instance of the correct type, in one of the following ways:</span></span>

    - <span data-ttu-id="d4028-113">当在源中声明的类型与 <xref:System.Data.Services.Client.DataServiceQuery%601> 的类型具有相同的名称时，会使用空的构造函数创建此类型的新实例。</span><span class="sxs-lookup"><span data-stu-id="d4028-113">When the type declared in the feed has the same name as the type of the <xref:System.Data.Services.Client.DataServiceQuery%601>, a new instance of this type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="d4028-114">当在源中声明的类型与从 <xref:System.Data.Services.Client.DataServiceQuery%601> 的类型派生的类型具有相同的名称时，会使用空的构造函数创建此派生类型的新实例。</span><span class="sxs-lookup"><span data-stu-id="d4028-114">When the type declared in the feed has the same name as a type that is derived from the type of the <xref:System.Data.Services.Client.DataServiceQuery%601>, a new instance of this derived type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="d4028-115">当在源中声明的类型无法与 <xref:System.Data.Services.Client.DataServiceQuery%601> 的类型或任何派生的类型相匹配时，会使用空的构造函数创建所查询类型的新实例。</span><span class="sxs-lookup"><span data-stu-id="d4028-115">When the type declared in the feed cannot be matched to the type of the <xref:System.Data.Services.Client.DataServiceQuery%601> or any derived types, a new instance of the queried type is created by using the empty constructor.</span></span>

    - <span data-ttu-id="d4028-116">设置 <xref:System.Data.Services.Client.DataServiceContext.ResolveType%2A> 属性时，会调用提供的委托来重写基于默认名称的类型映射，并改为创建由 <xref:System.Func%602> 返回的类型的新实例。</span><span class="sxs-lookup"><span data-stu-id="d4028-116">When the <xref:System.Data.Services.Client.DataServiceContext.ResolveType%2A> property is set, the supplied delegate is called to override the default name-based type mapping and a new instance of the type returned by the <xref:System.Func%602> is created instead.</span></span> <span data-ttu-id="d4028-117">如果此委托返回一个 null 值，则改为创建所查询类型的新实例。</span><span class="sxs-lookup"><span data-stu-id="d4028-117">If this delegate returns a null value, a new instance of the queried type is created instead.</span></span> <span data-ttu-id="d4028-118">可能需要重写基于默认名称的类型名称映射以支持继承方案。</span><span class="sxs-lookup"><span data-stu-id="d4028-118">It may be required to override the default name-based type name mapping to support inheritance scenarios.</span></span>

2. <span data-ttu-id="d4028-119">客户端库从 `id` 的 `entry` 元素中读取 URI 值，它是实体的标识值。</span><span class="sxs-lookup"><span data-stu-id="d4028-119">The client library reads the URI value from the `id` element of the `entry`, which is the identity value of the entity.</span></span> <span data-ttu-id="d4028-120">除非使用 <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> 的 <xref:System.Data.Services.Client.MergeOption.NoTracking> 值，否则将使用标识值来跟踪 <xref:System.Data.Services.Client.DataServiceContext> 中的对象。</span><span class="sxs-lookup"><span data-stu-id="d4028-120">Unless a <xref:System.Data.Services.Client.DataServiceContext.MergeOption%2A> value of <xref:System.Data.Services.Client.MergeOption.NoTracking> is used, the identity value is used to track the object in the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="d4028-121">该标识值还用于保证仅创建一个实体实例，即使某个实体在查询响应中返回多次。</span><span class="sxs-lookup"><span data-stu-id="d4028-121">The identity value is also used to guarantee that only a single entity instance is created, even when an entity is returned multiple times in the query response.</span></span>

3. <span data-ttu-id="d4028-122">客户端库从源项中读取属性并对新创建的对象设置相应的属性。</span><span class="sxs-lookup"><span data-stu-id="d4028-122">The client library reads properties from the feed entry and set the corresponding properties on the newly created object.</span></span> <span data-ttu-id="d4028-123">如果具有相同标识值的对象已出现在 <xref:System.Data.Services.Client.DataServiceContext> 中，则根据 <xref:System.Data.Services.Client.MergeOption> 的 <xref:System.Data.Services.Client.DataServiceContext> 设置来设定这些属性。</span><span class="sxs-lookup"><span data-stu-id="d4028-123">When an object that has the same identity value already occurs in the <xref:System.Data.Services.Client.DataServiceContext>, the properties are set based on the <xref:System.Data.Services.Client.MergeOption> setting of the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="d4028-124">响应可能包含其相应属性不出现在客户端类型中的属性值。</span><span class="sxs-lookup"><span data-stu-id="d4028-124">The response might contain property values for which a corresponding property does not occur in the client type.</span></span> <span data-ttu-id="d4028-125">发生这种情况时，将根据 <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> 的 <xref:System.Data.Services.Client.DataServiceContext> 属性的值采取操作。</span><span class="sxs-lookup"><span data-stu-id="d4028-125">When this occurs, the action depends on the value of the <xref:System.Data.Services.Client.DataServiceContext.IgnoreMissingProperties%2A> property of the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="d4028-126">当此属性设置为 `true` 时，忽略缺少的属性。</span><span class="sxs-lookup"><span data-stu-id="d4028-126">When this property is set to `true`, the missing property is ignored.</span></span> <span data-ttu-id="d4028-127">否则将引发错误。</span><span class="sxs-lookup"><span data-stu-id="d4028-127">Otherwise, an error is raised.</span></span> <span data-ttu-id="d4028-128">按如下方式设置这些属性：</span><span class="sxs-lookup"><span data-stu-id="d4028-128">Properties are set as follows:</span></span>

    - <span data-ttu-id="d4028-129">将标量属性设置为响应消息中该项的相应值。</span><span class="sxs-lookup"><span data-stu-id="d4028-129">Scalar properties are set to the corresponding value in the entry in the response message.</span></span>

    - <span data-ttu-id="d4028-130">将复杂属性设置为新的复杂类型实例，其中使用响应中的复杂类型的属性设置这些属性。</span><span class="sxs-lookup"><span data-stu-id="d4028-130">Complex properties are set to a new complex type instance, which are set with the properties of the complex type from the response.</span></span>

    - <span data-ttu-id="d4028-131">将返回相关实体集合的导航属性设置为 <xref:System.Collections.Generic.ICollection%601> 的新实例或现有实例，其中 `T` 是相关实体的类型。</span><span class="sxs-lookup"><span data-stu-id="d4028-131">Navigation properties that return a collection of related entities are set to a new or existing instance of <xref:System.Collections.Generic.ICollection%601>, where `T` is the type of the related entity.</span></span> <span data-ttu-id="d4028-132">除非相关对象已加载到 <xref:System.Data.Services.Client.DataServiceContext> 中，否则此集合是空的。</span><span class="sxs-lookup"><span data-stu-id="d4028-132">This collection is empty unless the related objects have been loaded into the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="d4028-133">有关详细信息，请参阅[加载延迟的内容](loading-deferred-content-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="d4028-133">For more information, see [Loading Deferred Content](loading-deferred-content-wcf-data-services.md).</span></span>

      > [!NOTE]
      > <span data-ttu-id="d4028-134">当生成的客户端数据类支持数据绑定时，导航属性改为返回 <xref:System.Data.Services.Client.DataServiceCollection%601> 类的实例。</span><span class="sxs-lookup"><span data-stu-id="d4028-134">When the generated client data classes support data binding, navigation properties return instances of the <xref:System.Data.Services.Client.DataServiceCollection%601> class instead.</span></span> <span data-ttu-id="d4028-135">有关详细信息，请参阅[将数据绑定到控件](binding-data-to-controls-wcf-data-services.md)。</span><span class="sxs-lookup"><span data-stu-id="d4028-135">For more information, see [Binding Data to Controls](binding-data-to-controls-wcf-data-services.md).</span></span>

4. <span data-ttu-id="d4028-136">引发 <xref:System.Data.Services.Client.DataServiceContext.ReadingEntity> 事件。</span><span class="sxs-lookup"><span data-stu-id="d4028-136">The <xref:System.Data.Services.Client.DataServiceContext.ReadingEntity> event is raised.</span></span>

5. <span data-ttu-id="d4028-137">客户端库将该对象附加到 <xref:System.Data.Services.Client.DataServiceContext>。</span><span class="sxs-lookup"><span data-stu-id="d4028-137">The client library attaches the object to the <xref:System.Data.Services.Client.DataServiceContext>.</span></span> <span data-ttu-id="d4028-138">当 <xref:System.Data.Services.Client.MergeOption> 为 <xref:System.Data.Services.Client.MergeOption.NoTracking> 时不附加该对象。</span><span class="sxs-lookup"><span data-stu-id="d4028-138">The object is not attached when the <xref:System.Data.Services.Client.MergeOption> is <xref:System.Data.Services.Client.MergeOption.NoTracking>.</span></span>

## <a name="see-also"></a><span data-ttu-id="d4028-139">另请参阅</span><span class="sxs-lookup"><span data-stu-id="d4028-139">See also</span></span>

- [<span data-ttu-id="d4028-140">查询数据服务</span><span class="sxs-lookup"><span data-stu-id="d4028-140">Querying the Data Service</span></span>](querying-the-data-service-wcf-data-services.md)
- [<span data-ttu-id="d4028-141">查询投影</span><span class="sxs-lookup"><span data-stu-id="d4028-141">Query Projections</span></span>](query-projections-wcf-data-services.md)
