---
title: 使用线程和线程处理
ms.date: 08/08/2018
ms.technology: dotnet-standard
helpviewer_keywords:
- threading [.NET Framework], about threading
- managed threading
ms.assetid: 9b5ec2cd-121b-4d49-b075-222cf26f2344
ms.openlocfilehash: 1d487edff2cdc2e63f81963bfaa1f68a06e5b36e
ms.sourcegitcommit: 7588136e355e10cbc2582f389c90c127363c02a5
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 03/15/2020
ms.locfileid: "75936844"
---
# <a name="using-threads-and-threading"></a><span data-ttu-id="19159-102">使用线程和线程处理</span><span class="sxs-lookup"><span data-stu-id="19159-102">Using threads and threading</span></span>

<span data-ttu-id="19159-103">借助 .NET，可以编写同时执行多个操作的应用程序。</span><span class="sxs-lookup"><span data-stu-id="19159-103">With .NET, you can write applications that perform multiple operations at the same time.</span></span> <span data-ttu-id="19159-104">可在单独的线程上执行可能妨碍其他操作的操作，这些线程是称为多线程处理或自由线程处理的进程   。</span><span class="sxs-lookup"><span data-stu-id="19159-104">Operations with the potential of holding up other operations can execute on separate threads, a process known as *multithreading* or *free threading*.</span></span>  
  
<span data-ttu-id="19159-105">使用多线程处理的应用程序可以更快地响应用户输入，因为在单独的线程上执行处理器密集型任务时，用户界面将保持活动状态。</span><span class="sxs-lookup"><span data-stu-id="19159-105">Applications that use multithreading are more responsive to user input because the user interface stays active as processor-intensive tasks execute on separate threads.</span></span> <span data-ttu-id="19159-106">创建可扩展的应用程序时，多线程编程也很有用，因为可以随着负载的增加添加线程。</span><span class="sxs-lookup"><span data-stu-id="19159-106">Multithreading is also useful when you create scalable applications, because you can add threads as the workload increases.</span></span>

> [!NOTE]
> <span data-ttu-id="19159-107">如果需要更好地控制应用程序线程的行为，可以自己管理线程。</span><span class="sxs-lookup"><span data-stu-id="19159-107">If you need more control over the behavior of the application's threads, you can manage the threads yourself.</span></span> <span data-ttu-id="19159-108">然而，自 .NET Framework 4 起，由于出现了 <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> 和 <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> 类、[并行 LINQ (PLINQ)](../parallel-programming/parallel-linq-plinq.md)、<xref:System.Collections.Concurrent?displayProperty=nameWithType> 命名空间中的新并发集合类以及基于任务（而非线程）概念的新编程模型，多线程编程大大得到了简化。</span><span class="sxs-lookup"><span data-stu-id="19159-108">However, starting with the .NET Framework 4, multithreaded programming is greatly simplified with the <xref:System.Threading.Tasks.Parallel?displayProperty=nameWithType> and <xref:System.Threading.Tasks.Task?displayProperty=nameWithType> classes, [Parallel LINQ (PLINQ)](../parallel-programming/parallel-linq-plinq.md), new concurrent collection classes in the <xref:System.Collections.Concurrent?displayProperty=nameWithType> namespace, and a new programming model that is based on the concept of tasks rather than threads.</span></span> <span data-ttu-id="19159-109">有关详细信息，请参阅[并行编程](../parallel-programming/index.md)和[任务并行库 (TPL)](../parallel-programming/task-parallel-library-tpl.md)。</span><span class="sxs-lookup"><span data-stu-id="19159-109">For more information, see [Parallel Programming](../parallel-programming/index.md) and [Task Parallel Library (TPL)](../parallel-programming/task-parallel-library-tpl.md).</span></span>

## <a name="how-to-create-and-start-a-new-thread"></a><span data-ttu-id="19159-110">如何：创建并启动新线程</span><span class="sxs-lookup"><span data-stu-id="19159-110">How to: Create and start a new thread</span></span>

<span data-ttu-id="19159-111">可通过创建 <xref:System.Threading.Thread?displayProperty=nameWithType> 类的新实例，并将要在新线程上执行的方法名提供给构造函数来创建新线程。</span><span class="sxs-lookup"><span data-stu-id="19159-111">You create a new thread by creating a new instance of the <xref:System.Threading.Thread?displayProperty=nameWithType> class and providing the name of the method that you want to execute on a new thread to the constructor.</span></span> <span data-ttu-id="19159-112">要启动已创建的线程，请调用 <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="19159-112">To start a created thread, call the <xref:System.Threading.Thread.Start%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="19159-113">有关详细信息和示例，请参阅[启动时创建线程并传递数据](creating-threads-and-passing-data-at-start-time.md)一文和 <xref:System.Threading.Thread> API 引用。</span><span class="sxs-lookup"><span data-stu-id="19159-113">For more information and examples, see the [Creating threads and passing data at start time](creating-threads-and-passing-data-at-start-time.md) article and the <xref:System.Threading.Thread> API reference.</span></span>

## <a name="how-to-stop-a-thread"></a><span data-ttu-id="19159-114">如何：停止线程</span><span class="sxs-lookup"><span data-stu-id="19159-114">How to: Stop a thread</span></span>

<span data-ttu-id="19159-115">要终止执行线程，请使用 <xref:System.Threading.CancellationToken?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="19159-115">To terminate the execution of a thread, use the <xref:System.Threading.CancellationToken?displayProperty=nameWithType>.</span></span> <span data-ttu-id="19159-116">它提供一种统一的方法以协作方式停止线程。</span><span class="sxs-lookup"><span data-stu-id="19159-116">It provides a unified way to stop threads cooperatively.</span></span> <span data-ttu-id="19159-117">有关详细信息，请参阅[托管线程中的取消](cancellation-in-managed-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="19159-117">For more information, see [Cancellation in managed threads](cancellation-in-managed-threads.md).</span></span>

<span data-ttu-id="19159-118">有时无法以协作方式停止线程，因为它运行的第三方代码不是为协作取消而设计的。</span><span class="sxs-lookup"><span data-stu-id="19159-118">Sometimes it is not possible to stop a thread cooperatively, because it runs third-party code not designed for cooperative cancellation.</span></span> <span data-ttu-id="19159-119">在这种情况下，可能需要强制终止其执行。</span><span class="sxs-lookup"><span data-stu-id="19159-119">In this case, you might want to terminate its execution forcibly.</span></span> <span data-ttu-id="19159-120">若要强制终止线程的执行，可以在 .NET Framework 中使用 <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="19159-120">To terminate the execution of a thread forcibly, in .NET Framework you can use the <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="19159-121">该方法在调用它的线程上引发 <xref:System.Threading.ThreadAbortException>。</span><span class="sxs-lookup"><span data-stu-id="19159-121">That method raises a <xref:System.Threading.ThreadAbortException> on the thread on which it's invoked.</span></span> <span data-ttu-id="19159-122">有关详细信息，请参阅[销毁线程](destroying-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="19159-122">For more information, see [Destroying threads](destroying-threads.md).</span></span> <span data-ttu-id="19159-123">.NET Core 中不支持 <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> 方法。</span><span class="sxs-lookup"><span data-stu-id="19159-123">The <xref:System.Threading.Thread.Abort%2A?displayProperty=nameWithType> method is not supported in .NET Core.</span></span> <span data-ttu-id="19159-124">如果需要在 .NET Core 中强制终止第三方代码的执行，请在单独的进程中运行该代码，并使用 <xref:System.Diagnostics.Process.Kill%2A?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="19159-124">If you need to terminate the execution of third-party code forcibly in .NET Core, run it in the separate process and use <xref:System.Diagnostics.Process.Kill%2A?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="19159-125"><xref:System.Threading.CancellationToken?displayProperty=nameWithType> 在 .NET Framework 4 之前的版本中不可用。</span><span class="sxs-lookup"><span data-stu-id="19159-125">The <xref:System.Threading.CancellationToken?displayProperty=nameWithType> is not available before .NET Framework 4.</span></span> <span data-ttu-id="19159-126">若要停止较旧 .NET Framework 版本中的线程，应使用线程同步技术手动实现协作取消。</span><span class="sxs-lookup"><span data-stu-id="19159-126">To stop a thread in older .NET Framework versions, you should implement the cooperative cancellation manually using the thread synchronization techniques.</span></span> <span data-ttu-id="19159-127">例如，可以创建 volatile 布尔字段 `shouldStop`，并使用它来请求线程执行的代码停止。</span><span class="sxs-lookup"><span data-stu-id="19159-127">For example, you can create the volatile boolean field `shouldStop` and use it to request the code executed by the thread to stop.</span></span> <span data-ttu-id="19159-128">有关详细信息，请参阅 C# 参考中的 [volatile](../../csharp/language-reference/keywords/volatile.md) 和 <xref:System.Threading.Volatile?displayProperty=nameWithType>。</span><span class="sxs-lookup"><span data-stu-id="19159-128">For more information, see [volatile](../../csharp/language-reference/keywords/volatile.md) in C# Reference and <xref:System.Threading.Volatile?displayProperty=nameWithType>.</span></span>

<span data-ttu-id="19159-129">使用 <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> 方法使调用线程等待线程终止停止。</span><span class="sxs-lookup"><span data-stu-id="19159-129">Use the <xref:System.Threading.Thread.Join%2A?displayProperty=nameWithType> method to make the calling thread wait for the termination of the thread being stopped.</span></span>

## <a name="how-to-pause-or-interrupt-a-thread"></a><span data-ttu-id="19159-130">如何：暂停或中断线程</span><span class="sxs-lookup"><span data-stu-id="19159-130">How to: Pause or interrupt a thread</span></span>

<span data-ttu-id="19159-131">使用 <xref:System.Threading.Thread.Sleep%2A?displayProperty=nameWithType> 方法暂停指定时间内的当前线程。</span><span class="sxs-lookup"><span data-stu-id="19159-131">You use the <xref:System.Threading.Thread.Sleep%2A?displayProperty=nameWithType> method to pause the current thread for a specified amount of time.</span></span> <span data-ttu-id="19159-132">可通过调用 <xref:System.Threading.Thread.Interrupt%2A?displayProperty=nameWithType> 方法来中断受阻止的线程。</span><span class="sxs-lookup"><span data-stu-id="19159-132">You can interrupt a blocked thread by calling the <xref:System.Threading.Thread.Interrupt%2A?displayProperty=nameWithType> method.</span></span> <span data-ttu-id="19159-133">有关详细信息，请参阅[暂停并中断线程](pausing-and-resuming-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="19159-133">For more information, see [Pausing and interrupting threads](pausing-and-resuming-threads.md).</span></span>

## <a name="thread-properties"></a><span data-ttu-id="19159-134">线程属性</span><span class="sxs-lookup"><span data-stu-id="19159-134">Thread properties</span></span>

<span data-ttu-id="19159-135">下表列出了某些 <xref:System.Threading.Thread> 属性：</span><span class="sxs-lookup"><span data-stu-id="19159-135">The following table presents some of the <xref:System.Threading.Thread> properties:</span></span>  
  
|<span data-ttu-id="19159-136">Property</span><span class="sxs-lookup"><span data-stu-id="19159-136">Property</span></span>|<span data-ttu-id="19159-137">说明</span><span class="sxs-lookup"><span data-stu-id="19159-137">Description</span></span>|  
|--------------|-----------|  
|<xref:System.Threading.Thread.IsAlive%2A>|<span data-ttu-id="19159-138">如果此线程已启动但尚未正常终止或中止，则返回 `true`。</span><span class="sxs-lookup"><span data-stu-id="19159-138">Returns `true` if a thread has been started and has not yet terminated normally or aborted.</span></span>|  
|<xref:System.Threading.Thread.IsBackground%2A>|<span data-ttu-id="19159-139">获取或设置布尔值，该值指示线程是否为后台线程。</span><span class="sxs-lookup"><span data-stu-id="19159-139">Gets or sets a Boolean that indicates if a thread is a background thread.</span></span> <span data-ttu-id="19159-140">后台线程类似前台线程，但后台线程不会阻止进程停止。</span><span class="sxs-lookup"><span data-stu-id="19159-140">Background threads are like foreground threads, but a background thread doesn't prevent a process from stopping.</span></span> <span data-ttu-id="19159-141">属于某个进程的所有前台线程均停止后，公共语言运行时通过对仍处于活动状态的后台进程调用 <xref:System.Threading.Thread.Abort%2A> 方法来结束进程。</span><span class="sxs-lookup"><span data-stu-id="19159-141">Once all foreground threads that belong to a process have stopped, the common language runtime ends the process by calling the <xref:System.Threading.Thread.Abort%2A> method on background threads that are still alive.</span></span> <span data-ttu-id="19159-142">有关详细信息，请参阅[前台和后台线程](foreground-and-background-threads.md)。</span><span class="sxs-lookup"><span data-stu-id="19159-142">For more information, see [Foreground and Background Threads](foreground-and-background-threads.md).</span></span>|  
|<xref:System.Threading.Thread.Name%2A>|<span data-ttu-id="19159-143">获取或设置线程的名称。</span><span class="sxs-lookup"><span data-stu-id="19159-143">Gets or sets the name of a thread.</span></span> <span data-ttu-id="19159-144">最常用于在调试时查找各个线程。</span><span class="sxs-lookup"><span data-stu-id="19159-144">Most frequently used to discover individual threads when you debug.</span></span>|  
|<xref:System.Threading.Thread.Priority%2A>|<span data-ttu-id="19159-145">获取或设置由操作系统用来确定线程计划优先顺序的 <xref:System.Threading.ThreadPriority> 值。</span><span class="sxs-lookup"><span data-stu-id="19159-145">Gets or sets a <xref:System.Threading.ThreadPriority> value that is used by the operating system to prioritize thread scheduling.</span></span> <span data-ttu-id="19159-146">有关详细信息，请参阅[计划线程](scheduling-threads.md)和 <xref:System.Threading.ThreadPriority> 引用。</span><span class="sxs-lookup"><span data-stu-id="19159-146">For more information, see [Scheduling threads](scheduling-threads.md) and the <xref:System.Threading.ThreadPriority> reference.</span></span>|  
|<xref:System.Threading.Thread.ThreadState%2A>|<span data-ttu-id="19159-147">获取 <xref:System.Threading.ThreadState> 值，该值包含线程的当前状态。</span><span class="sxs-lookup"><span data-stu-id="19159-147">Gets a <xref:System.Threading.ThreadState> value containing the current states of a thread.</span></span>|  

## <a name="see-also"></a><span data-ttu-id="19159-148">另请参阅</span><span class="sxs-lookup"><span data-stu-id="19159-148">See also</span></span>

- <xref:System.Threading.Thread?displayProperty=nameWithType>
- [<span data-ttu-id="19159-149">线程与线程处理</span><span class="sxs-lookup"><span data-stu-id="19159-149">Threads and Threading</span></span>](threads-and-threading.md)
- [<span data-ttu-id="19159-150">并行编程</span><span class="sxs-lookup"><span data-stu-id="19159-150">Parallel Programming</span></span>](../parallel-programming/index.md)
