---
title: XAML 的集合类型
ms.date: 03/30/2017
ms.assetid: 58f8e7c6-9a41-4f25-8551-c042f1315baa
ms.openlocfilehash: 2ec58026c605df31489c8aab4c4cc714dab11474
ms.sourcegitcommit: de17a7a0a37042f0d4406f5ae5393531caeb25ba
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/24/2020
ms.locfileid: "81432580"
---
# <a name="collections-and-collection-types-for-xaml"></a><span data-ttu-id="1d3c8-102">XAML 的收集类型</span><span class="sxs-lookup"><span data-stu-id="1d3c8-102">Collections and collection types for XAML</span></span>

<span data-ttu-id="1d3c8-103">本文介绍如何定义旨在支持集合的类型的属性，并支持 XAML 语法，以便将集合项实例化为父对象元素或属性元素的元素子级。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-103">This article describes how to define properties of types that are intended to support a collection, and to support the XAML syntax for instantiating collection items as element children of a parent object element or property element.</span></span>

## <a name="xaml-collection-concepts"></a><span data-ttu-id="1d3c8-104">XAML 收集概念</span><span class="sxs-lookup"><span data-stu-id="1d3c8-104">XAML Collection Concepts</span></span>

<span data-ttu-id="1d3c8-105">从概念上讲，XAML 中任何在 XAML 对象元素或 XAML 属性元素范围内有多个子项的关系都必须作为集合实现。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-105">Conceptually, any relationship in XAML where there are multiple child items within the scope of a XAML object element or XAML property element must be implemented as a collection.</span></span> <span data-ttu-id="1d3c8-106">该集合必须与 XAML 类型的特定 XAML 属性相关联，该属性是该关系中的父级。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-106">That collection must be associated with a particular XAML property of the XAML type that is the parent in that relationship.</span></span> <span data-ttu-id="1d3c8-107">属性必须是集合，因为 XAML 处理器希望将标记中的每个项分配为备份集合属性的新添加项。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-107">The property must be a collection because a XAML processor expects to assign each item in markup to be a newly added item of the backing collection property.</span></span>

<span data-ttu-id="1d3c8-108">在 XAML 语言级别，收集支持的确切要求尚未完全定义。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-108">At the XAML language level, the exact requirements of collection support are not fully defined.</span></span> <span data-ttu-id="1d3c8-109">集合可以是列表或字典（但不能同时两者）的概念在 XAML 语言级别定义，但哪些支持类型表示列表或字典不是由 XAML 语言定义的。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-109">The concept that a collection can be either a list or a dictionary(but not both) is defined at the XAML language level, but which backing types represent either lists or dictionaries is not defined by the XAML language.</span></span>

<span data-ttu-id="1d3c8-110">在 .NET XAML 服务中，XAML 集合支持的概念在 .NET 支持类型方面定义得更清晰。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-110">In .NET XAML Services, the concept of XAML collection support is more clearly defined in terms of .NET backing types.</span></span> <span data-ttu-id="1d3c8-111">具体来说，XAML 对集合的支持基于几个 .NET 概念和 API，这些概念和 API 用于一般列表和字典 .NET 编程。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-111">Specifically, the XAML support for collections is based on several .NET concepts and APIs that are used for lists and dictionaries in general .NET programming.</span></span>

1. <span data-ttu-id="1d3c8-112">接口<xref:System.Collections.IList>指示列表集合。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-112">The <xref:System.Collections.IList> interface indicates a list collection.</span></span>

2. <span data-ttu-id="1d3c8-113">接口<xref:System.Collections.IDictionary>指示字典集合。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-113">The <xref:System.Collections.IDictionary> interface indicates a dictionary collection.</span></span>

3. <span data-ttu-id="1d3c8-114"><xref:System.Array>表示数组，数组支持<xref:System.Collections.IList>方法。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-114"><xref:System.Array> represents an array, and an array supports <xref:System.Collections.IList> methods.</span></span>

<span data-ttu-id="1d3c8-115">在这些集合概念中，.NET XAML 服务 XAML 处理器期望在`Add`集合属性类型的特定实例上调用 该方法。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-115">In each of these collection concepts, a .NET XAML Services XAML processor expects to call the `Add` method on a specific instance of the collection property's type.</span></span> <span data-ttu-id="1d3c8-116">或者，在序列化方案中，XAML 处理器根据每个集合的特定概念"Item"为每个在列表、字典或数组中找到的每个项生成离散的 XAML 类型实例。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-116">Or, in a serialization scenario, a XAML processor produces discrete XAML-type instances for each item found in the list, dictionary, or array based on each collection's specific concept of "Items".</span></span> <span data-ttu-id="1d3c8-117">这些项目是： <xref:System.Collections.IList.Item%2A?displayProperty=nameWithType><xref:System.Collections.IDictionary.Item%2A?displayProperty=nameWithType>;的显式<xref:System.Array.System%23Collections%23IList%23Item%2A?displayProperty=nameWithType>。 <xref:System.Array></span><span class="sxs-lookup"><span data-stu-id="1d3c8-117">These items are: <xref:System.Collections.IList.Item%2A?displayProperty=nameWithType>; <xref:System.Collections.IDictionary.Item%2A?displayProperty=nameWithType>; the explicit <xref:System.Array.System%23Collections%23IList%23Item%2A?displayProperty=nameWithType> for <xref:System.Array>.</span></span>

## <a name="generic-collections"></a><span data-ttu-id="1d3c8-118">通用集合</span><span class="sxs-lookup"><span data-stu-id="1d3c8-118">Generic Collections</span></span>

<span data-ttu-id="1d3c8-119">泛型集合可用于常规 .NET 编程，也可用于 XAML 集合属性。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-119">Generic collections can be useful for general .NET programming, and can also be used for XAML collection properties.</span></span> <span data-ttu-id="1d3c8-120">但是，泛型接口<xref:System.Collections.Generic.IList%601>和<xref:System.Collections.Generic.IDictionary%602>.NET XAML 服务 XAML 处理器未标识为等效于非泛<xref:System.Collections.IList>型<xref:System.Collections.IDictionary>或 。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-120">However, the generic interfaces <xref:System.Collections.Generic.IList%601> and <xref:System.Collections.Generic.IDictionary%602> are not identified by .NET XAML Services XAML processors as being equivalent to the non-generic <xref:System.Collections.IList> or <xref:System.Collections.IDictionary>.</span></span> <span data-ttu-id="1d3c8-121">泛型集合属性类型的推荐方法是从类<xref:System.Collections.Generic.List%601>或<xref:System.Collections.Generic.Dictionary%602>派生，而不是实现接口。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-121">Rather than implementing the interfaces, a recommended approach for generic collection property types is to derive from the classes <xref:System.Collections.Generic.List%601> or <xref:System.Collections.Generic.Dictionary%602>.</span></span> <span data-ttu-id="1d3c8-122">这些类实现非泛型接口，从而在基本实现中包括对 XAML 集合的预期支持。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-122">These classes implement the non-generic interfaces and thus include the expected support for XAML collections in the base implementation.</span></span>

## <a name="read-only-collections-and-initialization-logic"></a><span data-ttu-id="1d3c8-123">只读集合和初始化逻辑</span><span class="sxs-lookup"><span data-stu-id="1d3c8-123">Read-Only Collections and Initialization Logic</span></span>

<span data-ttu-id="1d3c8-124">在 .NET 编程中，将保存集合值的任何属性作为只读集合，是一种常见的设计模式。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-124">In .NET programming, it is a common design pattern to make any property that holds a value of a collection as a read-only collection.</span></span> <span data-ttu-id="1d3c8-125">此模式允许拥有集合属性的实例更好地控制集合发生的情况。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-125">This pattern permits the instance that owns the collection property to better control what happens to the collection..</span></span> <span data-ttu-id="1d3c8-126">具体而言，该模式通过设置属性防止意外替换整个预先存在的集合。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-126">Specifically, the pattern prevents accidental replacement of the entire pre-existing collection by setting the property.</span></span> <span data-ttu-id="1d3c8-127">在此模式中，调用方对集合的任何访问都应该通过调用集合类型和/或相关集合接口（如<xref:System.Collections.IList>） 支持的方法或属性进行。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-127">In this pattern, any access to the collection by callers should instead be made by calling methods or properties as supported by the collection type and/or the relevant collection interfaces such as <xref:System.Collections.IList>.</span></span>

<span data-ttu-id="1d3c8-128">使用此模式意味着公开只读集合属性的任何类必须首先初始化该属性以容纳空集合。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-128">Using this pattern implies that any class that exposes a read-only collection property must first initialize that property to hold an empty collection.</span></span> <span data-ttu-id="1d3c8-129">通常，初始化是作为类构造行为的一部分执行的。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-129">Typically the initialization is performed as part of the construction behavior for the class.</span></span> <span data-ttu-id="1d3c8-130">为了对 XAML 有用，无参数构造函数始终引用此类逻辑非常重要，因为 XAML 在处理属性（集合属性或其他）之前通常调用无参数构造函数。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-130">To be useful for XAML, it is important that such logic is always referenced by the parameterless constructor, because XAML generally calls the parameterless constructor prior to processing the properties (collection properties or otherwise).</span></span>

## <a name="xaml-type-system-support-and-collections"></a><span data-ttu-id="1d3c8-131">XAML 类型系统支持和集合</span><span class="sxs-lookup"><span data-stu-id="1d3c8-131">XAML Type System Support and Collections</span></span>

<span data-ttu-id="1d3c8-132">除了解析 XAML 和填充或序列化集合属性的基本机制外，.NET XAML 服务中实现的 XAML 类型系统还包括与 XAML 中的集合相关的多个设计功能。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-132">Beyond the basic mechanics of parsing XAML and populating or serializing collection properties, the XAML type system as implemented in .NET XAML Services includes several design features that pertain to collections in XAML.</span></span>

1. <span data-ttu-id="1d3c8-133"><xref:System.Xaml.XamlType.IsCollection%2A>如果 XAML 类型由提供 XAML 集合支持的类型支持，则返回 true。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-133"><xref:System.Xaml.XamlType.IsCollection%2A> returns true if the XAML type is backed by a type that provides XAML collection support.</span></span>

2. <span data-ttu-id="1d3c8-134"><xref:System.Xaml.XamlType.IsDictionary%2A>并<xref:System.Xaml.XamlType.IsArray%2A>可以进一步识别 XAML 类型支持的集合模式。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-134"><xref:System.Xaml.XamlType.IsDictionary%2A> and <xref:System.Xaml.XamlType.IsArray%2A> can further identify which collection mode the XAML type supports.</span></span> <span data-ttu-id="1d3c8-135">对于基于 .NET XAML 服务和 XAML 类型系统但不基于现有<xref:System.Xaml.XamlWriter>实现的自定义 XAML 处理器，可能需要了解使用哪种收集模式，以便知道要调用哪种方法来进行收集处理。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-135">For custom XAML processors that are based on .NET XAML Services and the XAML type system but not based on existing <xref:System.Xaml.XamlWriter> implementations, knowing which collection mode is used might be necessary in order to know which method to invoke for collection processing.</span></span>

3. <span data-ttu-id="1d3c8-136">以前的每个属性值都可能受 XAML 类型的<xref:System.Xaml.XamlType.LookupCollectionKind%2A>重写的影响。</span><span class="sxs-lookup"><span data-stu-id="1d3c8-136">Each of the previous property values is potentially influenced by overrides of <xref:System.Xaml.XamlType.LookupCollectionKind%2A> on a XAML type.</span></span>
