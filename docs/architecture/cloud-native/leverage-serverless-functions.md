---
title: 利用无服务器函数
description: 在云本机应用程序中利用无服务器和 Azure Functions
ms.date: 04/13/2020
ms.openlocfilehash: 176499e3cd0349cd689b9d13d1c237a6343d13f3
ms.sourcegitcommit: 5988e9a29cedb8757320817deda3c08c6f44a6aa
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/28/2020
ms.locfileid: "82199737"
---
# <a name="leveraging-serverless-functions"></a><span data-ttu-id="6da9d-103">利用无服务器函数</span><span class="sxs-lookup"><span data-stu-id="6da9d-103">Leveraging serverless functions</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="6da9d-104">在极大范围内，从管理物理计算机到利用云功能，无服务器生活在极端的位置。</span><span class="sxs-lookup"><span data-stu-id="6da9d-104">In the spectrum from managing physical machines to leveraging cloud capabilities, serverless lives at the extreme end.</span></span> <span data-ttu-id="6da9d-105">你唯一的责任就是你的代码，你只需在代码运行时付费。</span><span class="sxs-lookup"><span data-stu-id="6da9d-105">Your only responsibility is your code, and you only pay when your code runs.</span></span> <span data-ttu-id="6da9d-106">Azure Functions 提供了一种将无服务器功能构建到你的云本机应用程序中的方法。</span><span class="sxs-lookup"><span data-stu-id="6da9d-106">Azure Functions provides a way to build serverless capabilities into your cloud-native applications.</span></span>

## <a name="what-is-serverless"></a><span data-ttu-id="6da9d-107">什么是无服务器？</span><span class="sxs-lookup"><span data-stu-id="6da9d-107">What is serverless?</span></span>

<span data-ttu-id="6da9d-108">无服务器是云计算的全新服务模型。</span><span class="sxs-lookup"><span data-stu-id="6da9d-108">Serverless is a relatively new service model of cloud computing.</span></span> <span data-ttu-id="6da9d-109">这并不意味着服务器是可选的，你的代码仍会在某个服务器上的某个位置运行。</span><span class="sxs-lookup"><span data-stu-id="6da9d-109">It doesn't mean that servers are optional - your code still runs on a server somewhere.</span></span> <span data-ttu-id="6da9d-110">不同之处在于，应用程序团队不再关心管理服务器基础结构。</span><span class="sxs-lookup"><span data-stu-id="6da9d-110">The distinction is that the application team no longer concerns itself with managing server infrastructure.</span></span> <span data-ttu-id="6da9d-111">相反，云供应商拥有此责任。</span><span class="sxs-lookup"><span data-stu-id="6da9d-111">Instead, the cloud vendor own this responsibility.</span></span> <span data-ttu-id="6da9d-112">开发团队通过向客户提供业务解决方案而不是管道提高其工作效率。</span><span class="sxs-lookup"><span data-stu-id="6da9d-112">The development team increases its productivity by delivering business solutions to customers, not plumbing.</span></span>

<span data-ttu-id="6da9d-113">无服务器计算使用事件触发的无状态容器来托管你的服务。</span><span class="sxs-lookup"><span data-stu-id="6da9d-113">Serverless computing uses event-triggered stateless containers to host your services.</span></span> <span data-ttu-id="6da9d-114">他们可以根据需要向外扩展和以满足需求。</span><span class="sxs-lookup"><span data-stu-id="6da9d-114">They can scale out and in to meet demand as-needed.</span></span> <span data-ttu-id="6da9d-115">Azure Functions 的无服务器平台与其他 Azure 服务（如队列、事件和存储）紧密集成。</span><span class="sxs-lookup"><span data-stu-id="6da9d-115">Serverless platforms like Azure Functions have tight integration with other Azure services like queues, events, and storage.</span></span>

## <a name="what-challenges-are-solved-by-serverless"></a><span data-ttu-id="6da9d-116">无服务器解决了哪些问题？</span><span class="sxs-lookup"><span data-stu-id="6da9d-116">What challenges are solved by serverless?</span></span>

<span data-ttu-id="6da9d-117">无服务器平台解决了许多耗时且昂贵的问题：</span><span class="sxs-lookup"><span data-stu-id="6da9d-117">Serverless platforms address many time-consuming and expensive concerns:</span></span>

- <span data-ttu-id="6da9d-118">购买计算机和软件许可证</span><span class="sxs-lookup"><span data-stu-id="6da9d-118">Purchasing machines and software licenses</span></span>
- <span data-ttu-id="6da9d-119">承载、保护、配置和维护计算机及其网络、电源和/C 要求</span><span class="sxs-lookup"><span data-stu-id="6da9d-119">Housing, securing, configuring, and maintaining the machines and their networking, power, and A/C requirements</span></span>
- <span data-ttu-id="6da9d-120">修补和升级操作系统和软件</span><span class="sxs-lookup"><span data-stu-id="6da9d-120">Patching and upgrading operating systems and software</span></span>
- <span data-ttu-id="6da9d-121">将 web 服务器或计算机服务配置为托管应用程序软件</span><span class="sxs-lookup"><span data-stu-id="6da9d-121">Configuring web servers or machine services to host application software</span></span>
- <span data-ttu-id="6da9d-122">在其平台中配置应用程序软件</span><span class="sxs-lookup"><span data-stu-id="6da9d-122">Configuring application software within its platform</span></span>

<span data-ttu-id="6da9d-123">许多公司分配了大量预算，以支持硬件基础结构问题。</span><span class="sxs-lookup"><span data-stu-id="6da9d-123">Many companies allocate large budgets to support hardware infrastructure concerns.</span></span> <span data-ttu-id="6da9d-124">迁移到云有助于降低这些成本;将应用程序切换到无服务器可以帮助消除它们。</span><span class="sxs-lookup"><span data-stu-id="6da9d-124">Moving to the cloud can help reduce these costs; shifting applications to serverless can help eliminate them.</span></span>

## <a name="what-is-the-difference-between-a-microservice-and-a-serverless-function"></a><span data-ttu-id="6da9d-125">微服务和无服务器函数之间的区别是什么？</span><span class="sxs-lookup"><span data-stu-id="6da9d-125">What is the difference between a microservice and a serverless function?</span></span>

<span data-ttu-id="6da9d-126">通常，微服务封装企业功能，例如在线电子商务网站的购物车。</span><span class="sxs-lookup"><span data-stu-id="6da9d-126">Typically, a microservice encapsulates a business capability, such as a shopping cart for an online eCommerce site.</span></span> <span data-ttu-id="6da9d-127">它公开了多个操作，使用户能够管理其购物体验。</span><span class="sxs-lookup"><span data-stu-id="6da9d-127">It exposes multiple operations that enable a user to manage their shopping experience.</span></span> <span data-ttu-id="6da9d-128">然而，函数是一种小型的轻型代码块，它执行单一用途操作来响应事件。</span><span class="sxs-lookup"><span data-stu-id="6da9d-128">A function, however, is a small, lightweight block of code that executes a single-purpose operation in response to an event.</span></span>
<span data-ttu-id="6da9d-129">通常构造微服务来响应请求，通常来自接口。</span><span class="sxs-lookup"><span data-stu-id="6da9d-129">Microservices are typically constructed to respond to requests, often from an interface.</span></span> <span data-ttu-id="6da9d-130">请求可以是 HTTP Rest 或基于 gRPC 的。</span><span class="sxs-lookup"><span data-stu-id="6da9d-130">Requests can be HTTP Rest- or gRPC-based.</span></span> <span data-ttu-id="6da9d-131">无服务器服务响应事件。</span><span class="sxs-lookup"><span data-stu-id="6da9d-131">Serverless services respond to events.</span></span> <span data-ttu-id="6da9d-132">其事件驱动的体系结构非常适合用于处理短时间运行的后台任务。</span><span class="sxs-lookup"><span data-stu-id="6da9d-132">Its event-driven architecture is ideal for processing short-running, background tasks.</span></span>

## <a name="what-scenarios-are-appropriate-for-serverless"></a><span data-ttu-id="6da9d-133">哪些方案适用于无服务器？</span><span class="sxs-lookup"><span data-stu-id="6da9d-133">What scenarios are appropriate for serverless?</span></span>

<span data-ttu-id="6da9d-134">无服务器显示为响应触发器而调用的各个短时间运行的函数。</span><span class="sxs-lookup"><span data-stu-id="6da9d-134">Serverless exposes individual short-running functions that are invoked in response to a trigger.</span></span> <span data-ttu-id="6da9d-135">这使它们非常适合用于处理后台任务。</span><span class="sxs-lookup"><span data-stu-id="6da9d-135">This makes them ideal for processing background tasks.</span></span>

<span data-ttu-id="6da9d-136">应用程序可能需要在工作流中作为一个步骤发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="6da9d-136">An application might need to send an email as a step in a workflow.</span></span> <span data-ttu-id="6da9d-137">不要以微服务请求的形式发送通知，而是将消息详细信息放到队列中。</span><span class="sxs-lookup"><span data-stu-id="6da9d-137">Instead of sending the notification as part of a microservice request, place the message details onto a queue.</span></span> <span data-ttu-id="6da9d-138">Azure 函数可以取消对消息的排队并以异步方式发送电子邮件。</span><span class="sxs-lookup"><span data-stu-id="6da9d-138">An Azure Function can dequeue the message and asynchronously send the email.</span></span> <span data-ttu-id="6da9d-139">这样做可以提高微服务的性能和可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="6da9d-139">Doing so could improve the performance and scalability of the microservice.</span></span> <span data-ttu-id="6da9d-140">可以实施[基于队列的负载调节](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling)，以避免与发送电子邮件相关的瓶颈。</span><span class="sxs-lookup"><span data-stu-id="6da9d-140">[Queue-based load leveling](https://docs.microsoft.com/azure/architecture/patterns/queue-based-load-leveling) can be implemented to avoid bottlenecks related to sending the emails.</span></span> <span data-ttu-id="6da9d-141">此外，可以在多个不同的应用程序中将此独立服务作为一个实用工具重复使用。</span><span class="sxs-lookup"><span data-stu-id="6da9d-141">Additionally, this stand-alone service could be reused as a utility across many different applications.</span></span>

<span data-ttu-id="6da9d-142">来自队列和主题的异步消息传送是触发无服务器函数的一种常见模式。</span><span class="sxs-lookup"><span data-stu-id="6da9d-142">Asynchronous messaging from queues and topics is a common pattern to trigger serverless functions.</span></span> <span data-ttu-id="6da9d-143">但是，可以由其他事件（如对 Azure Blob 存储的更改）触发 Azure Functions。</span><span class="sxs-lookup"><span data-stu-id="6da9d-143">However, Azure Functions can be triggered by other events, such as changes to Azure Blob Storage.</span></span> <span data-ttu-id="6da9d-144">支持图像上传的服务可以有一个负责优化映像大小的 Azure 函数。</span><span class="sxs-lookup"><span data-stu-id="6da9d-144">A service that supports image uploads could have an Azure Function responsible for optimizing the image size.</span></span> <span data-ttu-id="6da9d-145">此函数可通过插入到 Azure Blob 存储中直接触发，使微服务操作的复杂性保持不变。</span><span class="sxs-lookup"><span data-stu-id="6da9d-145">The function could be triggered directly by inserts into Azure Blob Storage, keeping complexity out of the microservice operations.</span></span>

<span data-ttu-id="6da9d-146">许多服务具有长时间运行的进程，作为其工作流的一部分。</span><span class="sxs-lookup"><span data-stu-id="6da9d-146">Many services have long-running processes as part of their workflows.</span></span> <span data-ttu-id="6da9d-147">通常，这些任务在用户与应用程序交互的过程中完成。</span><span class="sxs-lookup"><span data-stu-id="6da9d-147">Often these tasks are done as part of the user's interaction with the application.</span></span> <span data-ttu-id="6da9d-148">这些任务可强制用户等待，对其体验产生负面影响。</span><span class="sxs-lookup"><span data-stu-id="6da9d-148">These tasks can force the user to wait, negatively impacting their experience.</span></span> <span data-ttu-id="6da9d-149">无服务器计算提供在用户交互循环之外移动较慢任务的一种绝佳方式。</span><span class="sxs-lookup"><span data-stu-id="6da9d-149">Serverless computing provides a great way to move slower tasks outside of the user interaction loop.</span></span> <span data-ttu-id="6da9d-150">这些任务可以按需求进行缩放，而无需整个应用程序进行缩放。</span><span class="sxs-lookup"><span data-stu-id="6da9d-150">These tasks can scale with demand without requiring the entire application to scale.</span></span>

## <a name="when-should-you-avoid-serverless"></a><span data-ttu-id="6da9d-151">何时应避免无服务器服务器？</span><span class="sxs-lookup"><span data-stu-id="6da9d-151">When should you avoid serverless?</span></span>

<span data-ttu-id="6da9d-152">无服务器解决方案预配，按需缩放。</span><span class="sxs-lookup"><span data-stu-id="6da9d-152">Serverless solutions provision and scale on demand.</span></span> <span data-ttu-id="6da9d-153">调用新的实例时，冷启动是一个常见问题。</span><span class="sxs-lookup"><span data-stu-id="6da9d-153">When a new instance is invoked, cold starts are a common issue.</span></span> <span data-ttu-id="6da9d-154">冷启动是设置此实例所用的时间段。</span><span class="sxs-lookup"><span data-stu-id="6da9d-154">A cold start is the period of time it takes to provision this instance.</span></span> <span data-ttu-id="6da9d-155">通常，这种延迟可能会有几秒钟，但可能会更长，具体取决于不同的因素。</span><span class="sxs-lookup"><span data-stu-id="6da9d-155">Normally, this delay might be a few seconds, but can be longer depending on various factors.</span></span> <span data-ttu-id="6da9d-156">预配后，只要单个实例接收到定期请求，就会保持活动状态。</span><span class="sxs-lookup"><span data-stu-id="6da9d-156">Once provisioned, a single instance is kept alive as long as it receives periodic requests.</span></span> <span data-ttu-id="6da9d-157">但是，如果调用的服务不太频繁，Azure 可能会将其从内存中删除，并在 reinvoked 时需要冷启动。</span><span class="sxs-lookup"><span data-stu-id="6da9d-157">But, if a service is called less frequently, Azure may remove it from memory and require a cold start when reinvoked.</span></span> <span data-ttu-id="6da9d-158">当函数扩展到新实例时，还需要冷启动。</span><span class="sxs-lookup"><span data-stu-id="6da9d-158">Cold starts are also required when a function scales out to a new instance.</span></span>

<span data-ttu-id="6da9d-159">图3-10 显示了冷启动模式。</span><span class="sxs-lookup"><span data-stu-id="6da9d-159">Figure 3-10 shows a cold-start pattern.</span></span> <span data-ttu-id="6da9d-160">请注意应用程序冷时所需的额外步骤。</span><span class="sxs-lookup"><span data-stu-id="6da9d-160">Note the extra steps required when the app is cold.</span></span>

<span data-ttu-id="6da9d-161">![冷启动](./media/cold-start-warm-start.png)
**图 3-10**。</span><span class="sxs-lookup"><span data-stu-id="6da9d-161">![Cold versus warm start](./media/cold-start-warm-start.png)
**Figure 3-10**.</span></span> <span data-ttu-id="6da9d-162">冷启动和热启动。</span><span class="sxs-lookup"><span data-stu-id="6da9d-162">Cold start versus warm start.</span></span>

<span data-ttu-id="6da9d-163">为了避免冷启动，可能需要从[消耗计划切换到专用计划](https://azure.microsoft.com/blog/understanding-serverless-cold-start/)。</span><span class="sxs-lookup"><span data-stu-id="6da9d-163">To avoid cold starts entirely, you might switch from a [consumption plan to a dedicated plan](https://azure.microsoft.com/blog/understanding-serverless-cold-start/).</span></span> <span data-ttu-id="6da9d-164">你还可以配置一个或多个具有高级计划升级的[预准备好实例](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances)。</span><span class="sxs-lookup"><span data-stu-id="6da9d-164">You can also configure one or more [pre-warmed instances](https://docs.microsoft.com/azure/azure-functions/functions-premium-plan#pre-warmed-instances) with the premium plan upgrade.</span></span> <span data-ttu-id="6da9d-165">在这些情况下，当你需要添加另一个实例时，该实例已准备就绪，可以继续。</span><span class="sxs-lookup"><span data-stu-id="6da9d-165">In these cases, when you need to add another instance, it's already up and ready to go.</span></span> <span data-ttu-id="6da9d-166">这些选项可帮助减少与无服务器计算相关的冷启动问题。</span><span class="sxs-lookup"><span data-stu-id="6da9d-166">These options can help mitigate the cold start issue associated with serverless computing.</span></span>

<span data-ttu-id="6da9d-167">云提供程序根据计算执行时间和使用的内存计费无服务器。</span><span class="sxs-lookup"><span data-stu-id="6da9d-167">Cloud providers bill for serverless based on compute execution time and consumed memory.</span></span> <span data-ttu-id="6da9d-168">长时间运行的操作或高内存消耗工作负荷并非始终是无服务器的最佳候选项。</span><span class="sxs-lookup"><span data-stu-id="6da9d-168">Long running operations or high memory consumption workloads aren't always the best candidates for serverless.</span></span> <span data-ttu-id="6da9d-169">无服务器函数适用于可快速完成的小型工作块。</span><span class="sxs-lookup"><span data-stu-id="6da9d-169">Serverless functions favor small chunks of work that can complete quickly.</span></span> <span data-ttu-id="6da9d-170">大多数无服务器平台需要在几分钟内完成单个功能。</span><span class="sxs-lookup"><span data-stu-id="6da9d-170">Most serverless platforms require individual functions to complete within a few minutes.</span></span> <span data-ttu-id="6da9d-171">Azure Functions 默认为5分钟的超时持续时间，最多可以配置10分钟。</span><span class="sxs-lookup"><span data-stu-id="6da9d-171">Azure Functions defaults to a 5-minute time-out duration, which can be configured up to 10 minutes.</span></span> <span data-ttu-id="6da9d-172">Azure Functions 高级计划还可以减少此问题，并将超时设置为30分钟，且可配置的限制更多。</span><span class="sxs-lookup"><span data-stu-id="6da9d-172">The Azure Functions premium plan can mitigate this issue as well, defaulting time-outs to 30 minutes with an unbounded higher limit that can be configured.</span></span> <span data-ttu-id="6da9d-173">计算时间不是日历时间。</span><span class="sxs-lookup"><span data-stu-id="6da9d-173">Compute time isn't calendar time.</span></span> <span data-ttu-id="6da9d-174">使用[Azure Durable Functions framework](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?tabs=csharp)的更高级功能可能会在几天内暂停执行。</span><span class="sxs-lookup"><span data-stu-id="6da9d-174">More advanced functions using the [Azure Durable Functions framework](https://docs.microsoft.com/azure/azure-functions/durable/durable-functions-overview?tabs=csharp) may pause execution over a course of several days.</span></span> <span data-ttu-id="6da9d-175">根据实际执行时间计费-当函数唤醒并继续处理时。</span><span class="sxs-lookup"><span data-stu-id="6da9d-175">The billing is based on actual execution time - when the function wakes up and resumes processing.</span></span>

<span data-ttu-id="6da9d-176">最后，利用应用程序任务 Azure Functions 增加了复杂性。</span><span class="sxs-lookup"><span data-stu-id="6da9d-176">Finally, leveraging Azure Functions for application tasks adds complexity.</span></span> <span data-ttu-id="6da9d-177">首先，将应用程序设计为模块化、松散耦合的设计是明智的。</span><span class="sxs-lookup"><span data-stu-id="6da9d-177">It's wise to first architect your application with a modular, loosely coupled design.</span></span> <span data-ttu-id="6da9d-178">然后，确定是否有无服务器可提供的权益来论证额外的复杂性。</span><span class="sxs-lookup"><span data-stu-id="6da9d-178">Then, identify if there are benefits serverless would offer that justify the additional complexity.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="6da9d-179">[上一页](leverage-containers-orchestrators.md)
>[下一页](combine-containers-serverless-approaches.md)</span><span class="sxs-lookup"><span data-stu-id="6da9d-179">[Previous](leverage-containers-orchestrators.md)
[Next](combine-containers-serverless-approaches.md)</span></span>
