---
title: 在云本机应用程序中缓存
description: 了解云本机应用程序中的缓存策略。
author: robvet
ms.date: 01/22/2020
ms.openlocfilehash: 2da61a01fc53233d1934df813fcba3b91a495c43
ms.sourcegitcommit: 13e79efdbd589cad6b1de634f5d6b1262b12ab01
ms.translationtype: MT
ms.contentlocale: zh-CN
ms.lasthandoff: 01/28/2020
ms.locfileid: "76795115"
---
# <a name="caching-in-a-cloud-native-app"></a><span data-ttu-id="b4b10-103">在云本机应用中缓存</span><span class="sxs-lookup"><span data-stu-id="b4b10-103">Caching in a cloud-native app</span></span>

[!INCLUDE [book-preview](../../../includes/book-preview.md)]

<span data-ttu-id="b4b10-104">缓存的优点非常好理解。</span><span class="sxs-lookup"><span data-stu-id="b4b10-104">The benefits of caching are well understood.</span></span> <span data-ttu-id="b4b10-105">此方法的工作方式是将经常访问的数据从后端数据存储区暂时复制到靠近应用程序的*快速存储*。</span><span class="sxs-lookup"><span data-stu-id="b4b10-105">The technique works by temporarily copying frequently accessed data from a backend data store to *fast storage* that's located closer to the application.</span></span> <span data-ttu-id="b4b10-106">缓存通常是在 。</span><span class="sxs-lookup"><span data-stu-id="b4b10-106">Caching is often implemented where...</span></span>

- <span data-ttu-id="b4b10-107">数据保持相对静态。</span><span class="sxs-lookup"><span data-stu-id="b4b10-107">Data remains relatively static.</span></span>
- <span data-ttu-id="b4b10-108">数据访问速度较慢，尤其与缓存速度相比。</span><span class="sxs-lookup"><span data-stu-id="b4b10-108">Data access is slow, especially compared to the speed of the cache.</span></span>
- <span data-ttu-id="b4b10-109">数据受到高级别争用的限制。</span><span class="sxs-lookup"><span data-stu-id="b4b10-109">Data is subject to high levels of contention.</span></span>

## <a name="why"></a><span data-ttu-id="b4b10-110">为什么?</span><span class="sxs-lookup"><span data-stu-id="b4b10-110">Why?</span></span>

<span data-ttu-id="b4b10-111">如[Microsoft 缓存指南](https://docs.microsoft.com/azure/architecture/best-practices/caching)中所述，缓存可提高单个微服务和整个系统的性能、可伸缩性和可用性。</span><span class="sxs-lookup"><span data-stu-id="b4b10-111">As discussed in the [Microsoft caching guidance](https://docs.microsoft.com/azure/architecture/best-practices/caching), caching can increase performance, scalability, and availability for individual microservices and the system as a whole.</span></span> <span data-ttu-id="b4b10-112">它减少了处理对数据存储的大量并发请求的延迟和争用。</span><span class="sxs-lookup"><span data-stu-id="b4b10-112">It reduces the latency and contention of handling large volumes of concurrent requests to a data store.</span></span> <span data-ttu-id="b4b10-113">随着数据量和用户数量的增加，缓存的优点也就越大。</span><span class="sxs-lookup"><span data-stu-id="b4b10-113">As data volume and the number of users increase, the greater the benefits of caching become.</span></span>

<span data-ttu-id="b4b10-114">当客户端重复读取不可变或不经常更改的数据时，缓存最有效。</span><span class="sxs-lookup"><span data-stu-id="b4b10-114">Caching is most effective when a client repeatedly reads data that is immutable or that changes infrequently.</span></span> <span data-ttu-id="b4b10-115">示例包括引用信息，如产品和定价信息，或构建成本高昂的共享静态资源。</span><span class="sxs-lookup"><span data-stu-id="b4b10-115">Examples include reference information such as product and pricing information, or shared static resources that are costly to construct.</span></span>

<span data-ttu-id="b4b10-116">尽管微服务应是无状态的，但当绝对需要时，分布式缓存可支持对会话状态数据进行并发访问。</span><span class="sxs-lookup"><span data-stu-id="b4b10-116">While microservices should be stateless, a distributed cache can support concurrent access to session state data when absolutely required.</span></span>

<span data-ttu-id="b4b10-117">还应考虑进行缓存以避免重复计算。</span><span class="sxs-lookup"><span data-stu-id="b4b10-117">Also consider caching to avoid repetitive computations.</span></span> <span data-ttu-id="b4b10-118">如果操作会转换数据或执行复杂计算，请缓存后续请求的结果。</span><span class="sxs-lookup"><span data-stu-id="b4b10-118">If an operation transforms data or performs a complicated calculation, cache the result for subsequent requests.</span></span>

## <a name="caching-architecture"></a><span data-ttu-id="b4b10-119">缓存体系结构</span><span class="sxs-lookup"><span data-stu-id="b4b10-119">Caching architecture</span></span>

<span data-ttu-id="b4b10-120">云本机应用程序通常实现分布式缓存结构。</span><span class="sxs-lookup"><span data-stu-id="b4b10-120">Cloud native applications typically implement a distributed caching architecture.</span></span> <span data-ttu-id="b4b10-121">缓存是作为基于云的[后备服务](./definition.md#backing-services)托管的，独立于微服务。</span><span class="sxs-lookup"><span data-stu-id="b4b10-121">The cache is hosted as a cloud-based [backing service](./definition.md#backing-services), separate from the microservices.</span></span> <span data-ttu-id="b4b10-122">图5-20 显示了此体系结构。</span><span class="sxs-lookup"><span data-stu-id="b4b10-122">Figure 5-20 shows the architecture.</span></span>

![云本机应用中的缓存](media/caching-in-a-cloud-native-app.png)

<span data-ttu-id="b4b10-124">**图 5-19**：云本机应用中的缓存</span><span class="sxs-lookup"><span data-stu-id="b4b10-124">**Figure 5-19**: Caching in a cloud native app</span></span>

<span data-ttu-id="b4b10-125">在上图中，请注意缓存如何独立于微服务并由其共享。</span><span class="sxs-lookup"><span data-stu-id="b4b10-125">In the previous figure, note how the cache is independent of and shared by the microservices.</span></span> <span data-ttu-id="b4b10-126">在此方案中，通过[API 网关](./front-end-communication.md)调用缓存。</span><span class="sxs-lookup"><span data-stu-id="b4b10-126">In this scenario, the cache is invoked by the [API Gateway](./front-end-communication.md).</span></span> <span data-ttu-id="b4b10-127">如第4章所述，该网关充当所有传入请求的前端。</span><span class="sxs-lookup"><span data-stu-id="b4b10-127">As discussed in chapter 4, the gateway serves as a front end for all incoming requests.</span></span> <span data-ttu-id="b4b10-128">分布式缓存会尽可能返回缓存的数据，从而提高系统的响应能力。</span><span class="sxs-lookup"><span data-stu-id="b4b10-128">The distributed cache increases system responsiveness by returning cached data whenever possible.</span></span> <span data-ttu-id="b4b10-129">此外，从服务中分离缓存允许缓存单独进行扩展或缩减以满足增加的流量需求。</span><span class="sxs-lookup"><span data-stu-id="b4b10-129">Additionally, separating the cache from the services allows the cache to scale up or out independently to meet increased traffic demands.</span></span>

<span data-ttu-id="b4b10-130">该图展示了一种称为[缓存备用模式](https://docs.microsoft.com/azure/architecture/patterns/cache-aside)的常见缓存模式。</span><span class="sxs-lookup"><span data-stu-id="b4b10-130">The figure presents a common caching pattern known as the [cache-aside pattern](https://docs.microsoft.com/azure/architecture/patterns/cache-aside).</span></span> <span data-ttu-id="b4b10-131">对于传入请求，首先查询缓存（步骤 \#1）以获取响应。</span><span class="sxs-lookup"><span data-stu-id="b4b10-131">For an incoming request, you first query the cache (step \#1) for a response.</span></span> <span data-ttu-id="b4b10-132">如果找到，则立即返回数据。</span><span class="sxs-lookup"><span data-stu-id="b4b10-132">If found, the data is returned immediately.</span></span> <span data-ttu-id="b4b10-133">如果缓存中不存在数据（称为[缓存未命中](https://www.techopedia.com/definition/6308/cache-miss)），则会从下游服务（步骤 \#2）中的本地数据库检索数据。</span><span class="sxs-lookup"><span data-stu-id="b4b10-133">If the data doesn't exist in the cache (known as a [cache miss](https://www.techopedia.com/definition/6308/cache-miss)), it's retrieved from a local database in a downstream service (step \#2).</span></span> <span data-ttu-id="b4b10-134">然后，将其写入缓存供将来请求（步骤 \#3），并返回给调用方。</span><span class="sxs-lookup"><span data-stu-id="b4b10-134">It's then written to the cache for future requests (step \#3), and returned to the caller.</span></span> <span data-ttu-id="b4b10-135">必须小心，以便定期逐出缓存的数据，以便系统保持及时和一致。</span><span class="sxs-lookup"><span data-stu-id="b4b10-135">Care must be taken to periodically evict cached data so that the system remains timely and consistent.</span></span>

<span data-ttu-id="b4b10-136">随着共享缓存的增长，在多个节点上对数据进行分区可能会有好处。</span><span class="sxs-lookup"><span data-stu-id="b4b10-136">As a shared cache grows, it might prove beneficial to partition its data across multiple nodes.</span></span> <span data-ttu-id="b4b10-137">这样做可帮助最大程度地减少争用并提高可伸缩性。</span><span class="sxs-lookup"><span data-stu-id="b4b10-137">Doing so can help minimize contention and improve scalability.</span></span> <span data-ttu-id="b4b10-138">许多缓存服务支持动态添加和删除节点，以及跨分区重新平衡数据。</span><span class="sxs-lookup"><span data-stu-id="b4b10-138">Many Caching services support the ability to dynamically add and remove nodes and rebalance data across partitions.</span></span> <span data-ttu-id="b4b10-139">此方法通常涉及群集。</span><span class="sxs-lookup"><span data-stu-id="b4b10-139">This approach typically involves clustering.</span></span> <span data-ttu-id="b4b10-140">聚类分析将联合节点集合作为无缝单一缓存公开。</span><span class="sxs-lookup"><span data-stu-id="b4b10-140">Clustering exposes a collection of federated nodes as a seamless, single cache.</span></span> <span data-ttu-id="b4b10-141">但是，在内部，数据按预定义的分发策略分散到各个节点，以均衡负载。</span><span class="sxs-lookup"><span data-stu-id="b4b10-141">Internally, however, the data is dispersed across the nodes following a predefined distribution strategy that balances the load evenly.</span></span>

## <a name="azure-cache-for-redis"></a><span data-ttu-id="b4b10-142">用于 Redis 的 Azure 缓存</span><span class="sxs-lookup"><span data-stu-id="b4b10-142">Azure Cache for Redis</span></span>

<span data-ttu-id="b4b10-143">[适用于 Redis 的 Azure 缓存](https://azure.microsoft.com/services/cache/)是一种安全的数据缓存和消息代理服务，由 Microsoft 全面管理。</span><span class="sxs-lookup"><span data-stu-id="b4b10-143">[Azure Cache for Redis](https://azure.microsoft.com/services/cache/) is a secure data caching and messaging broker service, fully managed by Microsoft.</span></span> <span data-ttu-id="b4b10-144">它用作一种平台即服务（PaaS）产品，可提供高吞吐量和低延迟的数据访问。</span><span class="sxs-lookup"><span data-stu-id="b4b10-144">Consumed as a Platform as a Service (PaaS) offering, it provides high throughput and low-latency access to data.</span></span> <span data-ttu-id="b4b10-145">Azure 内部或外部的任何应用程序都可以访问该服务。</span><span class="sxs-lookup"><span data-stu-id="b4b10-145">The service is accessible to any application within or outside of Azure.</span></span>

<span data-ttu-id="b4b10-146">Azure Cache for Redis 服务管理对跨 Azure 数据中心托管的开放源代码 Redis 服务器的访问。</span><span class="sxs-lookup"><span data-stu-id="b4b10-146">The Azure Cache for Redis service manages access to open-source Redis servers hosted across Azure data centers.</span></span> <span data-ttu-id="b4b10-147">该服务充当提供管理、访问控制和安全性的外观。</span><span class="sxs-lookup"><span data-stu-id="b4b10-147">The service acts as a facade providing management, access control, and security.</span></span> <span data-ttu-id="b4b10-148">服务本身支持一组丰富的数据结构，包括字符串、哈希、列表和集。</span><span class="sxs-lookup"><span data-stu-id="b4b10-148">The service natively supports a rich set of data structures, including strings, hashes, lists, and sets.</span></span> <span data-ttu-id="b4b10-149">如果你的应用程序已使用 Redis，则它将按原样使用 Azure Cache for Redis。</span><span class="sxs-lookup"><span data-stu-id="b4b10-149">If your application already uses Redis, it will work as-is with Azure Cache for Redis.</span></span>

<span data-ttu-id="b4b10-150">适用于 Redis 的 Azure 缓存大于简单缓存服务器。</span><span class="sxs-lookup"><span data-stu-id="b4b10-150">Azure Cache for Redis is more than a simple cache server.</span></span> <span data-ttu-id="b4b10-151">它可以支持多种方案来增强微服务的体系结构：</span><span class="sxs-lookup"><span data-stu-id="b4b10-151">It can support a number of scenarios to enhance a microservices architecture:</span></span>

- <span data-ttu-id="b4b10-152">内存中数据存储区</span><span class="sxs-lookup"><span data-stu-id="b4b10-152">An in-memory data store</span></span>
- <span data-ttu-id="b4b10-153">分布式非关系数据库</span><span class="sxs-lookup"><span data-stu-id="b4b10-153">A distributed non-relational database</span></span>
- <span data-ttu-id="b4b10-154">消息代理</span><span class="sxs-lookup"><span data-stu-id="b4b10-154">A message broker</span></span>
- <span data-ttu-id="b4b10-155">配置或发现服务器</span><span class="sxs-lookup"><span data-stu-id="b4b10-155">A configuration or discovery server</span></span>
  
<span data-ttu-id="b4b10-156">对于高级方案，可以将缓存数据的副本[持久保存到磁盘](https://docs.microsoft.com/azure/azure-cache-for-redis/cache-how-to-premium-persistence)。</span><span class="sxs-lookup"><span data-stu-id="b4b10-156">For advanced scenarios, a copy of the cached data can be [persisted to disk](https://docs.microsoft.com/azure/azure-cache-for-redis/cache-how-to-premium-persistence).</span></span> <span data-ttu-id="b4b10-157">如果灾难性事件同时禁用主缓存和副本缓存，则会从最新快照重新构造缓存。</span><span class="sxs-lookup"><span data-stu-id="b4b10-157">If a catastrophic event disables both the primary and replica caches, the cache is reconstructed from the most recent snapshot.</span></span>

<span data-ttu-id="b4b10-158">Azure Redis 缓存可用于许多预定义的配置和定价层。</span><span class="sxs-lookup"><span data-stu-id="b4b10-158">Azure Redis Cache is available across a number of predefined configurations and pricing tiers.</span></span>  <span data-ttu-id="b4b10-159">[高级层](https://docs.microsoft.com/azure/azure-cache-for-redis/cache-premium-tier-intro)的功能包括多种企业级功能，如群集、数据持久性、异地复制和虚拟网络隔离。</span><span class="sxs-lookup"><span data-stu-id="b4b10-159">The [Premium tier](https://docs.microsoft.com/azure/azure-cache-for-redis/cache-premium-tier-intro) features many enterprise-level features such as clustering, data persistence, geo-replication, and virtual-network isolation.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="b4b10-160">[上一页](relational-vs-nosql-data.md)
>[下一页](elastic-search-in-azure.md)</span><span class="sxs-lookup"><span data-stu-id="b4b10-160">[Previous](relational-vs-nosql-data.md)
[Next](elastic-search-in-azure.md)</span></span>
