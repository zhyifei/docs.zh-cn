---
title: 将现有 .NET 应用部署为 Windows 容器
description: 通过 Azure 云和 Windows 容器现代化现有 .NET 应用程序 | 将现有 .NET 应用部署为 Windows 容器
ms.date: 04/29/2018
ms.openlocfilehash: 15e99e2ec0edd072a3d47d5c212ebbbf6705ecef
ms.sourcegitcommit: 465547886a1224a5435c3ac349c805e39ce77706
ms.translationtype: HT
ms.contentlocale: zh-CN
ms.lasthandoff: 04/21/2020
ms.locfileid: "81738429"
---
# <a name="deploy-existing-net-apps-as-windows-containers"></a><span data-ttu-id="d0ae5-103">将现有 .NET 应用部署为 Windows 容器</span><span class="sxs-lookup"><span data-stu-id="d0ae5-103">Deploy existing .NET apps as Windows containers</span></span>

<span data-ttu-id="d0ae5-104">基于 Windows 容器的部署适用于云优化的应用程序和云原生应用程序。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-104">Deployments that are based on Windows Containers are applicable to Cloud-Optimized applications and Cloud-Native applications.</span></span>

<span data-ttu-id="d0ae5-105">但在本指南中，尤其在以下部分中，主要介绍将 Windows 容器用于云优化  的应用程序，其中无需重新架构应用程序。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-105">However, in this guide and especially in the following sections, it mostly focuses on using Windows Containers for *Cloud-Optimized* applications where you don't need to rearchitect your application.</span></span>

## <a name="what-are-containers-linux-or-windows"></a><span data-ttu-id="d0ae5-106">什么是容器？</span><span class="sxs-lookup"><span data-stu-id="d0ae5-106">What are containers?</span></span> <span data-ttu-id="d0ae5-107">（Linux 或 Windows）</span><span class="sxs-lookup"><span data-stu-id="d0ae5-107">(Linux or Windows)</span></span>

<span data-ttu-id="d0ae5-108">容器是将应用程序打包到其自己的独立包中的一种方法。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-108">Containers are a way to wrap up an application into its own isolated package.</span></span> <span data-ttu-id="d0ae5-109">在其容器中，应用程序不受容器外部的应用程序或进程的影响。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-109">In its container, the application is not affected by applications or processes that exist outside of the container.</span></span> <span data-ttu-id="d0ae5-110">应用程序作为一个进程成功运行所依赖的一切都在容器内部。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-110">Everything the application depends on to run successfully as a process is inside the container.</span></span> <span data-ttu-id="d0ae5-111">无论容器可能移动到哪里，就直接依赖项而言，都将始终满足应用程序的要求，因为它与需要运行的所有内容（库依赖项、运行时等）捆绑在一起。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-111">Wherever the container might move, the requirements of the application will always be met, in terms of direct dependencies, because it is bundled with everything that it needs to run (library dependencies, runtimes, and so on).</span></span>

<span data-ttu-id="d0ae5-112">容器的主要特性是，它使环境在不同的部署中是相同的，因为容器本身附带了所需的所有依赖项。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-112">The main characteristic of a container is that it makes the environment the same across different deployments because the container itself comes with all the dependencies it needs.</span></span> <span data-ttu-id="d0ae5-113">你可以在计算机上调试应用程序，然后将其部署到保证具有相同环境的另一台计算机上。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-113">You can debug the application on your machine, and then deploy it to another machine, with the same environment guaranteed.</span></span>

<span data-ttu-id="d0ae5-114">容器是容器映像的实例。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-114">A container is an instance of a container image.</span></span> <span data-ttu-id="d0ae5-115">借助容器映像，可打包应用或服务（例如快照）并采用可靠且可重现的方式对其进行部署。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-115">A container image is a way to package an app or service (like a snapshot), and then deploy it in a reliable and reproducible way.</span></span> <span data-ttu-id="d0ae5-116">可以说 Docker 不只是一种技术，还是一种原理和过程。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-116">You could say that Docker is not only a technology-it's also a philosophy and a process.</span></span>

<span data-ttu-id="d0ae5-117">随着容器在日常变得越来越普遍，它们正成为行业范围内的“部署单元”。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-117">As containers daily become more common, they are becoming an industry-wide "unit of deployment."</span></span>

## <a name="benefits-of-containers-docker-engine-on-linux-or-windows"></a><span data-ttu-id="d0ae5-118">容器的优点（Linux 或 Windows 上的 Docker 引擎）</span><span class="sxs-lookup"><span data-stu-id="d0ae5-118">Benefits of containers (Docker Engine on Linux or Windows)</span></span>

<span data-ttu-id="d0ae5-119">使用容器（也可以定义为轻型构建块）构建应用程序，显著提高了敏捷性，有助于跨任何基础结构构建、传送和运行任何应用程序。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-119">Building applications by using containers-which also might be defined as lightweight building blocks-offers a significant increase in agility for building, shipping, and running any application, across any infrastructure.</span></span>

<span data-ttu-id="d0ae5-120">借助容器，只需稍微更改或无需更改代码，就可以将任何应用从开发带到生产，这是因为跨 Microsoft 开发人员工具、操作系统和云进行了 Docker 集成。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-120">With containers, you can take any app from development to production with little or no code change, thanks to Docker integration across Microsoft developer tools, operating systems, and cloud.</span></span>

<span data-ttu-id="d0ae5-121">当部署到普通虚拟机时，你可能已经有了将 ASP.NET 应用部署到虚拟机的方法。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-121">When you deploy to plain VMs, you probably already have a method in place for deploying ASP.NET apps to your VMs.</span></span> <span data-ttu-id="d0ae5-122">但是，使用 Puppet 等部署工具或类似工具，你的方法可能会涉及多个手动步骤或复杂的自动化过程。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-122">It's likely, though, that your method involves multiple manual steps or complex automated processes by using a deployment tool like Puppet, or a similar tool.</span></span> <span data-ttu-id="d0ae5-123">你可能需要执行诸如修改配置项、在服务器之间复制应用程序内容以及基于 .msi 设置运行交互式安装程序之类的任务，然后进行测试。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-123">You might need to perform tasks like modifying configuration items, copying application content between servers, and running interactive setup programs based on .msi setups, followed by testing.</span></span> <span data-ttu-id="d0ae5-124">部署中的所有这些步骤都会增加部署时间和风险。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-124">All those steps in the deployment add time and risk to deployments.</span></span> <span data-ttu-id="d0ae5-125">每当目标环境中不存在依赖项时，都将失败。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-125">You will get failures whenever a dependency is not present in the target environment.</span></span>

<span data-ttu-id="d0ae5-126">在 Windows 容器中，打包应用程序的过程是完全自动化的。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-126">In Windows Containers, the process of packaging applications is fully automated.</span></span> <span data-ttu-id="d0ae5-127">Windows 容器基于 Docker 平台，该平台为容器部署提供自动更新和回滚功能。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-127">Windows Containers is based on the Docker platform, which offers automatic updates and rollbacks for container deployments.</span></span> <span data-ttu-id="d0ae5-128">使用 Docker 引擎所获得的主要改进就是利用所有依赖项创建映像，这些映像就像应用程序的快照。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-128">The main improvement you get from using the Docker engine is that you create images, which are like snapshots of your application, with all its dependencies.</span></span> <span data-ttu-id="d0ae5-129">映像是 Docker 映像（在本例中为 Windows 容器映像）。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-129">The images are Docker images (a Windows container image, in this case).</span></span> <span data-ttu-id="d0ae5-130">映像在容器中运行 ASP.NET 应用，无需返回到源代码。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-130">The images run ASP.NET apps in containers, without going back to source code.</span></span> <span data-ttu-id="d0ae5-131">容器快照成为部署单元。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-131">The container snapshot becomes the unit of deployment.</span></span>

<span data-ttu-id="d0ae5-132">许多组织正在容器化现有的整体式应用程序，原因如下：</span><span class="sxs-lookup"><span data-stu-id="d0ae5-132">Many organizations are containerizing existing monolithic applications for the following reasons:</span></span>

- <span data-ttu-id="d0ae5-133">**通过改进的部署来释放敏捷性**。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-133">**Release agility through improved deployment**.</span></span> <span data-ttu-id="d0ae5-134">容器在开发和运营之间提供一致的部署协定。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-134">Containers offer a consistent deployment contract between development and operations.</span></span> <span data-ttu-id="d0ae5-135">在使用容器时，你不会听到开发人员说：“为什么它能在我的计算机上使用却不能用在生产中？”</span><span class="sxs-lookup"><span data-stu-id="d0ae5-135">When you use containers, you won't hear developers say, "It works on my machine, why not in production?"</span></span> <span data-ttu-id="d0ae5-136">他们可以说：“它作为容器运行，因此将在生产中运行。”</span><span class="sxs-lookup"><span data-stu-id="d0ae5-136">They can say, "It runs as a container, so it will run in production."</span></span> <span data-ttu-id="d0ae5-137">打包的应用程序及其所有依赖项可在任何受支持的基于容器的环境中执行。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-137">The packaged application, with all its dependencies, can be executed in any supported container-based environment.</span></span> <span data-ttu-id="d0ae5-138">它将以预期在所有部署目标（开发、QA、暂存、生产）中运行的方式运行。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-138">It will run the way it was intended to run in all deployment targets (dev, QA, staging, production).</span></span> <span data-ttu-id="d0ae5-139">容器消除了从一个阶段进入下一阶段时产生的大部分摩擦，从而大大改善了部署，让你可以更快地传送。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-139">Containers eliminate most frictions when they move from one stage to the next, which greatly improves deployment, and you can ship faster.</span></span>

- <span data-ttu-id="d0ae5-140">**成本降低**。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-140">**Cost reductions**.</span></span> <span data-ttu-id="d0ae5-141">容器可通过合并和删除现有硬件，或通过以更高的单位硬件密度运行应用程序来降低成本。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-141">Containers lead to lower costs, either by the consolidation and removal of existing hardware, or from running applications at a higher density per unit of hardware.</span></span>

- <span data-ttu-id="d0ae5-142">**可移植性**。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-142">**Portability**.</span></span> <span data-ttu-id="d0ae5-143">容器是模块化的，并且是可移植的。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-143">Containers are modular and portable.</span></span> <span data-ttu-id="d0ae5-144">Docker 容器在任何服务器操作系统（Linux 和 Windows）上、在任何主要公有云（Microsoft Azure、Amazon AWS、Google、IBM）以及本地和私有或混合云环境中均受支持。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-144">Docker containers are supported on any server operating system (Linux and Windows), in any major public cloud (Microsoft Azure, Amazon AWS, Google, IBM), and in on-premises and private or hybrid cloud environments.</span></span>

- <span data-ttu-id="d0ae5-145">**控制性**。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-145">**Control**.</span></span> <span data-ttu-id="d0ae5-146">容器提供在容器级别受控的灵活安全的环境。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-146">Containers offer a flexible and secure environment that's controlled at the container level.</span></span> <span data-ttu-id="d0ae5-147">可以通过在容器上设置执行约束策略来保护、隔离甚至限制容器。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-147">A container can be secured, isolated, and even limited by setting execution constraint policies on the container.</span></span> <span data-ttu-id="d0ae5-148">如讲述 Windows 容器的部分所述，Windows Server 2016 和 Hyper-V 容器提供其他企业支持选项。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-148">As detailed in the section about Windows Containers, Windows Server 2016 and Hyper-V containers offer additional enterprise support options.</span></span>

<span data-ttu-id="d0ae5-149">使用容器开发和维护应用程序时，敏捷性、可移植性和控制性的重大改进最终会导致成本显著降低。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-149">Significant improvements in agility, portability, and control ultimately lead to significant cost reductions when you use containers to develop and maintain applications.</span></span>

## <a name="what-is-docker"></a><span data-ttu-id="d0ae5-150">什么是 Docker？</span><span class="sxs-lookup"><span data-stu-id="d0ae5-150">What is Docker?</span></span>

<span data-ttu-id="d0ae5-151">[Docker](https://www.docker.com/) 是一种[开源项目](https://github.com/docker/docker)，用于将应用程序自动部署为可在云或本地运行的便携式独立容器。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-151">[Docker](https://www.docker.com/) is an [open-source project](https://github.com/docker/docker) that automates the deployment of applications as portable, self-sufficient containers that can run in the cloud or on-premises.</span></span> <span data-ttu-id="d0ae5-152">Docker 也是一家促进和发展这项技术的[公司](https://www.docker.com/)。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-152">Docker is also a [company](https://www.docker.com/) that promotes and evolves this technology.</span></span> <span data-ttu-id="d0ae5-153">该公司与云、Linux 和 Windows 供应商（包括 Microsoft）协作。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-153">The company works in collaboration with cloud, Linux, and Windows vendors, including Microsoft.</span></span>

![显示 Docker 如何在混合云中部署容器的关系图。](./media/deploy-existing-net-apps-as-windows-containers/docker-deploys-containers-all-layers.png)

<span data-ttu-id="d0ae5-155">**图 4-6.**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-155">**Figure 4-6.**</span></span> <span data-ttu-id="d0ae5-156">Docker 在混合云的所有层部署容器</span><span class="sxs-lookup"><span data-stu-id="d0ae5-156">Docker deploys containers at all layers of the hybrid cloud</span></span>

<span data-ttu-id="d0ae5-157">对于熟悉虚拟机的人而言，众多容器可能看起来非常相似。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-157">To someone familiar with virtual machines, containers might appear to be remarkably similar.</span></span> <span data-ttu-id="d0ae5-158">容器在操作系统上运行、具有文件系统，并且可以通过网络访问，就像它是物理或虚拟计算机系统一样。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-158">A container runs an operating system, has a file system, and can be accessed over a network, just like a physical or virtual computer system.</span></span> <span data-ttu-id="d0ae5-159">但是容器背后的技术和概念与虚拟机有很大不同。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-159">However, the technology and concepts behind containers are vastly different from virtual machines.</span></span> <span data-ttu-id="d0ae5-160">从开发人员的角度来看，容器必须被对待得更像是一个进程。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-160">From a developer point of view, a container must be treated more like a single process.</span></span> <span data-ttu-id="d0ae5-161">事实上，容器具有一个进程的单一入口点。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-161">In fact, a container has a single entry point for one process.</span></span>

<span data-ttu-id="d0ae5-162">Docker 容器（为简单起见，下面统称为“容器”  ）可以在 Linux 和 Windows 上本机运行。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-162">Docker containers (for simplicity, *containers*) can run natively on Linux and Windows.</span></span> <span data-ttu-id="d0ae5-163">运行常规容器时，Windows 容器只能在 Windows 主机（主机服务器或虚拟机）上运行，而 Linux 容器只能在 Linux 主机上运行。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-163">When running regular containers, Windows containers can run only on Windows hosts (a host server or a VM), and Linux containers can run only on Linux hosts.</span></span> <span data-ttu-id="d0ae5-164">但是，在最新版本的 Windows Server 和 Hyper-V 容器中，Linux 容器还可以使用目前仅在 Windows Server 容器中可用的 Hyper-V 隔离技术，在 Windows Server 上本机运行。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-164">However, in recent versions of Windows Server and Hyper-V containers, a Linux container can also run natively on Windows Server by using the Hyper-V isolation technology that currently is available only in Windows Server Containers.</span></span>

<span data-ttu-id="d0ae5-165">在不久的将来，同时具有 Linux 和 Windows 容器的混合环境可能会成为现实，甚至变得很常见。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-165">In the near future, mixed environments that have both Linux and Windows containers will be possible and even common.</span></span>

## <a name="benefits-of-windows-containers-for-your-existing-net-applications"></a><span data-ttu-id="d0ae5-166">将 Windows 容器用于现有 .NET 应用程序的好处</span><span class="sxs-lookup"><span data-stu-id="d0ae5-166">Benefits of Windows Containers for your existing .NET applications</span></span>

<span data-ttu-id="d0ae5-167">使用 Windows 容器的好处基本上与从容器中获得的好处大致相同。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-167">The benefits of using Windows Containers are fundamentally the same benefits you get from containers in general.</span></span> <span data-ttu-id="d0ae5-168">使用 Windows 容器可大大提高敏捷、可移植性和控制性。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-168">Using Windows Containers is about greatly improving agility, portability, and control.</span></span>

<span data-ttu-id="d0ae5-169">现有的 .NET 应用程序是指使用 .NET Framework 创建的那些应用程序。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-169">Existing .NET applications refer to those applications that were created using the .NET Framework.</span></span> <span data-ttu-id="d0ae5-170">例如，它们可能是传统的 ASP.NET Web 应用程序，它们不使用相对来说较新的 .NET Core，并在 Linux、Windows 和 MacOS 上跨平台运行。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-170">For example, they might be traditional ASP.NET web applications-they don't use .NET Core, which is newer and runs cross-platform on Linux, Windows, and MacOS.</span></span>

<span data-ttu-id="d0ae5-171">.NET Framework 中的主要依赖项为 Windows。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-171">The main dependency in the .NET Framework is Windows.</span></span> <span data-ttu-id="d0ae5-172">它还具有辅助依赖项，例如 IIS 和传统 ASP.NET 中的 System.Web。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-172">It also has secondary dependencies, like IIS, and System.Web in traditional ASP.NET.</span></span>

<span data-ttu-id="d0ae5-173">必须在 Windows 上运行 .NET Framework 应用程序一段时间。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-173">A .NET Framework application must run on Windows, period.</span></span> <span data-ttu-id="d0ae5-174">若要容器化现有 .NET Framework 应用程序，并且不能或不需要投资 .NET Core 的迁移（“如果它能正常工作，则不迁移”），则关于容器的唯一选择便是使用 Windows 容器。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-174">If you want to containerize existing .NET Framework applications and you can't or don't want to invest in a migration to .NET Core ("If it works properly, don't migrate it"), the only choice you have for containers is to use Windows Containers.</span></span>

<span data-ttu-id="d0ae5-175">因此，Windows 容器的一个主要优点是，为你提供一种通过容器化来现代化在 Windows 上运行的现有 .NET Framework 应用程序的方式。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-175">So, one of the main benefits of Windows Containers is that they offer you a way to modernize your existing .NET Framework applications that are running on Windows-through containerization.</span></span> <span data-ttu-id="d0ae5-176">最后，Windows 容器可以为你带来你所寻求的使用容器的好处 - 敏捷性、可移植性和更好的控制性。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-176">Ultimately, Windows Containers gets you the benefits that you are looking for by using containers-agility, portability, and better control.</span></span>

## <a name="choose-an-os-to-target-with-net-based-containers"></a><span data-ttu-id="d0ae5-177">选择一个操作系统以基于 .NET 的容器为目标</span><span class="sxs-lookup"><span data-stu-id="d0ae5-177">Choose an OS to target with .NET-based containers</span></span>

<span data-ttu-id="d0ae5-178">考虑到 Docker 支持的操作系统的多样性，以及 .NET Framework 与 .NET Core 之间的差异，应根据所使用的框架以特定的操作系统和特定版本为目标。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-178">Given the diversity of operating systems that are supported by Docker, as well as the differences between .NET Framework and .NET Core, you should target a specific OS and specific versions based on the framework you are using.</span></span>

<span data-ttu-id="d0ae5-179">对于 Windows，可使用 Windows Server Core 或 Windows Nano Server。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-179">For Windows, you can use Windows Server Core or Windows Nano Server.</span></span> <span data-ttu-id="d0ae5-180">这些 Windows 版本提供 .NET Framework 或 .NET Core 应用程序可能需要的不同特性（例如 IIS 与像 Kestrel 这样的自托管 Web 服务器）。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-180">These Windows versions provide different characteristics (like IIS versus a self-hosted web server like Kestrel) that might be needed by .NET Framework or .NET Core applications.</span></span>

<span data-ttu-id="d0ae5-181">对于 Linux，正式的 .NET Docker 映像（如 Debian）中提供并支持多个发行版本。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-181">For Linux, multiple distros are available and supported in official .NET Docker images (like Debian).</span></span>

<span data-ttu-id="d0ae5-182">图 4-7 显示了可以作为目标的操作系统版本，具体取决于应用的 .NET Framework 版本。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-182">Figure 4-7 shows OS versions that you can target, depending on the app's version of the .NET Framework.</span></span>

![显示根据 .NET Framework 版本判断以哪个操作系统为目标的关系图。](./media/deploy-existing-net-apps-as-windows-containers/dotnet-framework-operating-systems.png)

<span data-ttu-id="d0ae5-184">**图 4-7.**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-184">**Figure 4-7.**</span></span> <span data-ttu-id="d0ae5-185">根据 .NET Framework 版本判断作为目标的操作系统</span><span class="sxs-lookup"><span data-stu-id="d0ae5-185">Operating systems to target based on .NET Framework version</span></span>

<span data-ttu-id="d0ae5-186">在基于 .NET Framework 应用程序的现有或旧版应用程序的迁移方案中，主要依赖项位于 Windows 和 IIS 上。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-186">In migration scenarios for existing or legacy applications that are based on .NET Framework applications, the main dependencies are on Windows and IIS.</span></span> <span data-ttu-id="d0ae5-187">唯一的选择是使用基于 Windows Server Core 和 .NET Framework 的 Docker 映像。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-187">Your only option is to use Docker images based on Windows Server Core and the .NET Framework.</span></span>

<span data-ttu-id="d0ae5-188">将映像名称添加到 Dockerfile 文件后，可以使用标记来选择操作系统和版本，如以下基于 .NET Framework 的 Windows 容器映像的示例所示：</span><span class="sxs-lookup"><span data-stu-id="d0ae5-188">When you add the image name to your Dockerfile file, you can select the operating system and version by using a tag, as in the following examples for .NET Framework-based Windows container images:</span></span>

> | <span data-ttu-id="d0ae5-189">**标记**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-189">**Tag**</span></span> | <span data-ttu-id="d0ae5-190">**系统和版本**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-190">**System and version**</span></span> |
> |---|---|
> | <span data-ttu-id="d0ae5-191">**microsoft/dotnet-framework:4.x-windowsservercore**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-191">**microsoft/dotnet-framework:4.x-windowsservercore**</span></span> | <span data-ttu-id="d0ae5-192">Windows Server Core 上的 .NET Framework 4.x</span><span class="sxs-lookup"><span data-stu-id="d0ae5-192">.NET Framework 4.x on Windows Server Core</span></span> |
> | <span data-ttu-id="d0ae5-193">**microsoft/aspnet:4.x-windowsservercore**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-193">**microsoft/aspnet:4.x-windowsservercore**</span></span> | <span data-ttu-id="d0ae5-194">Windows Server Core 上的 .NET Framework 4.x 以及其他 ASP.NET 自定义项</span><span class="sxs-lookup"><span data-stu-id="d0ae5-194">.NET Framework 4.x with additional ASP.NET customization, on Windows Server Core</span></span> |

<span data-ttu-id="d0ae5-195">对于 .NET Core（适用于 Linux 和 Windows 的跨平台），标记应如下所示：</span><span class="sxs-lookup"><span data-stu-id="d0ae5-195">For .NET Core (cross-platform for Linux and Windows), the tags would look like the following:</span></span>

> | <span data-ttu-id="d0ae5-196">**标记**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-196">**Tag**</span></span> | <span data-ttu-id="d0ae5-197">**系统和版本**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-197">**System and version**</span></span>
> |---|---|
> | <span data-ttu-id="d0ae5-198">**microsoft/dotnet:2.0.0-runtime**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-198">**microsoft/dotnet:2.0.0-runtime**</span></span> | <span data-ttu-id="d0ae5-199">Linux 上的 .NET Core 2.0 仅运行时</span><span class="sxs-lookup"><span data-stu-id="d0ae5-199">.NET Core 2.0 runtime-only on Linux</span></span> |
> | <span data-ttu-id="d0ae5-200">**microsoft/dotnet:2.0.0-runtime-nanoserver**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-200">**microsoft/dotnet:2.0.0-runtime-nanoserver**</span></span> | <span data-ttu-id="d0ae5-201">Windows Nano Server 上的 .NET Core 2.0 仅运行时</span><span class="sxs-lookup"><span data-stu-id="d0ae5-201">.NET Core 2.0 runtime-only on Windows Nano Server</span></span> |

### <a name="multi-arch-images"></a><span data-ttu-id="d0ae5-202">多体系结构映像</span><span class="sxs-lookup"><span data-stu-id="d0ae5-202">Multi-arch images</span></span>

<span data-ttu-id="d0ae5-203">从 2017 年年中开始，还可以在 Docker 中使用一项称为[多体系结构](https://github.com/moby/moby/issues/15866)映像的新功能。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-203">Beginning in mid-2017, you can also use a new feature in Docker called [multi-arch](https://github.com/moby/moby/issues/15866) images.</span></span> <span data-ttu-id="d0ae5-204">.NET Core Docker 映像可使用多体系结构标记。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-204">.NET Core Docker images can use multi-arch tags.</span></span> <span data-ttu-id="d0ae5-205">你的 Dockerfile 文件不再需要定义你作为目标的操作系统。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-205">Your Dockerfile files no longer need to define the operating system that you are targeting.</span></span> <span data-ttu-id="d0ae5-206">多体系结构功能允许在多个机器配置中使用单个标记。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-206">The multi-arch feature allows a single tag to be used across multiple machine configurations.</span></span> <span data-ttu-id="d0ae5-207">例如，对于多体系结构，你可以使用通用标记：microsoft/dotnet:2.0.0-runtime  。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-207">For instance, with multi-arch, you can use one common tag: **microsoft/dotnet:2.0.0-runtime**.</span></span> <span data-ttu-id="d0ae5-208">如果从 Linux 容器环境拉取该标记，则会获得基于 Debian 的映像。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-208">If you pull that tag from a Linux container environment, you get the Debian-based image.</span></span> <span data-ttu-id="d0ae5-209">如果从 Windows 容器环境拉取该标记，则会获得基于 Nano Server 的映像。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-209">If you pull that tag from a Windows container environment, you get the Nano Server-based image.</span></span>

<span data-ttu-id="d0ae5-210">对于 .NET Framework 映像，因为传统 .NET Framework 仅支持 Windows，所以不能使用多体系结构功能。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-210">For .NET Framework images, because the traditional .NET Framework supports only Windows, you cannot use the multi-arch feature.</span></span>

## <a name="windows-container-types"></a><span data-ttu-id="d0ae5-211">Windows 容器类型</span><span class="sxs-lookup"><span data-stu-id="d0ae5-211">Windows container types</span></span>

<span data-ttu-id="d0ae5-212">与 Linux 容器一样，Windows Server 容器使用 Docker 引擎进行管理。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-212">Like Linux containers, Windows Server containers are managed by using Docker Engine.</span></span> <span data-ttu-id="d0ae5-213">与 Linux 容器不同，Windows 容器包括两个不同的容器类型或运行时间 - Windows Server 容器和 Hyper-V 隔离。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-213">Unlike Linux containers, Windows containers include two different container types, or run times-Windows Server containers and Hyper-V isolation.</span></span>

<span data-ttu-id="d0ae5-214">Windows Server 容器  ：通过进程和命名空间隔离技术提供应用程序隔离。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-214">**Windows Server containers**: Provides application isolation through process and namespace isolation technology.</span></span> <span data-ttu-id="d0ae5-215">Windows Server 容器与容器主机和主机上运行的所有容器共享内核。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-215">A Windows Server container shares a kernel with the container host and all containers that are running on the host.</span></span> <span data-ttu-id="d0ae5-216">这些容器不提供恶意安全边界，且不用于隔离不受信任的代码。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-216">These containers do not provide a hostile security boundary and should not be used to isolate untrusted code.</span></span> <span data-ttu-id="d0ae5-217">由于共享内核空间，这些容器需要相同的内核版本和配置。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-217">Because of the shared kernel space, these containers require the same kernel version and configuration.</span></span>

<span data-ttu-id="d0ae5-218">**Hyper-V 隔离**：通过在高度优化的虚拟机中运行各容器来扩展 Windows Server 容器提供的隔离。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-218">**Hyper-V isolation**: Expands on the isolation provided by Windows Server Containers by running each container on a highly optimized VM.</span></span> <span data-ttu-id="d0ae5-219">在此配置中，容器主机的内核不与同一主机上的其他容器共享。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-219">In this configuration, the kernel of the container host is not shared with other containers on the same host.</span></span> <span data-ttu-id="d0ae5-220">这些容器针对恶意多租户托管而设计，具有与虚拟机相同的安全保证。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-220">These containers are designed for hostile multitenant hosting, with the same security assurances of a VM.</span></span> <span data-ttu-id="d0ae5-221">因为这些容器不与主机或主机上的其他容器共享内核，所以它们可以运行具有不同版本和配置（具有受支持的版本）的内核。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-221">Because these containers don't share the kernel with the host or other containers on the host, they can run kernels with different versions and configurations (with supported versions).</span></span> <span data-ttu-id="d0ae5-222">例如，Windows 10 上的所有 Windows 容器都使用 Hyper-V 隔离来利用 Windows Server 内核版本和配置。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-222">For example, all Windows containers on Windows 10 use Hyper-V isolation to utilize the Windows Server kernel version and configuration.</span></span>

<span data-ttu-id="d0ae5-223">无论有无 Hyper-V 隔离，在 Windows 上运行容器都是运行时决策。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-223">Running a container on Windows with or without Hyper-V isolation is a run-time decision.</span></span> <span data-ttu-id="d0ae5-224">你可能最初选择使用 Hyper-V 隔离创建容器，然后在运行时选择将其作为 Windows Server 容器运行。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-224">You might choose to create the container with Hyper-V isolation initially, and at run time, choose to run it as a Windows Server container instead.</span></span>

### <a name="additional-resources"></a><span data-ttu-id="d0ae5-225">其他资源</span><span class="sxs-lookup"><span data-stu-id="d0ae5-225">Additional resources</span></span>

- <span data-ttu-id="d0ae5-226">**Windows 容器文档**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-226">**Windows Containers documentation**</span></span>

    <https://docs.microsoft.com/virtualization/windowscontainers/>

- <span data-ttu-id="d0ae5-227">**Windows 容器基础知识**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-227">**Windows Containers fundamentals**</span></span>

    <https://docs.microsoft.com/virtualization/windowscontainers/about/>

- <span data-ttu-id="d0ae5-228">**信息图：Microsoft 和容器**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-228">**Infographic: Microsoft and containers**</span></span>

    <https://info.microsoft.com/rs/157-GQE-382/images/Container%20infographic%201.4.17.pdf>

## <a name="the-container-ecosystem-in-azure"></a><span data-ttu-id="d0ae5-229">Azure 中的容器生态系统</span><span class="sxs-lookup"><span data-stu-id="d0ae5-229">The container ecosystem in Azure</span></span>

<span data-ttu-id="d0ae5-230">在前面的部分，已经介绍了 Docker 容器的优点，以及适用于 .NET 应用程序的特定容器映像的详细信息。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-230">In previous sections, it's been explained what the benefits of Docker containers are as well as details on the specific container images for .NET applications.</span></span> <span data-ttu-id="d0ae5-231">所有这些一般信息都是为了开发或容器化应用程序所需的基础信息。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-231">All that generic information is fundamental in order to develop or containerize an application.</span></span>
<span data-ttu-id="d0ae5-232">但是，在考虑生产部署环境甚至 QA 和开发/测试环境时，Microsoft Azure 提供了各种开放且广泛的选择，即云中的完整容器生态系统（如下图所示）。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-232">However, when thinking about the production deployment environment or even QA and Dev/Test environments, Microsoft Azure provides an open and broad variety of choices, a full container ecosystem in the cloud (shown in the diagram below).</span></span> <span data-ttu-id="d0ae5-233">根据具体的应用程序需求，应选择一个或另一个 Azure 产品。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-233">Depending on your specific application's needs, you should choose one or another Azure product.</span></span>

![Azure 中的容器生态系统的关系图。](./media/deploy-existing-net-apps-as-windows-containers/azure-container-ecosystem.png)

<span data-ttu-id="d0ae5-235">**图 4-7.5.**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-235">**Figure 4-7.5.**</span></span> <span data-ttu-id="d0ae5-236">Azure 中的容器生态系统</span><span class="sxs-lookup"><span data-stu-id="d0ae5-236">The container ecosystem in Azure</span></span>

<span data-ttu-id="d0ae5-237">在 Azure 中的容器生态系统中，以下支持容器的产品被视为基础结构：</span><span class="sxs-lookup"><span data-stu-id="d0ae5-237">From the container ecosystem in Azure, the following products supporting containers that are considered infrastructure:</span></span>

- <span data-ttu-id="d0ae5-238">**Azure 容器实例 (ACI)**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-238">**Azure Container Instances (ACI)**</span></span>
- <span data-ttu-id="d0ae5-239">**Azure 虚拟机**（在容器的支持下）</span><span class="sxs-lookup"><span data-stu-id="d0ae5-239">**Azure Virtual Machines** (With container's support)</span></span>
- <span data-ttu-id="d0ae5-240">**Azure 虚拟机规模集**（在容器的支持下）</span><span class="sxs-lookup"><span data-stu-id="d0ae5-240">**Azure Virtual Machine Scale Sets** (With container's support)</span></span>

<span data-ttu-id="d0ae5-241">从这三个产品来看，ACI 提供莫大的好处，即不需要维护基础操作系统、也不需要升级/修补等，但 ACI 仍被定位于基础结构级别，如本书后面部分所述。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-241">From those three, ACI provides a great benefit, which is the fact that you don't need to maintain the underlying OS, no need for you to upgrade/patch, etc. but ACI still is positioned in the infrastructure level, as better explained in the upcoming sections of this book.</span></span>

<span data-ttu-id="d0ae5-242">不过 Azure 中支持容器的产品在 PaaS（平台即服务）级别的定位更重要：</span><span class="sxs-lookup"><span data-stu-id="d0ae5-242">The products in Azure supporting containers that are at the same time positioned more in the PaaS (Platform as a Service) level are:</span></span>

- <span data-ttu-id="d0ae5-243">**Azure 应用服务**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-243">**Azure App Service**</span></span>
- <span data-ttu-id="d0ae5-244">**Azure Kubernetes 服务（AKS 和 ACS）**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-244">**Azure Kubernetes Service (AKS and ACS)**</span></span>
- <span data-ttu-id="d0ae5-245">**Azure Batch**</span><span class="sxs-lookup"><span data-stu-id="d0ae5-245">**Azure Batch**</span></span>

<span data-ttu-id="d0ae5-246">接下来，Azure 容器注册表是 Azure 中托管的高度可缩放容器注册表，可在注册和部署自定义容器映像时在以前的所有产品中使用。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-246">Then, Azure Container Registry is a high scalable container registry hosted in Azure that you can use from all the previous products when registering and deploying your custom container images.</span></span>

<span data-ttu-id="d0ae5-247">此外，还可以在容器中使用 Azure 中的其他托管服务，如 Azure SQL 数据库、Azure Redis 缓存、Azure Cosmos DB 等。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-247">In addition, from your containers, you can consume other managed services in Azure like Azure SQL Database, Azure Redis cache, Azure Cosmos DB, etc.</span></span> <span data-ttu-id="d0ae5-248">此外还有 Azure 市场中的第三方解决方案/平台，如 Cloud Foundry 和 OpenShift，还可以在其中使用 Azure 内的容器。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-248">plus there are third-party solutions/platforms available in Azure Marketplace like Cloud Foundry and OpenShift where you can also use containers within Azure.</span></span>

<span data-ttu-id="d0ae5-249">在接下来的部分，可以浏览 Microsoft 关于何时使用每个 Azure 产品和解决方案的建议，尤其是在以 Windows 容器为目标时。</span><span class="sxs-lookup"><span data-stu-id="d0ae5-249">In the next sections, you can explore Microsoft's recommendations on when to use each of those Azure products and solutions specifically when targeting Windows Containers.</span></span>

>[!div class="step-by-step"]
><span data-ttu-id="d0ae5-250">[上一页](what-about-cloud-native-applications.md)
>[下一页](when-not-to-deploy-to-windows-containers.md)</span><span class="sxs-lookup"><span data-stu-id="d0ae5-250">[Previous](what-about-cloud-native-applications.md)
[Next](when-not-to-deploy-to-windows-containers.md)</span></span>
